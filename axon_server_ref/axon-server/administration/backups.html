<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backups</title>
    <link rel="prev" href="backup-and-messaging-only-nodes.html">
    <link rel="next" href="recovery.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


  </head>
  <body class="article">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://library.axoniq.io">ðŸ“š AxonIQ Library</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../axon_framework_ref/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../index.html">Axon Server</a>
                <a class="navbar-item" href="../../../synapse_ref/latest/index.html">Axon Synapse</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../axon_framework_fundamentals/index.html">Axon Framework Fundamentals</a>
                <a class="navbar-item" href="../../../axon-server-fundamentals/index.html">Axon Server Fundamentals</a>
                <a class="navbar-item" href="../../../synapse-quick-start/latest/index.html">Axon Synapse Quick Start</a>
                <a class="navbar-item" href="../../../axoniq-console-getting-started/main/index.html">AxonIQ Console Getting Started</a>
                <a class="navbar-item" href="../../../giftcard/index.html">Building a Giftcard Application</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="axon_server_ref" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Axon Server</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/local-installation/README.html">Local installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/docker-k8s/README.html">Docker / K8s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="admin-configuration/configuration.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="admin-configuration/grpc-api.html">gRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="monitoring/axon-server-metrics.html">Axon Server Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="monitoring/diagnostics.html">Diagnostics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tiered-storage.html">Tiered Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-transformation.html">Event Transformation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backup-and-messaging-only-nodes.html">Backup and Messaging-Only Nodes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugins.html">Axon Server Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-ee.html">Access Control for Axon Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-clients.html">Security for Axon Framework Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-cli.html">Access Control and the CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-api.html">Access Control on the REST and gRPC APIs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-ldap.html">Axon Server EE - LDAP Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/access-control-oauth2.html">Axon Server EE - OAuth Extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../grpc-api.html">gRPC API</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Axon Server</a></li>
    <li><a href="README.html">Administration</a></li>
    <li><a href="backups.html">Backups</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master</button>
  <div class="version-menu">
    <a class="version is-current" href="backups.html">master</a>
    <a class="version is-missing" href="../../0/index.html">older releases</a>
  </div>
</div>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu">

    <a class="action" href="https://discuss.axoniq.io/search?q&#x3D;https%3A%2F%2Flibrary.axoniq.io%2Faxon_server_ref%2Faxon-server%2Fadministration%2Fbackups.html%20%23library" target="discuss_search">View Discussions</a>
    <a class="action" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Backups%22%20library%20page%20...&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BBackups%5D(https%3A%2F%2Flibrary.axoniq.io%2Faxon_server_ref%2Faxon-server%2Fadministration%2Fbackups.html)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


</div>
    <div class="content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Backups</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><!-- vale Google.Passive = NO -->
<!-- vale Google.Will = NO -->
<!-- vale Google.We = NO -->
<!-- vale Google.EnDash = NO --></p>
</div>
<div class="paragraph">
<p>The core strategy employed by AxonServer to keep data available, is to replicate it over various cluster nodes.
These nodes should be in availability zones that are isolated from each other in relevant disaster scenarios.
With Axon Server Enterprise 4.3, the introduction of specific <a href="backup-and-messaging-only-nodes.adoc">backup_nodes</a> makes it easier to set up and operate AxonServer without ever making explicit backups to off-line media.
Nevertheless, there are also environments where such backups are a strict requirement and for that reason, AxonServer does support it.</p>
</div>
<div class="paragraph">
<p>There are three types of items that need to be backed up</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#control-database">Control Database</a></p>
</li>
<li>
<p><a href="#event-stream-segments">Event Store Segments</a></p>
</li>
<li>
<p><a href="#log-entry-segments">Log Entry Segments</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To support the creation of consistent backups, Axon Server provides a REST API.
This API provides three controllers to perform backup operations</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Backup Info Rest Controller</em> - End point for Axon SE/EE for event stream segment backup</p>
</li>
<li>
<p><em>Backup Control DB Rest Controller</em> - End point for Axon SE for control database backup</p>
</li>
<li>
<p><em>Cluster Backup Info Rest Controller</em> - End points for Axon EE for control database and log entry segment backup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The API documentation is accessible at http:[server]:[port]/swagger-ui.html.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="control-database"><a class="anchor" href="#control-database"></a>Control database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The control database is a relational H2 database and contains important configuration information for your Axon Server SE/EE deployment.
Although it&#8217;s stored in a single file, this file cannot be simply copied for backup as it may not be in a safe state.</p>
</div>
<div class="paragraph">
<p>For Axon Server SE, a call to the POST endpoint <code>http://[server]/createControlDbBackup</code> forces the creation of a proper backup file.</p>
</div>
<div class="paragraph">
<p>For Axon Server EE, a call to the POST endpoint `http://[server]/v1/backup/createControlDbBackup`forces the creation of a proper backup file.
The <em>[server]</em> could be any node within the cluster which serves the <em>_admin</em> context.</p>
</div>
<div class="paragraph">
<p>In both cases, it returns the full path to that file (.zip), which can then be used to move that file to another storage medium.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="event-stream-segments"><a class="anchor" href="#event-stream-segments"></a>Event store segments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The event store segments are either closed and immutable, or still open for new events.
For the closed segments, it is feasible to only back up the ones that haven&#8217;t been backed-up yet, since the ones that have been are guaranteed not to change.</p>
</div>
<div class="paragraph">
<p>For both Axon Server SE/EE, a call to the GET endpoint <code>http://[server]/v1/backup/filenames</code> with event type (either <code>EVENT</code> or <code>SNAPSHOT</code>), the context name and optionally the last segment that has already been backed up will return a list of file names belonging to segments that haven&#8217;t been backed up yet, but which are now safe to backup by simply copying them.</p>
</div>
<div class="paragraph">
<p>For Axon SE, the <em>[server]</em> is the single Axon Server SE node while in the case of Axon EE, the <em>[server]</em> could be any node that is a PRIMARY member node for the context that needs to be backed up.</p>
</div>
<div class="paragraph">
<p>In addition, you may choose to back up the current segment file that is being written to.
These are files with names larger than the last entry returned to the filenames from the backup endpoint.
It is important to overwrite this file with subsequent backups, because no guarantees can be given about the completeness of this file.
This means the filename of this file should not be used to construct the "lastSegmentBackedUp" in subsequent requests to the backup endpoint.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note</strong></p>
</div>
<div class="paragraph">
<p>From Axon Server SE version 4.5.12 / Axon Server EE version 4.5.17 onwards there is a new endpoint available: <code>/v1/backup/eventstore</code>.
This endpoint returns a JSON object with the files to back up, including the currently active event store segment.
It also returns the number of last closed event store segment.
This number can be used in subsequent backups to retrieve files updated since the last backup.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="log-entry-segments"><a class="anchor" href="#log-entry-segments"></a>Log entry segments (only for Axon Server clusters)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unlike the event stream segments, the log entry segments backup should not be done incrementally.
All the files are replaced by the next backup.
The log entry segments backup is supported by the GET endpoint <code>http:[server]/v1/backup/log/filenames</code>.
It takes the context name and returns a list of file names that completely replace the previous backup for that context.
The <em>[server]</em> could be any node that is a PRIMARY member node for the context that needs to be backed up.</p>
</div>
<div class="paragraph">
<p>Even if the recent file has incomplete data, a node will be able to recover a consistent state from such a file and will initialize itself at the position immediately after the last complete write.
The replication process (if present) will ensure subsequent entries are automatically synchronized.</p>
</div>
<div class="paragraph">
<p>Because the control database contains a pointer to the last log entry that is known to be stored safely on the cluster (the commit index), the proper order of doing this is to first create the control database backup and then backing up the log entry segments and the event stream segments.</p>
</div>
<div class="paragraph">
<p>This will ensure that the log entry segments may have entries beyond the commit index (which is ok) but there are not missing entries before the commit index (which would be bad).
The log entries segments must be backed up within <em>*30 minutes*</em> after the backup of the controlDB, to prevent the log compaction procedure causes data inconsistencies.</p>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="backup-and-messaging-only-nodes.html">Backup and Messaging-Only Nodes</a></span>
  <span class="next"><a href="recovery.html">Recovery</a></span>
</nav>
    </article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
