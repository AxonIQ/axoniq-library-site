<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flow Control</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-server-reference/v2025.1/axon-server/performance/flow-control/">
    <link rel="prev" href="../tuning-event-processing/">
    <link rel="next" href="../../migration/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../../_'</script>


<link rel="icon" href="../../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../">Axon Server</a>
                <a class="navbar-item" href="../../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../">Axon Server Reference</a></li>
    <li><a href="../">Performance</a></li>
    <li><a href="./">Flow Control</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">

    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Flow%20Control" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Flow%20Control%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BFlow%20Control%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-server-reference%2Fv2025.1%2Faxon-server%2Fperformance%2Fflow-control%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v2025.1</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../../../development/axon-server/performance/flow-control/">development</a>
    <a class="version item is-current" href="./">v2025.1</a>
    <a class="version item" href="../../../../v2025.0/axon-server/performance/flow-control/">v2025.0</a>
    <a class="version item" href="../../../../v2024.2/axon-server/performance/flow-control/">v2024.2</a>
    <a class="version item" href="../../../../v2024.1/axon-server/performance/flow-control/">v2024.1</a>
    <a class="version item is-missing" href="../../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-server-reference" data-version="v2025.1">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../">Axon Server</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../installation/">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation/local-installation/">Local installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation/docker-k8s/">Docker / K8s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../administration/">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../administration/admin-configuration/">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/admin-configuration/configuration/">System properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/admin-configuration/command-line-interface/">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/admin-configuration/rest-api/">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/admin-configuration/grpc-api/">gRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../administration/monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/monitoring/actuator-endpoints/">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/monitoring/axon-server-metrics/">Axon Server Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/monitoring/grpc-metrics/">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/monitoring/heartbeat-monitoring/">Heartbeat Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/monitoring/diagnostics/">Diagnostics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/multi-context/">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/tiered-storage/">Tiered Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/event-transformation/">Event Transformation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/tagging/">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/backups/">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/recovery/">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/plugins/">Axon Server Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/persistent-streams/">Persistent Streams</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../administration/logging/">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../administration/logging/logging-format/">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../administration/error-codes/">Error Codes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../administration/integration/">Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../openapi/integration-api/">Axon Server Integration HTTP API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../openapi/integration-outbound-api/">Axon Server Outbound HTTP API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../clustering/">Clustering</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../clustering/cluster-basics/">Cluster Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../clustering/node-roles/">Node Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../clustering/replication-groups/">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../clustering/replication-logs/">Replication Logs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../security/">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/ssl/">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-ee/">Access Control for Axon Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-clients/">Security for Axon Framework Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-cli/">Access Control and the CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-api/">Access Control on the REST and gRPC APIs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-ldap/">Axon Server EE - LDAP Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/access-control-oauth2/">Axon Server EE - OAuth Extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning-event-processing/">Event Segments</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../migration/">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/non-axon-server-to-axon-server/">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../architecture/">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture/config-database/">Config Database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../troubleshooting/">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../rn-as-major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../rn-as-minor-releases/">Patch Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Flow Control</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><!-- vale Google.Passive = NO -->
<!-- vale Google.Will = NO --></p>
</div>
<div class="paragraph">
<p>Flow control is the process of managing the rate of data transmission between two nodes to prevent a fast sender from overwhelming a slow receiver.</p>
</div>
<div class="paragraph">
<p>In the messaging platform flow control is possible both between the messaging platform and the message handlers, and between the nodes in the messaging platform cluster.</p>
</div>
<div class="paragraph">
<p><em>Messaging Platform - Messaging Handler:</em></p>
</div>
<div class="paragraph">
<p>The client (the Axon Application) needs to set the following properties to configure flow control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>axon.axonserver.initial-nr-of-permits</code> [1000] - number of messages that the server can initially send to client.</p>
</li>
<li>
<p><code>axon.axonserver.nr-of-new-permits</code> [500] - additional number of messages that the server can send to client.</p>
</li>
<li>
<p><code>axon.axonserver.new-permits-threshold</code> [500] - when client reaches this threshold in remaining messages, it sends a request with additional number of messages to receive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Axon Server Nodes:</em></p>
</div>
<div class="paragraph">
<p>Set the following properties to control 'list aggregate events' prefetch rate, per aggregate and per segment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>axoniq.axonserver.event.aggregate.prefetch</code> [5] - Ensures that backpressure signals from clients are split into batches.
The initial request amount is {prefetch}*5, and subsequent (or replenishing) request amount is {prefetch}</p>
</li>
<li>
<p><code>axoniq.axonserver.event.events-per-segment-prefetch</code> [10] - the maximum prefetched events from each opened event segment (max two opened segments in parallel)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Set the following properties to set flow control on the synchronization between nodes in an Axon Server cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>axoniq.axonserver.commandFlowControl.initial-nr-of-permits</code> [10000] - number of messages that the master can initially send to replica.</p>
</li>
<li>
<p><code>axoniq.axonserver.commandFlowControl.nr-of-new-permits</code> [5000] - additional number of messages that the master can send to replica.</p>
</li>
<li>
<p><code>axoniq.axonserver.commandFlowControl.new-permits-threshold</code> [5000] - when replica reaches this threshold in remaining messages, it sends a request with additional number of messages to receive.</p>
</li>
<li>
<p><code>axoniq.axonserver.queryFlowControl.initial-nr-of-permits</code> [10000] - number of messages that the master can initially send to replica.</p>
</li>
<li>
<p><code>axoniq.axonserver.queryFlowControl.nr-of-new-permits</code> [5000] - additional number of messages that the master can send to replica.</p>
</li>
<li>
<p><code>axoniq.axonserver.queryFlowControl.new-permits-threshold</code> [5000] - when replica reaches this threshold in remaining messages, it sends a request with additional number of messages to receive.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_streaming_query"><a class="anchor" href="#_streaming_query"></a>Streaming query</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flow control and stream cancellation features are only available with Axon Server 4.6.0 and up.
Under the hood, backpressure does <code>Hop to Hop</code> signal propagation (see below) and inherits gRPC&#8217;s
<a href="https://developers.google.com/web/fundamentals/performance/http2/#flow_control">HTTP2-based backpressure model</a>.</p>
</div>
<div class="paragraph">
<p>As a result, backpressure will not behave intuitively and will not propagate exact request signals from consumer to producer.
HTTP/2 and Netty flow control have internal buffers based on message size.
In turn, Axon Framework and Axon Server prefetch messages into internal buffers based on message count.
The result is that the producer will send a number of messages until it fills all the buffers.
Only then will backpressure kick in.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Hop to hop</strong></p>
</div>
<div class="paragraph">
<p>The backpressure signal is propagated per-hop.
This approach makes it not an end-to-end connection that allows intermediate Axon Server instances to handle backpressure between two connections and pre-fetch additional messages to increase overall performance.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that similar to backpressure, the cancellation signal is also per hop.
This means it&#8217;s propagated over the network to Axon Server and then to the producer.
This solution will thus introduce some latency in the stream cancellation.
Even though there is potential latency involved in cancellation, any messages produced <strong>after</strong> the consumer signaled cancellation will be ignored.</p>
</div>
<div class="sect2">
<h3 id="_compatibility_with_axon_framework"><a class="anchor" href="#_compatibility_with_axon_framework"></a>Compatibility with Axon Framework</h3>
<div class="ulist">
<ul>
<li>
<p>In order to stream query results, the producer of those results, the consumer, and all Axon Server nodes in between must be at 4.6.0 or higher version.
In addition to that, both, consumer and producer <strong>must</strong> have Project Reactor on the classpath.</p>
</li>
<li>
<p>If the consumer is not at 4.6.0 or higher version, and/or does not have a Project Reactor on the classpath, it is not possible to invoke streaming of query results at all.</p>
</li>
<li>
<p>In all other cases, it is possible to invoke streaming of query results, but it will fallback to the point-to-point query behavior.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../tuning-event-processing/">Event Segments</a></span>
  <span class="next"><a href="../../migration/">Migration</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../../_/js/site.js" data-ui-root-path="../../../../../_"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../.." data-snippet-length="100" data-stylesheet="../../../../../_/css/search.css"></script>
<script async src="../../../../../search-index.js"></script>
    </div>
  </body>
</html>
