<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Command Handlers</title>
    <link rel="prev" href="command-dispatchers.html">
    <link rel="next" href="infrastructure.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../_/img/apple-touch-icon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../_'</script>


  </head>
  <body class="article">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../_/img/logo-dark2x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../home/basics.html">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Guides</a>
          <div class="navbar-dropdown card">
              <a class="navbar-item" href="../../home/guides/axon-framework.html">Axon Framework</a>
              <a class="navbar-item" href="../../home/guides/axon-server.html">Axon Server</a>
              <a class="navbar-item" href="../../home/guides/migration.html">Migration</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../introduction.html">Axon Framework</a>
                <a class="navbar-item" href="../../axon_server_ref/v2024.1/index.html">Axon Server</a>
                <a class="navbar-item" href="../../synapse_ref/latest/index.html">Axon Synapse</a>
                <a class="navbar-item" href="../../axoniq_console_ref/main/index.html">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../introduction.html">Axon Framework Reference</a></li>
    <li><a href="README.html">Commands</a></li>
    <li><a href="command-handlers.html">Command Handlers</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/master/docs/old-reference-guide/modules/axon-framework-commands/pages/command-handlers.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;https%3A%2F%2Fdocs.axoniq.io%2Faxon_framework_ref%2Faxon-framework-commands%2Fcommand-handlers.html%20%23library" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Command%20Handlers%22%20library%20page%20...&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BCommand%20Handlers%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon_framework_ref%2Faxon-framework-commands%2Fcommand-handlers.html)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">development</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item is-current" href="command-handlers.html">development</a>
    <a class="version item is-missing" href="../0/index.html">older releases</a>
  </div>
</div>
</div>
<div class="body">
<div class="nav-container" data-component="axon_framework_ref" data-version="master">
  <aside class="nav card">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../introduction.html">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../upgrading-to-4-7.html">Upgrading to Axon Framework 4.7</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/subscribing.html">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/streaming.html">Streaming Event Processor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors.html">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
    <div class="content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Command Handlers</h1>
            <div class="sect1">
<h2 id="_aggregate_command_handlers"><a class="anchor" href="#_aggregate_command_handlers"></a>Aggregate command handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Command Handlers can be placed in regular components, it is recommended to define the Command Handlers directly on the Aggregate that contains the state to process this command.</p>
</div>
<div class="paragraph">
<p>To define a Command Handler in an Aggregate, simply annotate the method which should handle the command with <code>@CommandHandler</code>.
The <code>@CommandHandler</code> annotated method will become a Command Handler for Command Messages where the <em>command name</em> matches fully qualified class name of the first parameter of that method.
Thus, a method signature of <code>void handle(RedeemCardCommand cmd)</code> annotated with <code>@CommandHandler</code>, will be the Command Handler of the <code>RedeemCardCommand</code> Command Messages.</p>
</div>
<div class="paragraph">
<p>Command Messages can also be <a href="command-dispatchers.html" class="xref page">dispatched</a> with different <em>command names</em>.
To be able to handle those correctly, the <code>String commandName</code> value can be specified in the <code>@CommandHandler</code> annotation.</p>
</div>
<div class="paragraph">
<p>In order for Axon to know which instance of an Aggregate type should handle the Command Message, the property carrying the Aggregate Identifier in the command object <strong>must</strong> be annotated with <code>@TargetAggregateIdentifier</code>.
The annotation may be placed on either the field or an accessor method (for example, a getter) in the Command object.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Routing in a distributed environment</strong></p>
</div>
<div class="paragraph">
<p>Regardless of the type of command, as soon as you start distributing your application (through Axon Server, for example), it is recommended to specify a routing key on the command.
This is the job of the <code>@TargetAggregateIdentifier</code>, but in absence of a field worthy of the annotation, the <code>@RoutingKey</code> annotation should be added to ensure the command can be routed.</p>
</div>
<div class="paragraph">
<p>If neither annotation works for your use case, a different <code>RoutingStrategy</code> can be configured, as is explained in the <a href="infrastructure.html#routing-strategy" class="xref page">Routing Strategy</a> section.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Taking the <code>GiftCard</code> Aggregate as an example, we can identify two Command Handlers on the Aggregate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.modelling.command.AggregateIdentifier;

import static org.axonframework.modelling.command.AggregateLifecycle.apply;

public class GiftCard {

    @AggregateIdentifier
    private String id;
    private int remainingValue;

    @CommandHandler
    public GiftCard(IssueCardCommand cmd) {
        apply(new CardIssuedEvent(cmd.getCardId(), cmd.getAmount()));
    }

    @CommandHandler
    public void handle(RedeemCardCommand cmd) {
        if (cmd.getAmount() &lt;= 0) {
            throw new IllegalArgumentException("amount &lt;= 0");
        }
        if (cmd.getAmount() &gt; remainingValue) {
            throw new IllegalStateException("amount &gt; remaining value");
        }
        apply(new CardRedeemedEvent(id, cmd.getTransactionId(), cmd.getAmount()));
    }
    // omitted event sourcing handlers
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Command objects, <code>IssueCardCommand</code> and <code>RedeemCardCommand</code>, which <code>GiftCard</code> handles have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.modelling.command.TargetAggregateIdentifier;

public class IssueCardCommand {

    @TargetAggregateIdentifier
    private final String cardId;
    private final Integer amount;

    public IssueCardCommand(String cardId, Integer amount) {
        this.cardId = cardId;
        this.amount = amount;
    }
    // omitted getters, equals/hashCode, toString functions
}

public class RedeemCardCommand {

    @TargetAggregateIdentifier
    private final String cardId;
    private final String transactionId;
    private final Integer amount;

    public RedeemCardCommand(String cardId, String transactionId, Integer amount) {
        this.cardId = cardId;
        this.transactionId = transactionId;
        this.amount = amount;
    }
    // omitted getters, equals/hashCode, toString functions
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>cardId</code> present in both commands is the reference to a <code>GiftCard</code> instance and thus is annotated with the <code>@TargetAggregateIdentifier</code> annotation.
Commands that create an Aggregate instance do not need to identify the target aggregate identifier, as there is no Aggregate in existence yet.
It is nonetheless recommended for consistency to annotate the Aggregate Identifier on them as well.</p>
</div>
<div class="paragraph">
<p>If you prefer to use another mechanism for routing commands, the behavior can be overridden by supplying a custom <code>CommandTargetResolver</code>.
This class should return the Aggregate Identifier and expected version (if any) based on a given command.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Aggregate Creation Command Handlers</strong></p>
</div>
<div class="paragraph">
<p>When the <code>@CommandHandler</code> annotation is placed on an aggregate&#8217;s constructor, the respective command will create a new instance of that aggregate and add it to the repository.
Those commands do not require to target a specific aggregate instance.
Therefore, those commands need neither the <code>@TargetAggregateIdentifier</code> nor the <code>@TargetAggregateVersion</code> annotation.
Furthermore, a custom <code>CommandTargetResolver</code> will not be invoked for these commands.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="_business_logic_and_state_changes"><a class="anchor" href="#_business_logic_and_state_changes"></a>Business logic and state changes</h3>
<div class="paragraph">
<p>Within an Aggregate there is a specific location to perform business logic validation and Aggregate state changes.
The Command Handlers should <em>decide</em> whether the Aggregate is in the correct state.
If yes, an Event is published.
If not, the Command might be ignored or an exception could be thrown, depending on the needs of the domain.</p>
</div>
<div class="paragraph">
<p>State changes should <strong>not</strong> occur in <em>any</em> Command Handling function.
The Event Sourcing Handlers should be the only methods where the Aggregate&#8217;s state is updated.
Failing to do so means the Aggregate would miss state changes when it is being sourced from its events.</p>
</div>
<div class="paragraph">
<p>The <a href="../testing/commands-events.html" class="xref page"> Aggregate Test Fixture</a> will guard against unintentional state changes in Command Handling functions.
It is thus advised to provide thorough test cases for <em>any</em> Aggregate implementation.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>When to handle an Event</strong></p>
</div>
<div class="paragraph">
<p>The only state an Aggregate requires is the state it needs to make a decision.
Handling an Event published by the Aggregate is thus only required if the state change the Event resembles is needed to drive future validation.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_applying_events_from_event_sourcing_handlers"><a class="anchor" href="#_applying_events_from_event_sourcing_handlers"></a>Applying events from event-sourcing handlers</h3>
<div class="paragraph">
<p>In some cases, especially when the Aggregate structure grows beyond just a couple of Entities, it is cleaner to react on events being published in other Entities of the same Aggregate (multi Entity Aggregates are explained in more detail <a href="modeling/multi-entity-aggregates.html" class="xref page">here</a>).
However, since the Event Handling methods are also invoked when reconstructing Aggregate state, special precautions must be taken.</p>
</div>
<div class="paragraph">
<p>It is possible to <code>apply()</code> new events inside an Event Sourcing Handler method.
This makes it possible for an Entity 'B' to apply an event in reaction to Entity 'A' doing something.
Axon will ignore the <code>apply()`invocation when replaying historic events upon sourcing the given Aggregate. Do note that in the scenario where Event Messages are published from an Event Sourcing Handler, the Event of the inner `apply()</code> invocation is only published to the entities after all entities have received the first event.
If more events need to be published, based on the state of an entity after applying an inner event, use <code>apply(&#8230;&#8203;).andThenApply(&#8230;&#8203;)</code>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Reacting to other Events</strong></p>
</div>
<div class="paragraph">
<p>An Aggregate <strong>cannot</strong> handle events from other sources then itself.
This is intentional as the Event Sourcing Handlers are used to recreate the state of the Aggregate.
For this it only needs it&#8217;s own events as those represent it&#8217;s state changes.</p>
</div>
<div class="paragraph">
<p>To make an Aggregate react on events from other Aggregate instances, <a href="../sagas/README.html" class="xref page">Sagas</a> or <a href="../events/event-handlers.html" class="xref page">Event Handling Components</a> should be leveraged</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_aggregate_command_handler_creation_policy"><a class="anchor" href="#_aggregate_command_handler_creation_policy"></a>Aggregate command handler creation policy</h3>
<div class="paragraph">
<p>Up until now, we have depicted the <code>GiftCard</code> aggregate with roughly two types of command handlers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@CommandHandler</code> annotated constructors</p>
</li>
<li>
<p><code>@CommandHandler</code> annotated methods</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Option 1 will always expect to be the instantiation of the <code>GiftCard</code> aggregate, whilst option 2 expects to be targeted towards an existing aggregate instance.
Although this may be the default, there is the option to define a <em>creation policy</em> on a command handler.
This can be achieved by adding the <code>@CreationPolicy</code> annotation to a command handler annotated method, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.modelling.command.CreationPolicy;
import org.axonframework.modelling.command.AggregateCreationPolicy;

public class GiftCard {

    public GiftCard() {
        // Required no-op constructor
    }

    @CommandHandler
    @CreationPolicy(AggregateCreationPolicy.ALWAYS)
    public void handle(IssueCardCommand cmd) {
        // An `IssueCardCommand`-handler which will create a `GiftCard` aggregate
    }

    @CommandHandler
    @CreationPolicy(AggregateCreationPolicy.CREATE_IF_MISSING)
    public void handle(CreateOrRechargeCardCommand cmd) {
        // A 'CreateOrRechargeCardCommand'-handler which creates a `GiftCard` aggregate if it did not exist
        // Otherwise, it will update an existing `GiftCard` aggregate.
    }
    // omitted aggregate state, command handling logic and event sourcing handlers
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As is shown above, the <code>@CreationPolicy</code> annotation requires stating the <code>AggregateCreationPolicy</code>.
This enumeration has the following options available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALWAYS</code> - A creation policy of "always" will expect to instantiate the aggregate.
This effectively works like a command handler annotated constructor.
Without defining a return type, the aggregate identifier used during the creation will be returned.
Through this approach, it is possible to return other results next to the aggregate identifier.</p>
</li>
<li>
<p><code>CREATE_IF_MISSING</code> - A creation policy of "create if missing" can either create an aggregate or act on an existing instance.
This policy should be regarded as a create or update approach of an aggregate.</p>
</li>
<li>
<p><code>NEVER</code> - A creation policy of "never" will be handled on an existing aggregate instance.
This effectively works like any regular command handler annotated method.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="external_command_handlers"><a class="anchor" href="#external_command_handlers"></a>External command handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Command handling functions are most often directly placed on the Aggregate (as described in more detail <a href="#_aggregate_command_handlers">here</a>).
There are situations however where it is not possible nor desired to route a command directly to an Aggregate instance.
Message handling functions, like Command Handlers, can however be placed on any object.
It is thus possible to instantiate a 'Command Handling Object'.</p>
</div>
<div class="paragraph">
<p>A Command Handling Object is a simple (regular) object, which has <code>@CommandHandler</code> annotated methods.
Unlike with Aggregates, there is only a <em>single</em> instance of a Command Handling Object, which handles <strong>all</strong> commands of the types it declares in its methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.modelling.command.Repository;

public class GiftCardCommandHandler {

    // 1.
    private final Repository&lt;GiftCard&gt; giftCardRepository;

    @CommandHandler
    public void handle(RedeemCardCommand cmd) {
        giftCardRepository.load(cmd.getCardId()) // 2.
                          .execute(giftCard -&gt; giftCard.handle(cmd)); // 3.
    }

    // omitted constructor
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above snippet we have decided that the <code>RedeemCardCommand</code> should no longer be directly handled on the <code>GiftCard</code>.
Instead, we load the <code>GiftCard</code> manually and execute the desired method on it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>Repository</code> for the <code>GiftCard</code> Aggregate, used for retrieval and storage of an Aggregate.
If <code>@CommandHandler</code> methods are placed directly on the Aggregate, Axon will automatically know to call the <code>Repository</code> to load a given instance.
It is thus <em>not</em> mandatory to directly access the <code>Repository</code>, but a <a href="../../architecture-overview/#separation-of-business-logic-and-infrastructure">design choice</a>.</p>
</li>
<li>
<p>To load the intended <code>GiftCard</code> Aggregate instance, the <code>Repository#load(String)</code> method is used.
The provided parameter should be the Aggregate identifier.</p>
</li>
<li>
<p>After that Aggregate has been loaded, the <code>Aggregate#execute(Consumer)</code> function should be invoked to perform an operation on the Aggregate.
Using the <code>execute</code> function ensure that the Aggregate life cycle is correctly started.</p>
</li>
</ol>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="command-dispatchers.html">Command Dispatchers</a></span>
  <span class="next"><a href="infrastructure.html">Infrastructure</a></span>
</nav>
    </article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-cloud">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-synapse">Axon Synapse</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/page-actions.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
