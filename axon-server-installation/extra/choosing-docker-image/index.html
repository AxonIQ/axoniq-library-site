<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Choosing Docker Image</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-server-installation/extra/choosing-docker-image/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../../_/img/apple-touch-icon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


  </head>
  <body class="article">
    <div class="banner">
    <a href="https://console.axoniq.io">Manage and monitor your Axon Framework applications and Axon Server environments. <span class="banner_button" target="_blank">Try AxonIQ Console</span></a>
</div>    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../../_/img/logo-dark4x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/v2024.2/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.11/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
        <a class="navbar-item navbar-button" href="https://axoniq.io/contact" target="_blank">Get in touch</a>
      </div>
    </div>
  </nav>
</header>
    <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Server Installation </a></li>
    <li><a href="./">Choosing Docker Image</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonIQ/axoniq-library-site/edit/main/content/axon-server-installation-guides/modules/ROOT/pages/extra/choosing-docker-image.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Choosing%20Docker%20Image" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Choosing%20Docker%20Image%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BChoosing%20Docker%20Image%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-server-installation%2Fextra%2Fchoosing-docker-image%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


</div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-server-installation" data-version="master">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Server Installation</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../developer/">AxonIQ Developer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/docker/">Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/kubernetes/">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../professional/">AxonIQ Professional</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/kubernetes/">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../enterprise/">Enterprise</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../enterprise/download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../enterprise/ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../enterprise/docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../enterprise/kubernetes/">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../migrations/">Migrations</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Choosing Docker Image</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>AxonIQ provides ready-to-use <a href="https://hub.docker.com/r/axoniq/axonserver">Axon Server images</a>.
These images are all based on <a href="https://hub.docker.com/_/eclipse-temurin">Eclipse Temurin</a>, which means they include a (limited) shell that allows you to connect "into" the running image and perform some commands.</p>
</div>
<div class="paragraph">
<p>There are two variants available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The regular images, for example, tagged <code>2024.2.4</code> or <code>2024.2.4-jdk-17</code> run Axon Server as the <code>root</code> user inside the container.
This image is particularly useful for running in Docker Desktop, as it will not have any trouble creating files and directories.</p>
</li>
<li>
<p>The <code>nonroot</code> images, for example, tagged <code>2024.2.4-nonroot</code> or <code>2024.2.4-jdk-17-nonroot</code> runs Axon Server as the <code>axonserver</code> user.
This image is more secure  in Kubernetes and OpenShift clusters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using a <code>nonroot</code> image, you have to run the container with <code>user</code> and <code>group</code> id <code>1001</code>. In Kubernetes, this would mean adding a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/">security context</a> to the pod definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: StatefulSet
spec:
  serviceName: axonserver
  replicas: 1
  template:
    spec:
      securityContext:
        runAsUser: 1001
        runAsGroup: 1001
        fsGroup: 1001
      containers:
      - name: axonserver
        image: axoniq/axonserver:latest-jdk-17-nonroot
        # Rest of file omitted for brevity</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing this will ensure that any mounted volumes will be writable by the user running Axon Server.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exported_volumes"><a class="anchor" href="#_exported_volumes"></a>Exported volumes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The pre-built images export the following volumes:</p>
</div>
<div class="sect2">
<h3 id="_axonserverconfig"><a class="anchor" href="#_axonserverconfig"></a><code>/axonserver/config</code></h3>
<div class="paragraph">
<p>This is where you can add configuration files, such as an additional <code>axonserver.properties</code> and the license file.
However, you can also opt to use, for instance, Kubernetes, or Docker-compose secrets.
Note that Axon Server assumes it can write to the directory configured with <code>axoniq.axonserver.enterprise.licenseDirectory</code>, so you don&#8217;t have to put the license on all nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_axonserverdata"><a class="anchor" href="#_axonserverdata"></a><code>/axonserver/data</code></h3>
<div class="paragraph">
<p>This is where the ControlDB, the PID file, and a copy of the application logs are written to.</p>
</div>
</div>
<div class="sect2">
<h3 id="_axonserverevents"><a class="anchor" href="#_axonserverevents"></a><code>/axonserver/events</code></h3>
<div class="paragraph">
<p>Contains the event store, with a single directory per context. Be sure to size this volume correctly, as it will grow over time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_axonserverlog"><a class="anchor" href="#_axonserverlog"></a><code>/axonserver/log</code></h3>
<div class="paragraph">
<p>Contains the replication logs. This needs to be big enough to hold the data of the past hour to ensure Axon Server can recover from failures correctly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_axonserverplugins"><a class="anchor" href="#_axonserverplugins"></a><code>/axonserver/plugins</code></h3>
<div class="paragraph">
<p>You can place plugins in this volume. The plugins are loaded at startup and can be used to extend Axon Server with additional functionality.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-image"><a class="anchor" href="#build-image"></a>Building your own image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can, of course, build your own container per your own requirements.
A starter Dockerfile is included below which can be tailored as per your requirements.</p>
</div>
<div class="paragraph">
<p>The starter file helps create the image in multiple stages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The image will be based on a compact image from Google’s <code>distroless</code> base images at the gcr.io repository, in this case <code>gcr.io/distroless/java:11</code>.</p>
</li>
<li>
<p>The first stage creates the directories that will become our volumes.
This step cannot be performed in the Distroless image, because that image does not provide a shell.</p>
</li>
<li>
<p>The second stage begins by copying the home directory with its volume mount points, carefully keeping ownership set to the new user.</p>
</li>
<li>
<p>The last steps copy the executable jar named axonserver.jar and a common set of properties.
It marks the volume mounting points and exposed ports and finally specifies the command to start Axon Server.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-docker hljs" data-lang="docker">FROM busybox as source

RUN mkdir -p /axonserver/config /axonserver/data /axonserver/events /axonserver/log /axonserver/exts

FROM gcr.io/distroless/java:11

COPY --from=source /axonserver /axonserver
COPY axonserver.jar axonserver.properties /axonserver/

WORKDIR /axonserver

VOLUME [ "/axonserver/config", "/axonserver/data", "/axonserver/events", "/axonserver/log", "/axonserver/exts", "/axonserver/plugins"  ]
EXPOSE 8024/tcp 8124/tcp 8224/tcp

ENTRYPOINT [ "java", "-jar", "./axonserver.jar" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to build a "nonroot" version, you need to adjust this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-docker hljs" data-lang="docker">FROM busybox as source
RUN addgroup -S -g 1001 axonserver \
    &amp;&amp; adduser -S -u 1001 -G axonserver -h /axonserver -D axonserver \
    &amp;&amp; mkdir -p /axonserver/config /axonserver/data /axonserver/events /axonserver/log /axonserver/exts \
    &amp;&amp; chown -R axonserver:axonserver /axonserver

FROM gcr.io/distroless/java:11

COPY --from=source /etc/passwd /etc/group /etc/
COPY --from=source --chown=axonserver /axonserver /axonserver

COPY --chown=axonserver axonserver.jar axonserver.properties /axonserver/

USER axonserver
WORKDIR /axonserver

VOLUME [ "/axonserver/config", "/axonserver/data", "/axonserver/events", "/axonserver/log", "/axonserver/exts", "/axonserver/plugins" ]
EXPOSE 8024/tcp 8124/tcp 8224/tcp

ENTRYPOINT [ "java", "-jar", "./axonserver.jar" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this will start by creating the user <code>axonserver</code> belonging to a group with the same name.
When copying the directory, we now have to ensure that ownership transfers correctly and specify the user to run as, but otherwise it looks pretty similar.</p>
</div>
<div class="paragraph">
<p>For the common properties (<code>axonserver.properties</code>), the minimum set can be added to ensure that the volumes get mounted and logs generated.
Again these can be tailored as per the deployment requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">axoniq.axonserver.event.storage=./events
axoniq.axonserver.snapshot.storage=./events
axoniq.axonserver.replication.log-storage-folder=./log

axoniq.axonserver.enterprise.licenseDirectory=./config
#axoniq.axonserver.accesscontrol.systemtokenfile=./config/axonserver.token

axoniq.axonserver.controldb-path=./data
axoniq.axonserver.pid-file-location=./data

logging.file=./data/axonserver.log
logging.file.max-history=10
logging.file.max-size=10MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Place the Dockerfile, the Axon Server jar file (<code>axonserver.jar</code>), the Axon Server client jar file (<code>axonserver-cli.jar</code>) and the <code>axonserver.properties</code> in the current directory.
Then build the image using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ docker build --tag my-repository/axonserver:my-axon-server-tag.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the construction of the Docker image.
The image us built and saved your local repository.
However, if you want to share it with others, you need to push it to a repository that others can access.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_image"><a class="anchor" href="#_running_the_image"></a>Running the image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whether you built your own image or are using the AxonIQ provided images, you can now use this image in the installation guides where appropriate.
Make sure to replace the image name with the one you built, or the one you want to use from AxonIQ, in the relevant guide&#8217;s commands and files.</p>
</div>
</div>
</div>
            </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-cloud">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-synapse">Axon Synapse</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://axoniq.bsky.social/">Bluesky</a></li>
          <li><a class="ext" target="_blank" href="https://www.instagram.com/axoniq/">Instagram</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
    </div>
  </body>
</html>
