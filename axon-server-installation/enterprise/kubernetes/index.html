<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-server-installation/enterprise/kubernetes/">
    <link rel="prev" href="../docker-compose/">
    <link rel="next" href="../../migrations/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../_/img/favicon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


<link rel="icon" href="../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/v2025.1/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Server Installation </a></li>
    <li><a href="../">Enterprise</a></li>
    <li><a href="./">Kubernetes</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonIQ/axoniq-library-site/edit/main/content/axon-server-installation-guides/modules/ROOT/pages/enterprise/kubernetes.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;undefined" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22undefined%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5Bundefined%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-server-installation%2Fenterprise%2Fkubernetes%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-server-installation" data-version="master">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Server Installation</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../developer/">AxonIQ Developer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/docker/">Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/kubernetes/">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../professional/">AxonIQ Professional</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../professional/kubernetes/">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Enterprise</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../download/">Download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ubuntu/">Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docker-compose/">Docker Compose</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../migrations/">Migrations</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <div class="paragraph">
<p><!-- vale AxonIQ.Headings = NO -->
= Kubernetes</p>
</div>
<div class="paragraph">
<p>Kubernetes has become an industry standard when it comes to deploying Software.
While we recommend installing Axon Server on virtual machines due to their better stability, this guide will help you install Axon Server Cluster on Kubernetes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AxonIQ does not provide a HELM chart, nor any installation instructions for service meshes such as <code>istio</code>.
You can adapt the instruction in this guide for your specific situation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kubernetes setup works with a variety of individual parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Stateful set</strong>: The stateful set for each node runs an Axon Server with a stable hostname, which is necessary for headless services.</p>
</li>
<li>
<p><strong>Persistent Volume Claims</strong>: As Axon Server needs to store data, there are several PVCs necessary.
These are included in the StatefulSet configuration.</p>
</li>
<li>
<p><strong>Network Service</strong>: For applications to reach Axon Server and communication between nodes, Kubernetes requires a network service that resolves to the pods created by the stateful sets.</p>
</li>
<li>
<p><strong>Config Map</strong>: A config map with the properties for Axon Server&#8217;s configuration.</p>
</li>
<li>
<p><strong>Secrets</strong>: A kubernetes secret that safely store your license file.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_create_a_namespace"><a class="anchor" href="#_step_1_create_a_namespace"></a>Step 1: Create a namespace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend running Axon Server in its separate namespace.
During this guide, we will use the <code>axonserver</code> namespace.
Because of Kubernetes networking, the namespace name selected affects some of the properties in your property file, such as <code>axoniq.axonserver.domain</code> and <code>axoniq.axonserver.internal-domain</code>.</p>
</div>
<div class="paragraph">
<p>Create it using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create namespace axonserver</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can name this namespace any way you like.
However, if you modify this, make sure you modify commands and properties later in this tutorial as well.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_choose_your_image_optional"><a class="anchor" href="#_step_1_choose_your_image_optional"></a>Step 1: Choose your image (optional)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AxonIQ provides ready-to-use Axon Server images called <code>docker.axoniq.io/axoniq/axonserver</code> (<a href="https://hub.docker.com/r/axoniq/axonserver">Docker Hub</a>) that are easy to deploy.
In this guide, we will use the <code>latest-jdk-17</code> image.
For a guide on all images, and how to make your own, see <a href="../../extra/choosing-docker-image/" class="xref page">choosing and building your own Docker image</a>.
If you choose to do this, replace the image in the commands below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_obtaining_axon_server_license_file"><a class="anchor" href="#_step_2_obtaining_axon_server_license_file"></a>Step 2: Obtaining Axon Server License File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to run a cluster of Enterprise nodes, you need to provide your configration with an <code>axoniq.license</code> Axon Server license file.
You can obtain it contacting our sales department.</p>
</div>
<div class="paragraph">
<p>It is still possible to use AxonIQ Console: if you already have a License, please contact your sales-rep.</p>
</div>
<div class="sect2">
<h3 id="_license_file"><a class="anchor" href="#_license_file"></a>License File</h3>
<div class="paragraph">
<p>If you have a license file, we suggest to save this in a secure place, such as kubernetes secrets or the vault of your choice.
In this guide we will store as kubernetes secret, but if you selected to form the cluster manually, you can also upload it directly to axonserver using the UI after the first node has been started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create secret generic axoniq-license -n axonserver --from-file=axoniq.license</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_axoniq_console"><a class="anchor" href="#_axoniq_console"></a>AxonIQ Console</h3>
<div class="paragraph">
<p>By connecting your Axon Server Enterprise to AxonIQ Console you can unlock additional functionality.
AxonIQ Console can also provide a license for your cluster.</p>
</div>
<details>
<summary class="title">Why connect to AxonIQ Console?</summary>
<div class="content">
<div class="paragraph">
<p>By connecting your Axon Server to AxonIQ Console, you will be able to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatic initialization and clustering of Axon Server instances</p>
</li>
<li>
<p>Create multiple contexts in Axon Server to organize your applications</p>
</li>
<li>
<p>Inspect the status of your Axon Server through AxonIQ Console</p>
</li>
<li>
<p>Get deep insights into the status and performance of your applications when also connected to AxonIQ Console</p>
</li>
<li>
<p>Create multiple users and Access token in Axon Server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast, without connecting to AxonIQ Console, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only have one context in Axon Server</p>
</li>
<li>
<p>Only have one user and one access key in Axon Server</p>
</li>
</ul>
</div>
</div>
</details>
<details>
<summary class="title">Obtaining AxonIQ Console access token</summary>
<div class="content">
<div class="paragraph">
<p>You can obtain the console access token by following these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into AxonIQ Console.</p>
</li>
<li>
<p>If this is your first time logging in, you will be prompted to enter your name. After this, your own Workspace will be created automatically</p>
</li>
<li>
<p>Go to the Axon Server page via the left menu</p>
</li>
<li>
<p>In the sidebar on the right, click "Manage access tokens" to open access token management</p>
</li>
<li>
<p>Click the button under "Show Token" to reveal your unique access token</p>
</li>
</ol>
</div>
<div class="videoblock">
<div class="content">
<iframe width="600" height="400" src="https://www.youtube.com/embed/HZOOZP8BtdI?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_configure_properties"><a class="anchor" href="#_step_3_configure_properties"></a>Step 3: Configure properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Axon Server needs to know how to run and form the cluster.
There are 3 methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Auto-clustering</strong>: By defining which node is in charge of forming the cluster and initial contexts, it will automatically form.</p>
</li>
<li>
<p><strong>Manual</strong>: Initializing in the Axon Server dashboard by going into the Axon Server dashboard UI, you can initialize the cluster manually. You can optionally upload your file license here.</p>
</li>
<li>
<p><strong>AxonIQ Console</strong>: When connecting to AxonIQ Console, your server will automatically receive information to form the cluster. This does require the hostname information to be set correctly; otherwise the nodes won&#8217;t be able to find each other.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Based on which method you choose, different <code>axonserver-1.properties</code> <code>axonserver-2.properties</code> and <code>axonserver-3.properties</code> have to be put into the properties file:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_auto_clustering" class="tab">
<p>Auto-clustering</p>
</li>
<li id="_tabs_1_manual" class="tab">
<p>Manual</p>
</li>
<li id="_tabs_1_axoniq_console" class="tab">
<p>AxonIQ Console</p>
</li>
</ul>
</div>
<div id="_tabs_1_auto_clustering--panel" class="tabpanel" aria-labelledby="_tabs_1_auto_clustering">
<div class="paragraph">
<p>In the properties below we define that our node <code>axonserver-1.axonserver.svc.cluster.local</code> will be the one in charge of forming the cluster.
At startup the <code>default</code> context will be created: you can change this behaviour adding your context in <code>axoniq.axonserver.autocluster.contexts</code></p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_axonserver_1_properties" class="tab">
<p>axonserver-1.properties</p>
</li>
<li id="_tabs_2_axonserver_2_properties" class="tab">
<p>axonserver-2.properties</p>
</li>
<li id="_tabs_2_axonserver_3_properties" class="tab">
<p>axonserver-3.properties</p>
</li>
</ul>
</div>
<div id="_tabs_2_axonserver_1_properties--panel" class="tabpanel" aria-labelledby="_tabs_2_axonserver_1_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-1
axoniq.axonserver.name=axonserver-1
axoniq.axonserver.hostname=axonserver-1
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license
axoniq.axonserver.autocluster.first=axonserver-1.axonserver.svc.cluster.local
axoniq.axonserver.autocluster.contexts=_admin,default</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_axonserver_2_properties--panel" class="tabpanel" aria-labelledby="_tabs_2_axonserver_2_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-2
axoniq.axonserver.name=axonserver-2
axoniq.axonserver.hostname=axonserver-2
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license
axoniq.axonserver.autocluster.first=axonserver-1.axonserver.svc.cluster.local
axoniq.axonserver.autocluster.contexts=_admin,default</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_axonserver_3_properties--panel" class="tabpanel" aria-labelledby="_tabs_2_axonserver_3_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-3
axoniq.axonserver.name=axonserver-3
axoniq.axonserver.hostname=axonserver-3
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license
axoniq.axonserver.autocluster.first=axonserver-1.axonserver.svc.cluster.local
axoniq.axonserver.autocluster.contexts=_admin,default</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="_tabs_1_manual--panel" class="tabpanel" aria-labelledby="_tabs_1_manual">
<div id="_tabs_3" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_3_axonserver_1_properties" class="tab">
<p>axonserver-1.properties</p>
</li>
<li id="_tabs_3_axonserver_2_properties" class="tab">
<p>axonserver-2.properties</p>
</li>
<li id="_tabs_3_axonserver_3_properties" class="tab">
<p>axonserver-3.properties</p>
</li>
</ul>
</div>
<div id="_tabs_3_axonserver_1_properties--panel" class="tabpanel" aria-labelledby="_tabs_3_axonserver_1_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-1
axoniq.axonserver.name=axonserver-1
axoniq.axonserver.hostname=axonserver-1
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
<div id="_tabs_3_axonserver_2_properties--panel" class="tabpanel" aria-labelledby="_tabs_3_axonserver_2_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-2
axoniq.axonserver.name=axonserver-2
axoniq.axonserver.hostname=axonserver-2
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
<div id="_tabs_3_axonserver_3_properties--panel" class="tabpanel" aria-labelledby="_tabs_3_axonserver_3_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-3
axoniq.axonserver.name=axonserver-3
axoniq.axonserver.hostname=axonserver-3
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="_tabs_1_axoniq_console--panel" class="tabpanel" aria-labelledby="_tabs_1_axoniq_console">
<div id="_tabs_4" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_4_axonserver_1_properties" class="tab">
<p>axonserver-1.properties</p>
</li>
<li id="_tabs_4_axonserver_2_properties" class="tab">
<p>axonserver-2.properties</p>
</li>
<li id="_tabs_4_axonserver_3_properties" class="tab">
<p>axonserver-3.properties</p>
</li>
</ul>
</div>
<div id="_tabs_4_axonserver_1_properties--panel" class="tabpanel" aria-labelledby="_tabs_4_axonserver_1_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-1
axoniq.axonserver.name=axonserver-1
axoniq.axonserver.hostname=axonserver-1
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.console.authentication=YOUR_ACCESS_TOKEN_FROM_STEP_2
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
<div id="_tabs_4_axonserver_2_properties--panel" class="tabpanel" aria-labelledby="_tabs_4_axonserver_2_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-2
axoniq.axonserver.name=axonserver-2
axoniq.axonserver.hostname=axonserver-2
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.console.authentication=YOUR_ACCESS_TOKEN_FROM_STEP_2
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
<div id="_tabs_4_axonserver_3_properties--panel" class="tabpanel" aria-labelledby="_tabs_4_axonserver_3_properties">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.servlet.context-path=/axonserver-3
axoniq.axonserver.name=axonserver-3
axoniq.axonserver.hostname=axonserver-3
axoniq.axonserver.domain=axonserver.svc.cluster.local
axoniq.axonserver.internal-domain=axonserver.svc.cluster.local
axoniq.console.authentication=YOUR_ACCESS_TOKEN_FROM_STEP_2
axoniq.axonserver.enterprise.licenseDirectory=/axonserver/data/license</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A full list of properties can be found in the <a href="../../../axon-server-reference/v2025.1/axon-server/administration/admin-configuration/configuration/" class="xref page">configuration reference</a>.
You can always customize these later on.</p>
</div>
<div class="paragraph">
<p>We can now create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create configmap axonserver-1-properties --from-file=./axonserver-1.properties -n axonserver
kubectl create configmap axonserver-2-properties --from-file=./axonserver-2.properties -n axonserver
kubectl create configmap axonserver-3-properties --from-file=./axonserver-3.properties -n axonserver</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This config has been kept as simple as possible for the purpose of this guide.
We recommend securing your Axon Server through Access Control.
See <a href="../../extra/securing-axon-server/" class="xref page">securing Axon Server</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_network_services"><a class="anchor" href="#_step_4_network_services"></a>Step 4: Network services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We want Axon Server to be reachable on port 8024 for the Axon Server Dashboard and port 8124 for your Axon Framework applications.</p>
</div>
<div class="paragraph">
<p>First, we will need to create the proper services.
These provide stable DNS names in Kubernetes.
Create the following YAMLs and save it to <code>axonserver-1-service.yaml</code> <code>axonserver-2-service.yaml</code> <code>axonserver-3-service.yaml</code>:</p>
</div>
<div id="_tabs_5" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_5_axonserver_1_service_yaml" class="tab">
<p>axonserver-1-service.yaml</p>
</li>
<li id="_tabs_5_axonserver_2_service_yaml" class="tab">
<p>axonserver-2-service.yaml</p>
</li>
<li id="_tabs_5_axonserver_3_service_yaml" class="tab">
<p>axonserver-3-service.yaml</p>
</li>
</ul>
</div>
<div id="_tabs_5_axonserver_1_service_yaml--panel" class="tabpanel" aria-labelledby="_tabs_5_axonserver_1_service_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: v1
kind: Service
metadata:
  name: axonserver-1-dashboard
  labels:
    app: axonserver-1
spec:
  ports:
  - name: gui
    port: 8024
    targetPort: 8024
  selector:
    app: axonserver-1
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: axonserver-1
  labels:
    app: axonserver-1
spec:
  ports:
  - name: grpc
    port: 8124
    targetPort: 8124
  - name: grpc-internal
    port: 8224
    targetPort: 8224
  clusterIP: None
  selector:
    app: axonserver-1</code></pre>
</div>
</div>
</div>
<div id="_tabs_5_axonserver_2_service_yaml--panel" class="tabpanel" aria-labelledby="_tabs_5_axonserver_2_service_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: v1
kind: Service
metadata:
  name: axonserver-2-dashboard
  labels:
    app: axonserver-2
spec:
  ports:
  - name: gui
    port: 8024
    targetPort: 8024
  selector:
    app: axonserver-2
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: axonserver-2
  labels:
    app: axonserver-2
spec:
  ports:
  - name: grpc
    port: 8124
    targetPort: 8124
  - name: grpc-internal
    port: 8224
    targetPort: 8224
  clusterIP: None
  selector:
    app: axonserver-2</code></pre>
</div>
</div>
</div>
<div id="_tabs_5_axonserver_3_service_yaml--panel" class="tabpanel" aria-labelledby="_tabs_5_axonserver_3_service_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: v1
kind: Service
metadata:
  name: axonserver-3-dashboard
  labels:
    app: axonserver-3
spec:
  ports:
  - name: gui
    port: 8024
    targetPort: 8024
  selector:
    app: axonserver-3
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: axonserver-3
  labels:
    app: axonserver-3
spec:
  ports:
  - name: grpc
    port: 8124
    targetPort: 8124
  - name: grpc-internal
    port: 8224
    targetPort: 8224
  clusterIP: None
  selector:
    app: axonserver-3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we can create the network services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f axonserver-1-service.yaml -n axonserver
kubectl apply -f axonserver-2-service.yaml -n axonserver
kubectl apply -f axonserver-3-service.yaml -n axonserver</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_5_creating_the_statefulset"><a class="anchor" href="#_step_5_creating_the_statefulset"></a>Step 5: Creating the StatefulSet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it&#8217;s time to run the StatefulSet.
The YAML below contains everything needed to run your Axon Server instances' cluster nodes.
Please save it to <code>axonserver-sts-1.yaml</code> <code>axonserver-sts-2.yaml</code> <code>axonserver-sts-3.yaml</code>.</p>
</div>
<div id="_tabs_6" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_6_auto_clustering" class="tab">
<p>Auto-clustering</p>
</li>
<li id="_tabs_6_manual" class="tab">
<p>Manual</p>
</li>
<li id="_tabs_6_axoniq_console" class="tab">
<p>AxonIQ Console</p>
</li>
</ul>
</div>
<div id="_tabs_6_auto_clustering--panel" class="tabpanel" aria-labelledby="_tabs_6_auto_clustering">
<div class="paragraph">
<p>If you select Auto-clustering you <strong>must</strong> provide license at startup, as a secret.</p>
</div>
<div id="_tabs_7" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_7_axonserver_sts_1_yaml" class="tab">
<p>axonserver-sts-1.yaml</p>
</li>
<li id="_tabs_7_axonserver_sts_2_yaml" class="tab">
<p>axonserver-sts-2.yaml</p>
</li>
<li id="_tabs_7_axonserver_sts_3_yaml" class="tab">
<p>axonserver-sts-3.yaml</p>
</li>
</ul>
</div>
<div id="_tabs_7_axonserver_sts_1_yaml--panel" class="tabpanel" aria-labelledby="_tabs_7_axonserver_sts_1_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-1
  labels:
    app: axonserver-1
spec:
  serviceName: axonserver-1
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-1
  template:
    metadata:
      labels:
        app: axonserver-1
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-1
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-1/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-1-properties
            items: 
            - key: axonserver-1.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_7_axonserver_sts_2_yaml--panel" class="tabpanel" aria-labelledby="_tabs_7_axonserver_sts_2_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-2
  labels:
    app: axonserver-2
spec:
  serviceName: axonserver-2
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-2
  template:
    metadata:
      labels:
        app: axonserver-2
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-2
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-2/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-2-properties
            items: 
            - key: axonserver-2.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_7_axonserver_sts_3_yaml--panel" class="tabpanel" aria-labelledby="_tabs_7_axonserver_sts_3_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-3
  labels:
    app: axonserver-3
spec:
  serviceName: axonserver-3
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-3
  template:
    metadata:
      labels:
        app: axonserver-3
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-3
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-3/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-3-properties
            items: 
            - key: axonserver-3.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="_tabs_6_manual--panel" class="tabpanel" aria-labelledby="_tabs_6_manual">
<div class="paragraph">
<p>If you select Manual, you can provide license as a secret or optionally upload to the node with the UI after the first node as started.
The example below is intended to use with a license file stored in a secret.
If you prefer to manually handle your license, you need to change your sts files by removing the parts referring to license under volumeMounts and volumes.</p>
</div>
<div id="_tabs_8" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_8_axonserver_sts_1_yaml" class="tab">
<p>axonserver-sts-1.yaml</p>
</li>
<li id="_tabs_8_axonserver_sts_2_yaml" class="tab">
<p>axonserver-sts-2.yaml</p>
</li>
<li id="_tabs_8_axonserver_sts_3_yaml" class="tab">
<p>axonserver-sts-3.yaml</p>
</li>
</ul>
</div>
<div id="_tabs_8_axonserver_sts_1_yaml--panel" class="tabpanel" aria-labelledby="_tabs_8_axonserver_sts_1_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-1
  labels:
    app: axonserver-1
spec:
  serviceName: axonserver-1
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-1
  template:
    metadata:
      labels:
        app: axonserver-1
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-1
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-1/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-1-properties
            items: 
            - key: axonserver-1.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_axonserver_sts_2_yaml--panel" class="tabpanel" aria-labelledby="_tabs_8_axonserver_sts_2_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-2
  labels:
    app: axonserver-2
spec:
  serviceName: axonserver-2
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-2
  template:
    metadata:
      labels:
        app: axonserver-2
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-2
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-2/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-2-properties
            items: 
            - key: axonserver-2.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_axonserver_sts_3_yaml--panel" class="tabpanel" aria-labelledby="_tabs_8_axonserver_sts_3_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-3
  labels:
    app: axonserver-3
spec:
  serviceName: axonserver-3
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-3
  template:
    metadata:
      labels:
        app: axonserver-3
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-3
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        - name: license
          mountPath: /axonserver/data/license
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-3/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-3-properties
            items: 
            - key: axonserver-3.properties
              path: axonserver.properties
        - name: license 
          secret:
            secretName: axoniq-license
            items:
              - key: axoniq.license
                path: axoniq.license
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="_tabs_6_axoniq_console--panel" class="tabpanel" aria-labelledby="_tabs_6_axoniq_console">
<div class="paragraph">
<p>If you use AxonIQ Console, license is provided by the service.</p>
</div>
<div id="_tabs_9" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_9_axonserver_sts_1_yaml" class="tab">
<p>axonserver-sts-1.yaml</p>
</li>
<li id="_tabs_9_axonserver_sts_2_yaml" class="tab">
<p>axonserver-sts-2.yaml</p>
</li>
<li id="_tabs_9_axonserver_sts_3_yaml" class="tab">
<p>axonserver-sts-3.yaml</p>
</li>
</ul>
</div>
<div id="_tabs_9_axonserver_sts_1_yaml--panel" class="tabpanel" aria-labelledby="_tabs_9_axonserver_sts_1_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-1
  labels:
    app: axonserver-1
spec:
  serviceName: axonserver-1
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-1
  template:
    metadata:
      labels:
        app: axonserver-1
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-1
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-1/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-1/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-1-properties
            items: 
            - key: axonserver-1.properties
              path: axonserver.properties
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_9_axonserver_sts_2_yaml--panel" class="tabpanel" aria-labelledby="_tabs_9_axonserver_sts_2_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-2
  labels:
    app: axonserver-2
spec:
  serviceName: axonserver-2
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-2
  template:
    metadata:
      labels:
        app: axonserver-2
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-2
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-2/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-2/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-2-properties
            items: 
            - key: axonserver-2.properties
              path: axonserver.properties
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
<div id="_tabs_9_axonserver_sts_3_yaml--panel" class="tabpanel" aria-labelledby="_tabs_9_axonserver_sts_3_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: axonserver-3
  labels:
    app: axonserver-3
spec:
  serviceName: axonserver-3
  replicas: 1
  selector:
    matchLabels:
      app: axonserver-3
  template:
    metadata:
      labels:
        app: axonserver-3
    spec:
      terminationGracePeriodSeconds: 120
      containers:
      - name: axonserver-3
        image: docker.axoniq.io/axoniq/axonserver:latest-jdk-17
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            memory: "4Gi"
            cpu: "1"
          limits:
            memory: "16Gi"
            cpu: "2"
        ports:
        - name: gui
          containerPort: 8024
          protocol: TCP
        - name: grpc
          containerPort: 8124
          protocol: TCP
        - name: grpc-internal
          containerPort: 8224
          protocol: TCP
        volumeMounts:
        - name: data
          mountPath: /axonserver/data
        - name: events
          mountPath: /axonserver/events
        - name: log
          mountPath: /axonserver/log
        - name: config 
          mountPath: /axonserver/config
          readOnly: true
        startupProbe:
          httpGet:
            path: /axonserver-3/actuator/info
            port: 8024
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        readinessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/readiness
            port: 8024
          initialDelaySeconds: 60
          periodSeconds: 5
          timeoutSeconds: 10
          failureThreshold: 110
        livenessProbe:
          httpGet:
            path: /axonserver-3/actuator/health/liveness
            port: 8024
          initialDelaySeconds: 90
          periodSeconds: 5
          successThreshold: 1
          failureThreshold: 10
          timeoutSeconds: 10
      volumes:
        - name: config 
          configMap:
            name: axonserver-3-properties
            items: 
            - key: axonserver-3.properties
              path: axonserver.properties
  volumeClaimTemplates:
    - metadata:
        name: log
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 10Gi
    - metadata:
        name: data
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 2Gi
    - metadata:
        name: events
      spec:
        accessModes: [ ReadWriteOnce ]
        resources:
          requests:
            storage: 20Gi</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now we can apply the StatefulSet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f axonserver-sts-1.yaml -n axonserver
kubectl apply -f axonserver-sts-2.yaml -n axonserver
kubectl apply -f axonserver-sts-3.yaml -n axonserver</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Kubernetes takes some time after a Pod is started to update internal DNS entries, depending on the k8s cluster resources and current status.
In our experience this can goes up to ~5 minutes. You will observe some initial warning with <code>Unable to resolve host</code>: this is normal, and it will solve as soon as DNS is ready.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now wait until Axon Server has started up by following the logging using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f axonserver-1-0 -n axonserver</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f axonserver-2-0 -n axonserver</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f axonserver-3-0 -n axonserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your server will be operational once you see logging similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">io.axoniq.axonserver.AxonServer: Started AxonServer in 29.056 seconds</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_6_ingresses_optional"><a class="anchor" href="#_step_6_ingresses_optional"></a>Step 6: Ingresses (optional)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The network services are only reachable from within the Kubernetes cluster.
From here, there are two ways to access the defined ports: port-forwarding or setting up an Ingress.</p>
</div>
<div class="sect2">
<h3 id="_port_forwarding"><a class="anchor" href="#_port_forwarding"></a>Port-forwarding</h3>
<div class="paragraph">
<p>Kubernetes provides a way to forward ports from the cluster to your local machine.
This is useful for development purposes.
To forward the Axon Server dashboard to your local machine, you can use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl port-forward service/axonserver-1-dashboard 8024:8024 -n axonserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>To forward the gRPC port for your Axon Framework applications, you can use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl port-forward service/axonserver-1 8124:8124 -n axonserver</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ingresses"><a class="anchor" href="#_ingresses"></a>Ingresses</h3>
<div class="paragraph">
<p>If you want a more permanent way to access the Axon Server dashboard, you can define an ingress.
This requires an Ingress Controller to be installed in your Kubernetes cluster.
How to do this is beyond the scope of this guide.</p>
</div>
<div class="paragraph">
<p>To create an ingress for the Axon Server dashboard, save the following YAML to <code>axonserver-1-ingress.yaml</code> <code>axonserver-2-ingress.yaml</code> <code>axonserver-3-ingress.yaml</code>:</p>
</div>
<div id="_tabs_10" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_10_axonserver_1" class="tab">
<p>axonserver-1</p>
</li>
<li id="_tabs_10_axonserver_2" class="tab">
<p>axonserver-2</p>
</li>
<li id="_tabs_10_axonserver_3" class="tab">
<p>axonserver-3</p>
</li>
</ul>
</div>
<div id="_tabs_10_axonserver_1--panel" class="tabpanel" aria-labelledby="_tabs_10_axonserver_1">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: axonserver-1
  annotations:
    kubernetes.io/ingress.class: public
    nginx.ingress.kubernetes.io/affinity: cookie
    nginx.ingress.kubernetes.io/affinity-mode: persistent
spec:
  rules:
  - http:
      paths:
      - backend:
          service:
            name: axonserver-1-dashboard
            port:
              number: 8024
        pathType: Prefix
        path: /axonserver-1</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_axonserver_2--panel" class="tabpanel" aria-labelledby="_tabs_10_axonserver_2">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: axonserver-2
  annotations:
    kubernetes.io/ingress.class: public
    nginx.ingress.kubernetes.io/affinity: cookie
    nginx.ingress.kubernetes.io/affinity-mode: persistent
spec:
  rules:
  - http:
      paths:
      - backend:
          service:
            name: axonserver-2-dashboard
            port:
              number: 8024
        pathType: Prefix
        path: /axonserver-2</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_axonserver_3--panel" class="tabpanel" aria-labelledby="_tabs_10_axonserver_3">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: axonserver-3
  annotations:
    kubernetes.io/ingress.class: public
    nginx.ingress.kubernetes.io/affinity: cookie
    nginx.ingress.kubernetes.io/affinity-mode: persistent
spec:
  rules:
  - http:
      paths:
      - backend:
          service:
            name: axonserver-3-dashboard
            port:
              number: 8024
        pathType: Prefix
        path: /axonserver-3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can now apply the ingress:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f axonserver-1-ingress.yaml -n axonserver
kubectl apply -f axonserver-2-ingress.yaml -n axonserver
kubectl apply -f axonserver-3-ingress.yaml -n axonserver</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to change the name of the Axon Server from <code>axonserver-1</code> to any other name, be sure to synchronize the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>axonserver-1.properties</code> file (both context-path and hostname)</p>
</li>
<li>
<p>In the StatefulSet (name, app labels, hostname, and probe urls)</p>
</li>
<li>
<p>In the network services</p>
</li>
<li>
<p>In the Ingress</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is necessary to ensure that all parts of the Axon Server setup are in sync.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next"><a class="anchor" href="#_next"></a>Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have Axon Server running in Kubernetes, you can start using it with your Axon Framework applications.</p>
</div>
<div class="paragraph">
<p>How you connect your applications depends on where you run them.
If you run them in the same Kubernetes cluster, you can use the network service to connect.
For the complete example above, this means to set the following property for your Axon Framework applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">axon.axonserver.servers=axonserver-1.axonserver.svc.cluster.local:8124</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to connect remotely, you need to use port-forwarding to your local computer.
This is not recommended for production use.</p>
</div>
<div class="paragraph">
<p>You can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl port-forward service/axonserver-1 8124:8124 -n axonserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your Axon Framework applications will automatically to this port <code>8124</code> on your local machine, as it&#8217;s the default settings.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_going_to_production"><a class="anchor" href="#_going_to_production"></a>Going to production</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you go to production, you need to consider the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Security</strong>: Ensure your Axon Server is secure using TLS and authentication.
See <a href="../../extra/securing-axon-server/" class="xref page">securing Axon Server</a> for more information.</p>
</li>
</ol>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../docker-compose/">Docker Compose</a></span>
  <span class="next"><a href="../../migrations/">Migrations</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright Â© 2025 AxonIQ BV. All Rights Reserved</p>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
    </div>
  </body>
</html>
