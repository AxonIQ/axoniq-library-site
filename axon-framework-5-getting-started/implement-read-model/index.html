<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Feature: Build Course Statistics Read Model (Projection)</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-5-getting-started/implement-read-model/">
    <link rel="prev" href="../implement-stateful-event-handler/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../_/img/apple-touch-icon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../_'</script>


  </head>
  <body class="article">
    <div class="header_container">
      <div class="banner">
    <a href="https://console.axoniq.io">Manage and monitor your Axon Framework applications and Axon Server environments. <span class="banner_button" target="_blank">Try AxonIQ Console</span></a>
</div>      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../_/img/logo-dark4x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../axon-server-reference/v2025.1/">Axon Server</a>
                <a class="navbar-item" href="../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
        <a class="navbar-item navbar-button" href="https://axoniq.io/contact" target="_blank">Get in touch</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../">Getting Started with Axon Framework 5 </a></li>
    <li><a href="./">Feature: Build Course Statistics Read Model (Projection)</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/main/docs/af5-getting-started/modules/ROOT/pages/implement-read-model.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Feature%3A%20Build%20Course%20Statistics%20Read%20Model%20(Projection)" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Feature%3A%20Build%20Course%20Statistics%20Read%20Model%20(Projection)%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BFeature%3A%20Build%20Course%20Statistics%20Read%20Model%20(Projection)%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-5-getting-started%2Fimplement-read-model%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-5-getting-started" data-version="master">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../">Getting Started with Axon Framework 5</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sample-domain-event-modeling/">University Domain</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../project-structure/">Project Structure</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../implement-command-create-course/">Feature: Course Creation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../implement-command-subscribe-student/">Feature: Subscribe Student</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configure-axon-server/">Connecting to Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text">xref:implement-stateless-event-handler.adoc</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../implement-stateful-event-handler/">Feature: Send Notification To The Administrator When All Courses Are Fully Booked</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="./">Feature: Build Course Statistics Read Model (Projection)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Feature: Build Course Statistics Read Model (Projection)</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, we&#8217;ll implement a read model (projection) that provides course statistics including enrollment numbers and capacity information.
This enables administrators and instructors to quickly access optimized views of course data for reporting, dashboards, and real-time monitoring without rebuilding the entire state from events for every read.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_a_read_model_projection"><a class="anchor" href="#_what_is_a_read_model_projection"></a>What is a read model (projection)?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A read model, also called a projection, is a view of data that&#8217;s optimized for queries rather than commands.
It&#8217;s built by processing events from the event store and maintaining a specialized data structure that supports specific read patterns.</p>
</div>
<div class="paragraph">
<p>Read models are <strong>query-optimized</strong> (structured for performant reads), <strong>eventually consistent</strong> (updated asynchronously), and <strong>purpose-built</strong> (each projection serves specific query needs using dedicated persistence mechanisms like SQL, Graph DB, etc.)
Common use cases include creating search indexes, building dashboards and reporting views, generating real-time analytics, and supporting complex queries across tags in the event store.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_the_course_statistics_feature"><a class="anchor" href="#_understanding_the_course_statistics_feature"></a>Understanding the course statistics feature</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../_images/FacultyContext_EventModeling.png" alt="FacultyContext EventModeling">
</div>
</div>
<div class="paragraph">
<p>The Event Modeling diagram shows various green sticky notes representing read models (views). The Course Statistics read model is one such view (<strong>Courses</strong> green sticky note) that provides real-time course enrollment and capacity information.
In Event Modeling terminology, these green sticky notes represent "views" that are continuously updated as events flow through the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_the_read_model"><a class="anchor" href="#_setting_up_the_read_model"></a>Setting up the read model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll build a complete read model system with these classes:
- <strong>Read Model</strong> - The data structure representing course statistics
- <strong>Repository</strong> - Interface for storing and retrieving read models
- <strong>Projection</strong> - Event handlers that build and update the read model
- <strong>Configuration</strong> - Wiring everything together with event processing</p>
</div>
<div class="sect2">
<h3 id="_step_1_define_the_read_model_data_structure"><a class="anchor" href="#_step_1_define_the_read_model_data_structure"></a>Step 1: Define the read model data structure</h3>
<div class="paragraph">
<p>First, let&#8217;s create the read model that represents course statistics:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/faculty/read/coursestats/CoursesStatsReadModel.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import io.axoniq.demo.university.shared.ids.CourseId;

public record CoursesStatsReadModel( <i class="conum" data-value="1"></i><b>(1)</b>
        CourseId courseId,
        String name,
        int capacity,
        int subscribedStudents
) {

    CoursesStatsReadModel name(String name){ <i class="conum" data-value="2"></i><b>(2)</b>
        return new CoursesStatsReadModel(courseId, name, capacity, subscribedStudents);
    }

    CoursesStatsReadModel capacity(int capacity){
        return new CoursesStatsReadModel(courseId, name, capacity, subscribedStudents);
    }

    CoursesStatsReadModel subscribedStudents(int subscribedStudents){
        return new CoursesStatsReadModel(courseId, name, capacity, subscribedStudents);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Immutable record representing course statistics - includes all data needed for course overview queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Convenience methods for creating updated versions while maintaining immutability</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_the_repository_interface"><a class="anchor" href="#_step_2_create_the_repository_interface"></a>Step 2: Create the Repository Interface</h3>
<div class="paragraph">
<p>Now let&#8217;s define the repository interface for storing and retrieving course statistics:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/faculty/read/coursestats/CourseStatsRepository.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import io.axoniq.demo.university.shared.ids.CourseId;

import java.util.Optional;

public interface CourseStatsRepository {
    CoursesStatsReadModel save(CoursesStatsReadModel stats); <i class="conum" data-value="1"></i><b>(1)</b>

    Optional&lt;CoursesStatsReadModel&gt; findById(CourseId courseId); <i class="conum" data-value="2"></i><b>(2)</b>

    default CoursesStatsReadModel findByIdOrThrow(CourseId courseId) { <i class="conum" data-value="3"></i><b>(3)</b>
        return findById(courseId).orElseThrow(() -&gt;
            new RuntimeException("Course with id " + courseId + " does not exist!"));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save or update course statistics</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Find statistics by course ID, returning Optional for safe handling</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Convenience method that throws an exception if the course doesn&#8217;t exist</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_implement_an_in_memory_repository"><a class="anchor" href="#_step_3_implement_an_in_memory_repository"></a>Step 3: Implement an In-Memory Repository</h3>
<div class="paragraph">
<p>For this tutorial, we&#8217;ll use a simple in-memory implementation. In production, you&#8217;d typically use a real database:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/faculty/read/coursestats/InMemoryCourseStatsRepository.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import io.axoniq.demo.university.shared.ids.CourseId;

import java.util.Optional;
import java.util.concurrent.ConcurrentHashMap;

class InMemoryCourseStatsRepository implements CourseStatsRepository {

    private final ConcurrentHashMap&lt;CourseId, CoursesStatsReadModel&gt; stats = new ConcurrentHashMap&lt;&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    @Override
    public CoursesStatsReadModel save(CoursesStatsReadModel stats) {
        this.stats.put(stats.courseId(), stats); <i class="conum" data-value="2"></i><b>(2)</b>
        return stats;
    }

    @Override
    public Optional&lt;CoursesStatsReadModel&gt; findById(CourseId courseId) {
        return Optional.ofNullable(stats.get(courseId)); <i class="conum" data-value="3"></i><b>(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Thread-safe concurrent map for storing read models in memory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Save by course ID as the key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Safe retrieval that handles missing entries</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_implement_the_projection_with_event_handlers"><a class="anchor" href="#_step_4_implement_the_projection_with_event_handlers"></a>Step 4: Implement the projection with event handlers</h3>
<div class="paragraph">
<p>Now let&#8217;s create the projection that builds the read model from events:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/faculty/read/coursestats/CoursesStatsProjection.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import io.axoniq.demo.university.faculty.events.*;
import org.axonframework.eventhandling.annotation.EventHandler;

class CoursesStatsProjection {

    private final CourseStatsRepository repository;

    public CoursesStatsProjection(CourseStatsRepository repository) { <i class="conum" data-value="1"></i><b>(1)</b>
        this.repository = repository;
    }

    @EventHandler
    void handle(CourseCreated event) { <i class="conum" data-value="2"></i><b>(2)</b>
        CoursesStatsReadModel readModel = new CoursesStatsReadModel(
                event.courseId(),
                event.name(),
                event.capacity(),
                0 // Start with zero students
        );
        repository.save(readModel);
    }

    @EventHandler
    void handle(CourseRenamed event) { <i class="conum" data-value="3"></i><b>(3)</b>
        CoursesStatsReadModel readModel = repository.findByIdOrThrow(event.courseId());
        var updatedReadModel = readModel.name(event.name());
        repository.save(updatedReadModel);
    }

    @EventHandler
    void handle(CourseCapacityChanged event) { <i class="conum" data-value="4"></i><b>(4)</b>
        CoursesStatsReadModel readModel = repository.findByIdOrThrow(event.courseId());
        var updatedReadModel = readModel.capacity(event.capacity());
        repository.save(updatedReadModel);
    }

    @EventHandler
    void handle(StudentSubscribedToCourse event) { <i class="conum" data-value="5"></i><b>(5)</b>
        CoursesStatsReadModel readModel = repository.findByIdOrThrow(event.courseId());
        var updatedReadModel = readModel.subscribedStudents(readModel.subscribedStudents() + 1);
        repository.save(updatedReadModel);
    }

    @EventHandler
    void handle(StudentUnsubscribedFromCourse event) { <i class="conum" data-value="6"></i><b>(6)</b>
        CoursesStatsReadModel readModel = repository.findByIdOrThrow(event.courseId());
        var updatedReadModel = readModel.subscribedStudents(readModel.subscribedStudents() - 1);
        repository.save(updatedReadModel);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an initial read model when a course is created with zero students</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Update the course name when renamed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Update capacity when changed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Increment student count when a student subscribes</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Decrement student count when a student unsubscribes</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_configure_the_read_model_components"><a class="anchor" href="#_step_5_configure_the_read_model_components"></a>Step 5: Configure the read model components</h3>
<div class="paragraph">
<p>Finally, let&#8217;s wire everything together with a proper Axon Framework 5 configuration:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/faculty/read/coursestats/CourseStatsConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import org.axonframework.eventhandling.GlobalSequenceTrackingToken;
import org.axonframework.eventhandling.configuration.EventProcessorModule;
import org.axonframework.eventhandling.pooled.PooledStreamingEventProcessorModule;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;

import java.util.concurrent.CompletableFuture;

public class CourseStatsConfiguration {

    public static EventSourcingConfigurer configure(EventSourcingConfigurer configurer) {
        PooledStreamingEventProcessorModule projectionProcessor = EventProcessorModule <i class="conum" data-value="1"></i><b>(1)</b>
                .pooledStreaming("Projection_CourseStats_Processor")
                .eventHandlingComponents(
                        c -&gt; c.annotated(cfg -&gt; new CoursesStatsProjection(cfg.getComponent(CourseStatsRepository.class))) <i class="conum" data-value="2"></i><b>(2)</b>
                )
                // Due to a minor bug in the InMemoryEventStorageEngine this customization is needed if you want to use the implementation in the tests
                .customized((c, cus) -&gt; cus.initialToken(s -&gt; CompletableFuture.completedFuture(new GlobalSequenceTrackingToken(0))));

        return configurer
                .componentRegistry(cr -&gt; cr.registerComponent(CourseStatsRepository.class, cfg -&gt; new InMemoryCourseStatsRepository())) <i class="conum" data-value="3"></i><b>(3)</b>
                .modelling(modelling -&gt; modelling.messaging(messaging -&gt; messaging.eventProcessing(eventProcessing -&gt;
                        eventProcessing.pooledStreaming(ps -&gt; ps.processor(projectionProcessor)) <i class="conum" data-value="4"></i><b>(4)</b>
                )));
    }

    private CourseStatsConfiguration() {
        // Prevent instantiation
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a pooled streaming event processor for handling projection events</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register the projection with dependency injection of the repository</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register the repository implementation as a component</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register the event processor with the framework</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_read_model"><a class="anchor" href="#_testing_the_read_model"></a>Testing the read model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s create comprehensive tests to verify our read model works correctly:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/io/axoniq/demo/university/faculty/read/coursestats/CourseStatsProjectionTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.axoniq.demo.university.faculty.read.coursestats;

import io.axoniq.demo.university.UniversityApplicationTest;
import io.axoniq.demo.university.faculty.events.*;
import io.axoniq.demo.university.shared.ids.CourseId;
import io.axoniq.demo.university.shared.ids.StudentId;
import org.awaitility.Awaitility;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

public class CourseStatsProjectionTest extends UniversityApplicationTest { <i class="conum" data-value="1"></i><b>(1)</b>

    @Override
    protected EventSourcingConfigurer overrideConfigurer(EventSourcingConfigurer configurer) { <i class="conum" data-value="2"></i><b>(2)</b>
        return CourseStatsConfiguration.configure(configurer);
    }

    @Nested
    class CourseCreation { <i class="conum" data-value="3"></i><b>(3)</b>

        @Test
        void givenNotExistingCourse_WhenGetById_ThenNotFound() {
            // given
            var courseId = CourseId.random();

            // when
            var found = courseStatsRepository().findById(courseId);

            // then
            assertThat(found).isEmpty();
        }

        @Test
        void givenCourseCreated_WhenGetById_ThenFoundCourseWithInitialCapacity() {
            // given
            var courseId = CourseId.random();
            eventOccurred(
                    new CourseCreated(courseId, "Event Sourcing in Practice", 42)
            );

            // when &amp; then
            CoursesStatsReadModel expectedReadModel = new CoursesStatsReadModel(
                    courseId,
                    "Event Sourcing in Practice",
                    42,
                    0 // Initially no students
            );
            assertReadModel(expectedReadModel);
        }
    }

    @Nested
    class CourseUpdates {

        @Test
        void givenCourseCreated_WhenCourseRenamed_ThenReadModelUpdatedWithNewName() {
            // given
            var courseId = CourseId.random();
            var originalName = "Event Sourcing in Practice";
            var newName = "Advanced Event Sourcing";

            eventOccurred(new CourseCreated(courseId, originalName, 42));
            eventOccurred(new CourseRenamed(courseId, newName));

            // when &amp; then
            CoursesStatsReadModel expectedReadModel = new CoursesStatsReadModel(
                    courseId,
                    newName, // Updated name
                    42,
                    0
            );
            assertReadModel(expectedReadModel);
        }

        @Test
        void givenCourseCreated_WhenCourseCapacityChanged_ThenReadModelUpdatedWithNewCapacity() {
            // given
            var courseId = CourseId.random();
            var originalCapacity = 42;
            var newCapacity = 100;

            eventOccurred(new CourseCreated(courseId, "Event Sourcing in Practice", originalCapacity));
            eventOccurred(new CourseCapacityChanged(courseId, newCapacity));

            // when &amp; then
            CoursesStatsReadModel expectedReadModel = new CoursesStatsReadModel(
                    courseId,
                    "Event Sourcing in Practice",
                    newCapacity, // Updated capacity
                    0
            );
            assertReadModel(expectedReadModel);
        }
    }

    @Nested
    class StudentEnrollments {

        @Test
        void givenCourseCreated_WhenStudentSubscribedToCourse_ThenReadModelUpdatedWithIncreasedSubscribedStudents() {
            // given
            var courseId = CourseId.random();
            var studentId = StudentId.random();

            eventOccurred(new CourseCreated(courseId, "Event Sourcing in Practice", 42));
            eventOccurred(new StudentSubscribedToCourse(studentId, courseId));

            // when &amp; then
            CoursesStatsReadModel expectedReadModel = new CoursesStatsReadModel(
                    courseId,
                    "Event Sourcing in Practice",
                    42,
                    1 // One student subscribed
            );
            assertReadModel(expectedReadModel);
        }

        @Test
        void givenCourseCreatedWithStudentSubscribed_WhenStudentUnsubscribedFromCourse_ThenReadModelUpdatedWithDecreasedSubscribedStudents() {
            // given
            var courseId = CourseId.random();
            var studentId = StudentId.random();

            eventOccurred(new CourseCreated(courseId, "Event Sourcing in Practice", 42));
            eventOccurred(new StudentSubscribedToCourse(studentId, courseId));
            eventOccurred(new StudentUnsubscribedFromCourse(studentId, courseId));

            // when &amp; then
            CoursesStatsReadModel expectedReadModel = new CoursesStatsReadModel(
                    courseId,
                    "Event Sourcing in Practice",
                    42,
                    0 // Back to zero students
            );
            assertReadModel(expectedReadModel);
        }
    }

    private void assertReadModel(CoursesStatsReadModel expectedReadModel) { <i class="conum" data-value="4"></i><b>(4)</b>
        Awaitility.await().untilAsserted(() -&gt; {
            var found = courseStatsRepository().findById(expectedReadModel.courseId());
            assertThat(found).isNotEmpty();
            assertThat(found).hasValue(expectedReadModel);
        });
    }

    private CourseStatsRepository courseStatsRepository() { <i class="conum" data-value="5"></i><b>(5)</b>
        return sut.getComponent(CourseStatsRepository.class);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend the test infrastructure base class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure our read model components for testing</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Group tests logically using nested test classes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Async assertion using Awaitility, because the projection is eventually consistent, we need to wait for it to be updated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Helper to access the repository from the test configuration</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_read_model_concepts"><a class="anchor" href="#_key_read_model_concepts"></a>Key read model concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_write_model_vs_query_model"><a class="anchor" href="#_write_model_vs_query_model"></a>Write model vs query model</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspect</th>
<th class="tableblock halign-left valign-top">Write Model</th>
<th class="tableblock halign-left valign-top">Query Model</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command processing, business logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query processing, optimized views</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Consistency</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strong consistency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eventually consistent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Performance</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimized for writes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimized for reads</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Complexity</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business logic complexity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple data transformation</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_the_main_application"><a class="anchor" href="#_integration_with_the_main_application"></a>Integration with the main application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use this read model in your main application, register the configuration:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/io/axoniq/demo/university/UniversityAxonApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class UniversityAxonApplication {

    public static ApplicationConfigurer configurer() {
        return configurer(c -&gt; {
            // Other configurations...
            CourseStatsConfiguration.configure(c); <i class="conum" data-value="1"></i><b>(1)</b>
        });
    }

    // rest omitted for brevity
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register the read model configuration to enable course statistics tracking</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you have learned how to implement read models (projections) with Axon Framework 5. Key takeaways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Read models</strong> provide query-optimized views of your data built from events</p>
</li>
<li>
<p><strong>Event handlers</strong> in projections update read models as events are processed</p>
</li>
<li>
<p><strong>Repository pattern</strong> abstracts read model storage and retrieval</p>
</li>
<li>
<p><strong>Testing</strong> uses async assertions to handle eventually consistent updates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read models enable powerful query capabilities, real-time dashboards, and optimized APIs while maintaining the benefits of Event Sourcing and CQRS architecture.
They form the foundation for building responsive user interfaces and analytical systems in event-driven applications.</p>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../implement-stateful-event-handler/">Feature: Send Notification To The Administrator When All Courses Are Fully Booked</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://axoniq.bsky.social/">Bluesky</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>&nbsp;</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.instagram.com/axoniq/">Instagram</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>

  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/page-actions.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
    </div>
  </body>
</html>
