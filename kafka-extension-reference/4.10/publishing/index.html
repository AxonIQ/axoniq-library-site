<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Publishing Events to Kafka</title>
    <link rel="canonical" href="https://docs.axoniq.io/kafka-extension-reference/4.10/publishing/">
    <link rel="prev" href="../">
    <link rel="next" href="../consuming/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../../_/img/apple-touch-icon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


  </head>
  <body class="article">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../../_/img/logo-dark4x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../axon-framework-reference/development/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/v2024.2/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.11/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
        <a class="navbar-item navbar-button" href="https://console.axoniq.io" target="_blank">AxonIQ Console</a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../">Kafka Extension Reference </a></li>
    <li><a href="./">Publishing Events to Kafka</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/extension-kafka/edit/axon-kafka-4.10.x/docs/reference/modules/ROOT/pages/publishing.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Publishing%20Events%20to%20Kafka" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Publishing%20Events%20to%20Kafka%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BPublishing%20Events%20to%20Kafka%5D(https%3A%2F%2Fdocs.axoniq.io%2Fkafka-extension-reference%2F4.10%2Fpublishing%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.10</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../development/publishing/">development</a>
    <a class="version item is-current" href="./">4.10</a>
  </div>
</div>
</div>
<div class="body">
<div class="nav-container" data-component="kafka-extension-reference" data-version="4.10">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../">Kafka Extension Reference</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="./">Publishing Events to Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../consuming/">Consuming Events From Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../message-format/">Customizing Event Message Format</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../springboot-configuration/">Configuration in SpringBoot</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/">Release notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Publishing Events to Kafka</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When Event Messages are published to an Event Bus (or Event Store), they can be forwarded to a Kafka topic using the <code>KafkaPublisher</code>. To achieve this it will utilize a Kafka <code>Producer</code>, retrieved through Axon&#8217;s <code>ProducerFactory</code>. The <code>KafkaPublisher</code> in turn receives the events to publish from a <code>KafkaEventPublisher</code>.</p>
</div>
<div class="paragraph">
<p>Since the <code>KafkaEventPublisher</code> is an event message handler in Axon terms, we can provide it to any <a href="../../../axon-framework-reference/development/events/event-processors/" class="xref page">Event Processor</a> to receive the published events. The choice of event processor which brings differing characteristics for event publication to Kafka:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Subscribing Event Processor</strong> - publication of messages to Kafka will occur in the same thread (and Unit of Work) which published the events to the event bus. This approach ensures failure to publish to Kafka enforces failure of the initial event publication on the event bus</p>
</li>
<li>
<p><strong>Tracking Event Processor</strong> - publication of messages to Kafka is run in a different thread (and Unit of Work) than the one which published the events to the event bus. This approach ensures the event has been published on the event bus regardless of whether publication to Kafka works</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When setting up event publication it is also important to take into account which <code>ConfirmationMode</code> is used. The <code>ConfirmationMode</code> influences the process of actually producing an event message on a Kafka topic, but also what kind of <code>Producer</code> the <code>ProducerFactory</code> will instantiate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>TRANSACTIONAL</strong> - This will require the <code>Producer</code> to start, commit and (in case of failure) rollback the transaction of publishing an event message. Alongside this, it will create a pool of <code>Producer</code> instances in the <code>ProducerFactory</code> to avoid continuous creation of new ones, requiring the user to provide a "transactional id prefix" to uniquely identify every <code>Producer</code> in the pool.</p>
</li>
<li>
<p><strong>WAIT_FOR_ACK</strong> - Setting "WAIT_FOR_ACK" as the <code>ConfirmationMode</code> will require the <code>Producer</code> instance to wait for a default of 1 second (configurable on the <code>KafkaPublisher</code>) until the event message publication has been acknowledged. Alongside this, it will create a single, shareable <code>Producer</code> instance from within the <code>ProducerFactory</code>.</p>
</li>
<li>
<p><strong>NONE</strong> - This is the default mode, which only ensures a single, shareable <code>Producer</code> instance from within the <code>ProducerFactory</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_event_publication_to_kafka"><a class="anchor" href="#_configuring_event_publication_to_kafka"></a>Configuring event publication to Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is a several step process to configure Event publication to Kafka, which starts with the <code>ProducerFactory</code>. Axon provides the <code>DefaultProducerFactory</code> implementation of the <code>ProducerFactory</code>, which should be instantiated through the provided <code>DefaultProducerFactory.Builder</code>.</p>
</div>
<div class="paragraph">
<p>The builder has one hard requirement, which is the <code>Producer</code> configuration <code>Map</code>. The <code>Map</code> contains the settings to use for the Kafka <code>Producer</code> client, such as the Kafka instance locations. Please check the <a href="https://kafka.apache.org/" class="external" target="_blank" rel="noopener">Kafka documentation</a> for the possible settings and their values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...
    public ProducerFactory&lt;String, byte[]&gt; producerFactory(Duration closeTimeout,
                                                           int producerCacheSize,
                                                           Map&lt;String, Object&gt; producerConfiguration,
                                                           ConfirmationMode confirmationMode,
                                                           String transactionIdPrefix) {
        return DefaultProducerFactory.&lt;String, byte[]&gt;builder()
                .closeTimeout(closeTimeout)                 // Defaults to "30" seconds
                .producerCacheSize(producerCacheSize)       // Defaults to "10"; only used for "TRANSACTIONAL" mode
                .configuration(producerConfiguration)       // Hard requirement
                .confirmationMode(confirmationMode)         // Defaults to a Confirmation Mode of "NONE"
                .transactionalIdPrefix(transactionIdPrefix) // Hard requirement when in "TRANSACTIONAL" mode
                .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second infrastructure component to introduce is the <code>KafkaPublisher</code>, which has a hard requirement on the <code>ProducerFactory</code>. Additionally, this would be the place to define the Kafka topics upon which Axon event messages will be published. You can set a function from event to <code>Optional&lt;String&gt;</code>. You can use this to only publish certain events, or put different events to different topics. Its not uncommon for Kafka topics to only contain one type of message. Note that the <code>KafkaPublisher</code> needs to be <code>shutDown</code> properly, to ensure all <code>Producer</code> instances are properly closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...

    public KafkaPublisher&lt;String, byte[]&gt; kafkaPublisher(String topic,
                                                         ProducerFactory&lt;String, byte[]&gt; producerFactory,
                                                         KafkaMessageConverter&lt;String, byte[]&gt; kafkaMessageConverter,
                                                         int publisherAckTimeout) {
        return KafkaPublisher.&lt;String, byte[]&gt;builder()
                .topicResolver(m -&gt; Optional.of(topic))     // Defaults to "Axon.Events" for all events
                .producerFactory(producerFactory)           // Hard requirement
                .messageConverter(kafkaMessageConverter)    // Defaults to a "DefaultKafkaMessageConverter"
                .publisherAckTimeout(publisherAckTimeout)   // Defaults to "1000" milliseconds; only used for "WAIT_FOR_ACK" mode
                .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, we need to provide Axon&#8217;s event messages to the <code>KafkaPublisher</code>. To that end a <code>KafkaEventPublisher</code> should be instantiated through the builder pattern. Remember to add the <code>KafkaEventPublisher</code> to an event processor implementation of your choice. It is recommended to use the <code>KafkaEventPublisher#DEFAULT_PROCESSING_GROUP</code> as the processing group name of the event processor to distinguish it from other event processors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...
    public KafkaEventPublisher&lt;String, byte[]&gt; kafkaEventPublisher(KafkaPublisher&lt;String, byte[]&gt; kafkaPublisher) {
        return KafkaEventPublisher.&lt;String, byte[]&gt;builder()
                .kafkaPublisher(kafkaPublisher)             // Hard requirement
                .build();
    }

    public void registerPublisherToEventProcessor(EventProcessingConfigurer eventProcessingConfigurer,
                                                  KafkaEventPublisher&lt;String, byte[]&gt; kafkaEventPublisher) {
        String processingGroup = KafkaEventPublisher.DEFAULT_PROCESSING_GROUP;
        eventProcessingConfigurer.registerEventHandler(configuration -&gt; kafkaEventPublisher)
                                 .assignHandlerTypesMatching(
                                         processingGroup,
                                         clazz -&gt; clazz.isAssignableFrom(KafkaEventPublisher.class)
                                 )
                                 .registerSubscribingEventProcessor(processingGroup);
        // Replace `registerSubscribingEventProcessor` for `registerTrackingEventProcessor` to use a tracking processor
    }
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_topic_partition_publication_considerations"><a class="anchor" href="#_topic_partition_publication_considerations"></a>Topic partition publication considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kafka ensures message ordering on a topic-partition level, not on an entire topic. To control events of a certain group to be placed in a dedicated partition, based on aggregate identifier for example, the <a href="../message-format/" class="xref page">message converter&#8217;s</a> <code>SequencingPolicy</code> can be utilized.</p>
</div>
<div class="paragraph">
<p>The topic-partition pair events have been published in also has impact on event consumption. This extension mitigates any ordering concerns with the <a href="../consuming/#streamable-messasge-source" class="xref page">streamable</a> solution, by ensuring a <code>Consumer</code> always receives <strong>all</strong> events of a topic to be able to perform a complete ordering. This guarantee is however not given when using the <a href="../consuming/#subscribable-message-source" class="xref page">subscribable</a> event consumption approach. The subscribable stream leaves all the ordering specifics in the hands of Kafka, which means the events should be published on a consistent partition to ensure ordering.</p>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../">Kafka Extension Reference</a></span>
  <span class="next"><a href="../consuming/">Consuming Events From Kafka</a></span>
</nav>
    </article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-cloud">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-synapse">Axon Synapse</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://axoniq.bsky.social/">Bluesky</a></li>
          <li><a class="ext" target="_blank" href="https://www.instagram.com/axoniq/">Instagram</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
