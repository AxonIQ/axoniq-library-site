<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reactor Gateways</title>
    <link rel="canonical" href="https://docs.axoniq.io/reactor-extension-reference/4.11/reactor-gateways/">
    <link rel="prev" href="../">
    <link rel="next" href="../release-notes/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../../_/img/apple-touch-icon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


  </head>
  <body class="article">
    <div class="banner">
    <a href="https://console.axoniq.io">Gain deep insights into Axon Framework applications with AxonIQ console. <span class="banner_button">Start now</span></a>
</div>    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../../_/img/logo-dark4x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/v2024.2/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.11/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
        <a class="navbar-item navbar-button" href="https://console.axoniq.io" target="_blank">AxonIQ Console</a>
      </div>
    </div>
  </nav>
</header>
    <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../">Reactor Extension Reference </a></li>
    <li><a href="./">Reactor Gateways</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/extension-reactor/edit/axon-reactor-4.11.x/docs/reference/modules/ROOT/pages/reactor-gateways.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Reactor%20Gateways" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Reactor%20Gateways%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BReactor%20Gateways%5D(https%3A%2F%2Fdocs.axoniq.io%2Freactor-extension-reference%2F4.11%2Freactor-gateways%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.11</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item is-current" href="./">4.11</a>
    <a class="version item" href="../../4.10/reactor-gateways/">4.10</a>
  </div>
</div>
</div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="reactor-extension-reference" data-version="4.11">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../">Reactor Extension Reference</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="./">Reactor Gateways</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/">Release notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Reactor Gateways</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The "Reactive Gateways" offer a reactive API wrapper around the command, query and event bus. Most of the operations are similar to those from non-reactive gateways, simply replacing the <code>CompletableFuture</code> with either a <code>Mono</code> or <code>Flux</code>. In some cases, the API is expended to ease use of common reactive patterns.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Reactor doesn&#8217;t allow <code>null</code> values in streams. Any <code>null</code> value returned from the handler will be mapped to <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html#empty" class="external" target="_blank" rel="noopener"><code>Mono#empty()</code></a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Retrying operations</div>
<div class="paragraph">
<p>All operations support Reactor&#8217;s retry mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">reactiveQueryGateway.query(query, ResponseType.class).retry(5);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This call will retry sending the query a maximum of five times when it fails.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_in_springboot"><a class="anchor" href="#_configuration_in_springboot"></a>Configuration in SpringBoot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension can be added as a Spring Boot starter dependency to your project using group id <code>org.axonframework.extensions.reactor</code> and artifact id <code>axon-reactor-spring-boot-starter</code>. The implementation of the extension can be found <a href="https://github.com/AxonFramework/extension-reactor" class="external" target="_blank" rel="noopener">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactor_command_gateway"><a class="anchor" href="#_reactor_command_gateway"></a>Reactor command gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the methods on the <code>ReactorCommandGateway</code>.</p>
</div>
<div class="sect2">
<h3 id="send"><a class="anchor" href="#send"></a><code>send</code></h3>
<div class="paragraph">
<p>Sends the given command once the caller subscribes to the command result. Returns immediately.</p>
</div>
<div class="paragraph">
<p>A common pattern is using the REST API to send a command. In this case it is recommend to for example use <a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html" class="external" target="_blank" rel="noopener">WebFlux</a>, and return the command result <code>Mono</code> directly to the controller:</p>
</div>
<div class="listingblock">
<div class="title">Sending a command from a Spring WebFlux Controller.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SpringCommandController {

    private final ReactorCommandGateway reactiveCommandGateway;

    @PostMapping
    public Mono&lt;CommandHandlerResponseBody&gt; sendCommand(@RequestBody CommandBody command) {
        return reactiveCommandGateway.send(command);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the command handling function returns type <code>void</code>, <code>Mono&lt;CommandHandlerResponseBody&gt;</code> should be replaced with <code>Mono&lt;Void&gt;</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another common pattern is "send and forget":</p>
</div>
<div class="listingblock">
<div class="title">Function that sends a command and returns immediately without waiting for the result.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class CommandDispatcher {

    private final ReactorCommandGateway reactiveCommandGateway;

    public void sendAndForget(MyCommand command) {
         reactiveCommandGateway.send(command)
                               .subscribe();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sendall"><a class="anchor" href="#sendall"></a><code>sendAll</code></h3>
<div class="paragraph">
<p>This method uses the given <code>Publisher</code> of commands to dispatch incoming commands.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This operation is available only in the Reactor extension. Use it to connect third-party streams that delivers commands.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Connects an external input stream directly to the Reactor Command Gateway.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class CommandPublisher {

    private final ReactorCommandGateway reactiveCommandGateway;

    @PostConstruct
    public void startReceivingCommands(Flux&lt;CommandBody&gt; inputStream) {
        reactiveCommandGateway.sendAll(inputStream)
                              .subscribe();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sendAll operation will keep sending commands until the input stream is canceled.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>send</code> and <code>sendAll</code> do not offer <em>any</em> backpressure, yet. The only backpressure mechanism in place is that commands will be sent sequentially; thus once the result of a previous command arrives. The number of commands is prefetched from an incoming stream and stored in a buffer for sending (see <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#concatMap" class="external" target="_blank" rel="noopener"><code>Flux#concatMap</code></a>). <strong>This slows down sending</strong>, but does not guarantee that the <code>Subscriber</code> will not be overwhelmed with commands if they are sent too fast.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactor_query_gateway"><a class="anchor" href="#_reactor_query_gateway"></a>Reactor query gateway</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="query"><a class="anchor" href="#query"></a><code>query</code></h3>
<div class="paragraph">
<p>Sends the given <code>query</code>, expecting a response in the form of <code>responseType</code> from a single source.</p>
</div>
<div class="listingblock">
<div class="title">Recommended way of using the Reactor query gateway within a Spring REST controller.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SpringQueryController {

    private final ReactorQueryGateway reactiveQueryGateway;

    // The query's Mono is returned to the Spring controller. Subscribe control is given to Spring Framework.
    @GetMapping
    public Mono&lt;SomeResponseType&gt; findAll(FindAllQuery query, Class&lt;SomeResponseType&gt; responseType) {
        return reactiveQueryGateway.query(query, responseType);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scattergather"><a class="anchor" href="#scattergather"></a><code>scatterGather</code></h3>
<div class="paragraph">
<p>Sends the given <code>query</code>, expecting a response in the form of <code>responseType</code> from several sources within a specified <code>duration</code>.</p>
</div>
<div class="listingblock">
<div class="title">Sends a given query that stops after receiving three results, or after 5 seconds.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SpringQueryController {

    private final ReactorQueryGateway reactiveQueryGateway;

    @GetMapping
    public Flux&lt;SomeResponseType&gt; findMany(FindManyQuery query) {
        return reactiveQueryGateway.scatterGather(query, SomeResponseType.class, Duration.ofSeconds(5)).take(3);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_subscription_queries"><a class="anchor" href="#_subscription_queries"></a>Subscription queries</h3>
<div class="paragraph">
<p>Firstly, the Reactor API for subscription queries in Axon is not new.</p>
</div>
<div class="paragraph">
<p>However, we noticed several patterns which are often used, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Concatenating initial results with query updates in a single stream, or</p>
</li>
<li>
<p>skipping the initial result all together.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As such, the Reactor Extension provides several methods to ease usage of these common patterns.</p>
</div>
<div class="sect3">
<h4 id="subscriptionquery"><a class="anchor" href="#subscriptionquery"></a><code>subscriptionQuery</code></h4>
<div class="paragraph">
<p>Sends the given <code>query</code>, returns the initial result and keeps streaming incremental updates until a subscriber unsubscribes from the <code>Flux</code>.</p>
</div>
<div class="paragraph">
<p>Note that this method should be used when the response type of the initial result and incremental update match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;ResultType&gt; resultFlux = reactiveQueryGateway.subscriptionQuery("criteriaQuery", ResultType.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above invocation through the <code>ReactorQueryGateway</code> is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SubscriptionQuerySender {

    private final ReactorQueryGateway reactiveQueryGateway;

    public Flux&lt;SomeResponseType&gt; sendSubscriptionQuery(SomeQuery query, Class&lt;SomeResponseType&gt; responseType) {
        return reactiveQueryGateway.subscriptionQuery(query, responseType, responseType)
                                   .flatMapMany(result -&gt; result.initialResult()
                                                                .concatWith(result.updates())
                                                                .doFinally(signal -&gt; result.close()));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subscriptionquerymany"><a class="anchor" href="#subscriptionquerymany"></a><code>subscriptionQueryMany</code></h4>
<div class="paragraph">
<p>Sends the given <code>query</code>, returns the initial result and keeps streaming incremental updates until a subscriber unsubscribes from the <code>Flux</code>.</p>
</div>
<div class="paragraph">
<p>This operation should be used when the initial result contains multiple instances of the response type which needs to be flattened. Additionally, the response type of the initial response and incremental updates need to match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;ResultType&gt; resultFlux = reactiveQueryGateway.subscriptionQueryMany("criteriaQuery", ResultType.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above invocation through the <code>ReactorQueryGateway</code> is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SubscriptionQuerySender {

    private final ReactorQueryGateway reactiveQueryGateway;

    public Flux&lt;SomeResponseType&gt; sendSubscriptionQuery(SomeQuery query, Class&lt;SomeResponseType&gt; responseType) {
        return reactiveQueryGateway.subscriptionQuery(query,
                                                      ResponseTypes.multipleInstancesOf(responseType),
                                                      ResponseTypes.instanceOf(responseType))
                                   .flatMapMany(result -&gt; result.initialResult()
                                                                .flatMapMany(Flux::fromIterable)
                                                                .concatWith(result.updates())
                                                                .doFinally(signal -&gt; result.close()));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="queryupdated"><a class="anchor" href="#queryupdated"></a><code>queryUpdates</code></h4>
<div class="paragraph">
<p>Sends the given <code>query</code> and streams incremental updates until a subscriber unsubscribes from the <code>Flux</code>.</p>
</div>
<div class="paragraph">
<p>This method could be used when subscriber is only interested in updates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;ResultType&gt; updatesOnly = reactiveQueryGateway.queryUpdates("criteriaQuery", ResultType.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above invocation through the ReactorQueryGateway is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SubscriptionQuerySender {

    private final ReactorQueryGateway reactiveQueryGateway;

    public Flux&lt;SomeResponseType&gt; sendSubscriptionQuery(SomeQuery query, Class&lt;SomeResponseType&gt; responseType) {
        return reactiveQueryGateway.subscriptionQuery(query, ResponseTypes.instanceOf(Void.class), responseType)
                                   .flatMapMany(result -&gt; result.updates()
                                                                .doFinally(signal -&gt; result.close()));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In the above shown methods, the subscription query is closed automatically after a subscriber has unsubscribed from the <code>Flux</code>. When using the regular <code>QueryGateway</code>, the subscription query needs to be closed manually however.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactor_event_gateway"><a class="anchor" href="#_reactor_event_gateway"></a>Reactor event gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reactive variation of the <code>EventGateway</code>. Provides support for reactive return types such as <code>Flux</code>.</p>
</div>
<div class="sect2">
<h3 id="publish"><a class="anchor" href="#publish"></a><code>publish</code></h3>
<div class="paragraph">
<p>Publishes the given <code>events</code> once the caller subscribes to the resulting <code>Flux</code>.</p>
</div>
<div class="paragraph">
<p>This method returns events that were published. Note that the returned events may be different from those the user has published, granted an <a href="#_interceptors">interceptor</a> has been registered which modifies events.</p>
</div>
<div class="listingblock">
<div class="title">Example of dispatcher modified events, returned to user as the result <code>Flux</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class EventPublisher {

    private final ReactorEventGateway reactiveEventGateway;

    // Register a dispatch interceptor to modify the event messages
    public EventPublisher() {
        reactiveEventGateway.registerDispatchInterceptor(
            eventMono -&gt; eventMono.map(event -&gt; GenericEventMessage.asEventMessage("intercepted" + event.getPayload()))
        );
    }

    public void publishEvent() {
        Flux&lt;Object&gt; result = reactiveEventGateway.publish("event");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interceptors"><a class="anchor" href="#_interceptors"></a>Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Axon provides a notion of <a href="../../../axon-framework-reference/4.11/messaging-concepts/message-intercepting/" class="xref page">interceptors</a>. The Reactor gateways allow for similar interceptor logic, namely the <code>ReactorMessageDispatchInterceptor</code> and <code>ReactorResultHandlerInterceptor</code>.</p>
</div>
<div class="paragraph">
<p>These interceptors allow us to centrally define rules and filters that will be applied to a message stream.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Interceptors will be applied in order they have been registered to the given component.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_react_dispatch_interceptors"><a class="anchor" href="#_react_dispatch_interceptors"></a>React dispatch interceptors</h3>
<div class="paragraph">
<p>The <code>ReactorMessageDispatchInterceptor</code> should be used to centrally apply rules and validations for outgoing messages. Note that a <code>ReactorMessageDispatchInterceptor</code> is an implementation of the default <code>MessageDispatchInterceptor</code> interface used throughout the framework. The implementation of this interface is described as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FunctionalInterface
public interface ReactorMessageDispatchInterceptor&lt;M extends Message&lt;?&gt;&gt; extends MessageDispatchInterceptor&lt;M&gt; {

    Mono&lt;M&gt; intercept(Mono&lt;M&gt; message);

    @Override
    default BiFunction&lt;Integer, M, M&gt; handle(List&lt;? extends M&gt; messages) {
        return (position, message) -&gt; intercept(Mono.just(message)).block();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It thus defaults the <code>MessageDispatchInterceptor#handle(List&lt;? extends M&gt;</code> method to utilize the <code>ReactorMessageDispatchInterceptor#intercept(Mono&lt;M&gt;</code>) method. As such, a <code>ReactorMessageDispatchInterceptor</code> could thus be configured on a plain Axon gateway too. Here are a couple of examples how a message dispatch interceptor could be used:</p>
</div>
<div class="listingblock">
<div class="title">Dispatch interceptor that adds key-value pairs to the message&#8217;s <code>MetaData</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerDispatchInterceptor(ReactorCommandGateway reactiveGateway) {
        reactiveGateway.registerDispatchInterceptor(
            msgMono -&gt; msgMono.map(msg -&gt; msg.andMetaData(Collections.singletonMap("key1", "value1")))
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dispatch interceptor that discards the message, based on a security flag in the Reactor Context.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerDispatchInterceptor(ReactorEventGateway reactiveGateway) {
        reactiveGateway.registerDispatchInterceptor(
            msgMono -&gt; msgMono.filterWhen(v -&gt; Mono.subscriberContext()
                              .filter(ctx-&gt; ctx.hasKey("security"))
                              .map(ctx-&gt;ctx.get("security")))
        );
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reactor_result_handler_interceptors"><a class="anchor" href="#_reactor_result_handler_interceptors"></a>Reactor result handler interceptors</h3>
<div class="paragraph">
<p>The <code>ReactorResultHandlerInterceptor</code> should be used to centrally apply rules and validations for incoming messages, a.k.a. results. The implementation of this interface is described as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FunctionalInterface
public interface ReactorResultHandlerInterceptor&lt;M extends Message&lt;?&gt;, R extends ResultMessage&lt;?&gt;&gt; {

    Flux&lt;R&gt; intercept(M message, Flux&lt;R&gt; results);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameters are the <code>message</code> that has been sent, and a <code>Flux</code> of <code>results</code> from that message, which is going to be intercepted. The <code>message</code> parameter can be useful if you want to apply a given result rule only for specific messages. Here are a couple of examples how a message result interceptor could be used:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This type of interceptor is available <em>only</em> in the Reactor Extension.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Result interceptor which discards all results that have a payload matching <code>blockedPayload</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerResultInterceptor(ReactorQueryGateway reactiveGateway) {
        reactiveGateway.registerResultHandlerInterceptor(
            (msg, results) -&gt; results.filter(r -&gt; !r.getPayload().equals("blockedPayload"))
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result interceptor which validates that the query result does not contain an empty <code>String</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerResultInterceptor(ReactorQueryGateway reactiveGateway) {
        reactiveQueryGateway.registerResultHandlerInterceptor(
            (query, results) -&gt; results.flatMap(r -&gt; {
                if (r.getPayload().equals("")) {
                    return Flux.&lt;ResultMessage&lt;?&gt;&gt;error(new RuntimeException("no empty strings allowed"));
                } else {
                    return Flux.just(r);
                }
            })
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result interceptor which discards all results where the <code>queryName</code> matches <code>myBlockedQuery</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerResultInterceptor(ReactorQueryGateway reactiveGateway) {
        reactiveQueryGateway.registerResultHandlerInterceptor(
            (q, results) -&gt; results.filter(it -&gt; !((boolean) q.getQueryName().equals("myBlockedQuery")))
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result interceptor which limits the result waiting time to thirty seconds per message.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerResultInterceptor(ReactorCommandGateway reactiveGateway) {
        reactiveGateway.registerResultHandlerInterceptor(
            (msg,results) -&gt; results.timeout(Duration.ofSeconds(30))
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result interceptor which limits the number of results to five entries, and logs all results.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ReactorConfiguration {

    public void registerResultInterceptor(ReactorCommandGateway reactiveGateway) {
        reactiveGateway.registerResultHandlerInterceptor(
            (msg,results) -&gt; results.log().take(5)
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../">Reactor Extension Reference</a></span>
  <span class="next"><a href="../release-notes/">Release notes</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-cloud">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-synapse">Axon Synapse</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://axoniq.bsky.social/">Bluesky</a></li>
          <li><a class="ext" target="_blank" href="https://www.instagram.com/axoniq/">Instagram</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
    </div>
  </body>
</html>
