<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Implementing Dead Letter Queues (DLQ)</title>
    <link rel="canonical" href="https://docs.axoniq.io/dead-letter-queue-guide/development/implementing/">
    <link rel="prev" href="../">
    <link rel="next" href="../retrying/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.ico" sizes="32x32">
    <link rel="icon" href="../../../_/img/icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="../../../_/img/icon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" href="../../../_/img/apple-touch-icon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


  </head>
  <body class="article">
    <div class="banner">
    <a href="https://console.axoniq.io">Manage and monitor your Axon Framework applications and Axon Server environments. <span class="banner_button" target="_blank">Try AxonIQ Console</span></a>
</div>    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io"><img src="../../../_/img/logo-dark4x.png" class="header_logo" /></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../axon-framework-reference/4.11/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/v2024.2/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-console-reference/">AxonIQ Console</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
          </div>
        </div>
        <a class="navbar-item navbar-button" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item navbar-button" href="https://discuss.axoniq.io" target="_blank">AxonIQ Discuss</a>
        <a class="navbar-item navbar-button" href="https://axoniq.io/contact" target="_blank">Get in touch</a>
      </div>
    </div>
  </nav>
</header>
    <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../">Dead-Letter Queues </a></li>
    <li><a href="../">Dead Letter Queues</a></li>
    <li><a href="./">Implementing dead letter queue</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/axon-4.10.x/docs/dead-letter-queue-guide/modules/ROOT/pages/implementing.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Implementing%20Dead%20Letter%20Queues%20(DLQ)" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Implementing%20Dead%20Letter%20Queues%20(DLQ)%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BImplementing%20Dead%20Letter%20Queues%20(DLQ)%5D(https%3A%2F%2Fdocs.axoniq.io%2Fdead-letter-queue-guide%2F4.10%2Fimplementing%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.10</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../development/implementing/">development</a>
    <a class="version item" href="../../4.11/implementing/">4.11</a>
    <a class="version item is-current" href="./">4.10</a>
  </div>
</div>
</div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="dead-letter-queue-guide" data-version="4.10">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../">Dead-Letter Queues</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Dead Letter Queues</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Implementing dead letter queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../retrying/">Retrying failed sequences</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/">Advanced use cases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
            <h1 class="page">Implementing Dead Letter Queues (DLQ)</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To enable a DLQ you need to configure the <code>SequencedDeadLetterQueue</code> component.
Like most components related to event processing, there are implementations available for JPA, JDBC, and Mongo.
To best leverage transactions, it&#8217;s best to choose the same implementation as the <code>TokenStore</code> and likely also for your projection. Please note that for best results, this also means having them located in the same database, or the same collection.</p>
</div>
<div class="paragraph">
<p>There are two ways of configuring the <code>SequencedDeadLetterQueue</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_dead_letter_queue_with_the_event_processor"><a class="anchor" href="#_register_a_dead_letter_queue_with_the_event_processor"></a>Register a dead letter queue with the event processor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first approach is to register a DLQ provider in the event processor configuration. This approach allows you to specify processing groups if you want to configure the DLQ only for some of them. As DLQs add complexity and introduce some overhead, you should prefer this method when you don&#8217;t need a separate DLQ for each processing group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    /**
     * Register the given {@code deadLetterProvider} as a default to build a {@link SequencedDeadLetterQueue} for
     * {@link EventProcessor}s created in this configuration.
     * &lt;p&gt;
     * The {@code deadLetterProvider} might return null if the given processing group name should not have a sequenced
     * dead letter queue. An explicitly sequenced dead letter queue set using
     * {@link #registerDeadLetterQueue(String, Function)} will always have precedence over the one provided by this method.
     *
     * @param deadLetterQueueProvider a builder {@link Function} that provides a {@link SequencedDeadLetterQueue} for a
     *                                processing group. It's possible to return null depending on the processing group.
     * @return the current {@link EventProcessingConfigurer} instance, for fluent interfacing
     */
    default EventProcessingConfigurer registerDeadLetterQueueProvider(
            Function&lt;String, Function&lt;Configuration, SequencedDeadLetterQueue&lt;EventMessage&lt;?&gt;&gt;&gt;&gt; deadLetterQueueProvider) {
        return this;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DeadLetterQueueProviderConfigurerModule</code> has an example of how you can use this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Bean
    @ConditionalOnMissingBean
    public DeadLetterQueueProviderConfigurerModule deadLetterQueueProviderConfigurerModule(
            EventProcessorProperties eventProcessorProperties,
            EntityManagerProvider entityManagerProvider,
            TransactionManager transactionManager,
            Serializer genericSerializer,
            @Qualifier("eventSerializer") Serializer eventSerializer
    ) {
        return new DeadLetterQueueProviderConfigurerModule(
                eventProcessorProperties,
                processingGroup -&gt; config -&gt; JpaSequencedDeadLetterQueue.builder()
                                                                        .processingGroup(processingGroup)
                                                                        .entityManagerProvider(entityManagerProvider)
                                                                        .transactionManager(transactionManager)
                                                                        .genericSerializer(genericSerializer)
                                                                        .eventSerializer(eventSerializer)
                                                                        .build()
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might notice the <code>EventProcessorProperties</code> parameter. That&#8217;s because with Spring autoconfiguration it&#8217;s easy to enable dead letter event processing for a specific processing group. You can do so by setting a property similar to <code>axon.eventhandling.processors.first.dlq.enabled=true</code>.
In this case, the processing group is <code>firsts</code>. Similarly, you can set caching and cache size.
Caching prevents unnecessary calls to the database, at the cost of keeping some of the sequence identifiers in memory.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_a_dead_letter_queue_to_a_specific_processing_group"><a class="anchor" href="#_add_a_dead_letter_queue_to_a_specific_processing_group"></a>Add a dead letter queue to a specific processing group</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The other way is to add a <code>SequencedDeadLetterQueue</code> to a specific processing group in the <code>EventProcessingConfigurer</code> using the <code>registerDeadLetterQueue</code> method.
For example for setting the <code>JpaSequencedDeadLetterQueue</code> on the <code>my-processing-group</code> in a non-Spring context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureDeadLetterQueue(EventProcessingConfigurer processingConfigurer) {
        // Replace "my-processing-group" for the processing group you want to configure the DLQ on.
        processingConfigurer.registerDeadLetterQueue(
                "my-processing-group",
                config -&gt; JpaSequencedDeadLetterQueue.builder()
                                                     .processingGroup("my-processing-group")
                                                     .maxSequences(256)
                                                     .maxSequenceSize(256)
                                                     .entityManagerProvider(config.getComponent(EntityManagerProvider.class))
                                                     .transactionManager(config.getComponent(TransactionManager.class))
                                                     .serializer(config.serializer())
                                                     .build()
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this enables the processing to continue in case of errors, it doesn&#8217;t retry the failed events automatically.
The next section explains some of the options to enable retries.</p>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../">Dead Letter Queues</a></span>
  <span class="next"><a href="../retrying/">Retrying failed sequences</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-framework">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axon-server">Axon Server</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/products/axoniq-console">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://www.axoniq.io/blog/protect-sensitive-data-in-an-event-sourced-application">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/">Customer Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://console.axoniq.io/">AxonIQ Console</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://axoniq.bsky.social/">Bluesky</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>&nbsp;</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.instagram.com/axoniq/">Instagram</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>

  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
    </div>
  </body>
</html>
