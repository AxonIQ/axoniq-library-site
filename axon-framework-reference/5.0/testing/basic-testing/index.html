<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basic Testing with AxonTestFixture</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/testing/basic-testing/">
    <link rel="prev" href="../">
    <link rel="next" href="../matchers-and-field-filters/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../_/img/favicon.png"><!-- 180Ã—180 -->
    <link rel="manifest" href="../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../_'</script>


<link rel="icon" href="../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../">Axon Framework</a>
                <a class="navbar-item" href="../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Framework Reference</a></li>
    <li><a href="../">Testing</a></li>
    <li><a href="./">Basic Testing</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/axon-5.0.x/docs/reference-guide/modules/testing/pages/basic-testing.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Basic%20Testing%20with%20AxonTestFixture" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Basic%20Testing%20with%20AxonTestFixture%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BBasic%20Testing%20with%20AxonTestFixture%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2F5.0%2Ftesting%2Fbasic-testing%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">5.0</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../../development/testing/basic-testing/">development</a>
    <a class="version item is-current" href="./">5.0</a>
    <a class="version item is-missing" href="../../../4.12/">4.12</a>
    <a class="version item is-missing" href="../../../4.11/">4.11</a>
    <a class="version item is-missing" href="../../../4.10/">4.10</a>
    <a class="version item is-missing" href="../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="5.0">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../migration/">Migration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/why-upgrade/">Why Upgrade?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/prerequisites/">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/solved-architecture-choices/">Resolved Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/understanding-architecture-principles/">Understanding Choices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/processing-context/">Processing Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../commands/">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-publishing/">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/event-processors/">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/subscribing/">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/infrastructure/">Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-store-internals/">Event Store Internals</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-versioning/">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Testing</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Basic Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../matchers-and-field-filters/">Matchers and Field Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced-testing/">Advanced Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../conversion/">Conversion</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/tracing/">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Basic Testing with AxonTestFixture</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>AxonTestFixture</code> is the main tool for testing Axon applications.
It provides a fluent API for setting up test scenarios, executing actions, and verifying results using a clear Given-When-Then pattern.</p>
</div>
<div class="paragraph">
<p><code>AxonTestFixture</code> is built on the same <code>ApplicationConfigurer</code> you use in production, which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>No duplicate configuration</strong> - Your tests use the same setup as your production code.</p>
</li>
<li>
<p><strong>Integration testing support</strong> - Test with real infrastructure (event stores, processors, etc).</p>
</li>
<li>
<p><strong>Consistent behavior</strong> - What works in tests works in production.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This makes the <code>AxonTestFixture</code> <strong>the</strong> choice whenever you want to test components that are attached to Axon.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_test_fixture"><a class="anchor" href="#_creating_a_test_fixture"></a>Creating a test fixture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_fixture_creation"><a class="anchor" href="#_basic_fixture_creation"></a>Basic fixture creation</h3>
<div class="paragraph">
<p>Create a fixture from any <code>ApplicationConfigurer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.eventsourcing.configuration.EventSourcedEntityModule;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        EventSourcingConfigurer configurer =
            EventSourcingConfigurer.create()
                                   .registerEntity(EventSourcedEntityModule.autodetected(
                                       String.class, Account.class
                                   ));
        fixture = AxonTestFixture.with(configurer);
    }

    @AfterEach
    void tearDown() {
        fixture.stop();  // Always stop the fixture
    }
    // tests...
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always call <code>fixture.stop()</code> in your <code>@AfterEach</code> method to properly release resources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fixture_with_customization"><a class="anchor" href="#_fixture_with_customization"></a>Fixture with customization</h3>
<div class="paragraph">
<p>You can customize the fixture using the <code>AxonTestFixture#with(ApplicationConfigurer, UnaryOperator&lt;Customization&gt;)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.eventsourcing.configuration.EventSourcedEntityModule;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        EventSourcingConfigurer configurer =
                EventSourcingConfigurer.create()
                                       .registerEntity(EventSourcedEntityModule.autodetected(
                                           String.class, Account.class
                                       ));
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.disableAxonServer()  // Disable Axon Server for tests
                                              .registerIgnoredField(MyEvent.class, "timestamp")
                                              .registerIgnoredField(MyEvent.class, "eventId")
        );
    }

    @AfterEach
    void tearDown() {
        fixture.stop();  // Always stop the fixture!
    }
    // tests...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Customization</code> given as the second parameter allows a number of adjustments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>disableAxonServer()</code> - Disable Axon Server connector (useful for local testing).</p>
</li>
<li>
<p><code>registerIgnoredField(Class&lt;?&gt; clazz, String field)</code> - Ignore specific fields during equality checks.</p>
</li>
<li>
<p><code>registerFieldFilter(FieldFilter filter)</code> - Register custom field filter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on field filters, be sure to read the dedicated <a href="../matchers-and-field-filters/" class="xref page">field filters</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reusing_production_configuration"><a class="anchor" href="#_reusing_production_configuration"></a>Reusing production configuration</h3>
<div class="paragraph">
<p>Although you can recreate your configuration specifically for your tests, it is recommended to reuse your production configuration.
This ensures your tests use the exact same configuration as production.</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_configuration_api" class="tab">
<p>Configuration API</p>
</li>
<li id="_tabs_1_spring_boot" class="tab">
<p>Spring Boot</p>
</li>
</ul>
</div>
<div id="_tabs_1_configuration_api--panel" class="tabpanel" aria-labelledby="_tabs_1_configuration_api">
<div class="paragraph">
<p>If you&#8217;re not using Axon&#8217;s configuration API directly, you can for example create a static configuration method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Production configuration class
public class AxonConfig {

    public static EventSourcingConfigurer configurer() {
        return EventSourcingConfigurer.create()
                                      .registerEntity(EventSourcedEntityModule.autodetected(
                                              String.class, Account.class
                                      ))
                                      .registerEntity(EventSourcedEntityModule.autodetected(
                                              String.class, Order.class
                                      ))
                                      .messaging(messaging -&gt; messaging.registerCommandHandlingModule(
                                              CommandHandlingModule.named("payment")
                                                                   .commandHandlers()
                                                                   .annotatedCommandHandlingComponent(c -&gt; new PaymentCommandHandler())
                                      ))
                                      .messaging(messaging -&gt; messaging.eventProcessing(AxonConfig::registerEventHandlers));
    }

    private static EventProcessingConfigurer registerEventHandlers(EventProcessingConfigurer eventProcessing) {
        return eventProcessing.pooledStreaming(pooledConfig -&gt; pooledConfig.processor(
                "my-processor",
                processorConfig -&gt; processorConfig.eventHandlingComponents(components -&gt; components.autodetected(
                        c -&gt; new NotificationEventHandler())
                ).notCustomized()
        ));
    }
}

// Test class
class AccountTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(AxonConfig.configurer());
    }

    @AfterEach
    void tearDown() {
        fixture.stop();  // Always stop the fixture!
    }
    // tests...
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_spring_boot--panel" class="tabpanel" aria-labelledby="_tabs_1_spring_boot">
<div class="paragraph">
<p>When using Spring Boot, the configurer is created by the Axon&#8217;s Spring Boot integration.
Inject it as a bean into your test for realistic integration testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.axonframework.test.server.AxonServerContainer;
import org.junit.jupiter.api.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.testcontainers.service.connection.ServiceConnection;
import org.testcontainers.junit.jupiter.Container;
import org.testcontainers.junit.jupiter.Testcontainers;

@SpringBootTest
@Testcontainers
class AccountTest {

    @Container
    @ServiceConnection
    static AxonServerContainer axonServer = new AxonServerContainer();

    @Autowired
    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(configurer);
    }

    @AfterEach
    void tearDown() {
        fixture.stop();
    }
    // Tests ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@SpringBootTest</code> annotation ensures Spring Boot starts with your production configuration, and <code>@Autowired</code> injects the configurer bean created by Axon&#8217;s Spring Boot integration.
The <code>AxonServerContainer</code> starts an Axon Server instance in a Docker container for realistic integration testing.
The <code>@ServiceConnection</code> annotation (Spring Boot 3.1+) automatically configures the Axon Server connection.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test_phases"><a class="anchor" href="#test_phases"></a>Test phases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every test follows a three-phase structure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong><a href="#given_phase">Given</a></strong> - Set up initial state for your test.</p>
</li>
<li>
<p><strong><a href="#when_phase">When</a></strong> - Execute the action being tested.</p>
</li>
<li>
<p><strong><a href="#then_phase">Then</a></strong> - Verify the results of the action.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The API enforces this structure with type-safe phase transitions.</p>
</div>
<div class="sect2">
<h3 id="given_phase"><a class="anchor" href="#given_phase"></a>Given-phase: Setting up initial state</h3>
<div class="paragraph">
<p>The given-phase defines the state before your test action.
Each operation runs in its own processing context and is immediately committed.</p>
</div>
<div class="sect3">
<h4 id="given_events"><a class="anchor" href="#given_events"></a>Given events</h4>
<div class="paragraph">
<p>You can define the given-phase by defining the events that should form the base for your tests.
In most event-driven applications, this is the recommended approach, as it gives granular control of what <strong>has</strong> happened until you move into the <a href="#when_phase">when-phase</a>.
The examples below show the provide operations you can use for this:</p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_single_event" class="tab">
<p>Single event</p>
</li>
<li id="_tabs_2_single_event_with_metadata" class="tab">
<p>Single event with metadata</p>
</li>
<li id="_tabs_2_multiple_events_at_once" class="tab">
<p>Multiple events at once</p>
</li>
</ul>
</div>
<div id="_tabs_2_single_event--panel" class="tabpanel" aria-labelledby="_tabs_2_single_event">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .event(new MoneyDepositedEvent("account-1", 100.00));
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_single_event_with_metadata--panel" class="tabpanel" aria-labelledby="_tabs_2_single_event_with_metadata">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.Metadata;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00), Metadata.with("userId", "user-123"));
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_multiple_events_at_once--panel" class="tabpanel" aria-labelledby="_tabs_2_multiple_events_at_once">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .events(
                       new AccountCreatedEvent("account-1", 500.00),
                       new MoneyDepositedEvent("account-1", 100.00)
               );
               // when...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can either use the <code>events(&#8230;&#8203;)</code> method with several events, or invoke the <code>events(&#8230;&#8203;)</code> method multiple times per event.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="given_commands"><a class="anchor" href="#given_commands"></a>Given commands</h4>
<div class="paragraph">
<p>Besides <a href="#given_events">given events</a>, you are able to derive the initial state based on commands as well.
This is useful when you want to test the full command handling flow, or our setup needs both command validation and event generation.
The examples below show the provide operations you can use for this:</p>
</div>
<div id="_tabs_3" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_3_single_command" class="tab">
<p>Single command</p>
</li>
<li id="_tabs_3_single_command_with_metadata" class="tab">
<p>Single command with metadata</p>
</li>
<li id="_tabs_3_multiple_commands_at_once" class="tab">
<p>Multiple commands at once</p>
</li>
</ul>
</div>
<div id="_tabs_3_single_command--panel" class="tabpanel" aria-labelledby="_tabs_3_single_command">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .command(new CreateAccountCommand("account-1", 500.00))
               .command(new DepositMoneyCommand("account-1", 100.00));
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_3_single_command_with_metadata--panel" class="tabpanel" aria-labelledby="_tabs_3_single_command_with_metadata">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.Metadata;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .command(new CreateAccountCommand("account-1", 500.00), Metadata.with("userId", "user-123"));
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_3_multiple_commands_at_once--panel" class="tabpanel" aria-labelledby="_tabs_3_multiple_commands_at_once">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .commands(
                       new CreateAccountCommand("account-1", 500.00),
                       new DepositMoneyCommand("account-1", 100.00)
               );
               // when...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can either use the <code>commands(&#8230;&#8203;)</code> method with several commands, or invoke the <code>command(&#8230;&#8203;)</code> method multiple times per command.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="no_prior_activity"><a class="anchor" href="#no_prior_activity"></a>Given no prior activity</h4>
<div class="paragraph">
<p>In some scenarios, there are no <a href="#given_events">given events</a> or <a href="#given_commands">given commands</a>.
When there is no priority activity, you can use the <code>noPriorActivity</code> method to initiate your test scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .noPriorActivity();
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="given_execute"><a class="anchor" href="#given_execute"></a>Given custom execute</h4>
<div class="paragraph">
<p>For complex setup scenarios you can use <code>execute(Function&lt;Configuration, ?&gt;)</code>.
The <code>execute()</code> grants access to the entire <code>Configuration</code>, allowing users to access any component they require.
This can be useful whenever you need to set up external state, mock (complex) test dependencies, or whenever the fixture does not support what you require.</p>
</div>
<div id="_tabs_4" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_4_execute" class="tab">
<p>Execute</p>
</li>
<li id="_tabs_4_asynchronous_execute" class="tab">
<p>Asynchronous execute</p>
</li>
</ul>
</div>
<div id="_tabs_4_execute--panel" class="tabpanel" aria-labelledby="_tabs_4_execute">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.modelling.repository.Repository;
import org.axonframework.test.fixture.AxonTestFixture;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .execute(config -&gt; {
                   // Access any component from configuration
                   var repository = config.getComponent(Repository.class);
                   // Perform custom setup
               });
               // when...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_4_asynchronous_execute--panel" class="tabpanel" aria-labelledby="_tabs_4_asynchronous_execute">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import java.util.concurrent.CompletableFuture;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .executeAsync(config -&gt; {
                   // Return CompletableFuture
                   return CompletableFuture.supplyAsync(() -&gt; {
                       // Async setup logic
                       return null;
                   });
               });
               // when...
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="when_phase"><a class="anchor" href="#when_phase"></a>When-phase: Executing the action</h3>
<div class="paragraph">
<p>The when-phase executes the action you&#8217;re testing.
The entire phase runs in a single processing context.</p>
</div>
<div class="sect3">
<h4 id="when_commands"><a class="anchor" href="#when_commands"></a>When dispatching commands</h4>
<div class="paragraph">
<p>In a lot of scenarios, the when-phase triggers by dispatching a command.
The command is dispatched through the command bus, and all resulting activity is recorded for verification.
The examples below show the provide operations you can use for this:</p>
</div>
<div id="_tabs_5" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_5_command" class="tab">
<p>Command</p>
</li>
<li id="_tabs_5_command_with_metadata" class="tab">
<p>Command with metadata</p>
</li>
</ul>
</div>
<div id="_tabs_5_command--panel" class="tabpanel" aria-labelledby="_tabs_5_command">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00));
               // then...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_5_command_with_metadata--panel" class="tabpanel" aria-labelledby="_tabs_5_command_with_metadata">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.Metadata;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00), Metadata.with("userId", "user-123"));
               // then...
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="when_events"><a class="anchor" href="#when_events"></a>When publishing events</h4>
<div class="paragraph">
<p>Besides <a href="#when_commands">when commands</a>, you are able to trigger the test based on events as well.
This is useful when you want to directly test your event handlers or simulate triggered events from an external system).
The examples below show the provide operations you can use for this:</p>
</div>
<div id="_tabs_6" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_6_single_event" class="tab">
<p>Single event</p>
</li>
<li id="_tabs_6_single_event_with_metadata" class="tab">
<p>Single event with metadata</p>
</li>
<li id="_tabs_6_multiple_events_at_once" class="tab">
<p>Multiple events at once</p>
</li>
</ul>
</div>
<div id="_tabs_6_single_event--panel" class="tabpanel" aria-labelledby="_tabs_6_single_event">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .events(new ExternalPaymentReceivedEvent("account-1", 100.00));
               // then...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_6_single_event_with_metadata--panel" class="tabpanel" aria-labelledby="_tabs_6_single_event_with_metadata">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.Metadata;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .events(
                   new ExternalPaymentReceivedEvent("account-1", 100.00),
                   Metadata.with("userId", "user-123")
               );
               // then...
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_6_multiple_events_at_once--panel" class="tabpanel" aria-labelledby="_tabs_6_multiple_events_at_once">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .events(
                   new ExternalPaymentReceivedEvent("account-1", 100.00),
                   new PaymentConfirmedEvent("account-1")
               );
               // then...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can either use the <code>events(&#8230;&#8203;)</code> method with several events, or invoke the <code>events(&#8230;&#8203;)</code> method multiple times per event.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="when_nothing"><a class="anchor" href="#when_nothing"></a>When nothing happens</h4>
<div class="paragraph">
<p>In some scenarios, you do not care about some triggering scenario like <a href="#when_commands">when commands</a> or <a href="#when_events">when events</a> provides.
Thus, when there is nothing happening in the system, you can use the <code>nothing</code> method to move to the <a href="#then_phase">then-phase</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .nothing();
               // then...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This option is useful whenever you want to validate against the given state directly, or if you want to validate the base reply from query handlers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="then_phase"><a class="anchor" href="#then_phase"></a>Then-phase: Verifying results</h3>
<div class="paragraph">
<p>The Then-phase verifies that the action from the <a href="#when_phase">when-phase</a> produced the expected results based on the <a href="#given_phase">given-phase&#8217;s</a> initial state.
As with given and when, there are a couple of options for you to validate your system fully.
Note that you are able to combine several then-phase verifiers to come to the desired validation!</p>
</div>
<div class="sect3">
<h4 id="then_successful"><a class="anchor" href="#then_successful"></a>Then verifying successful handling</h4>
<div class="paragraph">
<p>If you except the <a href="#when_phase">when-phase</a> to proceed without any exceptions, you can use the <code>success()</code> method as a quick validation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .success();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As stated at the start of <a href="#then_phase">this section</a>, you can follow up the <code>success()</code> check with another check, like <a href="#then_events">events</a>:
You can combine it with other assertions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .success()
               .events(new MoneyWithdrawnEvent("account-1", 100.00));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_exceptional"><a class="anchor" href="#then_exceptional"></a>Then verifying exceptional handling</h4>
<div class="paragraph">
<p>If you except the <a href="#when_phase">when-phase</a> to resolve exceptionally, you can utilize a number of <code>exception(&#8230;&#8203;)</code> methods:</p>
</div>
<div id="_tabs_7" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_7_specific_exception" class="tab">
<p>Specific exception</p>
</li>
<li id="_tabs_7_specific_exception_and_message" class="tab">
<p>Specific exception and message</p>
</li>
<li id="_tabs_7_custom_exception_matcher" class="tab">
<p>Custom exception matcher</p>
</li>
</ul>
</div>
<div id="_tabs_7_specific_exception--panel" class="tabpanel" aria-labelledby="_tabs_7_specific_exception">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .exception(InsufficientBalanceException.class);
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_7_specific_exception_and_message--panel" class="tabpanel" aria-labelledby="_tabs_7_specific_exception_and_message">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .exception(InsufficientBalanceException.class, "Insufficient balance");
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_7_custom_exception_matcher--panel" class="tabpanel" aria-labelledby="_tabs_7_custom_exception_matcher">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.junit.jupiter.api.Assertions.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .exceptionSatisfies(ex -&gt; {
                   assertInstanceOf(InsufficientBalanceException.class, ex);
                   var ibe = (InsufficientBalanceException) ex;
                   assertEquals("account-1", ibe.accountId());
                   assertEquals(100.00, ibe.requestedAmount());
               });
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_events"><a class="anchor" href="#then_events"></a>Then verifying events</h4>
<div class="paragraph">
<p>If the <a href="#when_phase">when-phase</a> was based on a <a href="#when_commands">command</a>, chances are high you want to verify the events, or events that have been published.
To that end, there are a number of event-specific methods you can use.
Examples of this are <code>events(&#8230;&#8203;)</code>, <code>eventsSatify(&#8230;&#8203;)</code>, <code>eventsMatch(&#8230;&#8203;)</code>, and <code>noEvents()</code>:</p>
</div>
<div id="_tabs_8" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_8_single_event" class="tab">
<p>Single event</p>
</li>
<li id="_tabs_8_multiple_events" class="tab">
<p>Multiple events</p>
</li>
<li id="_tabs_8_custom_event_validation" class="tab">
<p>Custom event validation</p>
</li>
<li id="_tabs_8_events_match_a_predicate" class="tab">
<p>Events match a predicate</p>
</li>
<li id="_tabs_8_no_events" class="tab">
<p>No events</p>
</li>
</ul>
</div>
<div id="_tabs_8_single_event--panel" class="tabpanel" aria-labelledby="_tabs_8_single_event">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .events(new MoneyWithdrawnEvent("account-1", 100.00));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_multiple_events--panel" class="tabpanel" aria-labelledby="_tabs_8_multiple_events">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .events(
                       new MoneyWithdrawnEvent("account-1", 100.00),
                       new BalanceUpdatedEvent("account-1", 400.00)
               );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can either use the <code>events(&#8230;&#8203;)</code> method with several events, or invoke the <code>events(&#8230;&#8203;)</code> method multiple times per event.</p>
</div>
</div>
<div id="_tabs_8_custom_event_validation--panel" class="tabpanel" aria-labelledby="_tabs_8_custom_event_validation">
<div id="then_event_satisfies" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.junit.jupiter.api.Assertions.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .eventsSatisfy(events -&gt; {
                   assertEquals(2, events.size());
                   MoneyWithdrawnEvent firstEvent =
                           events.getFirst().payloadAs(MoneyWithdrawnEvent.class);
                   assertEquals("account-1", firstEvent.accountId());
                   assertEquals(100.00, firstEvent.amount());
               });
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_events_match_a_predicate--panel" class="tabpanel" aria-labelledby="_tabs_8_events_match_a_predicate">
<div id="then_event_matches" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .eventsMatch(events -&gt; events.size() == 2
                       &amp;&amp; events.getFirst().payloadAs(MoneyWithdrawnEvent.class)
                                .accountId()
                                .equals("account-1"));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_no_events--panel" class="tabpanel" aria-labelledby="_tabs_8_no_events">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .noEvents();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_command_result"><a class="anchor" href="#then_command_result"></a>Then verifying command handling results</h4>
<div class="paragraph">
<p>If the <a href="#when_phase">when-phase</a> was based on a <a href="#when_commands">command</a>, you may want to verify the result your command handling functions return.
Thus, besides validating the <a href="#then_events">events</a> that have been published, you can for example validate the identifier of newly created entities:</p>
</div>
<div id="_tabs_9" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_9_result" class="tab">
<p>Result</p>
</li>
<li id="_tabs_9_result_satisfies" class="tab">
<p>Result satisfies</p>
</li>
<li id="_tabs_9_result_message_satisfies" class="tab">
<p>Result message satisfies</p>
</li>
</ul>
</div>
<div id="_tabs_9_result--panel" class="tabpanel" aria-labelledby="_tabs_9_result">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand("account-1", 500.00))
               .then()
               .resultMessagePayload("account-1");
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_9_result_satisfies--panel" class="tabpanel" aria-labelledby="_tabs_9_result_satisfies">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand("account-1", 500.00))
               .then()
               .resultMessagePayloadSatisfies(
                       String.class,
                       result -&gt; result.equals("account-1")
               );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_9_result_message_satisfies--panel" class="tabpanel" aria-labelledby="_tabs_9_result_message_satisfies">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand("account-1", 500.00))
               .then()
               .resultMessageSatisfies(
                       result -&gt; result.payloadAs(String.class).equals("account-1")
               );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_commands"><a class="anchor" href="#then_commands"></a>Then verifying dispatched commands</h4>
<div class="paragraph">
<p>Actions within the <a href="#when_phase">when-phase</a> can result in additional commands to be dispatched.
For example, if an event handler triggers the next step in a workflow, you would need to validate that new command.
To that end, you can use a number of command-specific then-phase tasks to validate your application.
Examples of this are <code>commands(&#8230;&#8203;)</code>, <code>commandsSatify(&#8230;&#8203;)</code>, <code>commandsMatch(&#8230;&#8203;)</code>, and <code>noCommands()</code>:</p>
</div>
<div id="_tabs_10" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_10_single_command" class="tab">
<p>Single command</p>
</li>
<li id="_tabs_10_multiple_commands" class="tab">
<p>Multiple commands</p>
</li>
<li id="_tabs_10_custom_command_validation" class="tab">
<p>Custom command validation</p>
</li>
<li id="_tabs_10_commands_match_a_predicate" class="tab">
<p>Commands match a predicate</p>
</li>
<li id="_tabs_10_no_commands" class="tab">
<p>No commands</p>
</li>
</ul>
</div>
<div id="_tabs_10_single_command--panel" class="tabpanel" aria-labelledby="_tabs_10_single_command">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .commands(new SendEmailCommand("user@example.com", "Welcome!"));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_multiple_commands--panel" class="tabpanel" aria-labelledby="_tabs_10_multiple_commands">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .commands(
                       new SendEmailCommand("user@example.com", "Welcome!"),
                       new DeregisterAccountCommand("account-1")
               );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can either use the <code>commands(&#8230;&#8203;)</code> method with several commands, or invoke the <code>commands(&#8230;&#8203;)</code> method multiple times per command.</p>
</div>
</div>
<div id="_tabs_10_custom_command_validation--panel" class="tabpanel" aria-labelledby="_tabs_10_custom_command_validation">
<div id="then_command_satisfies" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.junit.jupiter.api.Assertions.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .commandsSatisfy(commands -&gt; {
                   assertEquals(1, commands.size());
                   SendEmailCommand command = commands.getFirst().payloadAs(SendEmailCommand.class);
                   assertEquals("user@example.com", command.recipient());
               });
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_commands_match_a_predicate--panel" class="tabpanel" aria-labelledby="_tabs_10_commands_match_a_predicate">
<div id="then_command_matches" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .commandsMatch(commands -&gt; commands.size() == 1
                       &amp;&amp; commands.getFirst().payloadAs(SendEmailCommand.class)
                                  .equals("user@example.com"));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_no_commands--panel" class="tabpanel" aria-labelledby="_tabs_10_no_commands">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .noCommands();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_await"><a class="anchor" href="#then_await"></a>Then await verification</h4>
<div class="paragraph">
<p>Sometimes, the <a href="#when_phase">when-phase</a> action will not trigger immediately.
Examples of these are <a href="../advanced-testing/#integration_testing" class="xref page">(integration) tests</a> using a <a href="../../events/event-processors/streaming/" class="xref page">streaming event processor</a>, which by design take some time.
When this is the case you can use the <code>await(&#8230;&#8203;)</code> operation.
If you do not provide a <code>Duration</code>, the task will be awaited on for a default of five seconds.
When you know a task should be verifiable sooner or later, you can define your own <code>Duration</code>:</p>
</div>
<div id="_tabs_11" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_11_await" class="tab">
<p>Await</p>
</li>
<li id="_tabs_11_await_with_duration" class="tab">
<p>Await with duration</p>
</li>
</ul>
</div>
<div id="_tabs_11_await--panel" class="tabpanel" aria-labelledby="_tabs_11_await">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .await(then -&gt; then.commands(new SendEmailCommand("user@example.com", "Welcome!")));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using plain <code>await(&#8230;&#8203;)</code> uses the default timeout of 5 seconds at all time.</p>
</div>
</div>
<div id="_tabs_11_await_with_duration--panel" class="tabpanel" aria-labelledby="_tabs_11_await_with_duration">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import java.time.Duration;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .await(
                       then -&gt; then.commands(new SendEmailCommand("user@example.com", "Welcome!")),
                       Duration.ofMillis(250)
               );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="then_expect"><a class="anchor" href="#then_expect"></a>Then custom expect verification</h4>
<div class="paragraph">
<p>For complex verification scenarios you can use <code>expect(Consumer&lt;Configuration&gt;)</code>.
The <code>expect()</code> grants access to the entire <code>Configuration</code>, allowing users to access any component they require.
This can be useful whenever you need to verify external state, validate custom components, or whenever the fixture does not support what you require.</p>
</div>
<div id="_tabs_12" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_12_expect" class="tab">
<p>Expect</p>
</li>
<li id="_tabs_12_asynchronous_expect" class="tab">
<p>Asynchronous expect</p>
</li>
</ul>
</div>
<div id="_tabs_12_expect--panel" class="tabpanel" aria-labelledby="_tabs_12_expect">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.queryhandling.gateway.QueryGateway;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.junit.jupiter.api.Assertions.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .expect(config -&gt; {
                   AccountBalance balance =
                           config.getComponent(QueryGateway.class)
                                 .query(
                                         new GetBalanceQuery("account-1"),
                                         AccountBalance.class
                                 )
                                 .join();
                   assertEquals(400.00, balance.amount());
               });
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_12_asynchronous_expect--panel" class="tabpanel" aria-labelledby="_tabs_12_asynchronous_expect">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.queryhandling.gateway.QueryGateway;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.junit.jupiter.api.Assertions.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               // ...
               .when()
               .event(new AccountClosedEvent("account-1"))
               .then()
               .expectAsync(config -&gt; {
                   QueryGateway queryGateway = config.getComponent(QueryGateway.class);
                   // Return CompletableFuture, like the result from the QueryGateway
                   return queryGateway.query(
                                              new GetBalanceQuery("account-1"),
                                              AccountBalance.class
                                      )
                                      .thenAccept(balance -&gt; assertEquals(400.00, balance.amount()));
               });
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chaining_tests"><a class="anchor" href="#chaining_tests"></a>Chaining multiple tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When constructing unit tests sticking to a single given-when-then flow is recommended.
However, some test scenarios benefit from validating a more intricate flow.</p>
</div>
<div class="paragraph">
<p>Workflows are a clear example of this, where a number of <a href="#given_events">given events</a>, followed by a <a href="#when_commands">command</a>, result in <a href="#then_events">events</a> that form a clear basis for a follow-up <a href="#when_commands">command</a>.
To support these cases you can use the <code>and()</code> operation to chain an additional given-when-then block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .success()
               .events(new MoneyWithdrawnEvent("account-1", 100.00))
               .and()  // Chain to next test
               .when()
               .command(new WithdrawMoneyCommand("account-1", 500.00))
               .then()
               .exception(InsufficientBalanceException.class)
               .noEvents();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This structure provides a number of benefits you can utilize.
Like being able to reuse the previous test&#8217;s state, validating a sequence of operations, or to verify your workflows are up to par.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_test_scenarios"><a class="anchor" href="#_example_test_scenarios"></a>Example test scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Besides the specific examples spread throughout the explanation of the different <a href="#test_phases">phases</a>, there are coarse grained examples that you can benefit from.
To that end, the list below shows some tests for <a href="#testing_command_handling_components">command handling components</a>, <a href="#testing_event_handling_components">event handling components</a>, <a href="#testing_event_sourced_entities">event-sourced entities</a>, and testing <a href="#testing_query_handling_components">query handling components</a>.</p>
</div>
<div class="sect2">
<h3 id="testing_command_handling_components"><a class="anchor" href="#testing_command_handling_components"></a>Example: Testing a stateful command handling component</h3>
<div class="paragraph">
<p>In this test, the user decided to have a Command Handling Component called the <code>AccountCommandHandler</code> for which the state is automatically injected in the command handlers.
The state, which is the event-sourced <code>Account</code>, is registered separately with the configurer in this example.
Furthermore, the developer decided to construct fine-grained unit tests to validate the flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ModuleBuilder;
import org.axonframework.eventsourcing.configuration.EventSourcedEntityModule;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;
import org.axonframework.messaging.commandhandling.configuration.CommandHandlingModule;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountCommandHandlerTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        EventSourcedEntityModule&lt;String, Account&gt; eventSourcedEntity =
                EventSourcedEntityModule.autodetected(String.class, Account.class);
        ModuleBuilder&lt;CommandHandlingModule&gt; accountCommandHandlingModule =
                CommandHandlingModule.named("account")
                                     .commandHandlers()
                                     .annotatedCommandHandlingComponent(c -&gt; new AccountCommandHandler());
        EventSourcingConfigurer configurer =
                EventSourcingConfigurer.create()
                                       .registerEntity(eventSourcedEntity)
                                       .messaging(messaging -&gt; messaging.registerCommandHandlingModule(
                                               accountCommandHandlingModule
                                       ));

        fixture = AxonTestFixture.with(configurer);
    }

    @Test
    void createAccount() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand("account-1", 500.00))
               .then()
               .success()
               .events(new AccountCreatedEvent("account-1", 500.00));
    }

    @Test
    void withdrawMoney() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .success()
               .events(new MoneyWithdrawnEvent("account-1", 100.00));
    }

    @Test
    void withdrawInsufficientBalance() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 50.00))
               .when()
               .command(new WithdrawMoneyCommand("account-1", 100.00))
               .then()
               .exception(InsufficientBalanceException.class)
               .noEvents();
    }

    @AfterEach
    void tearDown() {
        fixture.stop();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing_event_handling_components"><a class="anchor" href="#testing_event_handling_components"></a>Example: Testing an event handling component</h3>
<div class="paragraph">
<p>Here is an example test scenario how an Event Handling Component sends emails as a result of handling an event. Take note of the use of <a href="#then_await">await</a>, which mandatory to give the <a href="../../events/event-processors/" class="xref page">event processor</a> time to actually process the event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.eventhandling.configuration.EventProcessorModule;
import org.axonframework.messaging.eventhandling.processing.streaming.pooled.PooledStreamingEventProcessorConfiguration;
import org.axonframework.messaging.eventhandling.processing.streaming.pooled.PooledStreamingEventProcessorModule;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class NotificationEventHandlerTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        MessagingConfigurer configurer = MessagingConfigurer.create().eventProcessing(
                processing -&gt; processing.pooledStreaming(
                        pooledStreaming -&gt; pooledStreaming.processor(
                                "notifications",
                                NotificationEventHandlerTest::configurePooledProcessor))
        );

        fixture = AxonTestFixture.with(configurer);
    }

    private static PooledStreamingEventProcessorModule configurePooledProcessor(
            EventProcessorModule.EventHandlingPhase&lt;PooledStreamingEventProcessorModule, PooledStreamingEventProcessorConfiguration&gt; processor
    ) {
        return processor.eventHandlingComponents(components -&gt; components.autodetected(
                                c -&gt; new NotificationEventHandler())
                        )
                        .notCustomized();
    }

    @Test
    void sendNotificationOnAccountCreated() {
        fixture.given()
               .noPriorActivity()
               .when()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .then()
               .await(
                       t -&gt; t.success()
                             .commands(new SendEmailCommand(
                                     "user@example.com", "Your account has been created"
                             ))
               );
    }

    @Test
    void sendNotificationOnLowBalance() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .when()
               .event(new MoneyWithdrawnEvent("account-1", 480.00))
               .then()
               .await(
                       t -&gt; t.success()
                             .commands(new SendEmailCommand(
                                     "user@example.com", "Low balance alert"
                             ))
               );
    }

    @AfterEach
    void tearDown() {
        fixture.stop();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing_event_sourced_entities"><a class="anchor" href="#testing_event_sourced_entities"></a>Example: Testing an event-sourced entity with command handler</h3>
<div class="paragraph">
<p>In this test example, the developers decided to combine the command handler with the event-sourced entity in one object.
Furthermore, the test runs through the complete lifecycle of an account in one go using the fixture&#8217;s <a href="#chaining_tests">chaining</a> capabilities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.eventsourcing.configuration.EventSourcedEntityModule;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountEntityTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        EventSourcingConfigurer configurer =
                EventSourcingConfigurer.create().registerEntity(
                    EventSourcedEntityModule.autodetected(String.class, Account.class)
                );

        fixture = AxonTestFixture.with(configurer);
    }

    @Test
    void accountLifecycleReactsAsExpected() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand("account-1", 500.00))
               .then()
               .success()
               .events(new AccountCreatedEvent("account-1", 500.00))
               .and()
               .when()
               .command(new DepositMoneyCommand("account-1", 100.00))
               .then()
               .success()
               .events(new MoneyDepositedEvent("account-1", 100.00))
               .and()
               .when()
               .command(new WithdrawMoneyCommand("account-1", 200.00))
               .then()
               .success()
               .events(new MoneyWithdrawnEvent("account-1", 200.00))
               .and()
               .when()
               .command(new CloseAccountCommand("account-1"))
               .then()
               .success()
               .events(new AccountClosedEvent("account-1"));
    }

    @AfterEach
    void tearDown() {
        fixture.stop();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing_query_handling_components"><a class="anchor" href="#testing_query_handling_components"></a>Example: Testing a query handling component</h3>
<div class="paragraph">
<p>As the test fixtures (not yet) support query validation, this scenario uses the <code>expect(&#8230;&#8203;)</code> operation to fully customize the <a href="#then_phase">then-phase</a> to their purposes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ModuleBuilder;
import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.eventhandling.configuration.EventProcessorModule;
import org.axonframework.messaging.eventhandling.processing.streaming.pooled.PooledStreamingEventProcessorConfiguration;
import org.axonframework.messaging.eventhandling.processing.streaming.pooled.PooledStreamingEventProcessorModule;
import org.axonframework.messaging.queryhandling.configuration.QueryHandlingModule;
import org.axonframework.messaging.queryhandling.gateway.QueryGateway;
import org.axonframework.test.fixture.AxonTestFixture;

import static org.junit.jupiter.api.Assertions.*;

class AccountQueryHandlerTest {

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        ModuleBuilder&lt;QueryHandlingModule&gt; accountQueryHandlingModule =
                QueryHandlingModule.named("account")
                                   .queryHandlers()
                                   .annotatedQueryHandlingComponent(c -&gt; new AccountQueryHandler());
        MessagingConfigurer configurer =
                MessagingConfigurer.create()
                                   .registerQueryHandlingModule(accountQueryHandlingModule)
                                   .eventProcessing(
                                           processing -&gt; processing.pooledStreaming(
                                                   pooledStreaming -&gt; pooledStreaming.processor(
                                                           "notifications",
                                                           AccountQueryHandlerTest::configurePooledProcessor
                                                   )
                                           )
                                   );

        fixture = AxonTestFixture.with(configurer);
    }

    private static PooledStreamingEventProcessorModule configurePooledProcessor(
            EventProcessorModule.EventHandlingPhase&lt;PooledStreamingEventProcessorModule, PooledStreamingEventProcessorConfiguration&gt; processor
    ) {
        return processor.eventHandlingComponents(components -&gt; components.autodetected(
                                c -&gt; new NotificationEventHandler())
                        )
                        .notCustomized();
    }

    @Test
    void testGetAccountBalance() {
        fixture.given()
               .event(new AccountCreatedEvent("account-1", 500.00))
               .event(new MoneyDepositedEvent("account-1", 100.00))
               .when()
               .nothing()
               .then()
               .expect(config -&gt; {
                   QueryGateway queryGateway = config.getComponent(QueryGateway.class);
                   var balance = queryGateway.query(
                           new GetBalanceQuery("account-1"),
                           AccountBalance.class
                   ).join();
                   assertEquals(600.00, balance.amount());
               });
    }

    @AfterEach
    void tearDown() {
        fixture.stop();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../">Testing</a></span>
  <span class="next"><a href="../matchers-and-field-filters/">Matchers and Field Filters</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright Â© 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    </div>
  </body>
</html>
