<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subscribing Event Processor</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/events/event-processors/subscribing/">
    <link rel="prev" href="../">
    <link rel="next" href="../streaming/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../../_'</script>


<link rel="icon" href="../../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../">Axon Framework</a>
                <a class="navbar-item" href="../../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../">Axon Framework Reference</a></li>
    <li><a href="../../">Events</a></li>
    <li><a href="../">Event Processors</a></li>
    <li><a href="./">Subscribing Event Processor</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/axon-5.0.x/docs/reference-guide/modules/events/pages/event-processors/subscribing.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Subscribing%20Event%20Processor" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Subscribing%20Event%20Processor%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BSubscribing%20Event%20Processor%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2F5.0%2Fevents%2Fevent-processors%2Fsubscribing%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">5.0</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../../../development/events/event-processors/subscribing/">development</a>
    <a class="version item is-current" href="./">5.0</a>
    <a class="version item" href="../../../../4.12/events/event-processors/subscribing/">4.12</a>
    <a class="version item" href="../../../../4.11/events/event-processors/subscribing/">4.11</a>
    <a class="version item" href="../../../../4.10/events/event-processors/subscribing/">4.10</a>
    <a class="version item is-missing" href="../../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="5.0">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../migration/">Migration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../migration/why-upgrade/">Why Upgrade?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../migration/prerequisites/">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../migration/solved-architecture-choices/">Resolved Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../migration/understanding-architecture-principles/">Understanding Choices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../messaging-concepts/processing-context/">Processing Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../commands/">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../commands/command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../commands/command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../commands/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../commands/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../event-publishing/">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="./">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../infrastructure/">Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../event-store-internals/">Event Store Internals</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../event-versioning/">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../queries/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../testing/">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../testing/basic-testing/">Basic Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../testing/matchers-and-field-filters/">Matchers and Field Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../testing/advanced-testing/">Advanced Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../conversion/">Conversion</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../monitoring/tracing/">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Subscribing Event Processor</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SubscribingEventProcessor</code>, or Subscribing Processor for short, is a type of <a href="../" class="xref page">Event Processor</a>.
As any Event Processor, it serves as the technical aspect to handle events by invoking the event handlers written in an Axon application.</p>
</div>
<div class="paragraph">
<p>The Subscribing Processor defines itself by receiving the events from a <code>SubscribableEventSource</code>.
The <code>SubscribableEventSource</code> is an infrastructure component to register a Subscribing Processor too.</p>
</div>
<div class="paragraph">
<p>After registration to the <code>SubscribableEventSource</code>, the event source gives the events to the <code>SubscribingEventProcessor</code> in the order they are received.
The most practical use of a Subscribing Processor is with a persistent stream as its event source, which allows for parallel processing and replay capabilities.</p>
</div>
<div class="paragraph">
<p>Axon currently provides two main types of <code>SubscribableEventSource</code> implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>EventBus</strong> - An interface for publishing and subscribing to events.
It delivers events to subscribers in the publishing thread.</p>
</li>
<li>
<p><strong>Persistent Stream</strong> - A event source backed by Axon Server that persists events and supports parallel processing across segments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using a simple bus solution like the <code>EventBus</code> as the event source, the Subscribing Processor will only receive <em>current</em> events.
Operations like <a href="../streaming/#replaying-events" class="xref page">replaying</a> are, therefore, not an option for any Subscribing Processor.
Furthermore, when the <code>EventBus</code> is used as the event source, the event publishing thread is the same one that handles the event in the Subscribing Processor.</p>
</div>
<div class="paragraph">
<p>Although this coupled approach deserves a spot within the framework, most scenarios require further decoupling of components by separating the threads as well.
When, for example, an application requires event processing parallelization to get a higher performance, this can be a blocker.
This predicament is why the <code>SubscribingEventProcessor</code> is not the default in Axon Framework.</p>
</div>
<div class="paragraph">
<p>Instead, the "Pooled Streaming Event Processor" (a <a href="../streaming/" class="xref page">Streaming Processor</a> implementation) takes up that role.
It provides greater flexibility for developers for configuring the event processor in greater detail, including parallel processing and event replay capabilities.
However, when using a Subscribing Processor with a <a href="#persistent_streams">persistent stream</a> as its event source, similar benefits can be achieved.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Subscribing Processor Use Cases</strong></p>
</div>
<div class="paragraph">
<p>The <code>SubscribingEventProcessor</code> is a sane option in roughly two scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When using <code>SubscribableEventSource</code> backed by a persisted and replayable store, like persistent streams.</p>
</li>
<li>
<p>When an entity should be updated within the same thread <strong>and</strong> transaction that published the event.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that when you aim to follow the CQRS paradigm, that scenario two is <strong>not</strong> recommended between command and query models.
When following CQRS, publishing an event should be regarded as updating a command model.
Handling an event to update an entity is seen as a query model update in virtually all scenarios.
Hence, think twice before deciding on scenario two!</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring"><a class="anchor" href="#configuring"></a>Configuring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure a Subscribing Event Processor you have roughly two approaches:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#declarative_config_plain">Declarative configuration</a></p>
</li>
<li>
<p><a href="#autodetected_config_spring_properties_plain">Autodetected configuration</a>, like Spring</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both solutions have examples drafted below, showing how to configure the "example-processor" with a specific event source.
For generic configuration options for any Event Processor, we refer to the <a href="../#general_processor_configuration" class="xref page">general processor configuration section</a>.</p>
</div>
<div class="sect2">
<h3 id="declarative_config_plain"><a class="anchor" href="#declarative_config_plain"></a>Declarative configuration</h3>
<div class="paragraph">
<p>When using Axon&#8217;s configuration API, you should invoke the <code>MessagingConfigurer#eventProcessing(Consumer&lt;EventProcessingConfigurer&gt;)</code> operation.
The <code>EventProcessingConfigurer</code> lambda guides users towards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, selecting the Event Processor type,</p>
</li>
<li>
<p>second, register a lambda to retrieve the Event Handling Components, and,</p>
</li>
<li>
<p>third, customization for the event processor, if any.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example below shows how this approach is used to define a (1) <code>SubscribingEventProcessor</code> with the (2) <code>AnnotatedEventHandlingClass</code> as the single event handling component, and (3) with a specific event source customization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.eventhandling.configuration.EventHandlingComponentsConfigurer;
import org.axonframework.messaging.eventhandling.processing.subscribing.SubscribingEventProcessorsConfigurer;

public class AxonConfig {

    public void configureEventProcessing(MessagingConfigurer configurer) {
        configurer.eventProcessing(eventConfigurer -&gt; eventConfigurer.subscribing(
                this::configureSubscribingProcessor
        ));
    }

    private SubscribingEventProcessorsConfigurer configureSubscribingProcessor(
            SubscribingEventProcessorsConfigurer subscribingConfigurer
    ) {
        return subscribingConfigurer.processor(
                "example-processor",
                config -&gt; config.eventHandlingComponents(this::configureHandlingComponent)
                                .customized((c, subscribingConfig) -&gt; subscribingConfig.eventSource(
                                        c.getComponent(EventBus.class)
                                ))
        );
    }

    private EventHandlingComponentsConfigurer.AdditionalComponentPhase configureHandlingComponent(
            EventHandlingComponentsConfigurer.RequiredComponentPhase componentConfigurer
    ) {
        return componentConfigurer.autodetected(c -&gt; new AnnotatedEventHandlingClass());
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="autodetected_config_spring_properties_plain"><a class="anchor" href="#autodetected_config_spring_properties_plain"></a>Autodetected configuration - Spring Boot properties file</h4>
<div class="paragraph">
<p>A properties file allows the configuration of several fields for the Subscribing Event Processor.
If more flexibility is required, like concretely defining the event handling components to attach, we recommend use of the <a href="#declarative_config_plain">declarative configuration</a> instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">axon.eventhandling.processors.example-processor.mode=subscribing
axon.eventhandling.processors.example-processor.source=eventBus</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the name of an event processor contains periods <code>.</code>, use the map notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">axon.eventhandling.processors[example.processor].mode=subscribing
axon.eventhandling.processors[example.processor].source=eventBus</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="error-mode"><a class="anchor" href="#error-mode"></a>Error mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whenever the <a href="../#error-handling" class="xref page">error handler</a> rethrows an exception, the <code>SubscribingEventProcessor</code> will have it bubble up to the publishing component of the event.
Providing the exception to the event publisher allows the publishing component to deal with it accordingly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistent_streams"><a class="anchor" href="#persistent_streams"></a>Persistent streams</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Persistent streams not available in Axon Framework 5.0</div>
<div class="paragraph">
<p>The Persistent Streams feature is not yet available in Axon Framework 5.0.
It will be introduced in Axon Framework 5.2.
The documentation below describes the Persistent Streams concepts for reference and future use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Subscribing Processor can use a Persistent Stream as its event source.
By using a persistent stream we allow a Subscribing Processor to process events in parallel and to replay events.</p>
</div>
<div class="paragraph">
<p>When a processor uses a persistent stream, it receives events from Axon Server.
After processing (a batch of) events, it sends an acknowledgment back to Axon Server.</p>
</div>
<div class="paragraph">
<p>The persistent stream can be split in segments to allow for parallel processing within a single client or across multiple instances of the client.
The number of segments can be changed dynamically.
Axon Server distributes the segments across the subscribers to ensure that all segments are connected.</p>
</div>
<div class="paragraph">
<p>Events are assigned to a specific segment based on the sequencing policy for the persistent stream.
Persistent streams support all the standard sequencing policies that also can be used for <a href="../streaming/#sequencing-policies" class="xref page">streaming processors</a>.</p>
</div>
<div class="paragraph">
<p>Clients can provide a filter in the persistent stream definition.
This reduces the number of events that the client receives from Axon Server.
The expression used to filter events are the same as expressions used in the ad-hoc query option in Axon Server.</p>
</div>
<div class="paragraph">
<p>Persistent streams do not require a token store in the client.
The state of the stream is maintained in Axon Server.</p>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>For a specific Event Processor to be a Subscribing instance using a persistent stream, the <a href="#declarative_config_plain">declarative</a> or <a href="#autodetected_config_spring_properties_plain">autodetected</a> configuration can be used.
The event source for the event processor must be a <code>PersistentStreamMessageSource</code>.</p>
</div>
<div class="paragraph">
<p>Each persistent stream must be identified by a unique name within your Axon Server environment.
This name serves as the stream&#8217;s identifier, and it&#8217;s crucial to understand that creating a new stream with an existing name will overwrite the previous stream connection.</p>
</div>
<div class="paragraph">
<p>The <code>PersistentStreamMessageSource</code> requires a <code>PersistentStreamProperties</code> to set the initial properties to create the persistent stream.
The properties contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>streamName</code>: The name of the persistent stream.
It&#8217;s a unique identifier of the connection with Axon Sever.
Usage of the same name will overwrite the existing connection.</p>
</li>
<li>
<p><code>segments</code>: The initial number of segments.</p>
</li>
<li>
<p><code>sequencingPolicyName</code>: The sequencing policy name.</p>
</li>
<li>
<p><code>sequencingPolicyParameters</code>: List of parameters for the sequencing policy.</p>
</li>
<li>
<p><code>initialPosition</code>: First token to read.</p>
</li>
<li>
<p><code>filter</code>: Filter for events on Axon Server side, use <code>null</code> to receive all events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>sequencingPolicyParameters</code> must be set if the sequencing policy is <code>PropertySequencingPolicy</code> or <code>MetadataSequencingPolicy</code>.</p>
</div>
<div class="paragraph">
<p>For the <code>MetadataSequencingPolicy</code>, the <code>sequencingPolicyParameters</code> must contain the name of one or more of the event&#8217;s metadata fields.
Events with the same value for these fields are passed in the same segment.</p>
</div>
<div class="paragraph">
<p>The <code>PropertySequencingPolicy</code> requires 4 values in the <code>sequencingPolicyParameters</code> list.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The serialization type for the events.
Supported values are <code>JSON</code> or <code>XML</code>.</p>
</li>
<li>
<p>The payload type to apply the policy on.</p>
</li>
<li>
<p>An expression to extract the property value from the event payload.
If the serialization type is <code>JSON</code> this must be a <code>JsonPath</code> expression.
For <code>XML</code> this must be an <code>Xpath</code> expression.</p>
</li>
<li>
<p>A fallback policy, the name of a sequencing policy to use if the payload type does not match the type specified in the second parameter.
This may be <code>PropertySequencingPolicy</code> to specify an expression for another payload type.
In this case add the serialization type, payload type, expression and fallback policy parameters for the alternative payload type.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="declarative_config_persistent"><a class="anchor" href="#declarative_config_persistent"></a>Declarative configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.axoniq.axonserver.connector.event.PersistentStreamProperties;
import org.axonframework.axonserver.connector.event.axon.PersistentStreamMessageSource;
import org.axonframework.axonserver.connector.event.axon.PersistentStreamSequencingPolicyProvider;
import org.axonframework.common.configuration.Configuration;
import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.eventhandling.configuration.EventHandlingComponentsConfigurer;
import org.axonframework.messaging.eventhandling.processing.subscribing.SubscribingEventProcessorsConfigurer;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.Executors;

public class AxonConfig {

    public void configureEventProcessing(MessagingConfigurer configurer) {
        configurer.eventProcessing(eventConfigurer -&gt; eventConfigurer.subscribing(
                this::configureSubscribingProcessor
        ));
    }

    private SubscribingEventProcessorsConfigurer configureSubscribingProcessor(
            SubscribingEventProcessorsConfigurer subscribingConfigurer
    ) {
        return subscribingConfigurer.processor(
                "example-processor",
                config -&gt; config.eventHandlingComponents(this::configureHandlingComponent)
                                .customized((c, subscribingConfig) -&gt; subscribingConfig.eventSource(
                                        constructPersistentStream(c)
                                ))
        );
    }

    public PersistentStreamMessageSource constructPersistentStream(Configuration configuration) {
        String streamName = "example-persistent-stream-name";
        int segmentCount = 4;
        // Not required for sequential per aggregate policy.
        // See PersistentStreamSequencingPolicyProvider JavaDoc for other policies.
        List&lt;String&gt; sequencingPolicyParameters = new ArrayList&lt;&gt;();
        // Optional parameter to filter events on Axon Server's side.
        String filter = null;
        int batchsize = 1024;

        PersistentStreamProperties persistentStreamProperties = new PersistentStreamProperties(
                streamName,
                segmentCount,
                PersistentStreamSequencingPolicyProvider.SEQUENTIAL_PER_AGGREGATE_POLICY,
                sequencingPolicyParameters,
                PersistentStreamProperties.HEAD_POSITION,
                filter
        );

        return new PersistentStreamMessageSource(
                streamName,
                configuration,
                persistentStreamProperties,
                Executors.newScheduledThreadPool(4),
                batchsize
        );
    }

    private EventHandlingComponentsConfigurer.AdditionalComponentPhase configureHandlingComponent(
            EventHandlingComponentsConfigurer.RequiredComponentPhase componentConfigurer
    ) {
        return componentConfigurer.autodetected(c -&gt; new AnnotatedEventHandlingClass());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="autodetected_config_spring_properties_persistent"><a class="anchor" href="#autodetected_config_spring_properties_persistent"></a>Autodetected configuration - Spring Boot properties file</h4>
<div class="paragraph">
<p>A properties file allows the configuration of some fields on an Event Processor.
Do note that the Java configuration provides more degrees of freedom.</p>
</div>
<div class="paragraph">
<p>The source property for the processor must point to a Spring Bean which is a <code>PersistentStreamMessageSource</code> or a <code>PersistentStreamMessageSourceDefinition</code>.
This bean can also be defined in the properties file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">axon.eventhandling.processors.example-processor.mode=subscribing
axon.eventhandling.processors.example-processor.source=example-persistent-stream

axon.axonserver.persistent-streams.example-persistent-stream.name=Example Persistent Stream
axon.axonserver.persistent-streams.example-persistent-stream.batch-size=100
axon.axonserver.persistent-streams.example-persistent-stream.initial-segment-count=4</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../">Event Processors</a></span>
  <span class="next"><a href="../streaming/">Streaming Event Processor</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../../_/js/site.js" data-ui-root-path="../../../../../_"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../.." data-snippet-length="100" data-stylesheet="../../../../../_/css/search.css"></script>
<script async src="../../../../../search-index.js"></script>
    </div>
  </body>
</html>
