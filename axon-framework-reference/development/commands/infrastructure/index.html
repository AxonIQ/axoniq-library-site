<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Infrastructure</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/commands/infrastructure/">
    <link rel="prev" href="../command-dispatchers/">
    <link rel="next" href="../configuration/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../_'</script>


<link rel="icon" href="../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../5.0/">Axon Framework</a>
                <a class="navbar-item" href="../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Framework Reference</a></li>
    <li><a href="../">Commands</a></li>
    <li><a href="./">Infrastructure</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/main/docs/reference-guide/modules/commands/pages/infrastructure.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Infrastructure" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Infrastructure%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BInfrastructure%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2Fdevelopment%2Fcommands%2Finfrastructure%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">development</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item is-current" href="./">development</a>
    <a class="version item" href="../../../5.0/commands/infrastructure/">5.0</a>
    <a class="version item is-missing" href="../../../4.12/">4.12</a>
    <a class="version item is-missing" href="../../../4.11/">4.11</a>
    <a class="version item is-missing" href="../../../4.10/">4.10</a>
    <a class="version item is-missing" href="../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="development">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../migration/">Migration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/why-upgrade/">Why Upgrade?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/prerequisites/">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/solved-architecture-choices/">Resolved Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/understanding-architecture-principles/">Understanding Choices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/processing-context/">Processing Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-publishing/">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/event-processors/">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/subscribing/">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/infrastructure/">Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-store-internals/">Event Store Internals</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-versioning/">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../testing/">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/basic-testing/">Basic Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/matchers-and-field-filters/">Matchers and Field Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/advanced-testing/">Advanced Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../conversion/">Conversion</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/tracing/">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Infrastructure</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Command handling in Axon Framework involves several infrastructure components that work together to dispatch commands, manage entity state, and coordinate command processing across your application.</p>
</div>
<div class="paragraph">
<p>This page covers the key infrastructure components you&#8217;ll work with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Repositories</strong> - Manage entity lifecycle and state persistence</p>
</li>
<li>
<p><strong>Command bus</strong> - Routes and dispatches commands to handlers</p>
</li>
<li>
<p><strong>Command gateway</strong> - Provides a convenient API for dispatching commands</p>
</li>
<li>
<p><strong>Command handling components</strong> - Register and manage command handlers</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repositories"><a class="anchor" href="#_repositories"></a>Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Repositories provide an abstraction for loading and persisting entities.
When you use entities for stateful command handling (see <a href="../command-handlers/" class="xref page">Command handlers</a>), repositories manage the entity lifecycle automatically.</p>
</div>
<div class="sect2">
<h3 id="_why_repositories"><a class="anchor" href="#_why_repositories"></a>Why repositories?</h3>
<div class="paragraph">
<p>Repositories handle several concerns for you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Loading entity state</strong> - Fetch current state from storage (event store or database)</p>
</li>
<li>
<p><strong>Lifecycle management</strong> - Track entity instances during command processing</p>
</li>
<li>
<p><strong>Persistence</strong> - Save state changes when command processing completes</p>
</li>
<li>
<p><strong>Coordination</strong> - Ensure changes are committed as part of the processing context</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Without a repository, you&#8217;d need to manually load entities, track changes, and persist them - repositories do all of this automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_async_native_api"><a class="anchor" href="#_async_native_api"></a>Async-native API</h3>
<div class="paragraph">
<p>Repository operations in Axon Framework are async-native, returning <code>CompletableFuture</code> to support non-blocking operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Repository&lt;ID, E&gt; {
    // Load an existing entity
    CompletableFuture&lt;ManagedEntity&lt;ID, E&gt;&gt; load(ID identifier,
                                                 ProcessingContext context);

    // Load existing or create new entity
    CompletableFuture&lt;ManagedEntity&lt;ID, E&gt;&gt; loadOrCreate(ID identifier,
                                                         ProcessingContext context);

    // Persist a new entity
    ManagedEntity&lt;ID, E&gt; persist(ID identifier, E entity,
                                 ProcessingContext context);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All repository operations require an active <code>ProcessingContext</code>.
Command handlers automatically receive a <code>ProcessingContext</code> parameter that you pass to repository methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managedentity"><a class="anchor" href="#_managedentity"></a><code>ManagedEntity</code></h3>
<div class="paragraph">
<p>Repositories return entities wrapped in a <code>ManagedEntity</code> interface.
This wrapper tracks the entity&#8217;s lifecycle and enables the repository to detect and persist changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ManagedEntity&lt;ID, E&gt; {
    ID identifier();           // Get the entity identifier
    E entity();               // Get the current entity state
    E applyStateChange(UnaryOperator&lt;E&gt; change);  // Modify entity state
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ManagedEntity</code> wrapper ensures that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to entity state are tracked</p>
</li>
<li>
<p>State modifications are persisted when the processing context commits</p>
</li>
<li>
<p>The repository maintains consistent state throughout command processing</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_repositories_in_command_handlers"><a class="anchor" href="#_using_repositories_in_command_handlers"></a>Using repositories in command handlers</h3>
<div class="paragraph">
<p>When command handlers are not on the entity itself, you use a repository to load and manage entities manually.
This pattern is covered in <a href="../command-handlers/#_command_centric_stateful_handlers" class="xref page">Command-centric stateful handlers</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class OrderCommandHandler {

    private final Repository&lt;String, Order&gt; orderRepository;

    public OrderCommandHandler(Repository&lt;String, Order&gt; orderRepository) {
        this.orderRepository = orderRepository;
    }

    @CommandHandler
    public void handle(ShipOrderCommand command,
                      ProcessingContext context,
                      EventAppender eventAppender) {
        // Load the entity
        orderRepository.load(command.orderId(), context)
            .thenAccept(managedOrder -&gt; {
                Order order = managedOrder.entity();
                // Apply business logic
                if (order.canShip()) {
                    eventAppender.append(new OrderShippedEvent(command.orderId()));
                }
            });
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eventsourcedrepository"><a class="anchor" href="#_eventsourcedrepository"></a><code>EventSourcedRepository</code></h3>
<div class="paragraph">
<p>The most common repository implementation is <code>EventSourcedRepository</code>, which manages event-sourced entities.</p>
</div>
<div class="paragraph">
<p>Configuration with Spring Boot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.extension.spring.stereotype.EventSourced;

@EventSourced
public class Order {

    // Omitted handlers and state for brevity.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration with Configuration API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.eventsourcing.annotation.EventSourcedEntity;
import org.axonframework.eventsourcing.configuration.EventSourcingConfigurer;

@EventSourcedEntity
public class Order {

    // Omitted handlers and state for brevity.
}

public class AxonConfig {

    public void configureOrderEntity(EventSourcingConfigurer configurer) {
        configurer.registerEntity(
                EventSourcedEntityModule.autodetected(String.class, Order.class)
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_bus"><a class="anchor" href="#_command_bus"></a>Command bus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The command bus is responsible for routing commands to their registered handlers.
It receives commands from gateways or dispatchers and invokes the appropriate command handler.</p>
</div>
<div class="sect2">
<h3 id="_simplecommandbus"><a class="anchor" href="#_simplecommandbus"></a><code>SimpleCommandBus</code></h3>
<div class="paragraph">
<p>The <code>SimpleCommandBus</code> is the standard command bus implementation.</p>
</div>
<div class="paragraph">
<p>Key characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Simple and reliable</strong> - Straightforward processing model</p>
</li>
<li>
<p><strong>Good performance</strong> - Low overhead for command handling</p>
</li>
<li>
<p><strong>Single JVM</strong> - Cannot distribute commands across multiple instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Boot automatically configures a <code>SimpleCommandBus</code> when using the Axon Spring Boot starter (unless Axon Server is configured).</p>
</div>
<div class="paragraph">
<p>Manual configuration:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_configuration_api" class="tab">
<p>Configuration API</p>
</li>
<li id="_tabs_1_spring_boot" class="tab">
<p>Spring Boot</p>
</li>
</ul>
</div>
<div id="_tabs_1_configuration_api--panel" class="tabpanel" aria-labelledby="_tabs_1_configuration_api">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;

public class AxonConfig {

    public void configureCommandBus(MessagingConfigurer configurer) {
        configurer.registerCommandBus(
                config -&gt; new SimpleCommandBus(
                        config.getComponent(UnitOfWorkFactory.class),
                        Collections.emptyList()
                )
        );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_spring_boot--panel" class="tabpanel" aria-labelledby="_tabs_1_spring_boot">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {

    @Bean
    public CommandBus commandBus(UnitOfWorkFactory unitOfWorkFactory,
                                 TransactionManager transactionManager) {
        return new SimpleCommandBus(
                unitOfWorkFactory,
                List.of(transactionManager)
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interceptors"><a class="anchor" href="#_interceptors"></a>Interceptors</h3>
<div class="paragraph">
<p>The command bus supports interceptors for cross-cutting concerns like logging, metrics, or validation.</p>
</div>
<div class="paragraph">
<p>There are two types of interceptors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dispatch interceptors</strong> - Invoked when a command is dispatched, before routing</p>
</li>
<li>
<p><strong>Handler interceptors</strong> - Invoked before the actual command handler, after routing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../../messaging-concepts/message-intercepting/#command-interceptors" class="xref page">Command interceptors</a> for details on implementing and registering interceptors.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_gateway"><a class="anchor" href="#_command_gateway"></a>Command gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The command gateway provides a convenient, type-safe API for dispatching commands.
While you can dispatch commands directly through the command bus, the gateway is generally the easiest option.</p>
</div>
<div class="sect2">
<h3 id="_using_the_default_commandgateway"><a class="anchor" href="#_using_the_default_commandgateway"></a>Using the default <code>CommandGateway</code></h3>
<div class="paragraph">
<p>The <code>CommandGateway</code> interface provides several methods for sending commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface CommandGateway {
    // Send and get CommandResult for full control
    CommandResult send(@Nonnull Object command);

    // Send and get CompletableFuture with converted result type
    CompletableFuture&lt;R&gt; send(@Nonnull Object command, @Nonnull Class&lt;R&gt; resultType);

    // Send and wait for result
    Object sendAndWait(@Nonnull Object command);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
public class OrderController {

    private final CommandGateway commandGateway;

    public OrderController(CommandGateway commandGateway) {
        this.commandGateway = commandGateway;
    }

    @PostMapping("/orders")
    public CompletableFuture&lt;String&gt; createOrder(@RequestBody CreateOrderRequest request) {
        CreateOrderCommand command = new CreateOrderCommand(
            UUID.randomUUID().toString(),
            request.getProductId(),
            request.getQuantity()
        );

        // Returns CompletableFuture&lt;String&gt; with the order ID
        return commandGateway.send(command, String.class);
    }

    @PostMapping("/orders/{id}/ship")
    public void shipOrder(@PathVariable String id) {
        // Fire and forget
        commandGateway.sendAndWait(new ShipOrderCommand(id));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Axon Framework will construct a <code>CommandGateway</code> component for you out of the box at all times.
With Axon&#8217;s Spring Boot integration, you can thus automatically inject a <code>CommandGateway</code> bean when needed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_handling_component_registration"><a class="anchor" href="#_command_handling_component_registration"></a>Command handling component registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Command handlers need to be registered with the framework so commands can be routed to them.</p>
</div>
<div class="sect2">
<h3 id="_spring_boot_auto_registration"><a class="anchor" href="#_spring_boot_auto_registration"></a>Spring Boot auto-registration</h3>
<div class="paragraph">
<p>With Spring Boot, command handlers are automatically discovered and registered when you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>@Component</code> or <code>@Service</code> on handler classes</p>
</li>
<li>
<p>Use <code>@EventSourced</code> on entity classes with command handlers</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class OrderCommandHandler {

    @CommandHandler
    public void handle(CreateOrderCommand command) {
        // Handler implementation
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EventSourced
public class Order {

    @CommandHandler
    public static Order handle(CreateOrderCommand command) {
        // Creation handler
        return new Order(command.orderId(), command.productId());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manual_registration_with_configuration_api"><a class="anchor" href="#_manual_registration_with_configuration_api"></a>Manual registration with configuration API</h3>
<div class="paragraph">
<p>When not using Spring Boot, register command handlers using <code>CommandHandlingModule</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.commandhandling.configuration.CommandHandlingModule;

public class AxonConfig {

    public void configureHandlers() {
        MessagingConfigurer.create()
            .registerCommandHandlingModule(
                CommandHandlingModule.named("order-commands")
                    .commandHandlers(handlers -&gt;
                        handlers.annotatedCommandHandlingComponent(
                            config -&gt; new OrderCommandHandler(
                                config.getComponent(Repository.class)
                            )
                        )
                    )
            );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>annotatedCommandHandlingComponent()</code> method scans the handler for <code>@CommandHandler</code> annotated methods and registers them with the command bus. When the you prefer to register methods as command handlers without the use of annotations, use the <code>commandHandler(QualifiedName, CommandHandler)</code> method instead.</p>
</div>
<div class="paragraph">
<p>For registering event-sourced entities and their repositories, use <code>EventSourcingConfigurer</code> or <code>ModellingConfigurer</code> which provide entity-specific registration methods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distributed_command_bus"><a class="anchor" href="#_distributed_command_bus"></a>Distributed command bus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For applications that need to distribute command handling across multiple JVM instances, Axon provides distributed command bus implementations. To that end, Axon Framework has a special type of <code>CommandBus</code> implementation, called the <code>DistributedCommandBus</code>.</p>
</div>
<div class="paragraph">
<p>The <code>DistributedCommandBus</code> takes in a local <code>CommandBus</code> (called the <code>localSegment</code>), a <code>CommandBusConnector</code>, and <code>DistributedCommandBusConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;
import org.axonframework.messaging.commandhandling.CommandBus;
import org.axonframework.messaging.commandhandling.SimpleCommandBus;
import org.axonframework.messaging.commandhandling.distributed.CommandBusConnector;
import org.axonframework.messaging.commandhandling.distributed.DistributedCommandBus;
import org.axonframework.messaging.commandhandling.distributed.DistributedCommandBusConfiguration;
import org.axonframework.messaging.core.unitofwork.UnitOfWorkFactory;

public class AxonConfig {

    public void configureDistributedCommandBus(MessagingConfigurer configurer) {
        configurer.registerCommandBus(
                config -&gt; {
                    SimpleCommandBus localSegment = new SimpleCommandBus(
                            config.getComponent(UnitOfWorkFactory.class),
                            Collections.emptyList()
                    );
                    return new DistributedCommandBus(
                            localSegment,
                            config.getComponent(CommandBusConnector.class),
                            DistributedCommandBusConfiguration.DEFAULT
                    );
                }
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The local segment covers command handler registration and command handler invocations within a given JVM instance. Hence, it covers the local activities of command processing.
The <code>CommandBusConnector</code> is in charge of dispatching and receiving commands to and from other JVM. The <code>CommandBusConnector</code> has several implementation, as described further below.
The <code>DistributedCommandBusConfiguration</code> allows customization of load factor, threads, and executor used by the <code>DistributedCommandBus</code>.</p>
</div>
<div class="sect2">
<h3 id="_axonservercommandbusconnector"><a class="anchor" href="#_axonservercommandbusconnector"></a><code>AxonServerCommandBusConnector</code></h3>
<div class="paragraph">
<p>The <code>AxonServerCommandBusConnector</code> connects to <a href="https://www.axoniq.io/products/axon-server" class="external" target="_blank" rel="noopener">Axon Server</a> for distributed command routing.
This is the default when using the Axon Spring Boot starter with <code>axon-server-connector</code> dependency.</p>
</div>
<div class="paragraph">
<p>With Spring Boot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
    &lt;artifactId&gt;axon-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;${axon.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure connection in <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">axon.axonserver.servers=localhost:8124
axon.axonserver.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To disable Axon Server and use local command bus instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">axon.axonserver.enabled=false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_routing_strategy"><a class="anchor" href="#_routing_strategy"></a>Routing strategy</h3>
<div class="paragraph">
<p>Distributed command buses use the routing information in every <code>CommandMessage</code> to decide how to route your commands. The <code>CommandGateway</code> is typically in charge of setting the <code>CommandMesasge#routingKey</code> field, as it constructs the <code>CommandMessage</code> for you. As such, the <code>RoutingStrategy</code> is a component present on the <code>DefaultCommandGateway</code>. Commands with the same routing key always go to the same instance.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If your node topology is instable, routing of commands with the same key will no longer be consistent.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The default <code>AnnotationRoutingStrategy</code> uses the <code>routingKey</code> attribute on the <code>@Command</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Command(routingKey = "orderId")
public class ShipOrderCommand {

    private final String orderId;
    private final String trackingNumber;

    // constructor, getters
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>routingKey</code> attribute specifies which property of the command should be used for routing.
Commands with the same routing key value will be routed to the same instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s recommended to annotate all command classes with <code>@Command</code> to explicitly declare their message properties, including namespace, name, version, and routing key.
This makes your commands self-documenting and ensures consistent message identification across your application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Custom routing strategies can be configured:</p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_configuration_api" class="tab">
<p>Configuration API</p>
</li>
<li id="_tabs_2_spring_boot" class="tab">
<p>Spring Boot</p>
</li>
</ul>
</div>
<div id="_tabs_2_configuration_api--panel" class="tabpanel" aria-labelledby="_tabs_2_configuration_api">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;

public class AxonConfig {

    public void configureRoutingStrategy() {
        MessagingConfigurer configurer = MessagingConfigurer.create();

        configurer.componentRegistry(registry -&gt;
            registry.registerComponent(
                RoutingStrategy.class,
                config -&gt; new AnnotationRoutingStrategy()
            )
        );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_spring_boot--panel" class="tabpanel" aria-labelledby="_tabs_2_spring_boot">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {

    @Bean
    public RoutingStrategy routingStrategy() {
        // Use default (Command.class annotation)
        return new AnnotationRoutingStrategy();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>MetadataRoutingStrategy</code> to route based on metadata values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {

    @Bean
    public RoutingStrategy routingStrategy() {
        return new MetadataRoutingStrategy("routingKey");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../command-dispatchers/">Dispatching</a></span>
  <span class="next"><a href="../configuration/">Configuration</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    </div>
  </body>
</html>
