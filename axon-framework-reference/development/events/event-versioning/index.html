<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event Versioning</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/events/event-versioning/">
    <link rel="prev" href="../event-store-internals/">
    <link rel="next" href="../../queries/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../_'</script>


<link rel="icon" href="../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../5.0/">Axon Framework</a>
                <a class="navbar-item" href="../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Framework Reference</a></li>
    <li><a href="../">Events</a></li>
    <li><a href="./">Versioning</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/main/docs/reference-guide/modules/events/pages/event-versioning.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Event%20Versioning" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Event%20Versioning%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BEvent%20Versioning%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2Fdevelopment%2Fevents%2Fevent-versioning%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">development</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item is-current" href="./">development</a>
    <a class="version item" href="../../../5.0/events/event-versioning/">5.0</a>
    <a class="version item" href="../../../4.12/events/event-versioning/">4.12</a>
    <a class="version item" href="../../../4.11/events/event-versioning/">4.11</a>
    <a class="version item" href="../../../4.10/events/event-versioning/">4.10</a>
    <a class="version item is-missing" href="../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="development">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../migration/">Migration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/why-upgrade/">Why Upgrade?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/prerequisites/">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/solved-architecture-choices/">Resolved Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/understanding-architecture-principles/">Understanding Choices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/processing-context/">Processing Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../commands/">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../event-publishing/">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../event-processors/">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../event-processors/subscribing/">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../event-processors/streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../event-processors/dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../infrastructure/">Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../event-store-internals/">Event Store Internals</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../testing/">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/basic-testing/">Basic Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/matchers-and-field-filters/">Matchers and Field Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/advanced-testing/">Advanced Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../conversion/">Conversion</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/tracing/">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Event Versioning</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In the lifecycle of an application, events <em>will</em> typically change their format.
As events are stored indefinitely, the application should be able to cope with several versions of an event.
This chapter will discuss what to keep in mind when creating your events, for backwards (and forwards) compatibility.
It will explain Axon&#8217;s versioning approach using payload conversion and when you might need upcasters.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="event_versioning_at_handling_time"><a class="anchor" href="#event_versioning_at_handling_time"></a>Event versioning at handling time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Axon Framework provides a flexible approach to event versioning that minimizes the need for complex migration strategies.
We dub this <strong>payload conversion at handling time</strong>, which allows different handlers to receive events in the format they expect.</p>
</div>
<div class="paragraph">
<p>When events are stored in the event store, they retain their serialized form (for example JSON or Avro binary) along with metadata about their <code>MessageType</code>.
When a handler needs to process an event, Axon converts the payload to the handler&#8217;s expected type at that moment.</p>
</div>
<div class="paragraph">
<p>This means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Different handlers can process the same event using different Java representations.</p>
</li>
<li>
<p>You can evolve your event handling without modifying stored events.</p>
</li>
<li>
<p>Simple structural changes often require no upcasters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider an event stored with this structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Event(name = "OrderPlaced", version = "1.0.0")
public record OrderPlacedEvent(
    String orderId,
    String customerId,
    List&lt;String&gt; productIds
) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Later, you want to process this same event with additional computed information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Event(name = "OrderPlaced", version = "2.0.0")
public record EnrichedOrderPlacedEvent(
    String orderId,
    String customerId,
    List&lt;String&gt; productIds,
    int productCount  // Computed from productIds
) {
    // Compact constructor that computes productCount
    public EnrichedOrderPlacedEvent(String orderId, String customerId, List&lt;String&gt; productIds) {
        this(orderId, customerId, productIds, productIds != null ? productIds.size() : 0);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add a handler that receives the event in this new format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EventHandler
public void on(EnrichedOrderPlacedEvent event) {
    // Axon converts the stored OrderPlacedEvent to EnrichedOrderPlacedEvent
    // The productCount field is computed during conversion
    notifyAnalytics(event.getProductCount());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In doing the above, Axon will know you want to handle the <code>"OrderPlaced"</code> and desire it in the <code>EnrichedOrderPlacedEvent</code>.
It will thus convert the stored format of the <code>"OrderPlaced"</code> into a <code>EnrichedOrderPlacedEvent</code>.
In the meantime, another handler (in for example another application) can still use the old format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EventHandler(eventName = "OrderPlaced")
public void on(OrderPlacedEvent event) {
    // Old handling flow...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both handlers process the same stored event, each receiving it in their preferred format.
Axon&#8217;s <code>Converter</code> performs the transformation automatically at handling time.</p>
</div>
<div class="paragraph">
<p>For complete details on payload conversion, see <a href="../../conversion/" class="xref page">Conversion</a>.</p>
</div>
<div class="sect2">
<h3 id="when_payload_conversion_is_sufficient"><a class="anchor" href="#when_payload_conversion_is_sufficient"></a>When payload conversion is sufficient</h3>
<div class="paragraph">
<p>Payload conversion handles many common versioning scenarios without requiring upcasters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Adding fields with defaults</strong> - New fields can have default values during conversion.</p>
</li>
<li>
<p><strong>Removing fields</strong> - Handlers simply don&#8217;t declare fields they don&#8217;t need.</p>
</li>
<li>
<p><strong>Renaming fields</strong> - Use Jackson annotations like <code>@JsonProperty</code> to map old names to new fields.</p>
</li>
<li>
<p><strong>Changing field types</strong> - Converters can transform compatible types (for example String to Integer, Date to Instant).</p>
</li>
<li>
<p><strong>Restructuring for different handlers</strong> - Different handlers can use completely different Java types for the same event.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="event-upcasting"><a class="anchor" href="#event-upcasting"></a>Event Upcasting</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Upcasters not available in Axon 5.0</div>
<div class="paragraph">
<p>Event upcasters are not yet available in Axon Framework 5.0.
They are scheduled to be reintroduced in Axon Framework 5.2.0 (see <a href="https://github.com/AxonFramework/AxonFramework/issues/3597">issue #3597</a>) with updated APIs aligned with the new conversion architecture.</p>
</div>
<div class="paragraph">
<p>For now, rely on <a href="#event_versioning_at_handling_time">payload conversion at handling time</a> for event versioning.
This approach handles most common versioning scenarios without requiring upcasters.</p>
</div>
<div class="paragraph">
<p>The documentation below describes the upcasting concepts and approach that will be available in future releases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For scenarios where <a href="#when_payload_conversion_is_sufficient">payload conversion</a> is not sufficient, Axon will provide upcasters to transform the stored representation of events.</p>
</div>
<div class="paragraph">
<p>Upcasting transforms events from their original stored structure to a new structure.
This is useful when you need to modify the event stream itself, such as splitting events, merging events, or fundamentally changing event types.</p>
</div>
<div class="paragraph">
<p>To upcast an event means to transform it from its original structure to its new structure.
Unlike payload conversion which happens at handling time, upcasting modifies how events are read from storage.
Manually written upcasters must be provided to specify how to transform the old structure to the new structure.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Benefits of Upcasters</div>
<div class="paragraph">
<p>Upcasting allows you to do non-destructive refactoring of stored events.
In other words, the complete event history remains intact, while events are transformed when read from the store.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Upcasters take one input event of version <code>x</code> and output zero or more new events of version <code>x + 1</code>.
Moreover, upcasters are processed in a chain, meaning that the output of one upcaster is sent to the input of the next.
This allows you to update events in an incremental manner, writing an upcaster for each new event version, making them small, isolated, and easy to understand.</p>
</div>
<div class="paragraph">
<p>In the remainder of this section we&#8217;ll explain when you need an upcaster, how to write an upcaster, describe the different (abstract) implementations of the Upcaster, and explain how the serialized representations of events affects how upcasters are written.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">When to use upcasters vs payload conversion</div>
<div class="paragraph">
<p>For most event versioning scenarios, <a href="#event_versioning_at_handling_time">payload conversion at handling time</a> is simpler and more flexible.
Only use upcasters when you need to transform the stored event structure in ways that conversion cannot handle.</p>
</div>
<div class="paragraph">
<p>See <a href="#when_upcasters_are_needed">When upcasters are needed</a> for specific scenarios where upcasters are required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="when_upcasters_are_needed"><a class="anchor" href="#when_upcasters_are_needed"></a>When upcasters are needed</h3>
<div class="paragraph">
<p>Upcasters are required when you need to transform the <strong>stored representation</strong> of events in ways that payload conversion cannot handle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Splitting one event into multiple events</strong> - When you need to split a single stored event into multiple distinct events.</p>
</li>
<li>
<p><strong>Merging multiple events</strong> - When you need to combine several stored events into one.</p>
</li>
<li>
<p><strong>Complex structural transformations</strong> - When the transformation requires access to multiple events or contextual information.</p>
</li>
<li>
<p><strong>Changing event identity</strong> - When you need to change the event&#8217;s MessageType (qualified name or version) in storage.</p>
</li>
<li>
<p><strong>Generic transformation for all handlers</strong> - When you have multiple handlers for the same event and want a single transformation to apply to all of them, rather than adjusting each handler individually.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For most scenarios, payload conversion is simpler and more flexible than upcasters.
Only use upcasters when the stored event structure itself must change.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_version_identification"><a class="anchor" href="#_event_version_identification"></a>Event version identification</h3>
<div class="paragraph">
<p>To allow an upcaster to determine what version of serialized object they are receiving, the Event Store stores a version along with the fully qualified name of the event&#8217;s <code>MessageType</code>.</p>
</div>
<div class="paragraph">
<p>This version is specified using the <code>@Event</code> annotation on your event class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Event(
    namespace = "com.example.orders",  // Defaults to package name
    name = "OrderPlaced",              // Defaults to simple class name
    version = "1.0.0"                  // Defaults to "0.0.1"
)
public record OrderPlacedEvent(String orderId) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version field in the <code>@Event</code> annotation determines the version stored in the event store.
Upcasters use this version to decide whether to transform an event.</p>
</div>
<div class="paragraph">
<p>Axon&#8217;s upcasters do not work with the <code>EventMessage</code> directly, but with an <code>IntermediateEventRepresentation</code>.
The <code>IntermediateEventRepresentation</code> provides functionality to retrieve all necessary fields to construct an <code>EventMessage</code> (and thus a upcasted <code>EventMessage</code> too), together with the actual <em>upcast</em> functions.
These upcast functions by default only allow the adjustment of the event&#8217;s payload, payload type and additions to the event&#8217;s metadata.
The actual representation of the events in the upcast function may vary based on the event serializer used or the desired form to work with, so the upcast function of the <code>IntermediateEventRepresentation</code> allows the selection of the expected representation type.
The other fields, for example the message/aggregate identifier, aggregate type, timestamp etc. are not adjustable by the <code>IntermediateEventRepresentation</code>.
Adjusting those fields is not the intended work for an upcaster.
As such, those options are not provided by the provided <code>IntermediateEventRepresentation</code> implementations.</p>
</div>
<div class="paragraph">
<p>The basic <code>Upcaster</code> interface for events in the Axon Framework works on a <code>Stream</code> of <code>IntermediateEventRepresentations</code> and returns a <code>Stream</code> of <code>IntermediateEventRepresentations</code>.
The upcasting process thus does not directly return the end result of the introduced upcast functions, but chains every upcasting function from one revision to another together by stacking <code>IntermediateEventRepresentations</code>.
Once this process has taken place and the end result is pulled from them, that is when the actual upcasting function is performed on the serialized event.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Different serialization formats</div>
<div class="paragraph">
<p>Sometimes the event store can contain events in different serialized formats, since differing <code>Converter</code> implementations were used.</p>
</div>
<div class="paragraph">
<p>During upcasting it is important to note what the format is of the <code>IntermediateEventRepresentation</code>, as it influences the upcaster solution provided.
To validate if the intermediate representation supports a given type, you can invoke <code>IntermediateEventRepresentation#canConvertDataTo(Class&lt;?&gt;)</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="provided_abstract_upcaster_implementations"><a class="anchor" href="#provided_abstract_upcaster_implementations"></a>Provided abstract Upcaster implementations</h3>
<div class="paragraph">
<p>As described earlier, the <code>Upcaster</code> interface does not upcast a single event; it requires a <code>Stream&lt;IntermediateEventRepresentation&gt;</code> and returns one.
However, an upcaster is usually written to adjust a single event out of this stream.
More elaborate upcasting setups are also imaginable.
For example from one event to multiple, or an upcaster which pulls state from an earlier event and pushes it in a later one.
This section describes the currently provided (abstract) implementations of event upcasters which a user can extend to add their own desired upcast functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SingleEventUpcaster</code> - a one-to-one implementation of an event upcaster.
Extending from this implementation requires one to implement a <code>canUpcast</code> and <code>doUpcast</code> function, which respectively check whether the event at hand is to be upcasted, and if so how it should be upcasted.
This is most likely the implementation to extend from, as most event adjustments are based on self contained data and are one to one.</p>
</li>
<li>
<p><code>EventMultiUpcaster</code> - a one-to-many implementation of an event upcaster.
It is mostly identical to a <code>SingleEventUpcaster</code>, with the exception that the <code>doUpcast</code> function returns a <code>Stream</code> instead of a single <code>IntermediateEventRepresentation</code>.
As such, this upcaster allows you to convert a single event to several events.
This might be useful if you for example have figured out you want more fine grained events from a <em>fat</em> event.</p>
</li>
<li>
<p><code>ContextAwareSingleEventUpcaster</code> - a one-to-one implementation of an upcaster, which can store context of events during the process.
Next to the <code>canUpcast</code> and <code>doUpcast</code>, the context aware upcaster requires one to implement a <code>buildContext</code> function, which is used to instantiate a context which is carried between events going through the upcaster.
The <code>canUpcast</code> and <code>doUpcast</code> functions receive the context as a second parameter, next to the <code>IntermediateEventRepresentation</code>.
The context can then be used within the upcasting process to pull fields from earlier events and populate other events.
It thus allows you to move a field from one event to a completely different event.</p>
</li>
<li>
<p><code>ContextAwareEventMultiUpcaster</code> - a one-to-many implementation of an upcaster, which can store context of events during the process.
This abstract implementation is a combination of the <code>EventMultiUpcaster</code> and <code>ContextAwareSingleEventUpcaster</code>, and thus services the goal of keeping context of <code>IntermediateEventRepresentations</code> and upcasting one such representation to several.
This implementation is useful if you not only want to copy a field from one event to another, but have the requirement to generate several new events in the process.</p>
</li>
<li>
<p><code>EventTypeUpcaster</code> - a full upcaster implementation dedicated to changing the event type.
The <code>EventTypeUpcaster</code> is an implementation of the <code>SingleEventUpcaster</code> with predefined <code>canUpcast</code> and <code>doUpcast</code> functions to be able to change an event from one event type to another.
This can be used to for example change the class or package name of an event with ease.
To create an <code>EventTypeUpcaster</code>, it is recommended to use the <code>EventTypeUpcaster#from(String expectedPayloadType, expectedRevision)</code> and <code>EventTypeUpcaster.Builder#to(upcastedPayloadType, upcastedRevision)</code> methods.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What&#8217;s part of the context in a Context-Aware Upcasters?</div>
<div class="paragraph">
<p>A context-aware upcaster allows you to collect state from previous events.
As upcasters work on a stream of events, all that can ever belong to the context is the state of that stream.</p>
</div>
<div class="paragraph">
<p>However, this "stream of events" is not identical at all times.
For example, when an entity is event-sourced, the event stream consists of entity instance-specific events.
Furthermore, the stream of events starts from the <a href="../event-processors/streaming/#tracking-tokens" class="xref page">tracking token&#8217;s</a> position for a <a href="../event-processors/streaming/" class="xref page">streaming event processor</a>.
Hence, the context contains different states depending on what&#8217;s included in the event stream.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_writing_an_upcaster"><a class="anchor" href="#_writing_an_upcaster"></a>Writing an Upcaster</h3>
<div class="paragraph">
<p>The following Java snippets will serve as a basic example of a one-to-one upcaster (the <code>SingleEventUpcaster</code>).</p>
</div>
<div class="paragraph">
<p>Old version of the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Event(name = "Complaint", version = "1.0")
public record ComplaintEvent(
    String id,
    String companyName
) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>New version of the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Event(name = "Complaint", version = "2.0")
public record ComplaintEvent(
    String id,
    String companyName,
    String description
) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upcaster from 1.0 revision to 2.0 revision:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_event_with_xstream" class="tab">
<p>Event with XStream</p>
</li>
<li id="_tabs_1_event_with_jackson" class="tab">
<p>Event with Jackson</p>
</li>
</ul>
</div>
<div id="_tabs_1_event_with_xstream--panel" class="tabpanel" aria-labelledby="_tabs_1_event_with_xstream">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ComplaintEvent1_to_2Upcaster extends SingleEventUpcaster {

   private static final SimpleSerializedType TARGET_TYPE =
           new SimpleSerializedType(ComplaintEvent.class.getTypeName(), "1.0");

   @Override
   protected boolean canUpcast(IntermediateEventRepresentation intermediateRepresentation) {
      return intermediateRepresentation.getType().equals(TARGET_TYPE);
   }

   @Override
   protected IntermediateEventRepresentation doUpcast(
           IntermediateEventRepresentation intermediateRepresentation
   ) {
      return intermediateRepresentation.upcastPayload(
              new SimpleSerializedType(TARGET_TYPE.getName(), "2.0"),
              org.dom4j.Document.class,
              document -&gt; {
                 document.getRootElement()
                         .addElement("description")
                         .setText("no complaint description"); // Default value
                 return document;
              }
      );
   }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_event_with_jackson--panel" class="tabpanel" aria-labelledby="_tabs_1_event_with_jackson">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ComplaintEvent1_to_2Upcaster extends SingleEventUpcaster {
   // upcaster implementation...

   private static final SimpleSerializedType TARGET_TYPE =
           new SimpleSerializedType(ComplaintEvent.class.getTypeName(), "1.0");

   @Override
   protected boolean canUpcast(IntermediateEventRepresentation intermediateRepresentation) {
      return intermediateRepresentation.getType().equals(TARGET_TYPE);
   }

   @Override
   protected IntermediateEventRepresentation doUpcast(
           IntermediateEventRepresentation intermediateRepresentation
   ) {
      return intermediateRepresentation.upcastPayload(
              new SimpleSerializedType(TARGET_TYPE.getName(), "2.0"),
              com.fasterxml.jackson.databind.JsonNode.class,
              event -&gt; {
                  ((ObjectNode) event).put("description", "no complaint description");
                  return event;
              }
      );
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_an_upcaster"><a class="anchor" href="#_configuring_an_upcaster"></a>Configuring an Upcaster</h3>
<div class="paragraph">
<p>After choosing an upcaster type and constructing your first instance, it is time to configure it in your application.
Important in the configuration is knowing that upcasters need to be invoked in order.
Events tend to move through several format iterations, each with its own upcasting requirements.
Since an upcaster only adjusts an event from one version to another, it is paramount to maintain the ordering of the upcasters.</p>
</div>
<div class="paragraph">
<p>The component in charge of that ordering is the <code>EventUpcasterChain</code>.
The upcaster chain is what the <code>EventStore</code> uses to attach all the upcast functions to the event stream.
When configuring your upcasters, most scenarios will not require you to touch the <code>EventUpcasterChain</code> directly.
Instead, consider the following snippets when it comes to registering upcasters:</p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_configuration_api" class="tab">
<p>Configuration API</p>
</li>
<li id="_tabs_2_spring_boot_with_order_annotation" class="tab">
<p>Spring Boot with <code>@Order</code> annotation</p>
</li>
<li id="_tabs_2_spring_boot_with_eventupcasterchain_bean" class="tab">
<p>Spring Boot with <code>EventUpcasterChain</code> bean</p>
</li>
</ul>
</div>
<div id="_tabs_2_configuration_api--panel" class="tabpanel" aria-labelledby="_tabs_2_configuration_api">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.messaging.core.configuration.MessagingConfigurer;

public class AxonConfig {
    // omitting other configuration methods...
    public void configureUpcasters(MessagingConfigurer configurer) {
        // The method invocation order imposes the upcaster ordering
        configurer.registerEventUpcaster(config -&gt; new ComplaintEvent0_to_1Upcaster())
                  .registerEventUpcaster(config -&gt; new ComplaintEvent1_to_2Upcaster());
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_spring_boot_with_order_annotation--panel" class="tabpanel" aria-labelledby="_tabs_2_spring_boot_with_order_annotation">
<div class="paragraph">
<p>Axon honors Spring&#8217;s <code>Order</code> annotation on upcasters.
The numbers used in the annotation will dictate the ordering.
The lower the number, the earlier it is registered to the upcaster chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
@Order(0)
public class ComplaintEvent0_to_1Upcaster extends SingleEventUpcaster {
   // upcaster implementation...

}

@Component
@Order(1)
public class ComplaintEvent1_to_2Upcaster extends SingleEventUpcaster {
   // upcaster implementation...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can be placed both on the class itself, or on bean creation methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    @Order(0)
    public SingleEventUpcaster complaintEventUpcasterOne() {
        return new ComplaintEvent0_to_1Upcaster();
    }

    @Bean
    @Order(1)
    public SingleEventUpcaster complaintEventUpcasterTwo() {
        return new ComplaintEvent0_to_1Upcaster();
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_spring_boot_with_eventupcasterchain_bean--panel" class="tabpanel" aria-labelledby="_tabs_2_spring_boot_with_eventupcasterchain_bean">
<div class="paragraph">
<p>Adding an <code>EventUpcasterChain</code> bean to the Application Context will tell Axon to configure it for your event source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    public EventUpcasterChain eventUpcasterChain() {
        return new EventUpcasterChain(
                new ComplaintEvent0_to_1Upcaster(),
                new ComplaintEvent0_to_1Upcaster()
        );
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upcasting_snapshots"><a class="anchor" href="#upcasting_snapshots"></a>Upcasting snapshots</h3>
<div class="paragraph">
<p>Although the description above leans towards event upcasting, note that all the given constructs can be used to upcast a <a href="../../tuning/event-snapshots/" class="xref page">snapshot</a>.</p>
</div>
<div class="paragraph">
<p>From the <code>abstract</code> upcaster implementations shared <a href="#provided_abstract_upcaster_implementations">earlier</a>, the only feasible upcaster is the <code>SingleEventUpcaster</code>. We can logically deduce that a multi-upcaster would be incorrect, as only the last returned snapshot is used to load an entity. Furthermore, context-aware upcasters aren&#8217;t necessary either, as any context-specific information in a snapshot is generated during event sourcing. Hence, if any data should carry over, simply reconstruct the snapshot instead.</p>
</div>
<div class="paragraph">
<p>When upcasting events, the <strong>type</strong> to upcaster equals the fully qualified class name of the event itself. When upcasting snapshots, the type is the fully qualified class name of the <strong>entity</strong>. Knowing this detail, let&#8217;s look at an example of a snapshot upcaster for the <code>GiftCard</code> entity (as exemplified <a href="../../commands/modeling/aggregate/" class="xref page">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GiftCardSnapshotNull_to_1Upcaster extends SingleEventUpcaster {

   private static final SimpleSerializedType TARGET_TYPE =
           new SimpleSerializedType(GiftCard.class.getTypeName(), null);

   @Override
   protected boolean canUpcast(IntermediateEventRepresentation intermediateRepresentation) {
      return intermediateRepresentation.getType().equals(TARGET_TYPE);
   }

   @Override
   protected IntermediateEventRepresentation doUpcast(
           IntermediateEventRepresentation intermediateRepresentation
   ) {
      return intermediateRepresentation.upcastPayload(
              new SimpleSerializedType(TARGET_TYPE.getName(), "1"),
              org.dom4j.Document.class,
                            com.fasterxml.jackson.databind.JsonNode.class,
              event -&gt; {
                  ((ObjectNode) event).put("owner", "[owner-id]");
                  return event;
              }
      );
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever constructing a snapshot upcaster, be mindful of <a href="../../tuning/event-snapshots/#_filtering_snapshot_events" class="xref page"><code>SnapshotFilters</code></a>.
When using the <code>@Event</code> annotation&#8217;s version field on your Entity, a <code>VersionSnapshotFilter</code> may be constructed by default.
This filter can prevent snapshot events from reaching your upcaster.</p>
</div>
<div class="paragraph">
<p>As such, it is advised to override the <code>SnapshotFilter</code> of an Entity to a no-op entry when you prefer to upcast your snapshots.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../event-store-internals/">Event Store Internals</a></span>
  <span class="next"><a href="../../queries/">Queries</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    </div>
  </body>
</html>
