<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Matchers and Field Filters</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/testing/matchers-and-field-filters/">
    <link rel="prev" href="../basic-testing/">
    <link rel="next" href="../advanced-testing/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../../_'</script>


<link rel="icon" href="../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../../5.0/">Axon Framework</a>
                <a class="navbar-item" href="../../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Axon Framework Reference</a></li>
    <li><a href="../">Testing</a></li>
    <li><a href="./">Matchers and Field Filters</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/main/docs/reference-guide/modules/testing/pages/matchers-and-field-filters.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Matchers%20and%20Field%20Filters" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Matchers%20and%20Field%20Filters%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BMatchers%20and%20Field%20Filters%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2Fdevelopment%2Ftesting%2Fmatchers-and-field-filters%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">development</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item is-current" href="./">development</a>
    <a class="version item" href="../../../5.0/testing/matchers-and-field-filters/">5.0</a>
    <a class="version item is-missing" href="../../../4.12/">4.12</a>
    <a class="version item is-missing" href="../../../4.11/">4.11</a>
    <a class="version item is-missing" href="../../../4.10/">4.10</a>
    <a class="version item is-missing" href="../../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="development">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../migration/">Migration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/why-upgrade/">Why Upgrade?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/prerequisites/">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/solved-architecture-choices/">Resolved Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../migration/understanding-architecture-principles/">Understanding Choices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/processing-context/">Processing Context</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../commands/">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commands/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-publishing/">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/event-processors/">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/subscribing/">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/infrastructure/">Infrastructure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-store-internals/">Event Store Internals</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-versioning/">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../basic-testing/">Basic Testing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Matchers and Field Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced-testing/">Advanced Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../conversion/">Conversion</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/tracing/">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Matchers and Field Filters</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When testing message handling, the fixture compares expected and actual messages using field-by-field equality.
While the built-in assertions cover most scenarios, <a href="#matchers">matchers</a> and <a href="#field_filters">field filters</a> provide a more expressive test flow for the <a href="../basic-testing/#then_phase" class="xref page">then-phase</a> of the <code>AxonTestFixture</code>.
Note that neither are required, but knowing they are there and how they are used can greatly improve your tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="matchers"><a class="anchor" href="#matchers"></a>Matchers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whenever the equality validation provided by operation like <a href="../basic-testing/#then_events" class="xref page"><code>events(&#8230;&#8203;)</code></a> or <a href="../basic-testing/#then_commands" class="xref page"><code>commands(&#8230;&#8203;)</code></a> do not cover your scenario well enough, you can use the match-based methods provided on the test fixture.
These matcher-based then-phase operations come in two flows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Then-satisfies - Lambda-based verification providing the messages to assert, like <a href="../basic-testing/#then_event_satisfies" class="xref page"><code>eventsSatisfy(&#8230;&#8203;)</code></a> and <a href="../basic-testing/#then_command_satisfies" class="xref page"><code>commandsSatisfy(&#8230;&#8203;)</code></a>.
Captures thrown <code>AssertionErrors</code> by the lambda to conclude the verification outcome.</p>
</li>
<li>
<p>Then-matches - Predicate-based verification providing the messages to assert, like <a href="../basic-testing/#then_event_matches" class="xref page"><code>eventsMatch(&#8230;&#8203;)</code></a> and <a href="../basic-testing/#then_command_matches" class="xref page"><code>commandsMatch(&#8230;&#8203;)</code></a>.
Uses the returned boolean to conclude the verification outcome.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You are able to taking a number of courses for verification as both then-satisfies and then-matches are lambda-based.
As such, you can invoke <strong>any</strong> matching logic you would like.
The main difference between both, is that then-satisfies will take the verification errors as thrown by the given lambda.
The then-matches flow expects a boolean to be returned to dictated if verification succeeded.
In taking this route, the use of (custom) matchers can provide benefits like ignoring certain field for verification, or for drafting application specific error messages, as matchers can be tailor-made for your use case.</p>
</div>
<div class="sect2">
<h3 id="_built_in_matchers"><a class="anchor" href="#_built_in_matchers"></a>Built-in matchers</h3>
<div class="paragraph">
<p>Axon provides several useful matchers, based on the Hamcrest <code>Matcher</code> interface.
These can be found in the <code>org.axonframework.test.matchers.Matchers</code> class as static operations, typically expecting another <code>Matcher</code> to complete the verification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>payloadsMatching(Matcher&lt;? extends List&lt;?&gt;&gt;)</code> - Matcher unwrapping the payload of <strong>all</strong>  messages, given them to the given matcher.</p>
</li>
<li>
<p><code>messageWithPayload(Matcher&lt;?&gt;)</code> - Matcher unwrapping the payload of a <strong>single</strong> message, giving it to the given Matcher.</p>
</li>
<li>
<p><code>listWithAllOf(Matcher&lt;T&gt;&#8230;&#8203;)</code> - Matcher expecting a <strong>list</strong> of matchers that <strong>all</strong> must match, in any order.</p>
</li>
<li>
<p><code>listWithAnyOf(Matcher&lt;T&gt;&#8230;&#8203;)</code> - Matcher expecting a <strong>list</strong> of matchers of which at least <strong>one</strong> must match, in any order.</p>
</li>
<li>
<p><code>sequenceOf(Matcher&lt;T&gt;&#8230;&#8203;)</code> - Matcher expecting  <strong>list</strong> of matchers that should match in the given <strong>order</strong>, allowing for gaps.</p>
</li>
<li>
<p><code>exactSequenceOf(Matcher&lt;T&gt;&#8230;&#8203;)</code> - Matcher expecting  <strong>list</strong> of matchers that should match <strong>exactly</strong> in the given <strong>order</strong>.</p>
</li>
<li>
<p><code>matches(Predicate&lt;T&gt;)</code> / <code>predicate(Predicate&lt;T&gt;)</code> - Matcher taking in a predicate.</p>
</li>
<li>
<p><code>deepEquals(T expected)</code> / <code>deepEquals(T expected, FieldFilter filter)</code> - Deep field-by-field quality with optional <a href="#field_filters">filtering</a>.</p>
</li>
<li>
<p><code>exactClassOf(Class&lt;T&gt; expected)</code> - Exact class type matching.</p>
</li>
<li>
<p><code>noEvents()</code> / <code>noCommands()</code> - Empty collection matching.</p>
</li>
<li>
<p><code>andNoMore()</code> / <code>nothing()</code> - Matcher signaling the end, to be used when a list of matchers is expected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code samples below show a number of examples using the built-in matchers. Note that all of them use Axon&#8217;s then-satisfies flow in combination with Hamcrest&#8217;s <code>assertThat</code> to contain the built-in matcher:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_payloads_matching_a_listwithallof_containing_matches" class="tab">
<p>Payloads matching a listWithAllOf() containing matches()</p>
</li>
<li id="_tabs_1_exact_sequence_of_messagewithpayload_containing_exactclassof_and_no_more" class="tab">
<p>Exact sequence of messageWithPayload() containing exactClassOf() and no more</p>
</li>
<li id="_tabs_1_no_events" class="tab">
<p>No events</p>
</li>
</ul>
</div>
<div id="_tabs_1_payloads_matching_a_listwithallof_containing_matches--panel" class="tabpanel" aria-labelledby="_tabs_1_payloads_matching_a_listwithallof_containing_matches">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.axonframework.test.matchers.Matchers.*;
import static org.hamcrest.MatcherAssert.assertThat;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void listWithAllOfMatchers() {
        fixture.when()
               .command(new ProcessOrderCommand("order-1"))
               .then()
               .eventsSatisfy(events -&gt; assertThat(events, payloadsMatching(
                       listWithAllOf(
                               matches(payload -&gt; payload instanceof OrderProcessedEvent),
                               matches(payload -&gt; payload instanceof InventoryIncrementedEvent)
                       )
               )));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_exact_sequence_of_messagewithpayload_containing_exactclassof_and_no_more--panel" class="tabpanel" aria-labelledby="_tabs_1_exact_sequence_of_messagewithpayload_containing_exactclassof_and_no_more">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.axonframework.test.matchers.Matchers.*;
import static org.hamcrest.MatcherAssert.assertThat;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void exactSequenceOfExactClasses() {
        fixture.when()
               .command(new CompleteOrderCommand("order-1"))
               .then()
               .eventsSatisfy(events -&gt; assertThat(events, exactSequenceOf(
                       messageWithPayload(exactClassOf(OrderCompletedEvent.class)),
                       messageWithPayload(exactClassOf(PaymentProcessedEvent.class)),
                       andNoMore()
               )));
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_no_events--panel" class="tabpanel" aria-labelledby="_tabs_1_no_events">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import static org.axonframework.test.matchers.Matchers.*;
import static org.hamcrest.MatcherAssert.assertThat;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void noEvents() {
        fixture.when()
               .command(new CompleteOrderCommand("unknown"))
               .then()
               .eventsSatisfy(events -&gt; assertThat(events, Matchers.noEvents()));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="field_filters"><a class="anchor" href="#field_filters"></a>Field filters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Field filters control which fields are included in this comparison, allowing you to ignore non-deterministic fields like timestamps and UUIDs.
To explain the benefits of field filters, let us look at the following example event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public record AccountCreatedEvent(
    String accountId,
    double initialBalance
) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When testing, you want to verify the <code>initialBalance</code>, but not the <code>accountId</code> since it is generated at runtime.
Hence, it will differ for every run.
As such, a plain test as shown below would not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.fixture.AxonTestFixture;

class AccountTest {

    private AxonTestFixture fixture;

    @Test
    void test() {
        fixture.given()
               .noPriorActivity()
               .when()
               .command(new CreateAccountCommand(500.00))
               .then()
               .events(new AccountCreatedEvent("???", 500.00));
               // Verify fails as we are unaware of the accountId
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The field filter solves this problem by instructing the fixture that certain fields can be "filtered" from verification.
Any registered field filters are applied during comparison in the then-phase following these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The fixture recursively examines all fields of expected and actual (nested) objects.</p>
</li>
<li>
<p>For each field, all registered field filters are consulted.</p>
</li>
<li>
<p>If any filter returns <code>false</code>, the field is skipped.</p>
</li>
<li>
<p>Only fields that pass all filters are compared.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before we look at <a href="#registering_field_filters">registering field filters</a> and <a href="#example_field_filter_usages">common examples</a>, it is good to know the alternatives.
This will allow you to take the most reasonable course of action for your application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The flexibility of <a href="#matchers">matchers</a> can resolve filtering on a per-test basis.</p>
</li>
<li>
<p>Inject mockable services that generate the fields you need to ignore.
This provides control over the returned result and thus the verified result.
Hence, field filters would become obsolete when services can be mocked.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="registering_field_filters"><a class="anchor" href="#registering_field_filters"></a>Registering field filters</h3>
<div class="paragraph">
<p>To register field filters with the test fixture, you need to customize it.
Hence, instead of using <code>AxonTestFixture#with(ApplicationConfigurer)</code>, you use the <code>AxonTestFixture#with(ApplicationConfigurer, UnaryOperator&lt;Customization&gt;)</code> operation.
The lambda on the <code>Customization</code> provides two methods to register field filters, which are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Customization#registerIgnoredField(Class&lt;?&gt; declaringClass, String fieldName)</code></p>
</li>
<li>
<p><code>Customization#registerFieldFilter(FieldFilter)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus, if you want to ignore a field for a specific message, you can use the <code>registerIgnoredField</code> operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.registerIgnoredField(
                        AccountCreatedEvent.class, "accountId"
                )
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this filter in place, the fixture will ignore fields named <code>"accountId"</code> for messages with the payload type <code>AccountCreatedEvent</code>.
If you need more control, you can provide a (custom) <code>FieldFilter</code> through the <code>registerFieldFilter</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.registerFieldFilter(
                        field -&gt; !field.getName().equals("accountId")
                )
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will filter out <strong>all</strong> occurrences of fields name <code>"accountId"</code> regardless of the message type.
Note that the <code>FieldFilter</code> is a functional interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FunctionalInterface
public interface FieldFilter {
    boolean accept(Field field);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returning <code>true</code> will include the field in comparison.
Thus <code>false</code> will ignore it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_field_filters"><a class="anchor" href="#_built_in_field_filters"></a>Built-in field filters</h3>
<div class="paragraph">
<p>Axon provides several built-in field filters that you can use instead of constructing your own:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>AllFieldsFilter</code> - Accepts all fields (the default behavior).</p>
</li>
<li>
<p><code>NonStaticFieldsFilter</code> - Excludes static fields from comparison.</p>
</li>
<li>
<p><code>NonTransientFieldsFilter</code> - Excludes transient fields from comparison.</p>
</li>
<li>
<p><code>IgnoreField</code> - Ignores a specific field; this is what <code>registerIgnoredField()</code> uses internally.</p>
</li>
<li>
<p><code>MatchAllFieldFilter</code> - Combines multiple filters using AND logic (all filters must accept the field).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="example_field_filter_usages"><a class="anchor" href="#example_field_filter_usages"></a>Example field filter usages</h3>
<div class="paragraph">
<p>The tabs below show a couple of common scenarios for which you could use field filters in your test fixtures,</p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_filter_timestamp_fields" class="tab">
<p>Filter timestamp fields</p>
</li>
<li id="_tabs_2_filter_identifier_fields" class="tab">
<p>Filter identifier fields</p>
</li>
<li id="_tabs_2_filter_annotated_fields" class="tab">
<p>Filter annotated fields</p>
</li>
<li id="_tabs_2_combining_filters" class="tab">
<p>Combining filters</p>
</li>
</ul>
</div>
<div id="_tabs_2_filter_timestamp_fields--panel" class="tabpanel" aria-labelledby="_tabs_2_filter_timestamp_fields">
<div class="paragraph">
<p>This custom <code>FieldFilter</code> registered below will ignore fields that are named <code>"timestamp"</code>, <code>"createdate"</code>, or <code>"updatedate"</code>, and if the type is an <code>Instant</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;

import java.time.Instant;

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.registerFieldFilter(field -&gt; {
                    String name = field.getName();
                    return !(name.contains("timestamp")
                            || name.contains("createDate")
                            || name.contains("updateDate"))
                            &amp;&amp; !field.getType().equals(Instant.class);
                })
        );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_filter_identifier_fields--panel" class="tabpanel" aria-labelledby="_tabs_2_filter_identifier_fields">
<div class="paragraph">
<p>This custom <code>FieldFilter</code> registered below will ignore fields that are contain <code>"id"</code> in the name and are of type <code>UUID</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import java.util.UUID;

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.registerFieldFilter(
                        field -&gt; !field.getType().equals(UUID.class)
                                &amp;&amp; !field.getName().toLowerCase().contains("id")
                )
        );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_filter_annotated_fields--panel" class="tabpanel" aria-labelledby="_tabs_2_filter_annotated_fields">
<div class="paragraph">
<p>You can filter on annotations as well, since the <code>FieldFilter</code> receive a <code>Field</code>.
Thus, you can define a custom annotation to mark fields that should be ignored.
In the example below, we have constructed an <code>@IgnoreInTest</code> annotation that we filter on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.junit.jupiter.api.*;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
@interface IgnoreInTest {
    // Annotation is named as-s for example purposes only!
}

record AccountCreatedEvent(
        @IgnoreInTest String accountId,
        double amount
) {
}

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(
                configurer,
                customization -&gt; customization.registerFieldFilter(
                        field -&gt; !field.isAnnotationPresent(IgnoreInTest.class)
                )
        );
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_combining_filters--panel" class="tabpanel" aria-labelledby="_tabs_2_combining_filters">
<div class="paragraph">
<p>Combine multiple filters.
All filters are combined with AND logic - a field must pass all filters to be included.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.common.configuration.ApplicationConfigurer;
import org.axonframework.test.fixture.AxonTestFixture;
import org.axonframework.test.matchers.NonTransientFieldsFilter;
import org.junit.jupiter.api.*;

class AccountTest {

    private ApplicationConfigurer configurer;

    private AxonTestFixture fixture;

    @BeforeEach
    void setUp() {
        fixture = AxonTestFixture.with(configurer, AccountTest::registerFilters);
    }

    private static AxonTestFixture.Customization registerFilters(
            AxonTestFixture.Customization customization
    ) {
        return customization.registerIgnoredField(AccountCreatedEvent.class, "accountId")
                            .registerIgnoredField(OrderCreatedEvent.class, "orderId")
                            .registerFieldFilter(NonTransientFieldsFilter.instance())
                            .registerFieldFilter(field -&gt; !field.getName().contains("internal"));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../basic-testing/">Basic Testing</a></span>
  <span class="next"><a href="../advanced-testing/">Advanced Testing</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    </div>
  </body>
</html>
