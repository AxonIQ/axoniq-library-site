<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Serialization</title>
    <link rel="canonical" href="https://docs.axoniq.io/axon-framework-reference/5.0/conversion/">
    <link rel="prev" href="../testing/sagas-1/">
    <link rel="next" href="../tuning/">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
    <link rel="icon" href="../../../_/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" href="../../../_/img/favicon.png"><!-- 180×180 -->
    <link rel="manifest" href="../../../_/static/manifest.webmanifest">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5QD58ZB');</script>
        <!-- End Google Tag Manager -->

    <script>var uiRootPath = '../../../_'</script>


<link rel="icon" href="../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
    <div class="header_container">
      
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5QD58ZB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.axoniq.io">
        <img src="../../../_/img/docs-logo.png" class="header_logo"/>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-center">
        <a class="navbar-item" href="../../../home/basics/">Basics</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/guides/">Guides</a>
          <div class="navbar-dropdown card">
            <a class="navbar-item" href="../../../home/guides/axon-framework">Axon Framework</a>
            <a class="navbar-item" href="../../../home/guides/axon-server">Axon Server</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="../../../home/reference/">Reference</a>
          <div class="navbar-dropdown card">
                <a class="navbar-item" href="../../5.0/">Axon Framework</a>
                <a class="navbar-item" href="../../../axon-framework-extensions/">Axon Framework Extensions</a>
                <a class="navbar-item" href="../../../axon-server-reference/development/">Axon Server</a>
                <a class="navbar-item" href="../../../synapse-reference/v0.12/">Axon Synapse</a>
                <a class="navbar-item" href="../../../axoniq-platform-reference/">Axoniq Platform</a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search AxonIQ Docs">
            </div>
          </div>
        <a class="navbar-item navbar-button" href="https://platform.axoniq.io" target="_blank">Axoniq Platform</a>
      </div>
    </div>
  </nav>
</header>
      <div class="toolbar card" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../">Axon Framework Reference</a></li>
    <li><a href="./">Serialization</a></li>
  </ul>
</nav>
<div class="page-actions">
  <button class="actions-menu-toggle" title="Show actions related to this page">Actions</button>
  <div class="actions-menu toolbar_dropdown_menu card">
      <a class="action item" href="https://github.com/AxonFramework/AxonFramework/edit/axon-4.11.x/docs/old-reference-guide/modules/ROOT/pages/serialization.adoc">Edit this Page</a>
    
    <a class="action item" href="https://discuss.axoniq.io/search?q&#x3D;Serialization" target="discuss_search">View Discussions</a>
    <a class="action item" href="https://discuss.axoniq.io/new-topic?category&#x3D;library&amp;title&#x3D;%22Serialization%22%20Discussion&amp;body&#x3D;%3C!--%20Replace%20this%20comment%20with%20your%20comment%2Fsuggestion%2Fquestion%2F...%20--%3E%0A%0A%0A%3C!--%0AKeep%20the%20section%20below!%0ALinking%20back%20to%20the%20documentation%20URL%20not%20only%20helps%20people%20go%20to%20the%20page%0Abut%20also%20helps%20find%20relevant%20discussions%20from%20the%20documentation%20page%20via%20the%20%22View%20Discussion%22%20menu.%0A--%3E%0A%5Bdetails%3D%22Related%20library%20page%22%5D%0A%5BSerialization%5D(https%3A%2F%2Fdocs.axoniq.io%2Faxon-framework-reference%2F4.11%2Fserialization%2F)%0A%5B%2Fdetails%5D%0A" target="discuss_add">Start new discussion</a>
  </div>
</div>


<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.11</button>
  <div class="version-menu toolbar_dropdown_menu card">
    <a class="version item" href="../../development/conversion/">development</a>
    <a class="version item" href="../../5.0/conversion/">5.0</a>
    <a class="version item" href="../../4.12/serialization/">4.12</a>
    <a class="version item is-current" href="./">4.11</a>
    <a class="version item" href="../../4.10/serialization/">4.10</a>
    <a class="version item is-missing" href="../../0/">older releases</a>
  </div>
</div>
</div>
    </div>
    <div class="content_container">
      <div class="body">
<div class="nav-container" data-component="axon-framework-reference" data-version="4.11">
    <aside class="nav card">
      <div class="panels">
        <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../">Axon Framework</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../upgrading-to-4-7/">Upgrading to Axon Framework 4.7</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../messaging-concepts/">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/anatomy-message/">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-correlation/">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-intercepting/">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/supported-parameters-annotated-handlers/">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/exception-handling/">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/unit-of-work/">Unit of Work</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/timeouts/">Timeouts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate/">Aggregates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/multi-entity-aggregates/">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/state-stored-aggregates/">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-creation-from-another-aggregate/">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-polymorphism/">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/conflict-resolution/">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/event-processors/">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/subscribing/">Subscribing Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/streaming/">Streaming Event Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/dead-letter-queue/">Dead-Letter Queue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/infrastructure/">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-versioning/">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers/">Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers/">Dispatching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations/">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration/">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation/">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations/">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure/">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers/">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers/">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../testing/">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/commands-events/">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/sagas-1/">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="./">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots/">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing/">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing/">Command Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/rdbms-tuning/">Relational Databases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing/">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics/">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health/">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors/">Event Processor Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking/">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration/">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules/">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/major-releases/">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/minor-releases/">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues-and-workarounds/">Known Issues and Workarounds</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      </div>
    </aside>
</div>
<main class="article">
    <div class="page_content">
        <aside class="toc sidebar" data-title="Page content" data-levels="2">
  <div class="toc-menu"></div>
</aside>
          <article class="doc">
                <h1 class="page">Serialization</h1>
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The flow of messages between (micro)services and storage of events requires preparation of the messages through serialization.
Axon uses the <code>XStreamSerializer</code> by default, which uses <a href="http://x-stream.github.io/">XStream</a> to serialize into and deserialize from XML.
XStream is reasonably fast, and the result of serialization is human-readable.
This makes it quite useful for logging and debugging purposes.</p>
</div>
<div class="paragraph">
<p>The <code>XStreamSerializer</code> allows further customization if that&#8217;s required.
You can, for example, define aliases for specific packages, classes, or even fields.
In addition to being an excellent way to shorten potentially long names, you can also use aliases when class definitions of the serialized objects change.
For more information about aliases, visit the <a href="http://x-stream.github.io/">XStream website</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, Axon provides the <code>JacksonSerializer</code>.
This <code>Serializer</code> implementation uses <a href="https://github.com/FasterXML/jackson">Jackson</a> to serialize objects into and deserialize from JSON.
It produces a more compact serialized form, while requiring those classes to stick to Jackson&#8217;s conventions (or configuration).
The compact format makes it ideal for events, commands, and queries, as it minimizes the storage space and package size.</p>
</div>
<div class="paragraph">
<p>The third option provided by the AxonFramework is the <code>AvroServializer</code>. The <code>Serializer</code> uses <a href="https://avro.apache.org/">Apache Avro</a> to serialize objects into and deserialize from <a href="https://avro.apache.org/docs/1.12.0/specification/#binary-encoding">binary single-object-encoded format</a>. The format is compact, is based on the <a href="https://avro.apache.org/docs/1.12.0/specification/">Avro Schema Specification</a> and is ideal for messaging (serialization of commands, events and queries) and event storage. This serializer is designed to serve as payload <code>event</code>/<code>message</code> serializer and requires a <code>delegate</code> serializer to serialize everything else (here the best choice is <code>JacksonSerializer</code>). Since the entire serialization process is based on Apache Avro schema, a schema store is required. The framework provides a local <code>SchemaStore</code> which can be pre-filled manually or uses SpringBoot class path scanning to detect  schemas located on the class path.</p>
</div>
<div class="paragraph">
<p>You may also implement your own serializer simply by creating a class that implements <code>Serializer</code> and setting it within Axon&#8217;s configuration for the desired infrastructure components.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serializer_implementations"><a class="anchor" href="#_serializer_implementations"></a>Serializer Implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>Serializers</code> come in several flavors in Axon Framework and are used for various things.
Currently, you can choose between the <code>XStreamSerializer</code>, <code>JacksonSerializer</code> and <code>AvroSerializer</code> to serialize messages (commands/queries/events), tokens, snapshots, deadlines and sagas in an Axon application.</p>
</div>
<div class="paragraph">
<p>As there are several objects to be serialized, it is typically desired to chose which serializer handles which object.
To that end, the <code>Configuration</code> API allows you to define default, <code>message</code> and <code>event</code> serializers, which lead to the following object-serialization break down:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Event <code>Serializer</code> is in charge of (de)serializing event message payload and metadata.
Events are typically stored in an event store for a long period of time.
This is the main driver for choosing the event serializer implementation.</p>
</li>
<li>
<p>The Message <code>Serializer</code> is in charge of (de)serializing the command and query message payload and metadata (used in a distributed application setup).
Messages are shared between nodes and typically need to be interoperable and/or compact.
Take this into account when choosing the message serializer implementation.</p>
</li>
<li>
<p>The default <code>Serializer</code> is in charge of (de)serializing the remainder, being the messages (except the payload and metadata), tokens, snapshots, deadlines and sagas.
These objects are generally not shared between different applications, and most of these classes aren&#8217;t expected to have some of the getters and setters that are, for example, typically required by Jackson based serializers.
For example, a <code>QueryMessage</code> consists of a payload and <code>ResponseType</code>, which will respectively be (de)serialized using the <code>message</code> and the <code>default</code> serializer, the query request and response payload will be (de)serialized using the`message`serializer.
A flexible, general-purpose serializer like <a href="http://x-stream.github.io/">XStream</a> is ideal for this purpose.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By default, all three <code>Serializer</code> flavors are set to use the <code>XStreamSerializer</code>, which internally uses <a href="http://x-stream.github.io/">XStream</a> to serialize objects to an XML format.
XML is verbose, but XStream has the major benefit of being able to serialize virtually anything.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>XStream and JDK 17</em></p>
</div>
<div class="paragraph">
<p>Although XStream can "serialize virtually anything," more recent versions of the JDK impede its flexibility.
This predicament comes down to XStream&#8217;s reflective approach to finding out how to de-/serialize <em>any</em> object, which has become problematic with Java&#8217;s intent to secure its internals.
Hence, if you&#8217;re using JDK 17, the chances are that objects (for example, your sagas) intended for serialization require additional configuration.</p>
</div>
<div class="paragraph">
<p>On some occasions configuring XStream&#8217;s security settings is sufficient.
Other times you will have to introduce custom <a href="https://x-stream.github.io/converters.html"><code>Converters</code></a> to de-/serialize specific types.
If you prefer not to deal with specific XStream settings, it might be better to use the <code>JacksonSerializer</code> throughout your Axon application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>XML&#8217;s verbosity is typically fine when storing tokens, sagas, or snapshots, but for messages (and specifically events) XML might cost too much due to its serialized size.
Thus for optimization reasons you can configure different serializers for your messages.
Another valid reason for customizing serializers is to achieve interoperability between different (Axon) applications, where the receiving end potentially enforces a specific serialized format.</p>
</div>
<div class="paragraph">
<p>There is an implicit ordering between the configurable serializer.
If no event <code>Serializer</code> is configured, the event de-/serialization will be performed by the message <code>Serializer</code>.
In turn, if no message <code>Serializer</code> is configured, the default <code>Serializer</code> will take that role.</p>
</div>
<div class="paragraph">
<p>See the following example on how to configure each serializer specifically, were we use the <code>XStreamSerializer</code> as the default and the <code>JacksonSerializer</code> for all our messages:</p>
</div>
<div class="sect3">
<h4 id="_axon_configuration_api_using_xstreamjacksonserializer"><a class="anchor" href="#_axon_configuration_api_using_xstreamjacksonserializer"></a>Axon Configuration API using XStream/JacksonSerializer</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SerializerConfiguration {

    public void serializerConfiguration(Configurer configurer) {
        // By default, we want the XStreamSerializer
        XStream xStream = new XStream();
        // Set the secure types on the xStream instance
        XStreamSerializer defaultSerializer = XStreamSerializer.builder()
                                                               .xStream(xStream)
                                                               .build();

        // But for all our messages we'd prefer the JacksonSerializer due to JSON's smaller format
        JacksonSerializer messageSerializer = JacksonSerializer.defaultSerializer();

        configurer.configureSerializer(configuration -&gt; defaultSerializer)
                  .configureMessageSerializer(configuration -&gt; messageSerializer)
                  .configureEventSerializer(configuration -&gt; messageSerializer);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_axon_configuration_api_using_xstreamavroserializer"><a class="anchor" href="#_axon_configuration_api_using_xstreamavroserializer"></a>Axon Configuration API using XStream/AvroSerializer</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SerializerConfiguration {

    public void serializerConfiguration(Configurer configurer, SchemaStore schemaStore) {
        // By default, we want the XStreamSerializer
        XStream xStream = new XStream();
        // Set the secure types on the xStream instance
        XStreamSerializer defaultSerializer = XStreamSerializer.builder()
                                                               .xStream(xStream)
                                                               .build();

        // But for all our messages we'd prefer the AvroSerializer due to Avro's smaller format
        AvroSerializer messageSerializer = AvroSerializer.builder()
                                                         .serializerDelegate(JacksonSerializer.defaultSerializer())
                                                         .schemaStore(schemaStore)
                                                         .build();

        configurer.configureSerializer(configuration -&gt; defaultSerializer)
                  .configureMessageSerializer(configuration -&gt; messageSerializer)
                  .configureEventSerializer(configuration -&gt; messageSerializer);
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_spring_boot_configuration_class_using_xstreamjacksonserializer"><a class="anchor" href="#_spring_boot_configuration_class_using_xstreamjacksonserializer"></a>Spring Boot - configuration class using XStream/JacksonSerializer</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class SerializerConfiguration {

   // By default, we want the XStreamSerializer
   @Bean
   public Serializer defaultSerializer() {
      // Set the secure types on the xStream instance
      XStream xStream = new XStream();
      return XStreamSerializer.builder()
                              .xStream(xStream)
                              .build();
   }

   // But for all our messages we'd prefer the JacksonSerializer due to JSON's smaller format
   @Bean
   @Qualifier("messageSerializer")
   public Serializer messageSerializer() {
      return JacksonSerializer.defaultSerializer();
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_boot_configuration_class_using_xstreamavroserializer"><a class="anchor" href="#_spring_boot_configuration_class_using_xstreamavroserializer"></a>Spring Boot - configuration class using XStream/AvroSerializer</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class SerializerConfiguration {

   // By default, we want the XStreamSerializer
   @Bean
   public Serializer defaultSerializer() {
      // Set the secure types on the xStream instance
      XStream xStream = new XStream();
      return XStreamSerializer.builder()
                              .xStream(xStream)
                              .build();
   }

   // But for all our messages we'd prefer the AvroSerializer due to Avro's smaller format
   @Bean
   @Qualifier("messageSerializer")
   public Serializer messageSerializer(SchemaStore schemaStore) {
      return AvroSerializer.builder()
                           .delegateSerializer(JacksonSerializer.defaultSerializer())
                           .schemaStore(schemaStore)
                           .build();
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_boot_properties_file"><a class="anchor" href="#_spring_boot_properties_file"></a>Spring Boot - properties file</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text"># Possible values for these keys are `default`, `xstream`, `java`, and `jackson`. `avro` can be used for `events` and `messages` only.
axon.serializer.general
axon.serializer.events
axon.serializer.messages</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_boot_yaml_file"><a class="anchor" href="#_spring_boot_yaml_file"></a>Spring Boot - YAML file</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># Possible values for these keys are `default`, `xstream`, `java`, and `jackson`. `avro` can be used for `events` and `messages` only.
axon:
    serializer:
        general:
        events:
        messages:</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serializer_tuning"><a class="anchor" href="#_serializer_tuning"></a>Serializer tuning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several things might be considered when the serialization process proofs to not be up to par with the expectations.</p>
</div>
<div class="sect2">
<h3 id="_xstreamserializer"><a class="anchor" href="#_xstreamserializer"></a>XStreamSerializer</h3>
<div class="paragraph">
<p>XStream is extremely configurable and extensible.
If you just use a plain <code>XStreamSerializer</code>, there are some quick wins ready to pick up.
XStream allows you to configure aliases for package names and event class names.
Aliases are typically much shorter (especially if you have long package names), making the serialized form of an event smaller.
And since we&#8217;re talking XML, each character removed from XML is twice the profit (one for the start tag, and one for the end tag).</p>
</div>
<div class="paragraph">
<p>A more advanced topic in XStream is creating custom converters.
The default reflection based converters are simple, but do not generate the most compact XML.
Always look carefully at the generated XML and see if all the information there is really needed to reconstruct the original instance.</p>
</div>
<div class="paragraph">
<p>Avoid the use of upcasters when possible.
XStream allows aliases to be used for fields, when they have changed name.
Imagine revision 0 of an event, that used a field called <code>"clientId"</code>.
The business prefers the term <code>"customer"</code>, so revision 1 was created with a field called <code>"customerId"</code>.
This can be configured completely in XStream, using field aliases.
You need to configure two aliases, in the following order: alias <code>"customerId"</code> to <code>"clientId"</code> and then alias <code>"customerId"</code> to <code>"customerId"</code>.
This will tell XStream that if it encounters a field called <code>"customerId"</code>, it will call the corresponding XML element <code>"customerId"</code> (the second alias overrides the first).
If XStream encounters an XML element called <code>"clientId"</code>, it is a known alias and will be resolved to field name <code>"customerId"</code>.
Check out the XStream documentation for more information.</p>
</div>
<div class="paragraph">
<p>For ultimate performance, you&#8217;re probably better off without reflection based mechanisms altogether.
In that case, it is probably wisest to create a custom serialization mechanism.
The <code>DataInputStream</code> and <code>DataOutputStream</code> allow you to easily write the contents of the events to an output stream.
The <code>ByteArrayOutputStream</code> and <code>ByteArrayInputStream</code> allow writing to and reading from byte arrays.</p>
</div>
</div>
<div class="sect2">
<h3 id="_avroserializer"><a class="anchor" href="#_avroserializer"></a>AvroSerializer</h3>
<div class="paragraph">
<p>The Avro Serializer requires a <code>SchemaStore</code> to operate, which must be able to resolve schemas of all messages being processed. By default, you can use the <code>org.apache.avro.message.SchemaStore.Cache</code> and add Avro schemas to it manually. If you are using
Spring Boot, the auto-configuration will create a <code>SchemaStore</code> instance for you. This Schema Store can be pre-filled with Avro Schemas extracted from Avro <code>SpecificRecordBase</code> instances. These are in turn generated by the <code>avro-maven-plugin</code> that should then be located on your classpath. For this purpose,
a special annotation <code>@AvroSchemaScan</code> should be put to any SpringBoot configuration class (similar to SpringData <code>@EntityScan</code>) in a package hierarchy including the <code>SpecificRecordBase</code> classes.</p>
</div>
<div class="paragraph">
<p>In case you want to use a central Schema Registry in your application landscape, you should provide your own <code>SchemaStore</code>
implementation, accessing this remote registry. Just implement the corresponding interface and wire it into the configuration of the <code>AvroSerrializer</code>. When doing this, do consider to implement a caching strategy in your implementation. The <code>AvroSerializer</code> will check the Avro Schemas by their fingerprints on any serialization / deserialization operation, making fast and local in-memory resolution important to keep up the performance.</p>
</div>
<div class="paragraph">
<p>The <code>AvroSerializer</code> is extendable and delegates to <code>AvroSerializerStrategy</code> to support different flavors of source classes. The default strategy is the <code>SpecificRecordBaseSerializerStrategy</code> that is capable to work with Java classes generated by <code>avro-maven-plugin</code>. If you use different representation of Avro classes in your project, you might want to supply a different <code>AvroSerializerStrategy</code> in order to deal with the specifics of your implementation. For example, to support KotlinX serialization of data classes, implemented by <a href="https://github.com/avro-kotlin/avro4k">avro4k</a>, there is a community project, delivering the corresponding <code>AvroSerializerStrategy</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preventing_duplicate_serialization"><a class="anchor" href="#_preventing_duplicate_serialization"></a>Preventing duplicate serialization</h3>
<div class="paragraph">
<p>Especially in distributed systems, event messages need to be serialized on multiple occasions.
Axon&#8217;s components are aware of this and have support for <code>SerializationAware</code> messages.
If a <code>SerializationAware</code> message is detected, its methods are used to serialize an object, instead of simply passing the payload to a serializer.
This allows for performance optimizations.</p>
</div>
<div class="paragraph">
<p>When you serialize messages yourself, and want to benefit from the <code>SerializationAware</code> optimization, use the <code>MessageSerializer</code> class to serialize the payload and metadata of messages.
All optimization logic is implemented in that class.
See the JavaDoc of the <code>MessageSerializer</code> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="different-serializer-for-events"><a class="anchor" href="#different-serializer-for-events"></a>Different serializer for events</h3>
<div class="paragraph">
<p>When using event sourcing, serialized events can stick around for a long time.
Therefore, consider the format to which they are serialized, carefully.
Consider configuring a separate serializer for events, carefully optimized for the way they are stored.
The JSON format generated by Jackson or Avro binary format is generally more suitable for the long term than XStream&#8217;s XML format. If you want to enforce the structural definition of the events, the Apache Avro is the best choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lenient_deserialization"><a class="anchor" href="#_lenient_deserialization"></a>Lenient Deserialization</h3>
<div class="paragraph">
<p>"Being lenient" from the <code>Serializer&#8217;s</code> perspective means the <code>Serializer</code> can ignore unknown properties.
If it thus was handling a format to deserialize, it would not fail when it is incapable of finding a field / setter / constructor parameter for a given field in the serialized format.</p>
</div>
<div class="paragraph">
<p>Enabling lenient serialization can be especially helpful to accommodate different message versions.
This situation would occur naturally when using an event store, as the format of the events would change overtime.
This might also happen between commands and queries if several distinct versions of an application are run concurrently.
A scenario when you would hit this is when going for a rolling upgrade pattern to deploying a new service.</p>
</div>
<div class="paragraph">
<p>To accommodate more closely with the desire to ignore unknown fields, both the <code>XStreamSerializer</code> and <code>JacksonSerializer</code> can be enabled as such.
How to achieve this is shown in the following snippet:</p>
</div>
<div class="sect3">
<h4 id="_xstreamserializer_2"><a class="anchor" href="#_xstreamserializer_2"></a><code>XStreamSerializer</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SerializerConfiguration {

    public Serializer buildSerializer() {
        return XStreamSerializer.builder()
                                .lenientDeserialization()
                                .build();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jacksonserializer"><a class="anchor" href="#_jacksonserializer"></a><code>JacksonSerializer</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SerializerConfiguration {

    public Serializer buildSerializer() {
        return JacksonSerializer.builder()
                                .lenientDeserialization()
                                .build();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_avroserializer_2"><a class="anchor" href="#_avroserializer_2"></a><code>AvroSerializer</code></h4>
<div class="paragraph">
<p>Apache Avro addresses the issue of reading of old messages by checking compatibility between the reader and writer Avro Schema. By its nature,
Apache Avro binary format is designed to be highly permissive to schema additions, so no additional overhead is required to allow lenient deserialization.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generic_types"><a class="anchor" href="#_generic_types"></a>Generic types</h3>
<div class="paragraph">
<p>Sometimes the objects serialized by Axon will contain lists or collections of data.
In other words, objects containing generics.
For XStream, this poses no problem, as it will automatically add the type information to the serialized format.
Jackson does not do this out of the box, however.</p>
</div>
<div class="paragraph">
<p>The recommended approach by Jackson is to use the <code>@JsonTypeInfo</code> to define type information.
Doing so will attach the object type to your, for example, serialized list/collection.
This approach ensures that the other end can reconstruct the concrete type for you.</p>
</div>
<div class="paragraph">
<p>Additionally, you can configure the <code>ObjectMapper</code> to add default typing information directly.
However, note that this may not be a secure approach, as is described on Jackson&#8217;s <a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonPolymorphicDeserialization">Polymorphic Deserialization</a> page.</p>
</div>
<div class="paragraph">
<p>If you prefer to enable default typing regardless, the <code>JacksonSerializer&#8217;s</code> builder provides a method to allow this for you.
With <code>JacksonSerializer.Builder#defaultTyping</code>, you will automatically enable the addition of types to the serialized format for lists and collections.
Consider the following sample on how to enable default typing for the <code>JacksonSerializer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SerializerConfiguration {
    // ...
    public Serializer buildSerializer() {
          return JacksonSerializer.builder()
                                  .defaultTyping()
                                  .build();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_contenttypeconverters"><a class="anchor" href="#_contenttypeconverters"></a><code>ContentTypeConverters</code></h3>
<div class="paragraph">
<p>An <a href="../events/event-versioning/#event-upcasting" class="xref page">upcaster</a> works on a given content type (for example, dom4j Document).
To provide extra flexibility between upcasters, content types between chained upcasters may vary.
Axon will try to convert between the content types automatically by using a <code>ContentTypeConverter</code>.
It will search for the shortest path from type <code>x</code> to type <code>y</code>, perform the conversion and pass the converted value into the requested upcaster.
For performance reasons, conversion will only be performed if the <code>canUpcast</code> method on the receiving upcaster yields true.</p>
</div>
<div class="paragraph">
<p>The <code>ContentTypeConverter</code> may depend on the type of serializer used.
Attempting to convert a <code>byte[]</code> to a dom4j <code>Document</code> will not make any sense unless a <code>Serializer</code> was used that writes an event as XML.
Axon Framework will only use the generic content type converters (such as the one converting a <code>String</code> to <code>byte[]</code> or a <code>byte[]</code> to <code>InputStream</code>) and the converters configured on the Serializer that will be used to deserialize the message.
That means if you use a JSON based serializer, you would be able to convert to and from JSON-specific formats.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>ContentTypeConverters and Upcasting</strong></p>
</div>
<div class="paragraph">
<p>To achieve the best performance, ensure that all upcasters in the same chain (where one&#8217;s output is another chain&#8217;s input) work on the same content type.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If Axon does not provide the content type conversion that you need, you can always write one yourself by implementing the <code>ContentTypeConverter</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>XStreamSerializer</code> supports dom4j as well as XOM as XML document representations.
The <code>JacksonSerializer</code> supports Jackson&#8217;s <code>JsonNode</code> and <code>ObjectNode</code>.
The <code>AvroSerializer</code> supports <code>GenericRecord</code> as intermediate format suitable for upcasting.</p>
</div>
</div>
</div>
</div>
        <nav class="pagination">
  <span class="prev"><a href="../testing/sagas-1/">Sagas</a></span>
  <span class="next"><a href="../tuning/">Tuning</a></span>
</nav>
    </article>
  </div>
</main>
</div>
      <footer class="footer">
  <div class="secondary-footer">
    <p>Copyright © 2025 AxonIQ BV. All Rights Reserved</p>
    <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=e0b2b5cb-139e-4753-acab-bae43f90c5d3" />
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/page-actions.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab" data-sync-storage-scope="session"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
    </div>
  </body>
</html>
