<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Commands / Events :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="README.html">
    <link rel="next" href="sagas-1.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/modeling/README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/jgroups.html">JGroups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../extensions/reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../extensions/reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../README.html">Axon Legacy Reference Guide</a></li>
    <li>Axon Framework</li>
    <li><a href="README.html">Testing</a></li>
    <li><a href="commands-events.html">Commands / Events</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/axon-framework/testing/commands-events.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Commands / Events</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One of the benefits of CQRS, and especially that of event sourcing, is that it is possible to express tests purely in terms of events and commands.
Both being functional components, events and commands have clear meaning to the domain expert or business owner.
Not only does this mean that tests expressed in terms of events and commands have a clear functional meaning, it also means that they hardly depend on any implementation choices.</p>
</div>
<div class="paragraph">
<p>The features described in this chapter require the <code>axon-test</code> module, which can be obtained by configuring a maven dependency (use <code>&lt;artifactId&gt;axon-test&lt;/artifactId&gt;</code> and <code>&lt;scope&gt;test&lt;/scope&gt;</code>) or from the full package download.</p>
</div>
<div class="paragraph">
<p>The fixtures described in this chapter work with any testing framework, such as JUnit and TestNG.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_model_testing"><a class="anchor" href="#_command_model_testing"></a>Command Model Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The command handling component is typically the component in any CQRS based architecture that contains the most complexity.
Being more complex than the others, this also means that there are extra test related requirements for this component.</p>
</div>
<div class="paragraph">
<p>Although being more complex, the API of a command handling component is fairly easy.
It has a command coming in, and events going out.
In some cases, there might be a query as part of command execution.
Other than that, commands and events are the only part of the API.
This means that it is possible to completely define a test scenario in terms of events and commands.
Typically, in the shape of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Given certain events in the past,</p>
</li>
<li>
<p>When executing this command,</p>
</li>
<li>
<p>Expect these events to be published and/or stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Axon Framework provides a test fixture that allows you to do exactly that.
The <code>AggregateTestFixture</code> allows you to configure a certain infrastructure, composed of the necessary command handler and repository, and express your scenario in terms of "given-when-then" events and commands.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Focus of a Test Fixture</strong></p>
</div>
<div class="paragraph">
<p>Since the unit of testing here is the aggregate, <code>AggregateTestFixture</code> is meant to test one aggregate only.
So, all commands in the <code>when</code> (or <code>given</code>) clause are meant to target the aggregate under test fixture.
Also, all <code>given</code> and <code>expected</code> events are meant to be triggered from the aggregate under test fixture.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The following example shows the usage of the "given-when-then" test fixture with JUnit 4 on the <code>GiftCard</code> aggregate (as defined <a href="../axon-framework-commands/modeling/aggregate.md#basic-aggregate-structure">earlier</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.aggregate.AggregateTestFixture;
import org.axonframework.test.aggregate.FixtureConfiguration;

public class GiftCardTest {

    private FixtureConfiguration&lt;GiftCard&gt; fixture;

    @Before
    public void setUp() {
        fixture = new AggregateTestFixture&lt;&gt;(GiftCard.class);
    }

    @Test
    public void testRedeemCardCommand() {
        fixture.given(new CardIssuedEvent("cardId", 100))
               .when(new RedeemCardCommand("cardId", "transactionId", 20))
               .expectSuccessfulHandlerExecution()
               .expectEvents(new CardRedeemedEvent("cardId", "transactionId", 20));
        /*
        These four lines define the actual scenario and its expected result.
        The first line defines the events that happened in the past.
        These events define the state of the aggregate under test.
        In practical terms, these are the events that the event store returns
         when an aggregate is loaded.

        The second line defines the command that we wish to execute against our system.

        Finally, we have two more methods that define expected behavior.
        In the example, we use the recommended void return type.
        The last method defines that we expect a single event as result
         of the command execution.
        */
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Aggregate Lifecycle Extension</strong></p>
</div>
<div class="paragraph">
<p>Alternatively, JUnit 5 users can use <code>StubAggregateLifecycleExtension</code> in order to directly attach to the aggregate lifecycle.
This might be useful if you prefer not to use the <code>AggregateTestFixture</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AggregateTest {

@RegisterExtension
static StubAggregateLifecycleExtension testSubject = new StubAggregateLifecycleExtension();

   @Test
   void test() {
       apply(new Event(...));

       assertEquals(1, testSubject.getAppliedEvents().size());
   }

}</code></pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The "given-when-then" test fixture defines three stages: configuration, execution and validation.
Each of these stages is represented by a different interface: <code>FixtureConfiguration</code>, <code>TestExecutor</code> and <code>ResultValidator</code>, respectively.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Fluent Interface</strong></p>
</div>
<div class="paragraph">
<p>To make optimal use of the migration between these stages, it is best to use the fluent interface provided by these methods, as shown in the example above.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="_test_setup"><a class="anchor" href="#_test_setup"></a>Test Setup</h3>
<div class="paragraph">
<p>During the configuration phase (i.e.
before the first "given" is provided), you provide the building blocks required to execute the test.
Specialized versions of the event bus, command bus and event store are provided as part of the fixture by default.
There are accessor methods in place to obtain references to them.
Any command handlers not registered directly on the aggregate need to be explicitly configured using the <code>registerAnnotatedCommandHandler</code> method.
Besides an Annotated Command Handler, you can register a wide variety of components and settings that define how the infrastructure around the Aggregate&#8217;s test should be set up, consisting out of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>registerRepository</code>:</p>
<div class="paragraph">
<p>Registers a custom Aggregate <a href="commands-events.html" class="xref page"><code>Repository</code></a>.</p>
</div>
</li>
<li>
<p><code>registerRepositoryProvider</code>:</p>
<div class="paragraph">
<p>Registers a <code>RepositoryProvider</code> used to <a href="#../axon-framework-commands/modeling/aggregate-creation-from-another-aggregate.adoc" class="xref unresolved">spawn new Aggregates</a>.</p>
</div>
</li>
<li>
<p><code>registerAggregateFactory</code>:</p>
<div class="paragraph">
<p>Registers a custom <a href="commands-events.html" class="xref page"><code>AggregateFactory</code></a>.</p>
</div>
</li>
<li>
<p><code>registerAnnotatedCommandHandler</code>:</p>
<div class="paragraph">
<p>Registers a Annotated Command Handler object.
Use this method to register components containing <code>@CommandHandler</code> annotated methods that invoke the <code>Repository</code> to execute operation on an aggregate.
You may end up in such a scenario when you prefer that command handlers and/or command messages are not contained inside the domain model (i.e.
the aggregate).</p>
</div>
</li>
<li>
<p><code>registerCommandHandler</code>:</p>
<div class="paragraph">
<p>Registers a <code>MessageHandler</code> of <code>CommandMessage</code>.</p>
</div>
</li>
<li>
<p><code>registerInjectableResource</code>:</p>
<div class="paragraph">
<p>Registers a resource which can be injected in to message handling members.</p>
</div>
</li>
<li>
<p><code>registerParameterResolverFactory</code>:</p>
<div class="paragraph">
<p>Registers a <a href="commands-events.html" class="xref page"><code>ParameterResolverFactory</code></a> to the test fixture.</p>
</div>
<div class="paragraph">
<p>This method is used to complement the default <code>ParameterResolvers</code> with custom <code>ParameterResolver</code>.</p>
</div>
</li>
<li>
<p><code>registerCommandDispatchInterceptor</code>:</p>
<div class="paragraph">
<p>Registers a command <a href="commands-events.html" class="xref page"><code>MessageDispatchInterceptor</code></a>.</p>
</div>
</li>
<li>
<p><code>registerCommandHandlerInterceptor</code>:</p>
<div class="paragraph">
<p>Registers a command <a href="commands-events.html" class="xref page"><code>MessageHandlerInterceptor</code></a>.</p>
</div>
</li>
<li>
<p><code>registerDeadlineDispatchInterceptor</code>:</p>
<div class="paragraph">
<p>Registers a <a href="commands-events.html" class="xref page"><code>DeadlineMessage</code></a> <code>MessageDispatchInterceptor</code>.</p>
</div>
</li>
<li>
<p><code>registerDeadlineHandlerInterceptor</code>:</p>
<div class="paragraph">
<p>Registers a <a href="commands-events.html" class="xref page"><code>DeadlineMessage</code></a> <code>MessageHandlerInterceptor</code>.</p>
</div>
</li>
<li>
<p><code>registerFieldFilter</code>:</p>
<div class="paragraph">
<p>Registers a <code>Field</code> filter used when comparing objects in the "then" phase.</p>
</div>
</li>
<li>
<p><code>registerIgnoredField</code>:</p>
<div class="paragraph">
<p>Registers a field that should be ignored for a given class when state equality is performed.</p>
</div>
</li>
<li>
<p><code>registerHandlerDefinition</code>:</p>
<div class="paragraph">
<p>Registers a custom <a href="../../appendices/message-handler-tuning/handler-enhancers.html" class="xref page"><code>HandlerDefinition</code></a> to the test fixture.</p>
</div>
</li>
<li>
<p><code>registerHandlerEnhancerDefinition</code>:</p>
<div class="paragraph">
<p>Registers a custom <a href="../../appendices/message-handler-tuning/handler-enhancers.html" class="xref page"><code>HandlerEnhancerDefinition</code></a> to the test fixture.</p>
</div>
<div class="paragraph">
<p>This method is used to complement the default <code>HandlerEnhancerDefinition</code> with a custom <code>HandlerEnhancerDefinition</code>.</p>
</div>
</li>
<li>
<p><code>registerCommandTargetResolver</code>:</p>
<div class="paragraph">
<p>Registers a <code>CommandTargetResolver</code> to the test fixture.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the fixture is configured, you can define the "given" events.
The test fixture will wrap these events as <code>DomainEventMessage</code>s.
If the "given" event implements <code>Message</code>, the payload and meta data of that message will be included in the <code>DomainEventMessage</code>, otherwise the given event is used as payload.
The sequence numbers of the <code>DomainEventMessage</code> are sequential, starting at <code>0</code>.
If no prior activity is expected, the <code>givenNoPriorActivity()</code> can be used as the starting point.</p>
</div>
<div class="paragraph">
<p>Alternatively, you may also provide commands as "given" scenario.
In that case, the events generated by those commands will be used to event source the aggregate when executing the actual command under test.
Use the &#8220;`+givenCommands(&#8230;&#8203;)+`&#8221; method to provide command objects.</p>
</div>
<div class="paragraph">
<p>A last option for the "given" phase, is providing the state of an Aggregate directly.
This is not recommended in case of Event Sourcing, and only in cases where reconstructing aggregates based on Commands or Events is unfeasible or when a <a href="#../axon-framework-commands/modeling/state-stored-aggregates.adoc" class="xref unresolved">State-Stored Aggregate</a> is used.
Use <code>fixture.givenState(() -&gt; new GiftCard())</code> to define the initial state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_execution_phase"><a class="anchor" href="#_test_execution_phase"></a>Test Execution Phase</h3>
<div class="paragraph">
<p>The execution phase allows you two entry points towards the <a href="commands-events.md#validation-phase">validation phase</a>.
Firstly, you can provide a Command to be executed against the command handling component.
Similar as with the given Events, if the provided Command is of type <code>CommandMessage</code> it will be dispatched as is.
The behavior of the invoked handler (either on the aggregate or as an external handler) is monitored and compared to the expectations registered in the validation phase.</p>
</div>
<div class="paragraph">
<p>Secondly, it is possible to elapse a certain time span with the <code>whenThenTimeElapses(Duration)</code> and <code>whenThenTimeAdvancesTo(Instant)</code> handles.
These support testing the publication of <code>DeadlineMessages</code>, as is further defined in <a href="../deadlines/">this</a> chapter.</p>
</div>
<div class="paragraph">
<p>Note that only activities that occur during the test <em>execution</em> phase are monitored.
Any Events or side-effects generated during the "given" phase are not considered in the validation phase.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Illegal State Change Detection</strong></p>
</div>
<div class="paragraph">
<p>During the execution of the test, Axon attempts to detect any illegal state changes in the aggregate under test.
It does so by comparing the state of the aggregate after the command execution to the state of the aggregate if it sourced from all "given" and stored events.
If that state is not identical, this means that a state change has occurred outside of an aggregate&#8217;s event handler method.
Static and transient fields are ignored in the comparison, as they typically contain references to resources.</p>
</div>
<div class="paragraph">
<p>You can switch detection in the configuration of the fixture with the <code>setReportIllegalStateChange()</code> method.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_validation_phase"><a class="anchor" href="#_validation_phase"></a>Validation Phase</h3>
<div class="paragraph">
<p>The last phase is the validation phase, which allows you to check on the activities of the command handling component.
This is generally done purely in terms of return values and events.</p>
</div>
<div class="sect3">
<h4 id="_validating_command_result"><a class="anchor" href="#_validating_command_result"></a>Validating Command Result</h4>
<div class="paragraph">
<p>The test fixture allows you to validate return values of your command handlers.
You can explicitly define the expected return value, or simply require that the method successfully returned.
You may also express any exceptions you expect the CommandHandler to throw.</p>
</div>
<div class="paragraph">
<p>The following methods are available for validating Command Results:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fixture.expectSuccessfulHandlerExecution()</code>:</p>
<div class="paragraph">
<p>Validates that the handler returned a regular response, which was not marked as an exceptional response.</p>
</div>
<div class="paragraph">
<p>The exact response is not evaluated.</p>
</div>
</li>
<li>
<p><code>fixture.expectResultMessagePayload(Object)</code>:</p>
<div class="paragraph">
<p>Validates that the handler returned a successful response, with a payload equal to the given payload.</p>
</div>
</li>
<li>
<p><code>fixture.expectResultMessagePayloadMatching(Matcher)</code>:</p>
<div class="paragraph">
<p>Validates that the handler returned a successful response, with a payload matching the given Matcher</p>
</div>
</li>
<li>
<p><code>fixture.expectResultMessage(CommandResultMessage)</code>:</p>
<div class="paragraph">
<p>Validates that the <code>CommandResultMessage</code> received has equal payload and meta data to that of given message.</p>
</div>
</li>
<li>
<p><code>fixture.expectResultMessageMatching(Matcher)</code>:</p>
<div class="paragraph">
<p>Validates that the <code>CommandResultMessage</code> matches the given Matcher.</p>
</div>
</li>
<li>
<p><code>fixture.expectException(Matcher)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result, and that the exception matches the given <code>Matcher</code>.</p>
</div>
</li>
<li>
<p><code>fixture.expectException(Class)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result with the given type of exception.</p>
</div>
</li>
<li>
<p><code>fixture.expectExceptionMessage(String)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result and the exception message is equal to the given message.</p>
</div>
</li>
<li>
<p><code>fixture.expectExceptionMessage(Matcher)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result and the exception message matches the given Matcher.</p>
</div>
</li>
<li>
<p><code>fixture.expectExceptionDetails(Object)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result and the exception details equal the given exception details.</p>
</div>
</li>
<li>
<p><code>fixture.expectExceptionDetails(Class)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result with the given type of exception details.</p>
</div>
</li>
<li>
<p><code>fixture.expectExceptionDetails(Matcher)</code>:</p>
<div class="paragraph">
<p>Validates that the command handling result is an exceptional result and the exception details match the given <code>Matcher</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_validating_published_events"><a class="anchor" href="#_validating_published_events"></a>Validating Published Events</h4>
<div class="paragraph">
<p>The other component is validation of published events.
There are two ways of matching expected events.</p>
</div>
<div class="paragraph">
<p>The first is to pass in event instances that need to be literally compared with the actual events.
All properties of the expected events are compared (using <code>equals()</code>) with their counterparts in the actual Events.
If one of the properties is not equal, the test fails and an extensive error report is generated.</p>
</div>
<div class="paragraph">
<p>The other way of expressing expectancies is using "Matchers" (provided by the Hamcrest library).
<code>Matcher</code> is an interface prescribing two methods: <code>matches(Object)</code> and <code>describeTo(Description)</code>.
The first returns a boolean to indicate whether the matcher matches or not.
The second allows you to express your expectation.
For example, a "GreaterThanTwoMatcher" could append "any event with value greater than two" to the description.
Descriptions allow expressive error messages to be created about why a test case fails.</p>
</div>
<div class="paragraph">
<p>Creating matchers for a list of events can be tedious and error-prone work.
To simplify things, Axon provides a set of matchers that allow you to provide a set of event specific matchers and tell Axon how they should match against the list.
These matchers are statically available through the abstract <code>Matchers</code> utility class.</p>
</div>
<div class="paragraph">
<p>Below is an overview of the available event list matchers and their purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>List with all of</strong>: <code>Matchers.listWithAllOf(event matchers...)</code></p>
<div class="paragraph">
<p>This matcher will succeed if all of the provided event matchers match against at least one event in the list of actual events.</p>
</div>
<div class="paragraph">
<p>It does not matter whether multiple matchers match against the same event,</p>
</div>
<div class="paragraph">
<p>nor if an event in the list does not match against any of the matchers.</p>
</div>
</li>
<li>
<p><strong>List with any of</strong>: <code>Matchers.listWithAnyOf(event matchers...)</code></p>
<div class="paragraph">
<p>This matcher will succeed if one or more of the provided event matchers matches against one or more</p>
</div>
<div class="paragraph">
<p>of the events in the actual list of events.</p>
</div>
<div class="paragraph">
<p>Some matchers may not even match at all, while another matches against multiple others.</p>
</div>
</li>
<li>
<p><strong>Sequence of Events</strong>: <code>Matchers.sequenceOf(event matchers...)</code> Use this matcher to verify that the actual events are matched in the same order as the provided event matchers.
It will succeed if each matcher matches against an event that comes after the event that the previous matcher matched against.
This means that "gaps" with unmatched events may appear.</p>
<div class="paragraph">
<p>If, after evaluating the events, more matchers are available, they are all matched against "<code class="code">null</code>".
It is up to the event matchers to decide whether they accept that or not.</p>
</div>
</li>
<li>
<p><strong>Exact sequence of Events</strong>: <code>Matchers.exactSequenceOf(event matchers...)</code></p>
<div class="paragraph">
<p>Variation of the "Sequence of Events" matcher where gaps of unmatched events are not allowed.</p>
</div>
<div class="paragraph">
<p>This means each matcher must match against the event directly following the event the previous matcher matched against.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For convenience, a few commonly required event matchers are provided.
They match against a single event instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Equal event</strong>: <code>Matchers.equalTo(instance...)</code></p>
<div class="paragraph">
<p>Verifies that the given object is semantically equal to the given event.</p>
</div>
<div class="paragraph">
<p>This matcher will compare all values in the fields of both actual and expected objects using a null-safe equals method.</p>
</div>
<div class="paragraph">
<p>This means that events can be compared, even if they do not implement the equals method.</p>
</div>
<div class="paragraph">
<p>The objects stored in fields of the given parameter <em>are</em> compared using equals,</p>
</div>
<div class="paragraph">
<p>requiring them to implement one correctly.</p>
</div>
</li>
<li>
<p><strong>No more events</strong>: <code>Matchers.andNoMore()</code> or <code>Matchers.nothing()</code></p>
<div class="paragraph">
<p>Only matches against a <code>null</code> value.</p>
</div>
<div class="paragraph">
<p>This matcher can be added as last matcher to the <em>exact</em> sequence of events matchers to ensure that no unmatched events remain.</p>
</div>
</li>
<li>
<p><strong>Predicate Matching</strong>: <code>Matchers.matches(Predicate)</code> or <code>Matchers.predicate(Predicate)</code></p>
<div class="paragraph">
<p>Creates a Matcher that matches with values defined by the specified <code>Predicate</code>.</p>
</div>
<div class="paragraph">
<p>Can be used in case the <code>Predicate</code> API provides a better means to validating the outcome.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since the matchers are passed a list of event messages, you sometimes only want to verify the payload of the message.
There are matchers to help you out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Payload matching</strong>: <code>Matchers.messageWithPayload(payload matcher)</code></p>
<div class="paragraph">
<p>Verifies that the payload of a message matches the given payload matcher.</p>
</div>
</li>
<li>
<p><strong>Payloads matching</strong>: <code>Matchers.payloadsMatching(list matcher)</code></p>
<div class="paragraph">
<p>Verifies that the payloads of the messages matches the given matcher.</p>
</div>
<div class="paragraph">
<p>The given matcher must match against a list containing each of the messages payload.</p>
</div>
<div class="paragraph">
<p>The payloads matching matcher is typically used as the outer matcher to prevent repetition of payload matchers.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below is a small code sample displaying the usage of these matchers.
In this example, we expect two events to be published.
The first event must be a "ThirdEvent", and the second "aFourthEventWithSomeSpecialThings".
There may be no third event, as that will fail against the "andNoMore" matcher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.test.aggregate.FixtureConfiguration;

import static org.axonframework.test.matchers.Matchers.andNoMore;
import static org.axonframework.test.matchers.Matchers.equalTo;
import static org.axonframework.test.matchers.Matchers.exactSequenceOf;
import static org.axonframework.test.matchers.Matchers.messageWithPayload;
import static org.axonframework.test.matchers.Matchers.payloadsMatching;

class MyCommandModelTest {

    private FixtureConfiguration&lt;MyCommandModel&gt; fixture;

    public void testWithMatchers() {
        fixture.given(new FirstEvent(), new SecondEvent())
               .when(new DoSomethingCommand("aggregateId"))
               .expectEventsMatching(exactSequenceOf(
                   // we can match against the payload only:
                   messageWithPayload(equalTo(new ThirdEvent())),
                   // this will match against a Message
                   aFourthEventWithSomeSpecialThings(),
                   // this will ensure that there are no more events
                   andNoMore()
               ));

               // or if we prefer to match on payloads only:
               .expectEventsMatching(payloadsMatching(
                   exactSequenceOf(
                       // we only have payloads, so we can equalTo directly
                       equalTo(new ThirdEvent()),
                       // now, this matcher matches against the payload too
                       aFourthEventWithSomeSpecialThings(),
                       // this still requires that there is no more events
                       andNoMore()
                   )
               ));
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_aggregate_state"><a class="anchor" href="#_validating_aggregate_state"></a>Validating Aggregate State</h4>
<div class="paragraph">
<p>In certain circumstances, it may be desirable to validate the state in which an Aggregate was left after a test.
This is especially the case in given-when-then scenario&#8217;s where the <em>given</em> represents an initial state as well, as is regular when using a <a href="#../axon-framework-commands/modeling/state-stored-aggregates.adoc" class="xref unresolved">State-Stored Aggregate</a>.</p>
</div>
<div class="paragraph">
<p>The fixture provides a method that allows verification of the state of the aggregate, as it is left after the <a href="commands-events.md#test-execution-phase">Execution Phase</a> (e.g.
the <em>when</em> state), to be validated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">fixture.givenState(() -&gt; new GiftCard())
       .when(new RedeemCardCommand())
       .expectState(state -&gt; {
           // perform assertions
       });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>expectState</code> method takes a consumer of the Aggregate type.
Use regular assertions provided by your test framework to assert the state of the given Aggregate.
Any (Runtime) Exception or Error will fail the test case accordingly.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Event-Sourced Aggregate State Validation</strong></p>
</div>
<div class="paragraph">
<p>State validation for testing Event Sourced Aggregates is considered bad practice.
Ideally, the state of an Aggregate is completely opaque to the testing code, as only the behavior should be validated.
Generally, the desire to validate state is an indication that a certain test scenario is missing from the test suite.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="_validating_deadlines"><a class="anchor" href="#_validating_deadlines"></a>Validating Deadlines</h4>
<div class="paragraph">
<p>The validation phase also provides the option to verify scheduled and met <a href="../deadlines/">deadlines</a> for a given Aggregate instance.
You can expect scheduled deadlines both through a <code>Duration</code> or an <code>Instant</code>, using explicit equals, a <code>Matcher</code> or just a deadline type to verify the deadline message.
+ The following methods are available for validating Deadlines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expectScheduledDeadline(Duration, Object)</code>:</p>
<div class="paragraph">
<p>Explicitly expect a given <code>deadline</code> to be scheduled after the specified <code>Duration</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineMatching(Duration, Matcher)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the <code>Matcher</code> to be scheduled after the specified <code>Duration</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineOfType(Duration, Class)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the given type to be scheduled after the specified <code>Duration</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineWithName(Duration, String)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the given deadline name to be scheduled after the specified <code>Duration</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadline(Instant, Object)</code>:</p>
<div class="paragraph">
<p>Explicitly expect a given <code>deadline</code> to be scheduled at the specified <code>Instant</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineMatching(Instant, Matcher)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the <code>Matcher</code> to be scheduled at the specified <code>Instant</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineOfType(Instant, Class)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the given type to be scheduled at the specified <code>Instant</code>.</p>
</div>
</li>
<li>
<p><code>expectScheduledDeadlineWithName(Instant, String)</code>:</p>
<div class="paragraph">
<p>Expect a deadline matching the given deadline name to be scheduled at the specified <code>Instant</code>.</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlines()</code>:</p>
<div class="paragraph">
<p>Expect that no deadlines are scheduled at all.</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineMatching(Matcher)</code>:</p>
<div class="paragraph">
<p>Expect no deadline matching the <code>Matcher</code> to be scheduled.</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineMatching(Duration, Matcher)</code>:</p>
<div class="paragraph">
<p>Expect no deadline matching the <code>Matcher</code> to be scheduled after the specified <code>Duration</code>.</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadline(Duration, Object)</code></p>
<div class="paragraph">
<p>Explicitly expect no given <code>deadline</code> to be scheduled after the specified <code>Duration</code>.`</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineOfType(Duration, Class)</code></p>
<div class="paragraph">
<p>Expect no deadline matching the given type to be scheduled after the specified <code>Duration</code>.`</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineWithName(Duration, String)</code></p>
<div class="paragraph">
<p>Expect no deadline matching the given deadline name to be scheduled after the specified <code>Duration</code>.`</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineMatching(Instant, Matcher)</code>:</p>
<div class="paragraph">
<p>Expect no deadline matching the <code>Matcher</code> to be scheduled at the specified <code>Instant</code>.</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadline(Instant, Object)</code></p>
<div class="paragraph">
<p>Explicitly expect no given <code>deadline</code> to be scheduled at the specified <code>Instant</code>.`</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineOfType(Instant, Class)</code></p>
<div class="paragraph">
<p>Expect no deadline matching the given type to be scheduled at the specified <code>Instant</code>.`</p>
</div>
</li>
<li>
<p><code>expectNoScheduledDeadlineWithName(Instant, String)</code></p>
<div class="paragraph">
<p>Expect no deadline matching the given deadline name to be scheduled at the specified <code>Instant</code>.`</p>
</div>
</li>
<li>
<p><code>expectDeadlinesMet(Object...)</code>:</p>
<div class="paragraph">
<p>Explicitly expect a <code>deadline</code> or several deadlines to have been met.</p>
</div>
</li>
<li>
<p><code>expectDeadlinesMetMatching(Matcher&lt;List&lt;DeadlineMessage&gt;&gt;)</code>:</p>
<div class="paragraph">
<p>Expect a matching deadline or several matching deadlines to have been met.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="README.html">Testing</a></span>
  <span class="next"><a href="sagas-1.html">Sagas</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
