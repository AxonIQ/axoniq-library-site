<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event Bus &amp; Event Store :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="event-processors/streaming.html">
    <link rel="next" href="event-versioning.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/modeling/README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/jgroups.html">JGroups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../extensions/reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../extensions/reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../README.html">Axon Legacy Reference Guide</a></li>
    <li>Axon Framework</li>
    <li><a href="README.html">Events</a></li>
    <li><a href="event-bus-and-event-store.html">Event Bus &amp; Event Store</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/axon-framework/events/event-bus-and-event-store.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Event Bus &amp; Event Store</h1>
<div class="sect1">
<h2 id="_event_bus"><a class="anchor" href="#_event_bus"></a>Event Bus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>EventBus</code> is the mechanism that dispatches events to the subscribed event handlers.
Axon provides three implementations of the Event Bus: <code>AxonServerEventStore</code>, <code>EmbeddedEventStore</code> and <code>SimpleEventBus</code>.
All three implementations support subscribing and tracking processors (see <a href="event-processors/README.html" class="xref page">Events Processors</a>).
However, the <code>AxonServerEventStore</code> and <code>EmbeddedEventStore</code> persist events (see <a href="event-bus-and-event-store.html" class="xref page">Event Store</a>), which allows you to replay them at a later stage.
The <code>SimpleEventBus</code> has a volatile storage and 'forgets' events as soon as they have been published to subscribed components.</p>
</div>
<div class="paragraph">
<p>An <code>AxonServerEventStore</code> event bus/store is configured by default.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event_store"><a class="anchor" href="#_event_store"></a>Event Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Event sourcing repositories need an event store to store and load events from aggregates.
An event store offers the functionality of an event bus.
Additionally, it persists published events and is able to retrieve previous events based on a given aggregate identifier.</p>
</div>
<div class="sect2">
<h3 id="_axon_server_as_an_event_store"><a class="anchor" href="#_axon_server_as_an_event_store"></a>Axon Server as an event store</h3>
<div class="paragraph">
<p>Axon provides an event store out of the box, the <code>AxonServerEventStore</code>.
It connects to the<a href="../../axon-server-introduction.html" class="xref page">AxonIQ AxonServer Server</a>to store and retrieve Events.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %} Declare dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">&lt;!--somewhere in the POM file--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
    &lt;artifactId&gt;axon-server-connector&lt;/artifactId&gt;
    &lt;version&gt;${axon.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
    &lt;artifactId&gt;axon-configuration&lt;/artifactId&gt;
    &lt;version&gt;${axon.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Returns a Configurer instance with default components configured.
// `AxonServerEventStore` is configured as Event Store by default.
Configurer configurer = DefaultConfigurer.defaultConfiguration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %} By simply declaring a dependency on <code>axon-spring-boot-starter</code>, Axon will automatically configure the event bus/event store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">&lt;!--somewhere in the POM file--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
    &lt;artifactId&gt;axon-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;${axon.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Excluding the Axon Server Connector</strong></p>
</div>
<div class="paragraph">
<p>If you exclude the <code>axon-server-connector</code> dependency from <code>axon-spring-boot-starter</code> the <code>EmbeddedEventStore</code> will be auto-configured for you, if a concrete implementation of <code>EventStorageEngine</code> is available.
If JPA or JDBC is detected on the classpath, a <code>JpaEventStorageEngine</code> or <code>JdbcEventStorageEngine</code> will respectively be auto-configured as the <code>EventStorageEngine</code>.
In absence of either, the auto configuration falls back to the <code>SimpleEventBus</code>.
{% endtab %} {% endtabs %}</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_event_store"><a class="anchor" href="#_embedded_event_store"></a>Embedded event store</h3>
<div class="paragraph">
<p>Alternatively, Axon provides a non-axon-server option, the <code>EmbeddedEventStore</code>.
It delegates the actual storage and retrieval of events to an <code>EventStorageEngine</code>.</p>
</div>
<div class="paragraph">
<p>There are multiple <code>EventStorageEngine</code> implementations available:</p>
</div>
<div class="sect3">
<h4 id="_jpaeventstorageengine"><a class="anchor" href="#_jpaeventstorageengine"></a><code>JpaEventStorageEngine</code></h4>
<div class="paragraph">
<p>The <code>JpaEventStorageEngine</code> stores events in a JPA-compatible data source.
The JPA event store stores events in entries.
These entries contain the serialized form of an event, as well as some fields where metadata is stored for fast lookup of these entries.
To use the <code>JpaEventStorageEngine</code>, you must have the JPA (<code>javax.persistence</code>) annotations on your classpath.</p>
</div>
<div class="paragraph">
<p>By default, the event store needs you to configure your persistence context (e.g.
as defined in the <code>META-INF/persistence.xml</code> file) to contain the classes <code>DomainEventEntry</code> and <code>SnapshotEventEntry</code> (both of these classes are located in the <code>org.axonframework.eventsourcing.eventstore.jpa</code> package).</p>
</div>
<div class="paragraph">
<p>Below is an example configuration of a persistence context configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-markup hljs" data-lang="markup">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" version="1.0"&gt;
    &lt;persistence-unit name="eventStore" transaction-type="RESOURCE_LOCAL"&gt; (1)
        &lt;class&gt;org...eventstore.jpa.DomainEventEntry&lt;/class&gt; (2)
        &lt;class&gt;org...eventstore.jpa.SnapshotEventEntry&lt;/class&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In this example, there is a specific persistence unit for the event store.</p>
<div class="paragraph">
<p>You may, however, choose to add the third line to any other persistence unit configuration.</p>
</div>
</li>
<li>
<p>This line registers the <code>DomainEventEntry</code> (the class used by the <code>JpaEventStore</code>) with the persistence context.</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Unique Key Constraint Consideration</strong></p>
</div>
<div class="paragraph">
<p>Axon uses locking to prevent two threads from accessing the same aggregate.
However, if you have multiple JVMs using the same database, this won&#8217;t help you.
In that case, you&#8217;d have to rely on the database to detect conflicts.
Concurrent access to the event store will result in a Key Constraint Violation, as the table only allows a single event for a given aggregate and sequence number.
Therefore, inserting a second event for an existing aggregate with an existing sequence number will result in an error.</p>
</div>
<div class="paragraph">
<p>The <code>JpaEventStorageEngine</code> can detect this error and translate it to a <code>ConcurrencyException</code>.
However, each database system reports this violation differently.
If you register your <code>DataSource</code> with the <code>JpaEventStore</code>, it will try to detect the type of database and figure out which error codes represent a Key Constraint Violation.
Alternatively, you may provide a <code>PersistenceExceptionTranslator</code> instance, which can tell if a given exception represents a key constraint violation.</p>
</div>
<div class="paragraph">
<p>If no <code>DataSource</code> or <code>PersistenceExceptionTranslator</code> is provided, exceptions from the database driver are thrown as-is.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>By default, the <code>JpaEventStorageEngine</code> requires an <code>EntityManagerProvider</code> implementation that returns the <code>EntityManager</code> instance for the <code>EventStorageEngine</code> to use.
This also allows application managed persistence contexts to be used.
It is the <code>EntityManagerProvider</code>'s responsibility to provide a correct instance of the <code>EntityManager</code>.</p>
</div>
<div class="paragraph">
<p>There are a few implementations of the <code>EntityManagerProvider</code> available, each for different needs.
The <code>SimpleEntityManagerProvider</code> simply returns the <code>EntityManager</code> instance which is given to it at construction time.
This makes the implementation a simple option for container managed contexts.
Alternatively, there is the <code>ContainerManagedEntityManagerProvider</code>, which returns the default persistence context, and is used by default by the JPA event store.</p>
</div>
<div class="paragraph">
<p>If you have a persistence unit called <code>"myPersistenceUnit"</code> which you wish to use in the <code>JpaEventStore</code>, the <code>EntityManagerProvider</code> implementation could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyEntityManagerProvider implements EntityManagerProvider {

    private EntityManager entityManager;

    @Override
    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext(unitName = "myPersistenceUnit")
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the JPA event store stores entries in <code>DomainEventEntry</code> and <code>SnapshotEventEntry</code> entities.
While this will suffice in many cases, you might encounter a situation where the metadata provided by these entities is not enough.
It is also possible that you might want to store events for different aggregate types in different tables.</p>
</div>
<div class="paragraph">
<p>If that is the case, you can extend the <code>JpaEventStorageEngine</code>.
It contains a number of protected methods that you can override to tweak its behavior.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Warning</strong></p>
</div>
<div class="paragraph">
<p>Note that persistence providers, such as Hibernate, use a first-level cache in their <code>EntityManager</code> implementation.
Typically, this means that all entities used or returned in queries are attached to the <code>EntityManager</code>.
They are only cleared when the surrounding transaction is committed or an explicit "clear" is performed inside the transaction.
This is especially the case when the queries are executed in the context of a transaction.</p>
</div>
<div class="paragraph">
<p>To work around this issue, make sure to exclusively query for non-entity objects.
You can use JPA&#8217;s <code>"SELECT new SomeClass(parameters) FROM ..."</code> style queries to work around this issue.
Alternatively, call <code>EntityManager.flush()</code> and <code>EntityManager.clear()</code> after fetching a batch of events.
Failure to do so might result in <code>OutOfMemoryException</code>s when loading large streams of events.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public Configurer jpaEventStorageConfigurer(EntityManagerProvider entityManagerProvider,
                                                TransactionManager transactionManager) {
        return DefaultConfigurer.jpaConfiguration(entityManagerProvider, transactionManager);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...

    // The EmbeddedEventStore delegates actual storage and retrieval of events to an EventStorageEngine.
    @Bean
    public EventStore eventStore(EventStorageEngine storageEngine,
                                 GlobalMetricRegistry metricRegistry) {
        return EmbeddedEventStore.builder()
                                 .storageEngine(storageEngine)
                                 .messageMonitor(metricRegistry.registerEventBus("eventStore"))
                                 .spanFactory(spanFactory)
                                 // ...
                                 .build();
    }

    // The JpaEventStorageEngine stores events in a JPA-compatible data source.
    @Bean
    public EventStorageEngine eventStorageEngine(Serializer serializer,
                                                 PersistenceExceptionResolver persistenceExceptionResolver,
                                                 @Qualifier("eventSerializer") Serializer eventSerializer,
                                                 EntityManagerProvider entityManagerProvider,
                                                 TransactionManager transactionManager) {
         return JpaEventStorageEngine.builder()
                                     .snapshotSerializer(serializer)
                                     .persistenceExceptionResolver(persistenceExceptionResolver)
                                     .eventSerializer(eventSerializer)
                                     .entityManagerProvider(entityManagerProvider)
                                     .transactionManager(transactionManager)
                                     // ...
                                     .build();
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Excluding the Axon Server Connector</strong></p>
</div>
<div class="paragraph">
<p>If you exclude the <code>axon-server-connector</code> dependency from <code>axon-spring-boot-starter</code> the <code>EmbeddedEventStore</code> will be auto-configured for you, if a concrete implementation of <code>EventStorageEngine</code> is available.
If JPA or JDBC is detected on the classpath, a <code>JpaEventStorageEngine</code> or <code>JdbcEventStorageEngine</code> will respectively be auto-configured as the <code>EventStorageEngine</code>.
In absence of either, the auto configuration falls back to the <code>SimpleEventBus</code>.
{% endtab %} {% endtabs %}</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="_jdbceventstorageengine"><a class="anchor" href="#_jdbceventstorageengine"></a>JdbcEventStorageEngine</h4>
<div class="paragraph">
<p>The JDBC event storage engine uses a JDBC Connection to store events in a JDBC compatible data storage.
Typically, these are relational databases.
Theoretically, anything that has a JDBC driver could be used to back the <code>JdbcEventStorageEngine</code>.</p>
</div>
<div class="paragraph">
<p>Similar to its JPA counterpart, the <code>JDBCEventStorageEngine</code> stores events in entries.
By default, each event is stored in a single entry, which corresponds with a row in a table.
The storage engine uses one table for events and another for snapshots.</p>
</div>
<div class="paragraph">
<p>The <code>JdbcEventStorageEngine</code> uses a <code>ConnectionProvider</code> to obtain connections.
Typically, the engine can obtain these connections directly from a <code>DataSource</code>.
However, Axon will bind these connections to a <code>UnitOfWork</code> to use a single connection within a unit of work.
This approach ensures that the framework uses a single transaction to store all events, even when multiple units of work are nested in the same thread.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureJdbcEventStorage(Configurer configurer,
                                          ConnectionProvider connectionProvider,
                                          EventTableFactory eventTableFactory) {
        configurer.configureEmbeddedEventStore(
                 config -&gt; {
                     JdbcEventStorageEngine storageEngine =
                              JdbcEventStorageEngine.builder()
                                                    .snapshotSerializer(config.serializer())
                                                    .connectionProvider(connectionProvider)
                                                    .transactionManager(config.getComponent(TransactionManager.class))
                                                    .eventSerializer(config.eventSerializer())
                                                    // ...
                                                    .build();
                     // If the schema has not been constructed yet, the createSchema method can be used:
                     storageEngine.createSchema(eventTableFactory);
                     return storageEngine;
                 }
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %} By having JDBC on the classpath, Axon&#8217;s <code>JdbcAutoConfiguration</code> will automatically generate the <code>JdbcEventStorageEngine</code> for you.
All that might be left is the creation of the schema.
Axon can help you here with the <code>createSchema</code> operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...

    // The EmbeddedEventStore delegates actual storage and retrieval of events to an EventStorageEngine.
    @Bean
    public EventStore eventStore(EventStorageEngine storageEngine,
                                 GlobalMetricRegistry metricRegistry) {
        return EmbeddedEventStore.builder()
                                 .storageEngine(storageEngine)
                                 .messageMonitor(metricRegistry.registerEventBus("eventStore"))
                                 .spanFactory(spanFactory)
                                 // ...
                                 .build();
    }

    // The JdbcEventStorageEngine stores events in a JDBC-compatible data source.
    @Bean
    public EventStorageEngine storageEngine(Serializer serializer,
                                            ConnectionProvider connectionProvider,
                                            @Qualifier("eventSerializer") Serializer eventSerializer,
                                            TransactionManager transactionManager,
                                            EventTableFactory tableFactory) {
        JdbcEventStorageEngine storageEngine = JdbcEventStorageEngine.builder()
                                                                     .snapshotSerializer(serializer)
                                                                     .connectionProvider(connectionProvider)
                                                                     .eventSerializer(eventSerializer)
                                                                     .transactionManager(transactionManager)
                                                                     // ...
                                                                     .build();
        // If the schema has not been constructed yet, the createSchema method can be used:
        storageEngine.createSchema(tableFactory);
        return storageEngine;
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Data sources providers with Spring</strong></p>
</div>
<div class="paragraph">
<p>We recommend that Spring users use the <code>SpringDataSourceConnectionProvider</code> to attach a connection from a <code>DataSource</code> to an existing transaction.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>SQL Statement Customizability</strong></p>
</div>
<div class="paragraph">
<p>Databases have slight deviations from what&#8217;s the optimal SQL statement to perform in differing scenarios.
Since optimizing for all possibilities out there is beyond the framework&#8217;s scope, you can adjust the default statements used by the storage engine.</p>
</div>
<div class="paragraph">
<p>Check the <code>JdbcEventStorageEngineStatements</code> utility class for the default statements used by the <code>JdbcEventStorageEngine</code>.
Furthermore, the <code>org.axonframework.eventsourcing.eventstore.jdbc.statements</code> package contains the set of adjustable statements.
Each of these statement-builders can be customized through the <code>JdbcEventStorageEngine.Builder</code>.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="_mongoeventstorageengine"><a class="anchor" href="#_mongoeventstorageengine"></a>MongoEventStorageEngine</h4>
<div class="paragraph">
<p><a href="https://www.mongodb.com/">MongoDB</a> is a document based NoSQL store.
Its scalability characteristics make it suitable for use as an event store.
Axon provides the <code>MongoEventStorageEngine</code>, which uses MongoDB as a backing database.
It is contained in the Axon Mongo module (Maven artifactId <code>axon-mongo</code>).</p>
</div>
<div class="paragraph">
<p>Events are stored in two separate collections: one for the event streams and one for snapshots.</p>
</div>
<div class="paragraph">
<p>By default, the <code>MongoEventStorageEngine</code> stores each event in a separate document.
It is, however, possible to change the <code>StorageStrategy</code> used.
The alternative provided by Axon is the <code>DocumentPerCommitStorageStrategy</code>, which creates a single document for all events that have been stored in a single commit (i.e.
in the same <code>DomainEventStream</code>).</p>
</div>
<div class="paragraph">
<p>The advantage of storing an entire commit in a single document is that commit is stored atomically.
Furthermore, it requires only a single roundtrip for any number of events.
The disadvantage is that it becomes harder to query events directly in the database.
For example, when refactoring the domain model it is harder to "transfer" events from one aggregate to another if they are included in a "commit document".</p>
</div>
<div class="paragraph">
<p>The <code>MongoEventStorageEngine</code> does not require a lot of configuration.
All it needs is a reference to the collections to store the events in, and you&#8217;re set to go.
For production environments, you may want to double check the indexes on your collections.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureMongoEventStorage(Configurer configurer, MongoTemplate mongoTemplate) {
        configurer.configureEmbeddedEventStore(
                 config -&gt; MongoEventStorageEngine.builder()
                                                  .mongoTemplate(mongoTemplate)
                                                  // ...
                                                  .build()
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...

    // The EmbeddedEventStore delegates actual storage and retrieval of events to an EventStorageEngine.
    @Bean
    public EventStore eventStore(EventStorageEngine storageEngine,
                                 GlobalMetricRegistry metricRegistry) {
       return EmbeddedEventStore.builder()
                                .storageEngine(storageEngine)
                                .messageMonitor(metricRegistry.registerEventBus("eventStore"))
                                .spanFactory(spanFactory)
                                // ...
                                .build();
    }

    // The MongoEventStorageEngine stores each event in a separate MongoDB document.
    @Bean
    public EventStorageEngine storageEngine(MongoClient client) {
        return MongoEventStorageEngine.builder()
                                      .mongoTemplate(DefaultMongoTemplate.builder()
                                                                         .mongoDatabase(client)
                                                                         .build())
                                      // ...
                                      .build();
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Excluding the Axon Server Connector</strong></p>
</div>
<div class="paragraph">
<p>If you exclude the <code>axon-server-connector</code> dependency from <code>axon-spring-boot-starter</code> the <code>EmbeddedEventStore</code> will be auto-configured for you, if a concrete implementation of <code>EventStorageEngine</code> is available.
When it is desired to use Mongo as the Event Storage approach, this means providing a <code>MongoEventStorageEngine</code> bean.
{% endtab %} {% endtabs %}</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_store_utilities"><a class="anchor" href="#_event_store_utilities"></a>Event store utilities</h3>
<div class="paragraph">
<p>Axon provides a number of Event Storage Engines that may be useful in certain circumstances.</p>
</div>
<div class="sect3">
<h4 id="_in_memory_event_storage"><a class="anchor" href="#_in_memory_event_storage"></a>In-Memory Event Storage</h4>
<div class="paragraph">
<p>The <code>InMemoryEventStorageEngine</code> keeps stored events in memory.
While it probably outperforms any other event store out there, it is not really meant for long-term production use.
However, it is very useful in short-lived tools or tests that require an event store.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureInMemoryEventStorage(Configurer configurer) {
        configurer.configureEmbeddedEventStore(config -&gt; new InMemoryEventStorageEngine());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...

    // The EmbeddedEventStore delegates actual storage and retrieval of events to an EventStorageEngine.
    @Bean
    public EventStore eventStore(EventStorageEngine storageEngine,
                                 GlobalMetricRegistry metricRegistry) {
        return EmbeddedEventStore.builder()
                                 .storageEngine(storageEngine)
                                 .messageMonitor(metricRegistry.registerEventBus("eventStore"))
                                 .spanFactory(spanFactory)
                                 // ...
                                 .build();
    }

    // The InMemoryEventStorageEngine stores each event in memory.
    @Bean
    public EventStorageEngine storageEngine() {
        return new InMemoryEventStorageEngine();
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Excluding the Axon Server Connector</strong></p>
</div>
<div class="paragraph">
<p>If you exclude the <code>axon-server-connector</code> dependency from <code>axon-spring-boot-starter</code> the <code>EmbeddedEventStore</code> will be auto-configured for you, if a concrete implementation of <code>EventStorageEngine</code> is available.
When it is desired to use an in-memory Event Storage approach, this means providing an <code>InMemoryEventStorageEngine</code> Bean.
{% endtab %} {% endtabs %}</p>
</div>
</blockquote>
</div>
</div>
<div class="sect3">
<h4 id="_combining_multiple_event_stores_into_one"><a class="anchor" href="#_combining_multiple_event_stores_into_one"></a>Combining multiple event stores into one</h4>
<div class="paragraph">
<p>The <code>SequenceEventStorageEngine</code> is a wrapper around two other event storage engines.
When reading, it returns the events from both event storage engines.
Appended events are only appended to the second event storage engine.
This is useful in cases where two different implementations of event storage are used for performance reasons, for example.
The first would be a larger, but slower event store, while the second is optimized for quick reading and writing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_stored_events"><a class="anchor" href="#_filtering_stored_events"></a>Filtering Stored Events</h4>
<div class="paragraph">
<p>The <code>FilteringEventStorageEngine</code> allows events to be filtered based on a predicate.
Only events that match the given predicate will be stored.
Note that event processors that use the event store as a source of events may not receive these events because they are not being stored.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_influencing_the_serialization_process"><a class="anchor" href="#_influencing_the_serialization_process"></a>Influencing the serialization process</h3>
<div class="paragraph">
<p>Event stores need a way to serialize the event to prepare it for storage.
By default, Axon uses the <code>XStreamSerializer</code>, which uses <a href="http://x-stream.github.io/">XStream</a> to serialize events into XML.
XStream is reasonably fast and is more flexible than Java Serialization.
Furthermore, the result of XStream serialization is human readable.
This makes it quite useful for logging and debugging purposes.</p>
</div>
<div class="paragraph">
<p>The <code>XStreamSerializer</code> can be configured.
You can define aliases it should use for certain packages, classes or even fields.
Besides being a nice way to shorten potentially long names, aliases can also be used when class definitions of events change.
For more information about aliases, visit the <a href="http://x-stream.github.io/">XStream website</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, Axon also provides the <code>JacksonSerializer</code>, which uses <a href="https://github.com/FasterXML/jackson">Jackson</a> to serialize events into JSON.
While it produces a more compact serialized form, it does require that classes stick to the conventions (or configuration) required by Jackson.</p>
</div>
<div class="paragraph">
<p>You may also implement your own serializer, simply by creating a class that implements <code>Serializer</code>, and configuring the event store to use that implementation instead of the default.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Returns a Configurer instance with default components configured.
// We explicitly set `JacksonSerializer` as desired event serializer.
Configurer configurer = DefaultConfigurer.defaultConfiguration()
      .configureEventSerializer(c -&gt; JacksonSerializer.builder().build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %} You can specify a serializer in your <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text"># somewhere in your `application.properties`

axon.serializer.events=jackson # posible values: java, xstream, jackson</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can explicitly define your Serializer in the Spring context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// somewhere in your `@Configuration` class
@Qualifier("eventSerializer")
@Bean
public Serializer eventSerializer() {
    return JacksonSerializer.builder().build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="sect3">
<h4 id="_serializing_events_vs_the_rest"><a class="anchor" href="#_serializing_events_vs_the_rest"></a>Serializing events vs 'the rest'</h4>
<div class="paragraph">
<p>It is possible to use a different serializer for the storage of events, than all other objects that Axon needs to serialize (such as commands, snapshots, sagas, etc).
While the <code>XStreamSerializer</code>'s capability to serialize virtually anything makes it a very decent default, its output is not always a form that makes it nice to share with other applications.
The <code>JacksonSerializer</code> creates much nicer output, but requires a certain structure in the objects to serialize.
This structure is typically present in events, making it a very suitable event serializer.</p>
</div>
<div class="paragraph">
<p>If no explicit <code>eventSerializer</code> is configured, events are serialized using the main serializer that has been configured (which defaults to the <code>XStreamSerializer</code>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distributing_events"><a class="anchor" href="#_distributing_events"></a>Distributing Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To distribute events between applications, it is important to know whether the applications belong to the same <a href="../../architecture-overview/ddd-cqrs-concepts.md#bounded-context">bounded context</a>.
Applications within the same context "speak the same language." In other words, they communicate using the same set of messages and thus events.</p>
</div>
<div class="paragraph">
<p>As such, we can share the <code>EventStore</code>'s data source between these applications.
We may thus achieve distribution by utilizing the source itself.
You can use both the <a href="#embedded-event-store"><code>EmbeddedEventStore</code></a> and <a href="../../axon-server-introduction.html" class="xref page">Axon Server</a> for this.
The former would require the applications to point to the same data source, whereas the latter would require the applications to partake in the same context.</p>
</div>
<div class="paragraph">
<p>However, sharing the entire event API is not recommended whenever the applications do not belong to the same context.
Instead, we should protect the boundary of the contexts, except for some clearly defined cross-boundary messages.
Since accessing the same source isn&#8217;t an option, we require a different solution to share events.</p>
</div>
<div class="paragraph">
<p>To distribute events between bounded contexts, you can use Axon Server&#8217;s <a href="../../axon-server/administration/multi-context.html" class="xref page">multi-context</a> solution, for example.
The multi-context support requires application registration to specific contexts.
Then, you can open a stream to another context through the <code>AxonServerEventStore#createStreamableMessageSourceForContext(String)</code> operation.
With this source in hand, you can configure a <a href="event-processors/streaming.html" class="xref page">Streaming Processor</a> to start reading from it.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use a message broker to distribute events between contexts.
Axon provides a couple of these as <a href="../../extensions">extension modules</a>, for example <a href="../../extensions/spring-amqp.html" class="xref page">Spring AMQP</a> or <a href="../../extensions/kafka.html" class="xref page">Kafka</a>.</p>
</div>
<div class="paragraph">
<p>Although this allows further event distribution, we still recommend consciously sharing <em>the correct</em> events.
Ideally, we add a form of context mapping, like an anti-corruption layer, between the contexts.
In other words, we recommend using a separate component that maps the events from the local context to a shared language right before distribution.</p>
</div>
<div class="paragraph">
<p>For example, this mapper would publish the messages on the AMQP queue or Kafka topic.
When it comes to Axon Server, we could, for example, use a distinct shared/global context to contain the shared language.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="event-processors/streaming.html">Streaming Event Processors</a></span>
  <span class="next"><a href="event-versioning.html">Event Versioning</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
