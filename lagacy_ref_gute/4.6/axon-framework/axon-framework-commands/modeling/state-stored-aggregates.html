<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>State Stored Aggregates :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="multi-entity-aggregates.html">
    <link rel="next" href="aggregate-creation-from-another-aggregate.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../events/event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/jgroups.html">JGroups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../extensions/reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../extensions/reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../extensions/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../README.html">Axon Legacy Reference Guide</a></li>
    <li>Axon Framework</li>
    <li><a href="../README.html">Commands</a></li>
    <li><a href="README.html">Modeling</a></li>
    <li><a href="state-stored-aggregates.html">State Stored Aggregates</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/axon-framework/axon-framework-commands/modeling/state-stored-aggregates.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">State Stored Aggregates</h1>
<div class="paragraph">
<p>In the <a href="aggregate.html" class="xref page">Aggregate</a> main page we have seen how to create an Aggregate backed by Event Sourcing.
In other words, the storage method for an Event Sourced Aggregate is by replaying the events which constitute the changes on the Aggregate.</p>
</div>
<div class="paragraph">
<p>An Aggregate can however be stored as-is too.
When doing so, the <code>Repository</code> used to save and load the Aggregate, is the <code>GenericJpaRepository</code>.
The structure of a state-stored Aggregate is a little different from an Event Sourced Aggregate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.axonframework.commandhandling.CommandHandler;
import org.axonframework.eventhandling.EventHandler;
import org.axonframework.modelling.command.AggregateIdentifier;
import org.axonframework.modelling.command.AggregateMember;

import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.OneToMany;

@Entity // 1.
public class GiftCard {

    @Id // 2.
    @AggregateIdentifier
    private String id;

    // 3.
    @OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @JoinColumn(name = "giftCardId")
    @AggregateMember
    private List&lt;GiftCardTransaction&gt; transactions = new ArrayList&lt;&gt;();

    private int remainingValue;

    @CommandHandler  // 4.
    public GiftCard(IssueCardCommand cmd) {
        if (cmd.getAmount() &lt;= 0) {
            throw new IllegalArgumentException("amount &lt;= 0");
        }
        id = cmd.getCardId();
        remainingValue = cmd.getAmount();

         // 5.
        apply(new CardIssuedEvent(cmd.getCardId(), cmd.getAmount()));
    }

    @CommandHandler
    public void handle(RedeemCardCommand cmd) {
         // 6.
        if (cmd.getAmount() &lt;= 0) {
            throw new IllegalArgumentException("amount &lt;= 0");
        }
        if (cmd.getAmount() &gt; remainingValue) {
            throw new IllegalStateException("amount &gt; remaining value");
        }
        if (transactions.stream().map(GiftCardTransaction::getTransactionId).anyMatch(cmd.getTransactionId()::equals)) {
            throw new IllegalStateException("TransactionId must be unique");
        }

         // 7.
        remainingValue -= cmd.getAmount();
        transactions.add(new GiftCardTransaction(id, cmd.getTransactionId(), cmd.getAmount()));

        apply(new CardRedeemedEvent(id, cmd.getTransactionId(), cmd.getAmount()));
    }

    @EventHandler  // 8.
    protected void on(CardReimbursedEvent event) {
        this.remainingValue += event.getAmount();
    }

    protected GiftCard() { }  // 9.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above exert shows an state stored Aggregate from a 'Gift Card Service'.
The numbered comments in the snippet point out Axon specifics which are explained here:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As the Aggregate is stored in a JPA repository, it is required to annotated the class with <code>@Entity</code>.</p>
</li>
<li>
<p>An Aggregate Root must declare a field that contains the Aggregate Identifier.</p>
<div class="paragraph">
<p>This identifier must be initialized at the latest when the first event is published.</p>
</div>
<div class="paragraph">
<p>This identifier field must be annotated by the <code>@AggregateIdentifier</code> annotation.</p>
</div>
<div class="paragraph">
<p>When using JPA to store the Aggregate, Axon knows to use the <code>@Id</code> annotation provided by JPA.</p>
</div>
<div class="paragraph">
<p>Since the Aggregate is an entity, the <code>@Id</code> annotation is a hard requirement.</p>
</div>
</li>
<li>
<p>This Aggregate has several '<a href="multi-entity-aggregates.html" class="xref page">Aggregate Members</a>'.</p>
<div class="paragraph">
<p>Since the Aggregate is stored as is, the correct mapping of the entities should be taken into account.</p>
</div>
</li>
<li>
<p>A <code>@CommandHandler</code> annotated constructor, or differently put the 'command handling constructor'.</p>
<div class="paragraph">
<p>This annotation tells the framework that the given constructor is capable of handling the <code>IssueCardCommand</code>.</p>
</div>
</li>
<li>
<p>The static <code>AggregateLifecycle#apply(Object...)</code> may be used to publish an Event Message.</p>
<div class="paragraph">
<p>Upon calling this function the provided <code>Object</code>s will be published as <code>EventMessage</code>s within the scope of the Aggregate they are applied in.</p>
</div>
</li>
<li>
<p>The Command Handling method will first decide whether the incoming Command is valid to handle at this point.</p>
</li>
<li>
<p>After the business logic has been validated, the state of the Aggregate may be adjusted</p>
</li>
<li>
<p>Entities within an Aggregate can listen to the events the Aggregate publishes, by defining an <code>@EventHandler</code> annotated method.</p>
<div class="paragraph">
<p>These methods will be invoked when an Event Message is published prior to being handled by any external handlers.</p>
</div>
</li>
<li>
<p>A no-arg constructor, which is required by JPA.</p>
<div class="paragraph">
<p>Failure to provide this constructor will result in an exception when loading the Aggregate.</p>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Adjusting state in Command Handlers</strong></p>
</div>
<div class="paragraph">
<p>Differently from <a href="aggregate.html" class="xref page">Event Sourced Aggregates</a>, State-Stored Aggregates can pair the decision making logic and state changes in a Command Handler.
There are no consequences for State-Stored Aggregates in following this paradigm as there are no Event Sourcing Handlers which drive it&#8217;s state.</p>
</div>
</blockquote>
</div>
<nav class="pagination">
  <span class="prev"><a href="multi-entity-aggregates.html">Multi-Entity Aggregates</a></span>
  <span class="next"><a href="aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../../_/js/site.js" data-ui-root-path="../../../../../_"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
