<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Infrastructure :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="command-handlers.html">
    <link rel="next" href="configuration.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="modeling/README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/jgroups.html">JGroups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../extensions/reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../extensions/reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../README.html">Axon Legacy Reference Guide</a></li>
    <li>Axon Framework</li>
    <li><a href="README.html">Commands</a></li>
    <li><a href="infrastructure.html">Infrastructure</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/axon-framework/axon-framework-commands/infrastructure.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Infrastructure</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Command dispatching, as exemplified in the <a href="command-dispatchers.html" class="xref page">Dispatching Commands</a> page, has a number of advantages.
Firstly, it constructs an object that clearly describes the intent of the client.
By logging the command, you store both the intent and the related data for future reference.
Command handling also makes it easy to expose your command processing components to remote clients, via web services for example.</p>
</div>
<div class="paragraph">
<p>Testing also becomes a lot easier.
You could define test scripts by just defining the starting situation (given), command to execute (when) and expected results (then) by listing a number of events and commands (see <a href="#../testing/commands-events.adoc" class="xref unresolved">Testing</a> for more on this).</p>
</div>
<div class="paragraph">
<p>The last major advantage is that it is very easy to switch between synchronous and asynchronous, as well as local versus distributed command processing.</p>
</div>
<div class="paragraph">
<p>This does not mean command dispatching using explicit command objects is the only way to do it.
The goal of Axon is not to prescribe a specific way of working, but to support you doing it your way, while providing best practices as the default behavior.
It is still possible to use a service layer that you can invoke to execute commands.
The method will just need to start a unit of work (see <a href="#../messaging-concepts/unit-of-work.adoc" class="xref unresolved">Unit of Work</a>) and perform a commit or rollback on it when the method is finished.</p>
</div>
<div class="paragraph">
<p>The next sections provide an overview of the tasks related to setting up a command dispatching infrastructure with the Axon Framework.
The API-friendlier <a href="#the-command-gateway"><code>CommandGateway</code></a> is mentioned, as well as the <code>CommandBus</code> in both a <a href="#the-command-bus---local">local</a> and <a href="#the-command-bus---distributed">distributed</a> environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_command_gateway"><a class="anchor" href="#_the_command_gateway"></a>The Command Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Command Gateway is a convenient interface towards the command dispatching mechanism.
While you are not required to use a gateway to dispatch commands, it is generally the easiest option to do so.</p>
</div>
<div class="paragraph">
<p>There are two ways to use a Command Gateway.
The first is to use the <code>CommandGateway</code> interface and the <code>DefaultCommandGateway</code> implementation provided by Axon.
The command gateway provides a number of methods that allow you to send a command and wait for a result either synchronously, with a timeout or asynchronously.</p>
</div>
<div class="paragraph">
<p>The other option is perhaps the most flexible of all.
You can turn almost any interface into a command gateway using the <code>CommandGatewayFactory</code>.
This allows you to define your application&#8217;s interface using strong typing and declaring your own (checked) business exceptions.
Axon will automatically generate an implementation for that interface at runtime.</p>
</div>
<div class="sect2">
<h3 id="_configuring_the_command_gateway"><a class="anchor" href="#_configuring_the_command_gateway"></a>Configuring the Command Gateway</h3>
<div class="paragraph">
<p>Both your custom Command Gateway and the one provided by Axon need to at least be configured with a Command Bus.
In addition, the Command Gateway can be configured with a <code>RetryScheduler</code>, <code>CommandDispatchInterceptor</code>s, and <code>CommandCallback</code>s.</p>
</div>
<div class="paragraph">
<p><strong>RetryScheduler</strong></p>
</div>
<div class="paragraph">
<p>The <code>RetryScheduler</code> is capable of scheduling retries when command execution has failed.
When a command fails due to an exception that is explicitly non-transient, no retries are done at all.
Note that the retry scheduler is only invoked when a command fails due to a <code>RuntimeException</code>.
Checked exceptions are regarded as a "business exception" and will never trigger a retry.</p>
</div>
<div class="paragraph">
<p>Currently, two implementations exist:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>IntervalRetryScheduler</code> will retry a given command at set intervals until it succeeds,</p>
<div class="paragraph">
<p>or a maximum number of retries has taken place.</p>
</div>
</li>
<li>
<p>The <code>ExponentialBackOffIntervalRetryScheduler</code> retries failed commands with an exponential back-off interval until</p>
<div class="paragraph">
<p>it succeeds, or a maximum number of retries has taken place.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>CommandDispatchInterceptor</strong></p>
</div>
<div class="paragraph">
<p><code>CommandDispatchInterceptor</code>s allow modification of <code>CommandMessage</code>s prior to dispatching them to the Command Bus.
In contrast to <code>CommandDispatchInterceptor</code>s configured on the Command Bus, these interceptors are only invoked when messages are sent through this Gateway.
For example, these interceptors could be used to attach metadata to a command or perform validation.</p>
</div>
<div class="paragraph">
<p><strong>CommandCallback</strong></p>
</div>
<div class="paragraph">
<p>A <code>CommandCallback</code> can be provided to the Command Gateway upon a regular <code>send</code>, specifying what to do with the command handling result.
It works with the <code>CommandMessage</code> and <code>CommandResultMessage</code> classes, thus allowing for some generic behavior for all Commands sent through this gateway regardless of their type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_custom_command_gateway"><a class="anchor" href="#_creating_a_custom_command_gateway"></a>Creating a custom Command Gateway</h3>
<div class="paragraph">
<p>Axon allows a custom interface to be used as a command gateway.
The behavior of each method declared in the interface is based on the parameter types, return type and declared exception.
Using this gateway is not only convenient, it makes testing a lot easier by allowing you to mock your interface where needed.</p>
</div>
<div class="paragraph">
<p>This is how parameters affect the behavior of the command gateway:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first parameter is expected to be the actual command object to dispatch.</p>
</li>
<li>
<p>Parameters annotated with <code>@MetaDataValue</code> will have their value assigned to the metadata field with the identifier passed as annotation parameter</p>
</li>
<li>
<p>Parameters of type <code>MetaData</code> will be merged with the <code>MetaData</code> on the <code>CommandMessage</code>.</p>
<div class="paragraph">
<p>Metadata defined by latter parameters will overwrite the metadata of earlier parameters, if their key is equal.</p>
</div>
</li>
<li>
<p>Parameters of type <code>CommandCallback</code> will have their <code>onResult(CommandMessage&lt;?
extends C&gt;, CommandResultMessage&lt;?
extends R&gt;)</code> invoked after the command has been handled.
Although the <code>CommandCallback</code> provides a means to deal with the result of command handling, this is no impact on whether you can define a return type on the custom command gateway.
In case both a callback and return type are defined, the invocations of the callback will always match with the return value (or exception).
Lastly, know that you may pass in several <code>CommandCallback</code> instances, which all will be invoked in order.</p>
</li>
<li>
<p>The last two parameters indicate a timeout and may be of types <code>long</code> (or <code>int</code>) and <code>TimeUnit</code>.</p>
<div class="paragraph">
<p>The method will block at most as long as these parameters indicate.
How the method reacts to a timeout depends on the exceptions declared on the method (see below).</p>
</div>
<div class="paragraph">
<p>Note that if other properties of the method prevent blocking altogether, a timeout will never occur.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The declared return value of a method will also affect its behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>void</code> return type will cause the method to return immediately, unless there are other indications on the method that one would want to wait, such as a timeout or declared exceptions.</p>
</li>
<li>
<p>Return types of <code>Future</code>, <code>CompletionStage</code> and <code>CompletableFuture</code> will cause the method to return immediately.</p>
<div class="paragraph">
<p>You can access the result of the command handler using the <code>CompletableFuture</code> instance returned from the method.</p>
</div>
<div class="paragraph">
<p>Exceptions and timeouts declared on the method are ignored.</p>
</div>
</li>
<li>
<p>Any other return type will cause the method to block until a result is available.</p>
<div class="paragraph">
<p>The result is cast to the return type (causing a <code>ClassCastException</code> if the types do not match).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exceptions have the following effect:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any declared checked exception will be thrown if the command handler (or an interceptor) threw an exception of that type.</p>
<div class="paragraph">
<p>If a checked exception is thrown that has not been declared, it is wrapped in a <code>CommandExecutionException</code>, which is a <code>RuntimeException</code>.</p>
</div>
</li>
<li>
<p>When a timeout occurs, the default behavior is to return <code>null</code> from the method.</p>
<div class="paragraph">
<p>This can be changed by declaring a <code>TimeoutException</code>.</p>
</div>
<div class="paragraph">
<p>If this exception is declared, a <code>TimeoutException</code> is thrown instead.</p>
</div>
</li>
<li>
<p>When a thread is interrupted while waiting for a result, the default behavior is to return null.</p>
<div class="paragraph">
<p>In that case, the interrupted flag is set back on the thread.</p>
</div>
<div class="paragraph">
<p>By declaring an <code>InterruptedException</code> on the method, this behavior is changed to throw that exception instead.</p>
</div>
<div class="paragraph">
<p>The interrupt flag is removed when the exception is thrown, consistent with the java specification.</p>
</div>
</li>
<li>
<p>Other runtime exceptions may be declared on the method, but will not have any effect other than clarification to the API user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, there is the possibility to use annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As specified in the parameter section, the <code>@MetaDataValue</code> annotation on a parameter will have the value of that parameter added as metadata value.</p>
<div class="paragraph">
<p>The key of the metadata entry is provided as parameter to the annotation.</p>
</div>
</li>
<li>
<p>Methods annotated with <code>@Timeout</code> will block at most the indicated amount of time.</p>
<div class="paragraph">
<p>This annotation is ignored if the method declares timeout parameters.</p>
</div>
</li>
<li>
<p>Classes annotated with <code>@Timeout</code> will cause all methods declared in that class to block at most the indicated amount of time, unless they are annotated with their own <code>@Timeout</code> annotation or specify timeout parameters.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface MyGateway {

    // fire and forget
    void sendCommand(MyPayloadType command);

    // method that attaches metadata and will wait for a result for 10 seconds
    @Timeout(value = 10, unit = TimeUnit.SECONDS)
    ReturnValue sendCommandAndWaitForAResult(MyPayloadType command,
                                             @MetaDataValue("userId") String userId);

    // alternative that throws exceptions on timeout
    @Timeout(value = 20, unit = TimeUnit.SECONDS)
    ReturnValue sendCommandAndWaitForAResult(MyPayloadType command)
                         throws TimeoutException, InterruptedException;

    // this method will also wait, caller decides how long
    void sendCommandAndWait(MyPayloadType command, long timeout, TimeUnit unit)
                         throws TimeoutException, InterruptedException;
}

// To configure a gateway:
CommandGatewayFactory factory = CommandGatewayFactory.builder()
                                                     .commandBus(commandBus)
                                                     .build();
// note that the commandBus can be obtained from the Configuration
// object returned on `configurer.initialize()`.
MyGateway myGateway = factory.createGateway(MyGateway.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_command_bus_local"><a class="anchor" href="#_the_command_bus_local"></a>The Command Bus - Local</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The local command bus is the mechanism that dispatches commands to their respective command handlers within an Axon application.
Suggestions on how to use the <code>CommandBus</code> can be found <a href="command-dispatchers.md#the-command-bus">here</a>.
Several flavors of the command bus, with differing characteristics, exist within the framework.</p>
</div>
<div class="sect2">
<h3 id="_simplecommandbus"><a class="anchor" href="#_simplecommandbus"></a>SimpleCommandBus</h3>
<div class="paragraph">
<p>The <code>SimpleCommandBus</code> is, as the name suggests, the simplest implementation.
It does straightforward processing of commands in the thread that dispatches them.
After a command is processed, the modified aggregate(s) are saved and generated events are published in that same thread.
In most scenarios, such as web applications, this implementation will suit your needs.</p>
</div>
<div class="paragraph">
<p>Like most <code>CommandBus</code> implementations, the <code>SimpleCommandBus</code> allows interceptors to be configured.
<code>CommandDispatchInterceptor</code>s are invoked when a command is dispatched on the command bus.
The <code>CommandHandlerInterceptor</code>s are invoked before the actual command handler method is, allowing you to do modify or block the command.
See <a href="../messaging-concepts/message-intercepting.md#command-interceptors">Command Interceptors</a> for more information.</p>
</div>
<div class="paragraph">
<p>Since all command processing is done in the same thread, this implementation is limited to the JVM&#8217;s boundaries.
The performance of this implementation is good, but not extraordinary.
To cross JVM boundaries, or to get the most out of your CPU cycles, check out the other <code>CommandBus</code> implementations.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureSimpleCommandBus(Configurer configurer) {
        configurer.configureCommandBus(
                config -&gt; {
                    CommandBus commandBus =
                            SimpleCommandBus.builder()
                                            .transactionManager(config.getComponent(TransactionManager.class))
                                            .spanFactory(config.spanFactory())
                                            .messageMonitor(config.messageMonitor(SimpleCommandBus.class, "commandBus"))
                                            // ...
                                            .build();
                    commandBus.registerHandlerInterceptor(
                            new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders())
                    );
                return commandBus;
              }
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    public CommandBus simpleCommandBus(TransactionManager transactionManager,
                                       GlobalMetricRegistry metricRegistry,
                                       SpanFactory spanFactory) {
        return SimpleCommandBus.builder()
                               .transactionManager(transactionManager)
                               .messageMonitor(metricRegistry.registerCommandBus("commandBus"))
                               .spanFactory(spanFactory)
                               // ...
                               .build();
    }

    @Bean
    public ConfigurerModule commandBusCorrelationConfigurerModule() {
        return configurer -&gt; configurer.onInitialize(
                  config -&gt; config.commandBus().registerHandlerInterceptor(
                            new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders())
                  )
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
</div>
<div class="sect2">
<h3 id="_asynchronouscommandbus"><a class="anchor" href="#_asynchronouscommandbus"></a>AsynchronousCommandBus</h3>
<div class="paragraph">
<p>As the name suggest, the <code>AsynchronousCommandBus</code> implementation executes commands asynchronously from the thread that dispatches them.
It uses an <code>Executor</code> to perform the actual handling logic on a different Thread.</p>
</div>
<div class="paragraph">
<p>By default, the <code>AsynchronousCommandBus</code> uses an unbounded cached thread pool.
This means a thread is created when a command is dispatched.
Threads that have finished processing a command are reused for new commands.
Threads are stopped if they have not processed a command for 60 seconds.</p>
</div>
<div class="paragraph">
<p>Alternatively, an <code>Executor</code> instance may be provided to configure a different threading strategy.</p>
</div>
<div class="paragraph">
<p>Note that the <code>AsynchronousCommandBus</code> should be shut down when stopping the application, to make sure any waiting threads are properly shut down.
To shut down, call the <code>shutdown()</code> method.
This will also shutdown any provided <code>Executor</code> instance, if it implements the <code>ExecutorService</code> interface.</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureAsynchronousCommandBus(Configurer configurer) {
      configurer.configureCommandBus(
              config -&gt; {
                CommandBus commandBus =
                        AsynchronousCommandBus.builder()
                                              .transactionManager(config.getComponent(TransactionManager.class))
                                              .spanFactory(config.spanFactory())
                                              .messageMonitor(config.messageMonitor(
                                                      AsynchronousCommandBus.class, "commandBus"
                                              ))
                                              // ...
                                              .build();
                commandBus.registerHandlerInterceptor(
                        new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders())
                );
                return commandBus;
              }
      );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    public CommandBus asynchronousCommandBus(TransactionManager transactionManager,
                                             GlobalMetricRegistry metricRegistry,
                                             SpanFactory spanFactory) {
        return AsynchronousCommandBus.builder()
                                     .transactionManager(transactionManager)
                                     .messageMonitor(metricRegistry.registerCommandBus("commandBus"))
                                     .spanFactory(spanFactory)
                                     // ...
                                     .build();
    }

    @Bean
    public ConfigurerModule commandBusCorrelationConfigurerModule() {
        return configurer -&gt; configurer.onInitialize(
                  config -&gt; config.commandBus().registerHandlerInterceptor(
                            new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders())
                  )
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
</div>
<div class="sect2">
<h3 id="_disruptorcommandbus"><a class="anchor" href="#_disruptorcommandbus"></a>DisruptorCommandBus</h3>
<div class="paragraph">
<p>The <code>SimpleCommandBus</code> has reasonable performance characteristics.
The fact that the <code>SimpleCommandBus</code> needs locking to prevent multiple threads from concurrently accessing the same aggregate causes processing overhead and lock contention.</p>
</div>
<div class="paragraph">
<p>The <code>DisruptorCommandBus</code> takes a different approach to multithreaded processing.
Instead of having multiple threads each doing the same process, there are multiple threads, each taking care of a piece of the process.
The <code>DisruptorCommandBus</code> uses the <a href="http://lmax-exchange.github.io/disruptor/">Disruptor</a>, a small framework for concurrent programming, to achieve much better performance, by just taking a different approach to multi-threading.
Instead of doing the processing in the calling thread, the tasks are handed off to two groups of threads, that each take care of a part of the processing.
The first group of threads will execute the command handler, changing an aggregate&#8217;s state.
The second group will store and publish the events to the event store.</p>
</div>
<div class="paragraph">
<p>While the <code>DisruptorCommandBus</code> easily outperforms the <code>SimpleCommandBus</code> by a factor of 4(!), there are a few limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>DisruptorCommandBus</code> only supports event sourced aggregates.</p>
<div class="paragraph">
<p>This Command Bus also acts as a Repository for the aggregates processed by the Disruptor.</p>
</div>
<div class="paragraph">
<p>To get a reference to the Repository, use <code>createRepository(AggregateFactory)</code>.</p>
</div>
</li>
<li>
<p>A command can only result in a state change in a single aggregate instance.</p>
</li>
<li>
<p>When using a cache, it allows only a single aggregate for a given identifier.</p>
<div class="paragraph">
<p>This means it is not possible to have two aggregates of different types with the same identifier.</p>
</div>
</li>
<li>
<p>Commands should generally not cause a failure that requires a rollback of the unit of work.</p>
<div class="paragraph">
<p>When a rollback occurs, the <code>DisruptorCommandBus</code> cannot guarantee that commands are processed in the order they were dispatched.</p>
</div>
<div class="paragraph">
<p>Furthermore, it requires a retry of a number of other commands, causing unnecessary computations.</p>
</div>
</li>
<li>
<p>When creating a new aggregate instance, commands updating that created instance may not all happen in the exact order as provided.</p>
<div class="paragraph">
<p>Once the aggregate is created, all commands will be executed exactly in the order they were dispatched.</p>
</div>
<div class="paragraph">
<p>To ensure the order, use a callback on the creating command to wait for the aggregate being created.</p>
</div>
<div class="paragraph">
<p>It shouldn&#8217;t take more than a few milliseconds.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To construct a <code>DisruptorCommandBus</code> instance, you need an <code>EventStore</code>.
This component is explained in the <a href="#../events/event-bus-and-event-store.adoc" class="xref unresolved">Event Bus and Event Store</a> section.</p>
</div>
<div class="paragraph">
<p>Optionally, you can provide a <code>DisruptorConfiguration</code> instance, which allows you to tweak the configuration to optimize performance for your specific environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Buffer size</code> - the number of slots on the ring buffer to register incoming commands.</p>
<div class="paragraph">
<p>Higher values may increase throughput, but also cause higher latency.
Must always be a power of 2.
Defaults to 4096.</p>
</div>
</li>
<li>
<p><code>ProducerType</code> - indicates whether the entries are produced by a single thread, or multiple.
Defaults to multiple.</p>
</li>
<li>
<p><code>WaitStrategy</code> - the strategy to use when the processor threads (the three threads taking care of the actual processing) need to wait for each other.</p>
<div class="paragraph">
<p>The best wait strategy depends on the number of cores available in the machine, and the number of other processes running.</p>
</div>
<div class="paragraph">
<p>If low latency is crucial, and the <code>DisruptorCommandBus</code> may claim cores for itself, you can use the <code>BusySpinWaitStrategy</code>.</p>
</div>
<div class="paragraph">
<p>To make the command bus claim less of the CPU and allow other threads to do processing, use the <code>YieldingWaitStrategy</code>.</p>
</div>
<div class="paragraph">
<p>Finally, you can use the <code>SleepingWaitStrategy</code> and <code>BlockingWaitStrategy</code> to allow other processes a fair share of CPU.</p>
</div>
<div class="paragraph">
<p>The latter is suitable if the Command Bus is not expected to be processing full-time.</p>
</div>
<div class="paragraph">
<p>Defaults to the <code>BlockingWaitStrategy</code>.</p>
</div>
</li>
<li>
<p><code>Executor</code> - sets the Executor that provides the Threads for the <code>DisruptorCommandBus</code>.</p>
<div class="paragraph">
<p>This executor must be able to provide at least four threads.</p>
</div>
<div class="paragraph">
<p>Three of the threads are claimed by the processing components of the <code>DisruptorCommandBus</code>.</p>
</div>
<div class="paragraph">
<p>Extra threads are used to invoke callbacks and to schedule retries in case an Aggregate&#8217;s state is detected to be corrupt.</p>
</div>
<div class="paragraph">
<p>Defaults to a <code>CachedThreadPool</code> that provides threads from a thread group called <code>"DisruptorCommandBus"</code>.</p>
</div>
</li>
<li>
<p><code>TransactionManager</code> - defines the transaction manager that should ensure that the storage and publication of events are executed within a transaction.</p>
</li>
<li>
<p><code>InvokerInterceptors</code> - defines the <code>CommandHandlerInterceptor</code>s that are to be used in the invocation process.</p>
<div class="paragraph">
<p>This is the process that calls the actual Command Handler method.</p>
</div>
</li>
<li>
<p><code>PublisherInterceptors</code> - defines the <code>CommandHandlerInterceptor</code>s that are to be used in the publication process.</p>
<div class="paragraph">
<p>This is the process that stores and publishes the generated events.</p>
</div>
</li>
<li>
<p><code>RollbackConfiguration</code> - defines on which Exceptions a Unit of Work should be rolled back.</p>
<div class="paragraph">
<p>Defaults to a configuration that rolls back on unchecked exceptions.</p>
</div>
</li>
<li>
<p><code>RescheduleCommandsOnCorruptState</code> - indicates whether Commands that have been executed against an Aggregate that has been corrupted (e.g.
because a Unit of Work was rolled back) should be rescheduled.</p>
<div class="paragraph">
<p>If <code>false</code> the callback&#8217;s <code>onFailure()</code> method will be invoked.</p>
</div>
<div class="paragraph">
<p>If <code>true</code> (the default), the command will be rescheduled instead.</p>
</div>
</li>
<li>
<p><code>CoolingDownPeriod</code> - sets the number of seconds to wait to make sure all commands are processed.</p>
<div class="paragraph">
<p>During the cooling down period, no new commands are accepted, but existing commands are processed, and rescheduled when necessary.</p>
</div>
<div class="paragraph">
<p>The cooling down period ensures that threads are available for rescheduling the commands and calling callbacks.</p>
</div>
<div class="paragraph">
<p>Defaults to <code>1000</code> (1 second).</p>
</div>
</li>
<li>
<p><code>Cache</code> - sets the cache that stores aggregate instances that have been reconstructed from the Event Store.</p>
<div class="paragraph">
<p>The cache is used to store aggregate instances that are not in active use by the disruptor.</p>
</div>
</li>
<li>
<p><code>InvokerThreadCount</code> - the number of threads to assign to the invocation of command handlers.</p>
<div class="paragraph">
<p>A good starting point is half the number of cores in the machine.</p>
</div>
</li>
<li>
<p><code>PublisherThreadCount</code> - the number of threads to use to publish events.</p>
<div class="paragraph">
<p>A good starting point is half the number of cores, and could be increased if a lot of time is spent on I/O.</p>
</div>
</li>
<li>
<p><code>SerializerThreadCount</code> - the number of threads to use to pre-serialize events.</p>
<div class="paragraph">
<p>This defaults to <code>1</code>, but is ignored if no serializer is configured.</p>
</div>
</li>
<li>
<p><code>Serializer</code> - the serializer to perform pre-serialization with.</p>
<div class="paragraph">
<p>When a serializer is configured, the <code>DisruptorCommandBus</code> will wrap all generated events in a <code>SerializationAware</code> message.</p>
</div>
<div class="paragraph">
<p>The serialized form of the payload and metadata is attached before they are published to the Event Store.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureDisruptorCommandBus(Configurer configurer) {
        configurer.configureCommandBus(config -&gt; {
            CommandBus commandBus = DisruptorCommandBus.builder()
                                                       .transactionManager(config.getComponent(TransactionManager.class))
                                                       .messageMonitor(config.messageMonitor(
                                                               DisruptorCommandBus.class, "commandBus"
                                                       ))
                                                       .bufferSize(4096)
                                                       // ...
                                                       .build();
            commandBus.registerHandlerInterceptor(new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders()));
            return commandBus;
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    public CommandBus disruptorCommandBus(TransactionManager transactionManager,
                                          GlobalMetricRegistry metricRegistry) {
        return DisruptorCommandBus.builder()
                                  .transactionManager(transactionManager)
                                  .messageMonitor(metricRegistry.registerCommandBus("commandBus"))
                                  .bufferSize(4096)
                                  // ...
                                  .build();
    }

    @Bean
    public ConfigurerModule commandBusCorrelationConfigurerModule() {
        return configurer -&gt; configurer.onInitialize(
                  config -&gt; config.commandBus().registerHandlerInterceptor(
                            new CorrelationDataInterceptor&lt;&gt;(config.correlationDataProviders())
                  )
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_command_bus_distributed"><a class="anchor" href="#_the_command_bus_distributed"></a>The Command Bus - Distributed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Oftentimes you would want multiple instances of command buses in different JVMs to act as one.
Commands dispatched on one JVM&#8217;s command bus should be seamlessly transported to a command handler in another JVM while sending back any results.
That is where the concept of 'distributing the command bus' comes in.</p>
</div>
<div class="paragraph">
<p>There are a couple of concepts that are configurable, regardless of the type of distributed command bus that is being used:</p>
</div>
<div class="sect2">
<h3 id="_local_segment"><a class="anchor" href="#_local_segment"></a>Local Segment</h3>
<div class="paragraph">
<p>Unlike the <a href="#the-command-bus---local">local</a> <code>CommandBus</code> implementations, the distributed command buses do not invoke any handlers at all.
All they do is form a "bridge" between command bus implementations on different JVM&#8217;s, delegating any received commands to the so-called <em>local segment</em>.</p>
</div>
<div class="paragraph">
<p>By default, this local segment is the <a href="infrastructure.md#simplecommandbus"><code>SimpleCommandBus</code></a>.
You can configure the local segment to be any of the other local command buses too, like the <a href="infrastructure.md#asynchronouscommandbus"><code>AsynchronousCommandBus</code></a> and <a href="infrastructure.md#disruptorcommandbus"><code>DisruptorCommandBus</code></a>.
The details of how to configure the local segment are shown in the implementation sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_load_factor"><a class="anchor" href="#_load_factor"></a>Load Factor</h3>
<div class="paragraph">
<p>The load factor defines the amount of load an Axon application would carry compared to other instances.
For example, if you have a two machine set up, each with a load factor of 100, they will both carry an equal amount of load.</p>
</div>
<div class="paragraph">
<p>Increasing the load factor to 200 on both would still mean that both machines receive the same amount of load.
This points out that the load factor will only change the load amongst systems if the values are not equal.
Doing so would make sense in a heterogeneous application landscape, where the faster machines should deal with a bigger portion of command handling than the slower machines.</p>
</div>
<div class="paragraph">
<p>The default load factor set for the distributed <code>CommandBus</code> implementations is 100.
The configuration changes slightly per distributed implementation and as such will be covered in those sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_routing_strategy"><a class="anchor" href="#_routing_strategy"></a>Routing Strategy</h3>
<div class="paragraph">
<p>Commands should be <a href="../../architecture-overview/README.md#explicit-messaging">routed consistently</a> to the same application, especially those targeted towards a specific Aggregate.
This ensures a single instance is in charge of the targeted aggregate, resolving the concurrent access issue and allowing for optimization like caching to work as designed.
The component dealing with the consistent routing in an Axon application is the <code>RoutingStrategy</code>.</p>
</div>
<div class="paragraph">
<p>The <code>RoutingStrategy</code> receives a <code>CommandMessage</code> and based on the message returns the routing key to use.
Two commands with the same routing key will <strong>always</strong> be routed to the same segment, as long as there is no topology change in the distributed set-up.</p>
</div>
<div class="paragraph">
<p>At the moment, there are five implementations of the <code>RoutingStrategy</code>.
Three of these are intended to be fallback solutions, in case the routing key cannot be resolved:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>AnnotationRoutingStrategy</code> - the <strong>default</strong> routing strategy expects the <code>TargetAggregateIdentifier</code> or <code>RoutingKey</code> annotation to be present on a field inside the command class.
The annotated field or getter is searched, and the contents will be returned as the routing key for that command.</p>
</li>
<li>
<p>The <code>MetaDataRoutingStrategy</code> - uses a property defined during creation of this strategy to fetch the routing key from the <code>CommandMessage</code>'s <code>MetaData</code>.</p>
</li>
<li>
<p>The <code>ERROR</code> <code>UnresolvedRoutingKeyPolicy</code> - the <strong>default fallback</strong> that will cause an exception to be thrown when the routing key cannot be resolved from the given <code>CommandMessage</code>.</p>
</li>
<li>
<p>The <code>RANDOM_KEY</code> <code>UnresolvedRoutingKeyPolicy</code> - will return a random value when a routing key cannot be resolved from the <code>CommandMessage</code>.
This means that those commands will be routed to a random segment of the command bus.</p>
</li>
<li>
<p>The <code>STATIC_KEY</code> <code>UnresolvedRoutingKeyPolicy</code> - will return a static key (named "unresolved") for unresolved routing keys.
This policy routes all commands to the same segment, as long as the configuration of segments does not change.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>AnnotationRoutingStrategy</code> and <code>MetaDataRoutingStrategy</code> are considered the full implementations to configure.
The <code>ERROR</code>, <code>RANDOM_KEY</code> and <code>STATIC_KEY</code> are <em>fallback routing strategies</em> that should be configured on the annotation or meta-data implementations.
To get a grasp how these are constructed, consider the following sample:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="AnnotationRoutingStrategy" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// A custom annotation can be used to drive the AnnotationRoutingStrategy
@interface CustomRoutingAnnotation {
}
// Constructs a AnnotationRoutingStrategy with a different annotation and fallback:
public RoutingStrategy routingStrategy() {
    return AnnotationRoutingStrategy.builder()
                                    .annotationType(CustomRoutingAnnotation.class)
                                    .fallbackRoutingStrategy(UnresolvedRoutingKeyPolicy.STATIC_KEY)
                                    .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="MetaDataRoutingStrategy" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Constructs a MetaDataRoutingStrategy with the defined meta data key and a different fallback:
public RoutingStrategy routingStrategy() {
    return MetaDataRoutingStrategy.builder()
                                  .metaDataKey("my-routing-key")
                                  .fallbackRoutingStrategy(UnresolvedRoutingKeyPolicy.RANDOM_KEY)
                                  .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="paragraph">
<p>Of course, a custom implementation of the <code>RoutingStrategy</code> can also be provided when necessary.
When we need to deviate from the default <code>AnnotationRoutingStrategy</code>, we should configure it like so:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AxonConfig {
    // omitting other configuration methods...
    public void configureRoutingStrategy(Configurer configurer, YourRoutingStrategy yourRoutingStrategy) {
        configurer.registerComponent(RoutingStrategy.class, config -&gt; yourRoutingStrategy);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // omitting other configuration methods...
    @Bean
    public RoutingStrategy routingStrategy() {
        return /* construct your routing strategy */;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
</div>
<div class="sect2">
<h3 id="_axonservercommandbus"><a class="anchor" href="#_axonservercommandbus"></a>AxonServerCommandBus</h3>
<div class="paragraph">
<p>The <code>AxonServerCommandBus</code> is the <em>default</em> distributed <code>CommandBus</code> implementation that is set by the framework.
It connects to <a href="../../axon-server-introduction.html" class="xref page">AxonServer</a>, with which it can send and receive commands.</p>
</div>
<div class="paragraph">
<p>As it is the default, configuring it is relatively straightforward:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %} Declare dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">&lt;!-- somewhere in the POM file... --&gt;
&lt;dependencyManagement&gt;
    &lt;!-- amongst the dependencies... --&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
            &lt;artifactId&gt;axon-bom&lt;/artifactId&gt;
            &lt;version&gt;${version.axon}&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;!-- ... --&gt;
&lt;/dependencyManagement&gt;
&lt;!-- ... --&gt;
&lt;dependencies&gt;
    &lt;!-- amongst the dependencies... --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
        &lt;artifactId&gt;axon-server-connector&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
        &lt;artifactId&gt;axon-configuration&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!-- ... --&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// The AxonServerCommandBus is configured as Command Bus by default when constructing a DefaultConfigurer.
Configurer configurer = DefaultConfigurer.defaultConfiguration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %} By simply including the <code>axon-spring-boot-starter</code> dependency, Axon will automatically configure the <code>AxonServerCommandBus</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">&lt;!--somewhere in the POM file--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.axonframework&lt;/groupId&gt;
    &lt;artifactId&gt;axon-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;${axon.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Disabling Axon Server</strong></p>
</div>
<div class="paragraph">
<p>There are two options to disable Axon Framework&#8217;s default of using the <code>AxonServerCommandBus</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By excluding the <code>axon-server-connector</code> dependency.</p>
</li>
<li>
<p>By setting <code>axon.server.enabled</code> to <code>false</code> when Spring Boot is used.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When doing any of these, Axon will fallback to the <strong>un</strong>distributed <a href="infrastructure.md#simplecommandbus"><code>SimpleCommandBus</code></a>, unless configured otherwise.</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="_local_segment_and_load_factor_configuration"><a class="anchor" href="#_local_segment_and_load_factor_configuration"></a>Local Segment and Load Factor Configuration</h4>
<div class="paragraph">
<p>The <a href="#load-factor">load factor</a> for the <code>AxonServerCommandBus</code> is defined through the <code>CommandLoadFactorProvider</code>.
This interface allows us to distinguish between commands to, for example, use a different load factor per command message.
This might be useful if some commands are routed more often towards one instance in favour of the other.</p>
</div>
<div class="paragraph">
<p>The following should be done to configure a custom <a href="#local-segment">local segment</a> and/or load factor:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Axon Configuration API" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Somewhere in the configuration class
public CommandBus axonServerCommandBus(CommandBus localSegment,
                                       CommandLoadFactorProvider loadFactorProvider,
                                       ...) {
    return AxonServerCommandBus.builder()
                               .localSegment(localSegment)
                               .targetContextResolver(targetContextResolver)
                               // All required configuration components are specified in the JavaDoc of the Builder
                               .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="Spring Boot AutoConfiguration" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class AxonConfig {
    // The Qualifier annotation specifying "localSegment" will make this CommandBus the local segment
    @Bean
    @Qualifier("localSegment")
    public CommandBus localSegment() {

        return /* construct your local segment */;
    }

    @Bean
    public CommandLoadFactorProvider loadFactorProvider() {
      return /* construct your load factor provider */;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_distributedcommandbus"><a class="anchor" href="#_distributedcommandbus"></a>DistributedCommandBus</h3>
<div class="paragraph">
<p>The alternative to the <a href="#axonservercommandbus"><code>AxonServerCommandBus</code></a> is the <code>DistributedCommandBus</code>.
Each instance of the <code>DistributedCommandBus</code> on each JVM is referred to as a "Segment".</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="../../.gitbook/assets/distributed-command-bus.png" alt="Structure of the Distributed Command Bus">
</div>
</div>
<div class="paragraph">
<p>The <code>DistributedCommandBus</code> relies on two components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>CommandBusConnector</code> - implements the communication protocol between the JVM&#8217;s to send the command over the wire and to receive the response.</p>
</li>
<li>
<p>The <code>CommandRouter</code> - chooses the destination for each incoming command.
It defines which segment of the <code>DistributedCommandBus</code> should be given a command, based on a routing key calculated by the <a href="#routing-strategy">routing strategy</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can choose different flavors of these components that are available as extension modules.
Currently, Axon provides two extensions to that end, which are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <a href="../../extensions/spring-cloud.html" class="xref page">SpringCloud</a> extension</p>
</li>
<li>
<p>The <a href="../../extensions/jgroups.html" class="xref page">JGroups</a> extension</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configuring a distributed command bus can (mostly) be done without any modifications in configuration files.
The most straightforward approach to this is to include the Spring Boot starter dependency of either the Spring Cloud or JGroups extension.
With that in place, a single property needs to be added to the application context, to enable the <code>DistributedCommandBus</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">axon.distributed.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended to visit the respective extension pages on how to configure JGroups or Spring Cloud for the <code>DistributedCommandBus</code>.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="command-handlers.html">Command Handlers</a></span>
  <span class="next"><a href="configuration.html">Configuration</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
