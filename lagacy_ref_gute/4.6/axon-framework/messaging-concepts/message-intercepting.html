<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Message Intercepting :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="message-correlation.html">
    <link rel="next" href="supported-parameters-annotated-handlers.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework-commands/modeling/README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework-commands/modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework-commands/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../events/event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/jgroups.html">JGroups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../extensions/reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../extensions/reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../extensions/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../README.html">Axon Legacy Reference Guide</a></li>
    <li>Axon Framework</li>
    <li><a href="README.html">Messaging Concepts</a></li>
    <li><a href="message-intercepting.html">Message Intercepting</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/axon-framework/messaging-concepts/message-intercepting.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Message Intercepting</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>There are two different types of interceptors: dispatch interceptors and handler interceptors.
Dispatch interceptors are invoked before a message is dispatched to a message handler.
At that point, it may not even be known that a handler exists for that message.
Handler interceptors are invoked just before the message handler is invoked.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_interceptors"><a class="anchor" href="#_command_interceptors"></a>Command Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the advantages of using a command bus is the ability to undertake action based on all incoming commands.
Examples are logging or authentication, which you might want to do regardless of the type of command.
This is done using Interceptors.</p>
</div>
<div class="sect2">
<h3 id="_command_dispatch_interceptors"><a class="anchor" href="#_command_dispatch_interceptors"></a>Command Dispatch Interceptors</h3>
<div class="paragraph">
<p>Message dispatch interceptors are invoked when a command is dispatched on a command bus.
They have the ability to alter the command message by adding metadata.
They can also block the command by throwing an exception.
These interceptors are always invoked on the thread that dispatches the command.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a <code>MessageDispatchInterceptor</code> which logs each command message being dispatched on a <code>CommandBus</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyCommandDispatchInterceptor implements MessageDispatchInterceptor&lt;CommandMessage&lt;?&gt;&gt; {

    private static final Logger LOGGER = LoggerFactory.getLogger(MyCommandDispatchInterceptor.class);

    @Override
    public BiFunction&lt;Integer, CommandMessage&lt;?&gt;, CommandMessage&lt;?&gt;&gt; handle(List&lt;? extends CommandMessage&lt;?&gt;&gt; messages) {
        return (index, command) -&gt; {
            LOGGER.info("Dispatching a command {}.", command);
            return command;
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can register this dispatch interceptor with a <code>CommandBus</code> by doing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CommandBusConfiguration {

    public CommandBus configureCommandBus() {
        CommandBus commandBus = SimpleCommandBus.builder().build();
        commandBus.registerDispatchInterceptor(new MyCommandDispatchInterceptor());
        return commandBus;
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_structural_validation"><a class="anchor" href="#_structural_validation"></a>Structural validation</h4>
<div class="paragraph">
<p>There is no point in processing a command if it does not contain all required information in the correct format.
In fact, a command that lacks information should be blocked as early as possible, preferably even before a transaction has been started.
Therefore, an interceptor should check all incoming commands for the availability of such information.
This is called structural validation.</p>
</div>
<div class="paragraph">
<p>Axon Framework has support for JSR 303 Bean Validation based validation.
This allows you to annotate the fields on commands with annotations like <code>@NotEmpty</code> and <code>@Pattern</code>.
You need to include a JSR 303 implementation (such as Hibernate-Validator) on your classpath.
Then, configure a <code>BeanValidationInterceptor</code> on your command bus, and it will automatically find and configure your validator implementation.
While it uses sensible defaults, you can fine-tune it to your specific needs.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Interceptor Ordering Tip</strong></p>
</div>
<div class="paragraph">
<p>You want to spend as few resources on an invalid command as possible.
Therefore, this interceptor is generally placed at the very front of the interceptor chain.
In some cases, a <code>LoggingInterceptor</code> or <code>AuditingInterceptor</code> might need to be placed first, with the validating interceptor immediately following it.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The <code>BeanValidationInterceptor</code> also implements <code>MessageHandlerInterceptor</code>, allowing you to configure it as a handler interceptor as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command_handler_interceptors"><a class="anchor" href="#_command_handler_interceptors"></a>Command Handler Interceptors</h3>
<div class="paragraph">
<p>Message handler interceptors can take action both before and after command processing.
Interceptors can even block command processing altogether, for example for security reasons.</p>
</div>
<div class="paragraph">
<p>Interceptors must implement the <code>MessageHandlerInterceptor</code> interface.
This interface declares one method, <code>handle</code>, that takes two parameters: the current <code>UnitOfWork</code> and an <code>InterceptorChain</code>.
The <code>InterceptorChain</code> is used to continue the dispatching process.
The <code>UnitOfWork</code> gives you (1) the message being handled and (2) provides the possibility to tie in logic prior, during or after (command) message handling (see <a href="unit-of-work.html" class="xref page">Unit Of Work</a> for more information about the phases).</p>
</div>
<div class="paragraph">
<p>Unlike dispatch interceptors, handler interceptors are invoked in the context of the command handler.
That means they can attach correlation data based on the message being handled to the unit of work, for example.
This correlation data will then be attached to messages being created in the context of that unit of work.</p>
</div>
<div class="paragraph">
<p>Handler interceptors are also typically used to manage transactions around the handling of a command.
To do so, register a <code>TransactionManagingInterceptor</code>, which in turn is configured with a <code>TransactionManager</code> to start and commit (or roll back) the actual transaction.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a Message Handler Interceptor which will only allow the handling of commands that contain <code>axonUser</code> as a value for the <code>userId</code> field in the <code>MetaData</code>.
If the <code>userId</code> is not present in the metadata, an exception will be thrown which will prevent the command from being handled.
Additionally, if the value of <code>userId</code> does not match <code>axonUser</code>, we will also not proceed up the chain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyCommandHandlerInterceptor implements MessageHandlerInterceptor&lt;CommandMessage&lt;?&gt;&gt; {

    @Override
    public Object handle(UnitOfWork&lt;? extends CommandMessage&lt;?&gt;&gt; unitOfWork, InterceptorChain interceptorChain) throws Exception {
        CommandMessage&lt;?&gt; command = unitOfWork.getMessage();
        String userId = Optional.ofNullable(command.getMetaData().get("userId"))
                                .map(uId -&gt; (String) uId)
                                .orElseThrow(IllegalCommandException::new);
        if ("axonUser".equals(userId)) {
            return interceptorChain.proceed();
        }
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can register the handler interceptor with a <code>CommandBus</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CommandBusConfiguration {

    public CommandBus configureCommandBus() {
        CommandBus commandBus = SimpleCommandBus.builder().build();
        commandBus.registerHandlerInterceptor(new MyCommandHandlerInterceptor());
        return commandBus;
    }

}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_commandhandlerinterceptor_annotation"><a class="anchor" href="#_commandhandlerinterceptor_annotation"></a><code>@CommandHandlerInterceptor</code> Annotation</h4>
<div class="paragraph">
<p>The framework has the ability to add a Handler Interceptor as a <code>@CommandHandlerInterceptor</code> annotated method on the Aggregate/Entity.
The difference between a method on an Aggregate and a "<a href="message-intercepting.md#command-handler-interceptors">regular</a>" Command Handler Interceptor, is that with the annotation approach you can make decisions based on the current state of the given Aggregate.
Some properties of an annotated Command Handler Interceptor are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The annotation can be put on entities within the Aggregate.</p>
</li>
<li>
<p>It is possible to intercept a command on Aggregate Root level, whilst the command handler is in a child entity.</p>
</li>
<li>
<p>Command execution can be prevented by firing an exception from an annotated command handler interceptor.</p>
</li>
<li>
<p>It is possible to define an <code>InterceptorChain</code> as a parameter of the command handler interceptor method and use it to control command execution.</p>
</li>
<li>
<p>By using the <code>commandNamePattern</code> attribute of the <code>@CommandHandlerInterceptor</code> annotation we can intercept all commands matching the provided regular expression.</p>
</li>
<li>
<p>Events can be applied from an annotated command handler interceptor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example below we can see a <code>@CommandHandlerInterceptor</code> annotated method which prevents command execution if a command&#8217;s <code>state</code> field does not match the Aggregate&#8217;s <code>state</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GiftCard {
    //..
    private String state;
    //..
    @CommandHandlerInterceptor
    public void intercept(RedeemCardCommand command, InterceptorChain interceptorChain) {
        if (this.state.equals(command.getState())) {
            interceptorChain.proceed();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>@CommandHandlerInterceptor</code> is essentially a more specific implementation of the <code>@MessageHandlerInterceptor</code> described <a href="#messagehandlerinterceptor">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event_interceptors"><a class="anchor" href="#_event_interceptors"></a>Event Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to command messages, event messages can also be intercepted prior to publishing and handling to perform additional actions on all events.
This boils down to the same two types of interceptors for messages: the dispatch interceptor and the handler interceptor.</p>
</div>
<div class="sect2">
<h3 id="_event_dispatch_interceptors"><a class="anchor" href="#_event_dispatch_interceptors"></a>Event Dispatch Interceptors</h3>
<div class="paragraph">
<p>Any message dispatch interceptors registered to an event bus will be invoked when an event is published.
They have the ability to alter the event message by adding metadata.
They can also provide you with overall logging capabilities for when an event is published.
These interceptors are always invoked on the thread that published the event.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create an event message dispatch interceptor which logs each event message being published on an <code>EventBus</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EventLoggingDispatchInterceptor
                implements MessageDispatchInterceptor&lt;EventMessage&lt;?&gt;&gt; {

    private static final Logger logger =
                LoggerFactory.getLogger(EventLoggingDispatchInterceptor.class);

    @Override
    public BiFunction&lt;Integer, EventMessage&lt;?&gt;, EventMessage&lt;?&gt;&gt; handle(
                List&lt;? extends EventMessage&lt;?&gt;&gt; messages) {
        return (index, event) -&gt; {
            logger.info("Publishing event: [{}].", event);
            return event;
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then register this dispatch interceptor with an <code>EventBus</code> by doing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EventBusConfiguration {

    public EventBus configureEventBus(EventStorageEngine eventStorageEngine) {
        // note that an EventStore is a more specific implementation of an EventBus
        EventBus eventBus = EmbeddedEventStore.builder()
                                              .storageEngine(eventStorageEngine)
                                              .build();
        eventBus.registerDispatchInterceptor(new EventLoggingDispatchInterceptor());
        return eventBus;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_handler_interceptors"><a class="anchor" href="#_event_handler_interceptors"></a>Event Handler Interceptors</h3>
<div class="paragraph">
<p>Message handler interceptors can take action both before and after event processing.
Interceptors can even block event processing altogether, for example for security reasons.</p>
</div>
<div class="paragraph">
<p>Interceptors must implement the <code>MessageHandlerInterceptor</code> interface.
This interface declares one method, <code>handle()</code>, that takes two parameters: the current <code>UnitOfWork</code> and an <code>InterceptorChain</code>.
The <code>InterceptorChain</code> is used to continue the dispatching process.
The <code>UnitOfWork</code> gives you (1) the message being handled and (2) provides the possibility to tie in logic prior, during or after (event) message handling (see <a href="unit-of-work.html" class="xref page">Unit Of Work</a> for more information about the phases).</p>
</div>
<div class="paragraph">
<p>Unlike dispatch interceptors, handler interceptors are invoked in the context of the event handler.
That means they can attach correlation data based on the message being handled to the unit of work, for example.
This correlation data will then be attached to event messages being created in the context of that unit of work.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a message handler interceptor which will only allow the handling of events that contain <code>axonUser</code> as the value for the <code>userId</code> field in the <code>MetaData</code>.
If the <code>userId</code> is not present in the metadata, an exception will be thrown which will prevent the Event from being handled.
And if the value of <code>userId</code> does not match <code>axonUser</code>, we will also not proceed up the chain.
Authenticating the event message like shown in this example is a regular use case of the <code>MessageHandlerInterceptor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyEventHandlerInterceptor
        implements MessageHandlerInterceptor&lt;EventMessage&lt;?&gt;&gt; {

    @Override
    public Object handle(UnitOfWork&lt;? extends EventMessage&lt;?&gt;&gt; unitOfWork,
                         InterceptorChain interceptorChain) throws Exception {
        EventMessage&lt;?&gt; event = unitOfWork.getMessage();
        String userId = Optional.ofNullable(event.getMetaData().get("userId"))
                                .map(uId -&gt; (String) uId)
                                .orElseThrow(IllegalEventException::new);
        if ("axonUser".equals(userId)) {
            return interceptorChain.proceed();
        }
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can register the handler interceptor with an <code>EventProcessor</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EventProcessorConfiguration {

    public void configureEventProcessing(Configurer configurer) {
        configurer.eventProcessing()
                  .registerTrackingEventProcessor("my-tracking-processor")
                  .registerHandlerInterceptor("my-tracking-processor",
                                              configuration -&gt; new MyEventHandlerInterceptor());
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Interceptor Registration</strong></p>
</div>
<div class="paragraph">
<p>Different from the <code>CommandBus</code> and <code>QueryBus</code>, which both can have handler interceptors and dispatch interceptors, the <code>EventBus</code> can only register dispatch interceptors.
This is because the sole purpose of the <code>EventBus</code> is event publishing/dispatching, thus they are where event dispatch interceptors are registered.
<code>EventProcessor</code>s are in charge of handling event messages, thus they are where event handler interceptors are registered.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_interceptors"><a class="anchor" href="#_query_interceptors"></a>Query Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the advantages of using a query bus is the ability to undertake action based on all incoming queries.
Examples are logging or authentication, which you might want to do regardless of the type of query.
This is done using interceptors.</p>
</div>
<div class="sect2">
<h3 id="_query_dispatch_interceptors"><a class="anchor" href="#_query_dispatch_interceptors"></a>Query Dispatch Interceptors</h3>
<div class="paragraph">
<p>Message dispatch interceptors are invoked when a query is dispatched on a query bus or when a subscription update to a query message is dispatched on a query update emitter.
They have the ability to alter the message by adding metadata.
They can also block the handler execution by throwing an exception.
These interceptors are always invoked on the thread that dispatches the message.</p>
</div>
<div class="sect3">
<h4 id="_structural_validation_2"><a class="anchor" href="#_structural_validation_2"></a>Structural validation</h4>
<div class="paragraph">
<p>There is no point in processing a query if it does not contain all required information in the correct format.
In fact, a query that lacks information should be blocked as early as possible.
Therefore, an interceptor should check all incoming queries for the availability of such information.
This is called structural validation.</p>
</div>
<div class="paragraph">
<p>Axon Framework has support for JSR 303 Bean Validation based validation.
This allows you to annotate the fields on queries with annotations like <code>@NotEmpty</code> and <code>@Pattern</code>.
You need to include a JSR 303 implementation (such as Hibernate-Validator) on your classpath.
Then, configure a <code>BeanValidationInterceptor</code> on your query bus, and it will automatically find and configure your validator implementation.
While it uses sensible defaults, you can fine-tune it to your specific needs.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Interceptor Ordering Tip</strong></p>
</div>
<div class="paragraph">
<p>You want to spend as few resources on an invalid queries as possible.
Therefore, this interceptor is generally placed at the very front of the interceptor chain.
In some cases, a logging or auditing interceptor might need to be placed first, with the validating interceptor immediately following it.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The <code>BeanValidationInterceptor</code> also implements <code>MessageHandlerInterceptor</code>, allowing you to configure it as a handler interceptor as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_handler_interceptors"><a class="anchor" href="#_query_handler_interceptors"></a>Query Handler Interceptors</h3>
<div class="paragraph">
<p>Message handler interceptors can take action both before and after query processing.
Interceptors can even block query processing altogether, for example for security reasons.</p>
</div>
<div class="paragraph">
<p>Interceptors must implement the <code>MessageHandlerInterceptor</code> interface.
This interface declares one method, <code>handle</code>, that takes two parameters: the current <code>UnitOfWork</code> and an <code>InterceptorChain</code>.
The <code>InterceptorChain</code> is used to continue the dispatching process.
The <code>UnitOfWork</code> gives you (1) the message being handled and (2) provides the possibility to tie in logic prior, during or after (query) message handling (see<a href="unit-of-work.html" class="xref page">Unit Of Work</a>for more information about the phases).</p>
</div>
<div class="paragraph">
<p>Unlike dispatch interceptors, handler interceptors are invoked in the context of the query handler.
That means they can attach correlation data based on the message being handled to the unit of work, for example.
This correlation data will then be attached to messages being created in the context of that unit of work.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_messagehandlerinterceptor"><a class="anchor" href="#_messagehandlerinterceptor"></a>@MessageHandlerInterceptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alongside defining overall <code>MessageHandlerInterceptor</code> instances on the component handling a message (e.g.
a command, query or event), it is also possible to define a handler interceptor for a specific component containing the handlers.
This can be achieved by adding a method handling the message, combined with the <code>@MessageHandlerInterceptor</code> annotation.
Adding such a method allows you more fine-grained control over which message handling components should react and how these should react.</p>
</div>
<div class="paragraph">
<p>Several handles are given to you when it comes to adding the <code>@MessageHandlerInterceptor</code>, like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>MessageHandlerInterceptor</code> instances work with the <code>InterceptorChain</code> to decide when to proceed with other interceptors in the chain.
The <code>InterceptorChain</code> is an <em>optional</em> parameter which can be added to the intercepting method to provide you with the same control.
In absence of this parameter, the framework will call <code>InterceptorChain#proceed</code> once the method is exited.</p>
</li>
<li>
<p>You can define the type of <code>Message</code> the interceptor should deal with.
By default, it reacts to any <code>Message</code> implementation.
If an <code>EventMessage</code> specific interceptor is desired, the <code>messageType</code> parameter on the annotation should be set to <code>EventMessage.class</code>.</p>
</li>
<li>
<p>For even more fine-grained control of which messages should react to the interceptor, the <code>payloadType</code> contained in the <code>Message</code> to handle can be specified.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following snippets shows some possible approaches of using the <code>@MessageHandlerInterceptor</code> annotation:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Simple @MessageHandlerInterceptor method" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CardSummaryProjection {
    /*
     * Some @EventHandler and @QueryHandler annotated methods
     */
    @MessageHandlerInterceptor
    public void intercept(Message&lt;?&gt; message) {
        // Add your intercepting logic here based on the
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="@MessageHandlerInterceptor method defining the Message type" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CardSummaryProjection {
    /*
     * Some @EventHandler and @QueryHandler annotated methods
     */
    @MessageHandlerInterceptor(messageType = EventMessage.class)
    public void intercept(EventMessage&lt;?&gt; eventMessage) {
        // Add your intercepting logic here based on the
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% tab title="@MessageHandlerInterceptor method defining the Message and payload type" %}</p>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CardSummaryProjection {
    /*
     * Some @EventHandler and @QueryHandler annotated methods
     */
    @MessageHandlerInterceptor(
        messageType = EventMessage.class,
        payloadType = CardRedeemedEvent.class
    )
    public void intercept(CardRedeemedEvent event) {
        // Add your intercepting logic here based on the
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %}</p>
</div>
<div class="paragraph">
<p>{% tab title="@MessageHandlerInterceptor method defining an InterceptorChain parameter" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CardSummaryProjection {
    /*
     * Some @EventHandler and @QueryHandler annotated methods
     */
    @MessageHandlerInterceptor(messageType = QueryMessage.class)
    public void intercept(QueryMessage&lt;?, ?&gt; queryMessage,
                          InterceptorChain interceptorChain) throws Exception {
        // Add your intercepting logic before
        interceptorChain.proceed();
        // or after the InterceptorChain#proceed invocation
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="paragraph">
<p>Next to the message, payload and <code>InterceptorChain</code>, a <code>@MessageHandlerInterceptor</code> annotated method can resolve other parameters as well.
Which parameters the framework can resolve on such a function, is based on the type of <code>Message</code> being handled by the interceptor.
For more specifics on which parameters are resolvable for the <code>Message</code> being handled, take a look at <a href="supported-parameters-annotated-handlers.html" class="xref page">this</a> page.</p>
</div>
<div class="sect2">
<h3 id="_exceptionhandler"><a class="anchor" href="#_exceptionhandler"></a>@ExceptionHandler</h3>
<div class="paragraph">
<p>The <code>@MessageHandlerInterceptor</code> also allows for a more specific version of an intercepting function.
Namely, an <code>@ExceptionHandler</code> annotated method.</p>
</div>
<div class="paragraph">
<p>The framework invokes <code>@ExceptionHandler</code> annotated methods <em>only</em> for exceptional results of message handling.
Using exception handlers like this, for example, allows you to throw more domain-specific exceptions as a result of a thrown database/service exception.
Or, you can catch an aggregate-specific exception and translate it to a generic error code.</p>
</div>
<div class="paragraph">
<p>To Axon, an exception handler is just like any other message handling method.
You can thus wire all <a href="supported-parameters-annotated-handlers.html" class="xref page">default parameters</a> to an exception handler, similar to command, event, and query handlers.
Hence, you can add the exception, payload, <code>MetaData</code>, and other options to the <code>@ExceptionHandler</code> annotated function.</p>
</div>
<div class="paragraph">
<p>You can introduce <code>@ExceptionHandler</code> annotated methods in any message handling component.
Furthermore, you can choose to react to all exceptions or define specific exception/message combinations to which the handler should respond.
Check the following samples for some snippets on how to use this:</p>
</div>
<div class="paragraph">
<p>{% tabs %} {% tab title="Aggregate Exception Handlers" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class GiftCard {

    // State, command handlers and event sourcing handlers omitted for brevity

    @ExceptionHandler
    public void handleAll(Exception exception) {
        // Handles all exceptions thrown within this component generically
    }

    @ExceptionHandler
    public void handleIssueCardExceptions(IssueCardCommand command) {
        // Handles all exceptions thrown from the IssueCardCommand handler within this component
    }

    @ExceptionHandler(payloadType = IssueCardCommand.class)
    public void handleIssueCardExceptions() {
        // Handles all exceptions thrown from the IssueCardCommand handler within this component
    }

    @ExceptionHandler
    public void handleIllegalStateExceptions(IllegalStateException exception) {
        // Handles all IllegalStateExceptions thrown within this component
    }

    @ExceptionHandler(resultType = IllegalStateException.class)
    public void handleIllegalStateExceptions(Exception exception) {
        // Handles all IllegalStateExceptions thrown within this component
    }

    @ExceptionHandler
    public void handleIllegalStateExceptionsFromIssueCard(IssueCardCommand command,
                                                          IllegalStateException exception) {
        // Handles all IllegalStateExceptions thrown from the IssueCardCommand handler within this component
    }

    @ExceptionHandler(resultType = IllegalStateException.class, payloadType = IssueCardCommand.class)
    public void handleIllegalStateExceptionsFromIssueCard() {
        // Handles all IllegalStateExceptions thrown from the IssueCardCommand handler within this component
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% tab title="Projector Exception Handlers" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class CardSummaryProjection {

    // Repositories/Services, event handlers and query handlers omitted for brevity

    @ExceptionHandler
    public void handleAll(Exception exception) {
        // Handles all exceptions thrown within this component generically
    }

    @ExceptionHandler
    public void handleFindCardQueryExceptions(FindCardQuery query) {
        // Handles all exceptions thrown from the FindCardQuery handler within this component
    }

    @ExceptionHandler(payloadType = FindCardQuery.class)
    public void handleFindCardQueryExceptions() {
        // Handles all exceptions thrown from the FindCardQuery handler within this component
    }

    @ExceptionHandler
    public void handleIllegalArgumentExceptions(IllegalArgumentException exception) {
        // Handles all IllegalArgumentExceptions thrown within this component
    }

    @ExceptionHandler(resultType = IllegalArgumentException.class)
    public void handleIllegalArgumentExceptions(Exception exception) {
        // Handles all IllegalArgumentExceptions thrown within this component
    }

    @ExceptionHandler
    public void handleIllegalArgumentExceptionsFromCardIssued(CardIssuedEvent event,
                                                              IllegalArgumentException exception) {
        // Handles all IllegalArgumentExceptions thrown from the CardIssuedEvent handler within this component
    }

    @ExceptionHandler(resultType = IllegalArgumentException.class, payloadType = CardIssuedEvent.class)
    public void handleIllegalArgumentExceptionsFromCardIssued() {
        // Handles all IllegalArgumentExceptions thrown from the CardIssuedEvent handler within this component
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endtab %} {% endtabs %}</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Exception Handling for Aggregate Constructors</strong></p>
</div>
<div class="paragraph">
<p>The <code>@ExceptionHandler</code> annotated methods require an existing component instance to work.
Because of this, exception handlers <strong>do not</strong> work for (command handling) constructors of an aggregate.</p>
</div>
<div class="paragraph">
<p>If you thus expect exceptions on an aggregate&#8217;s command handler that you need to handle differently, it is recommended to use Axon&#8217;s <a href="../axon-framework-commands/command-handlers.md#aggregate-command-handler-creation-policy">creation policy</a>.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="message-correlation.html">Message Correlation</a></span>
  <span class="next"><a href="supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
