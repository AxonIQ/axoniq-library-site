<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka :: ðŸ“š AxonIQ Library</title>
    <link rel="prev" href="jgroups.html">
    <link rel="next" href="kotlin.html">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">ðŸ“š AxonIQ Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Explanations</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../concepts/index.html">Software Development Concepts</a>
                <a class="navbar-item" href="../../../understanding-axon/index.html">Understanding Axon</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">References</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../axon_framework_ref/4.6/index.html">Axon Framework</a>
                <a class="navbar-item" href="../README.html">Axon Legacy Reference Guide</a>
                <a class="navbar-item" href="../../../axon_server_ref/4.6/index.html">Axon Server</a>
                <a class="navbar-item" href="../../../axoniq_cloud_ref/latest/index.html">AxonIQ Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Tutorials</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../giftcard/4.6/index.html">Axon Framework - from design to deployment</a>
                <a class="navbar-item" href="../../../as_admin/index.html">Axon Server Administration</a>
                <a class="navbar-item" href="../../../af_customization/4.6/index.html">Customizing Axon Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">How-to guides</a>
          <div class="navbar-dropdown">
                <a class="navbar-item" href="../../../ac_howtos/latest/index.html">AxonIQ Cloud Console How-to Guides</a>
          </div>
        </div>
        <a class="navbar-item" href="https://academy.axoniq.io" target="_blank">AxonIQ Academy</a>
        <a class="navbar-item" href="https://discuss.axoniq.io" target="_blank">Discuss</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lagacy_ref_gute" data-version="4.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../README.html">Axon Legacy Reference Guide</a></h3>

<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../README.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture-overview/README.html">Architecture Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture-overview/ddd-cqrs-concepts.html">DDD &amp; CQRS Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture-overview/event-sourcing.html">Event Sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture-overview/event-driven-microservices.html">Event-Driven Microservices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-server-introduction.html">Axon Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/README.html">Release Notes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-axon-framework/README.html">Axon Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/rn-axon-framework/rn-af-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/rn-axon-framework/rn-af-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-axon-server/README.html">Axon Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/rn-axon-server/rn-as-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/rn-axon-server/rn-asse-minor-releases.html">Minor Releases Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/rn-axon-server/rn-as-minor-releases.html">Minor Releases Enterprise Edition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/README.html">Axon Framework Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-amqp/README.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-amqp/rn-amqp-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-cdi/README.html">CDI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-cdi/rn-cdi-major-releases.html">Major Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-jgroups/README.html">JGroups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-jgroups/rn-jgroups-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-jgroups/rn-jgroups-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kafka/README.html">Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kafka/rn-kafka-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kafka/rn-kafka-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kotlin/README.html">Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kotlin/rn-kotlin-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-kotlin/rn-kotlin-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-mongo/README.html">Mongo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-mongo/rn-mongo-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-mongo/rn-mongo-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-multi-tenancy/README.html">Multi-Tenancy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-multi-tenancy/rn-multi-tenancy-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-reactor/README.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-reactor/rn-reactor-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-reactor/rn-reactor-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-spring-native/README.html">Spring-Native Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-spring-native/rn-spring-native-experimental-releases.html">Experimental Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-springcloud/README.html">Spring Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-springcloud/rn-springcloud-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-springcloud/rn-springcloud-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../release-notes/rn-extensions/rn-tracing/README.html">Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-tracing/rn-tracing-major-releases.html">Major Releases</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../release-notes/rn-extensions/rn-tracing/rn-tracing-minor-releases.html">Minor Releases</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started/quick-start.html">Quick Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Framework</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-framework/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/messaging-concepts/README.html">Messaging Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/anatomy-message.html">Anatomy of a Message</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/message-correlation.html">Message Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/message-intercepting.html">Message Intercepting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/supported-parameters-annotated-handlers.html">Supported Parameters for Annotated Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/exception-handling.html">Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/messaging-concepts/unit-of-work.html">Unit of Work</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/axon-framework-commands/README.html">Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/README.html">Modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/aggregate.html">Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/multi-entity-aggregates.html">Multi-Entity Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/state-stored-aggregates.html">State Stored Aggregates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/aggregate-creation-from-another-aggregate.html">Aggregate Creation from another Aggregate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/aggregate-polymorphism.html">Aggregate Polymorphism</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/modeling/conflict-resolution.html">Conflict Resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/command-dispatchers.html">Command Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/command-handlers.html">Command Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/infrastructure.html">Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/axon-framework-commands/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/events/README.html">Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/events/event-dispatchers.html">Event Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/events/event-handlers.html">Event Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/events/event-processors/README.html">Event Processors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/events/event-processors/subscribing.html">Subscribing Event Processors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-framework/events/event-processors/streaming.html">Streaming Event Processors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/events/event-bus-and-event-store.html">Event Bus &amp; Event Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/events/event-versioning.html">Event Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/queries/README.html">Queries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/queries/query-processing.html">Query Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/queries/query-dispatchers.html">Query Dispatchers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/queries/query-handlers.html">Query Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/queries/implementations.html">Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/queries/configuration.html">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/sagas/README.html">Sagas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/sagas/implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/sagas/associations.html">Associations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/sagas/infrastructure.html">Infrastructure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/deadlines/README.html">Deadlines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/deadlines/deadline-managers.html">Deadline Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/deadlines/event-schedulers.html">Event Schedulers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/testing/README.html">Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/testing/commands-events.html">Commands / Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/testing/sagas-1.html">Sagas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-framework/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/tuning/README.html">Tuning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/tuning/event-snapshots.html">Event Snapshots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/tuning/event-processing.html">Event Processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/tuning/command-processing.html">Command Processing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-framework/monitoring/README.html">Monitoring and Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/monitoring/tracing.html">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/monitoring/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/monitoring/health.html">Health Indicators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/monitoring/processors.html">Event Tracker Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-framework/monitoring/message-tracking.html">Message Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-framework/spring-boot-integration.html">Spring Boot Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-framework/modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Axon Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../axon-server/introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/installation/README.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/installation/local-installation/README.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/installation/local-installation/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/installation/local-installation/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/installation/docker-k8s/README.html">Docker / K8s</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/installation/docker-k8s/axon-server-se.html">Axon Server SE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/installation/docker-k8s/axon-server-ee.html">Axon Server EE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/administration/README.html">Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/administration/admin-configuration/README.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/admin-configuration/configuration.html">System Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/admin-configuration/command-line-interface.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/admin-configuration/rest-api.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/admin-configuration/grpc-api.html">GRPC API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/administration/monitoring/README.html">Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/monitoring/actuator-endpoints.html">Actuator Endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/monitoring/grpc-metrics.html">gRPC Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/monitoring/heartbeat-monitoring.html">Heartbeat Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/clustering.html">Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/replication-groups.html">Replication Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/multi-context.html">Multi-Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/tagging.html">Tagging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/backup-and-messaging-only-nodes.html">Backup and Messaging-only Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/recovery.html">Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/administration/logging/README.html">Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../axon-server/administration/logging/logging-format.html">Logging Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/administration/error-codes.html">Error Codes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/security/README.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/ssl.html">SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-se.html">Access Control - Standard Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-ee.html">Access Control - Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-clients.html">Access Control - Client Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-cli.html">Access Control - CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-api.html">Access Control - API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-ldap.html">Access Control - LDAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/security/access-control-oauth2.html">Access Control - OAuth 2.0</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/performance/README.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/performance/tuning-event-processing.html">Event Segments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/performance/flow-control.html">Flow Control</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../axon-server/migration/README.html">Migration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/migration/standard-to-enterprise-edition.html">Standard to Enterprise Edition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../axon-server/migration/non-axon-server-to-axon-server.html">Non-Axon Server to Axon Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring-amqp.html">Spring AMQP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jgroups.html">JGroups</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="kafka.html">Kafka</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="mongo.html">Mongo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="reactor/reactor.html">Reactor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reactor/reactive-gateways/reactive-gateways.html">Reactor Gateways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring-cloud.html">Spring Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/rdbms-tuning.html" class="xref page">A.
RDBMS Tuning</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/message-handler-tuning/README.html" class="xref page">B.
Message Handler Tuning</a></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendices/message-handler-tuning/parameter-resolvers.html">Parameter Resolvers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../appendices/message-handler-tuning/handler-enhancers.html">Handler Enhancers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/meta-annotations.html" class="xref page">C.
Meta Annotations</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="/lagacy_ref_gute/4.6/appendices/identifier-generation.html" class="xref page">D.
Identifier Generation</a></span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="#./appendices/query-reference.md.adoc" class="xref unresolved">E.
Axon Server Query Language</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../README.html">Axon Legacy Reference Guide</a></li>
    <li>Extensions</li>
    <li><a href="kafka.html">Kafka</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/azzazzel/axoniq-reference-guide/edit/kramdoc/modules/ROOT/pages/extensions/kafka.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Kafka</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Kafka is a very popular system for publishing and consuming events.
Its architecture is fundamentally different from most messaging systems and combines speed with reliability.</p>
</div>
<div class="paragraph">
<p>Axon provides an extension dedicated to <em>publishing</em> and <em>receiving</em> event messages from Kafka.
The Kafka Extension should be regarded as an alternative approach to distributing events, besides (the default) Axon Server.
It&#8217;s also possible to use the extension to stream events from Kafka to Axon server, or the other way around.</p>
</div>
<div class="paragraph">
<p>The implementation of the extension can be found <a href="https://github.com/AxonFramework/extension-kafka">here</a>.
The shared repository also contains a <a href="https://github.com/AxonFramework/extension-kafka/tree/master/kafka-axon-example">sample project</a> using the extension.</p>
</div>
<div class="paragraph">
<p>To use the Kafka Extension components from Axon, make sure the <code>axon-kafka</code> module is available on the classpath.
Using the extension requires setting up and configuring Kafka following your project&#8217;s requirements.
How this is achieved is outside of the scope of this reference guide and should be found in Kafka&#8217;s <a href="https://kafka.apache.org/">documentation</a>.</p>
</div>
<div class="paragraph">
<p>{% hint style="info" %} Note that Kafka is a perfectly fine event distribution mechanism, but it is not an event store.
Along those lines this extension <strong>only</strong> provides the means to distributed Axon&#8217;s events through Kafka.
Due to this the extension cannot be used to event source aggregates, as this requires an event store implementation.
We recommend using a built-for-purpose event store like <a href="../axon-server-introduction.html" class="xref page">Axon Server</a>, or alternatively an RDBMS based (the JPA or JDBC implementations for example).
{% endhint %}</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_events_to_kafka"><a class="anchor" href="#_publishing_events_to_kafka"></a>Publishing Events to Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Event Messages are published to an Event Bus (or Event Store), they can be forwarded to a Kafka topic using the <code>KafkaPublisher</code>.
To achieve this it will utilize a Kafka <code>Producer</code>, retrieved through Axon&#8217;s <code>ProducerFactory</code>.
The <code>KafkaPublisher</code> in turn receives the events to publish from a <code>KafkaEventPublisher</code>.</p>
</div>
<div class="paragraph">
<p>Since the <code>KafkaEventPublisher</code> is an event message handler in Axon terms, we can provide it to any <a href="../axon-framework/events/event-processors/README.html" class="xref page">Event Processor</a> to receive the published events.
The choice of event processor which brings differing characteristics for event publication to Kafka:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Subscribing Event Processor</strong> - publication of messages to Kafka will occur in the same thread (and Unit of Work) which published the events to the event bus.
This approach ensures failure to publish to Kafka enforces failure of the initial event publication on the event bus</p>
</li>
<li>
<p><strong>Tracking Event Processor</strong> - publication of messages to Kafka is run in a different thread (and Unit of Work) than the one which published the events to the event bus.
This approach ensures the event has been published on the event bus regardless of whether publication to Kafka works</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When setting up event publication it is also important to take into account which <code>ConfirmationMode</code> is used.
The <code>ConfirmationMode</code> influences the process of actually producing an event message on a Kafka topic, but also what kind of <code>Producer</code> the <code>ProducerFactory</code> will instantiate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>TRANSACTIONAL</strong> - This will require the <code>Producer</code> to start, commit and (in case of failure) rollback the transaction of publishing an event message.
Alongside this, it will create a pool of <code>Producer</code> instances in the <code>ProducerFactory</code> to avoid continuous creation of new ones, requiring the user to provide a "transactional id prefix" to uniquely identify every <code>Producer</code> in the pool.</p>
</li>
<li>
<p><strong>WAIT_FOR_ACK</strong> - Setting "WAIT_FOR_ACK" as the <code>ConfirmationMode</code> will require the <code>Producer</code> instance to wait for a default of 1 second (configurable on the <code>KafkaPublisher</code>) until the event message publication has been acknowledged.
Alongside this, it will create a single, shareable <code>Producer</code> instance from within the <code>ProducerFactory</code>.</p>
</li>
<li>
<p><strong>NONE</strong> - This is the <em>default</em> mode, which only ensures a single, shareable <code>Producer</code> instance from within the <code>ProducerFactory</code>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuring_event_publication_to_kafka"><a class="anchor" href="#_configuring_event_publication_to_kafka"></a>Configuring Event Publication to Kafka</h3>
<div class="paragraph">
<p>It is a several step process to configure Event publication to Kafka, which starts with the <code>ProducerFactory</code>.
Axon provides the <code>DefaultProducerFactory</code> implementation of the <code>ProducerFactory</code>, which should be instantiated through the provided <code>DefaultProducerFactory.Builder</code>.</p>
</div>
<div class="paragraph">
<p>The builder has one hard requirement, which is the <code>Producer</code> configuration <code>Map</code>.
The <code>Map</code> contains the settings to use for the Kafka <code>Producer</code> client, such as the Kafka instance locations.
Please check the Kafka <a href="https://kafka.apache.org/">documentation</a> for the possible settings and their values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...
    public ProducerFactory&lt;String, byte[]&gt; producerFactory(Duration closeTimeout,
                                                           int producerCacheSize,
                                                           Map&lt;String, Object&gt; producerConfiguration,
                                                           ConfirmationMode confirmationMode,
                                                           String transactionIdPrefix) {
        return DefaultProducerFactory.&lt;String, byte[]&gt;builder()
                .closeTimeout(closeTimeout)                 // Defaults to "30" seconds
                .producerCacheSize(producerCacheSize)       // Defaults to "10"; only used for "TRANSACTIONAL" mode
                .configuration(producerConfiguration)       // Hard requirement
                .confirmationMode(confirmationMode)         // Defaults to a Confirmation Mode of "NONE"
                .transactionalIdPrefix(transactionIdPrefix) // Hard requirement when in "TRANSACTIONAL" mode
                .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second infrastructure component to introduce is the <code>KafkaPublisher</code>, which has a hard requirement on the <code>ProducerFactory</code>.
Additionally, this would be the place to define the Kafka topics upon which Axon event messages will be published.
You can set a function from event to <code>Optional&lt;String&gt;</code>.
You can use this to only publish certain events, or put different events to different topics.
Its not uncommon for Kafka topics to only contain one type of message.
Note that the <code>KafkaPublisher</code> needs to be <code>shutDown</code> properly, to ensure all <code>Producer</code> instances are properly closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...

    public KafkaPublisher&lt;String, byte[]&gt; kafkaPublisher(String topic,
                                                         ProducerFactory&lt;String, byte[]&gt; producerFactory,
                                                         KafkaMessageConverter&lt;String, byte[]&gt; kafkaMessageConverter,
                                                         int publisherAckTimeout) {
        return KafkaPublisher.&lt;String, byte[]&gt;builder()
                .topicResolver(m -&gt; Optional.of(topic))     // Defaults to "Axon.Events" for all events
                .producerFactory(producerFactory)           // Hard requirement
                .messageConverter(kafkaMessageConverter)    // Defaults to a "DefaultKafkaMessageConverter"
                .publisherAckTimeout(publisherAckTimeout)   // Defaults to "1000" milliseconds; only used for "WAIT_FOR_ACK" mode
                .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, we need to provide Axon&#8217;s event messages to the <code>KafkaPublisher</code>.
To that end a <code>KafkaEventPublisher</code> should be instantiated through the builder pattern.
Remember to add the <code>KafkaEventPublisher</code> to an event processor implementation of your choice.
It is recommended to use the <code>KafkaEventPublisher#DEFAULT_PROCESSING_GROUP</code> as the processing group name of the event processor to distinguish it from other event processors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventPublicationConfiguration {
    // ...
    public KafkaEventPublisher&lt;String, byte[]&gt; kafkaEventPublisher(KafkaPublisher&lt;String, byte[]&gt; kafkaPublisher) {
        return KafkaEventPublisher.&lt;String, byte[]&gt;builder()
                .kafkaPublisher(kafkaPublisher)             // Hard requirement
                .build();
    }

    public void registerPublisherToEventProcessor(EventProcessingConfigurer eventProcessingConfigurer,
                                                  KafkaEventPublisher&lt;String, byte[]&gt; kafkaEventPublisher) {
        String processingGroup = KafkaEventPublisher.DEFAULT_PROCESSING_GROUP;
        eventProcessingConfigurer.registerEventHandler(configuration -&gt; kafkaEventPublisher)
                                 .assignHandlerTypesMatching(
                                         processingGroup,
                                         clazz -&gt; clazz.isAssignableFrom(KafkaEventPublisher.class)
                                 )
                                 .registerSubscribingEventProcessor(processingGroup);
        // Replace `registerSubscribingEventProcessor` for `registerTrackingEventProcessor` to use a tracking processor
    }
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_topic_partition_publication_considerations"><a class="anchor" href="#_topic_partition_publication_considerations"></a>Topic partition publication considerations</h3>
<div class="paragraph">
<p>Kafka ensures message ordering on a topic-partition level, not on an entire topic.
To control events of a certain group to be placed in a dedicated partition, based on aggregate identifier for example, the <a href="kafka.md#customizing-event-message-format">message converter&#8217;s</a> <code>SequencingPolicy</code> can be utilized.</p>
</div>
<div class="paragraph">
<p>The topic-partition pair events have been published in also has impact on event consumption.
This extension mitigates any ordering concerns with the <a href="kafka.md#consuming-events-with-a-streamable-message-source">streamable</a> solution, by ensuring a <code>Consumer</code> always receives <strong>all</strong> events of a topic to be able to perform a complete ordering.
This guarantee is however not given when using the <a href="kafka.md#consuming-events-with-a-subscribable-message-source">subscribable</a> event consumption approach.
The subscribable stream leaves all the ordering specifics in the hands of Kafka, which means the events should be published on a consistent partition to ensure ordering.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consuming_events_from_kafka"><a class="anchor" href="#_consuming_events_from_kafka"></a>Consuming Events from Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Event messages in an Axon application can be consumed through either a Subscribing or a Tracking <a href="../axon-framework/events/event-processors/README.html" class="xref page">Event Processor</a>.
Both options are maintained when it comes to consuming events from a Kafka topic, which from a set-up perspective translates to a <a href="kafka.md#consuming-events-with-a-subscribable-message-source">SubscribableMessageSource</a> or a <a href="kafka.md#consuming-events-with-a-streamable-message-source">StreamableKafkaMessageSource</a> respectively, Both will be described in more detail later on, as we first shed light on the general requirements for event consumption in Axon through Kafka.</p>
</div>
<div class="paragraph">
<p>Both approaches use a similar mechanism to poll events with a Kafka <code>Consumer</code>, which breaks down to a combination of a <code>ConsumerFactory</code> and a <code>Fetcher</code>.
The extension provides a <code>DefaultConsumerFactory</code>, whose sole requirement is a <code>Map</code> of configuration properties.
The <code>Map</code> contains the settings to use for the Kafka <code>Consumer</code> client, such as the Kafka instance locations.
Please check the Kafka <a href="https://kafka.apache.org/">documentation</a> for the possible settings and their values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventConsumptionConfiguration {
    // ...
    public ConsumerFactory&lt;String, byte[]&gt; consumerFactory(Map&lt;String, Object&gt; consumerConfiguration) {
        return new DefaultConsumerFactory&lt;&gt;(consumerConfiguration);
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is the <code>Fetcher</code> instance&#8217;s job to retrieve the actual messages from Kafka by directing a <code>Consumer</code> instance it receives from the message source.
You can draft up your own implementation or use the provided <code>AsyncFetcher</code> to this end.
The <code>AsyncFetcher</code> doesn&#8217;t need to be explicitly started, as it will react on the message source starting it.
It does need to be shut down, to ensure any thread pool or active connections are properly closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventConsumptionConfiguration {
    // ...
    public Fetcher&lt;?, ?, ?&gt; fetcher(long timeoutMillis,
                                    ExecutorService executorService) {
        return AsyncFetcher.builder()
                           .pollTimeout(timeoutMillis)          // Defaults to "5000" milliseconds
                           .executorService(executorService)    // Defaults to a cached thread pool executor
                           .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_consuming_events_with_a_subscribable_message_source"><a class="anchor" href="#_consuming_events_with_a_subscribable_message_source"></a>Consuming Events with a Subscribable Message Source</h3>
<div class="paragraph">
<p>Using the <code>SubscribableKafkaMessageSource</code> means you are inclined to use a <code>SubscribingEventProcessor</code> to consume the events in your event handlers.</p>
</div>
<div class="paragraph">
<p>When using this source, Kafka&#8217;s idea of pairing <code>Consumer</code> instances into "Consumer Groups" is used.
This is strengthened by making the <code>groupId</code> upon source construction a <em>hard requirement</em>.
To use a common <code>groupId</code> essentially means that the event-stream-workload can be shared on Kafka&#8217;s terms, whereas a <code>SubscribingEventProcessor</code> typically works on its own accord regardless of the number of instances.
The workload sharing can be achieved by having several application instances with the same <code>groupId</code> or by adjusting the consumer count through the <code>SubscribableKafkaMessageSource</code>'s builder.
The same benefit holds for <a href="../axon-framework/events/event-processors/streaming.md#replaying-events">resetting</a> an event stream, which in Axon is reserved to the <code>TrackingEventProcessor</code>, but is now opened up through Kafka&#8217;s own API&#8217;s.</p>
</div>
<div class="paragraph">
<p>Although the <code>SubscribableKafkaMessageSource</code> thus provides the niceties the tracking event processor normally provides, it does come with two catches:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Axon&#8217;s approach of the <code>SequencingPolicy</code> to deduce which thread receives which events is entirely lost.</p>
<div class="paragraph">
<p>It is thus dependent on which topic-partition pairs are given to a <code>Consumer</code> for the events your handlers receives.</p>
</div>
<div class="paragraph">
<p>From a usage perspective this means event message ordering is no longer guaranteed by Axon.</p>
</div>
<div class="paragraph">
<p>It is thus the user&#8217;s job to ensure events are published in the right topic-partition pair.</p>
</div>
</li>
<li>
<p>The API Axon provides for resets is entirely lost,</p>
<div class="paragraph">
<p>since this API can only be correctly triggered through the <code>TrackingEventProcessor#resetTokens</code> operation</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Due to the above it is recommended the user is knowledgeable about Kafka&#8217;s specifics on message consumption.</p>
</div>
<div class="paragraph">
<p>When it comes to configuring a <code>SubscribableKafkaMessageSource</code> as a message source for a <code>SubscribingEventProcessor</code>, there is one additional requirement beside source creation and registration.
The source should only start with polling for events as soon as all interested subscribing event processors have been subscribed to it.
To ensure the <code>SubscribableKafkaMessageSource#start()</code> operation is called at the right point in the configuration lifecycle, the <code>KafkaMessageSourceConfigurer</code> should be utilized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventConsumptionConfiguration {
    // ...
    public KafkaMessageSourceConfigurer kafkaMessageSourceConfigurer(Configurer configurer) {
        KafkaMessageSourceConfigurer kafkaMessageSourceConfigurer = new KafkaMessageSourceConfigurer();
        configurer.registerModule(kafkaMessageSourceConfigurer);
        return kafkaMessageSourceConfigurer;
    }

    public SubscribableKafkaMessageSource&lt;String, byte[]&gt; subscribableKafkaMessageSource(List&lt;String&gt; topics,
                                                                                         String groupId,
                                                                                         ConsumerFactory&lt;String, byte[]&gt; consumerFactory,
                                                                                         Fetcher&lt;String, byte[], EventMessage&lt;?&gt;&gt; fetcher,
                                                                                         KafkaMessageConverter&lt;String, byte[]&gt; messageConverter,
                                                                                         int consumerCount,
                                                                                         KafkaMessageSourceConfigurer kafkaMessageSourceConfigurer) {
        SubscribableKafkaMessageSource&lt;String, byte[]&gt; subscribableKafkaMessageSource = SubscribableKafkaMessageSource.&lt;String, byte[]&gt;builder()
                .topics(topics)                     // Defaults to a collection of "Axon.Events"
                .groupId(groupId)                   // Hard requirement
                .consumerFactory(consumerFactory)   // Hard requirement
                .fetcher(fetcher)                   // Hard requirement
                .messageConverter(messageConverter) // Defaults to a "DefaultKafkaMessageConverter"
                .consumerCount(consumerCount)       // Defaults to a single Consumer
                .build();
        // Registering the source is required to tie into the Configurers lifecycle to start the source at the right stage
        kafkaMessageSourceConfigurer.registerSubscribableSource(configuration -&gt; subscribableKafkaMessageSource);
        return subscribableKafkaMessageSource;
    }

    public void configureSubscribableKafkaSource(EventProcessingConfigurer eventProcessingConfigurer,
                                                 String processorName,
                                                 SubscribableKafkaMessageSource&lt;String, byte[]&gt; subscribableKafkaMessageSource) {
        eventProcessingConfigurer.registerSubscribingEventProcessor(
                processorName,
                configuration -&gt; subscribableKafkaMessageSource
        );
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>KafkaMessageSourceConfigurer</code> is an Axon <code>ModuleConfiguration</code> which ties in to the start and end lifecycle of the application.
It should receive the <code>SubscribableKafkaMessageSource</code> as a source which should start and stop.
The <code>KafkaMessageSourceConfigurer</code> instance itself should be registered as a module to the main <code>Configurer</code>.</p>
</div>
<div class="paragraph">
<p>If only a single subscribing event processor will be subscribed to the kafka message source, <code>SubscribableKafkaMessageSource.Builder#autoStart()</code> can be toggled on.
This will start the <code>SubscribableKafkaMessageSource</code> upon the first subscription.</p>
</div>
</div>
<div class="sect2">
<h3 id="_consuming_events_with_a_streamable_message_source"><a class="anchor" href="#_consuming_events_with_a_streamable_message_source"></a>Consuming Events with a Streamable Message Source</h3>
<div class="paragraph">
<p>Using the <code>StreamableKafkaMessageSource</code> means you are inclined to use a <code>TrackingEventProcessor</code> to consume the events in your event handlers.</p>
</div>
<div class="paragraph">
<p>Whereas the <a href="kafka.md#consuming-events-with-a-subscribable-message-source">subscribable kafka message source</a> uses Kafka&#8217;s idea of sharing the workload through multiple <code>Consumer</code> instances in the same "Consumer Group", the streamable approach doesn&#8217;t use a consumer group, and assigns all available partitions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaEventConsumptionConfiguration {
    // ...
    public StreamableKafkaMessageSource&lt;String, byte[]&gt; streamableKafkaMessageSource(List&lt;String&gt; topics,
                                                                                     ConsumerFactory&lt;String, byte[]&gt; consumerFactory,
                                                                                     Fetcher&lt;String, byte[], KafkaEventMessage&gt; fetcher,
                                                                                     KafkaMessageConverter&lt;String, byte[]&gt; messageConverter,
                                                                                     int bufferCapacity) {
        return StreamableKafkaMessageSource.&lt;String, byte[]&gt;builder()
                .topics(topics)                                                 // Defaults to a collection of "Axon.Events"
                .consumerFactory(consumerFactory)                               // Hard requirement
                .fetcher(fetcher)                                               // Hard requirement
                .messageConverter(messageConverter)                             // Defaults to a "DefaultKafkaMessageConverter"
                .bufferFactory(
                        () -&gt; new SortedKafkaMessageBuffer&lt;&gt;(bufferCapacity))   // Defaults to a "SortedKafkaMessageBuffer" with a buffer capacity of "1000"
                .build();
    }

    public void configureStreamableKafkaSource(EventProcessingConfigurer eventProcessingConfigurer,
                                               String processorName,
                                               StreamableKafkaMessageSource&lt;String, byte[]&gt; streamableKafkaMessageSource) {
        eventProcessingConfigurer.registerTrackingEventProcessor(
                processorName,
                configuration -&gt; streamableKafkaMessageSource
        );
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that as with any tracking event processor, the progress on the event stream is stored in a <code>TrackingToken</code>.
Using the <code>StreamableKafkaMessageSource</code> means a <code>KafkaTrackingToken</code> containing topic-partition to offset pairs is stored in the <code>TokenStore</code>.
If no other <code>TokenStore</code> is provided, and auto-configuration is used, a <code>KafkaTokenStore</code> will be set instead of an <code>InMemoryTokenStore</code>.
The <code>KafkaTokenStore</code> by default uses the <code>__axon_token_store_updates</code> topic.
This should be a compacted topic, which should be created and configured automatically.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_event_message_format"><a class="anchor" href="#_customizing_event_message_format"></a>Customizing event message format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous sections the <code>KafkaMessageConverter&lt;K, V&gt;</code> has been shown as a requirement for event production and consumption.
The <code>K</code> is the format of the message&#8217;s key, where the <code>V</code> stand for the message&#8217;s value.
The extension provides a <code>DefaultKafkaMessageConverter</code> which converts an axon <code>EventMessage</code> to a Kafka <code>ProducerRecord</code>, and an <code>ConsumerRecord</code> back into an <code>EventMessage</code>.
This <code>DefaultKafkaMessageConverter</code> uses <code>String</code> as the key and <code>byte[]</code> as the value of the message to de-/serialize.</p>
</div>
<div class="paragraph">
<p>Albeit the default, this implementation allows for some customization, such as how the <code>EventMessage</code>'s <code>MetaData</code> is mapped to Kafka headers.
This is achieved by adjusting the "header value mapper" in the <code>DefaultKafkaMessageConverter</code>'s builder.</p>
</div>
<div class="paragraph">
<p>The <code>SequencingPolicy</code> can be adjusted to change the behaviour of the record key being used.
The default sequencing policy is the <code>SequentialPerAggregatePolicy</code>, which leads to the aggregate identifier of an event being the key of a <code>ProducerRecord</code> and <code>ConsumerRecord</code>.</p>
</div>
<div class="paragraph">
<p>The format of an event message defines an API between the producer and the consumer of the message.
This API may change over time, leading to incompatibility between the event class' structure on the receiving side and the event structure of a message containing the old format.
Axon addresses the topic of <a href="../axon-framework/events/event-versioning.html" class="xref page">Event Versioning</a> by introducing Event Upcasters.
The <code>DefaultKafkaMessageConverter</code> supports this by provisioning an <code>EventUpcasterChain</code> and run the upcasting process on the <code>MetaData</code> and <code>Payload</code> of individual messages converted from <code>ConsumerRecord</code> before those are passed to the <code>Serializer</code> and converted into <code>Event</code> instances.</p>
</div>
<div class="paragraph">
<p>Note that the <code>KafkaMessageConverter</code> feeds the upcasters with messages one-by-one, limiting it to one-to-one or one-to-many upcasting <strong>only</strong>.
Upcasters performing a many-to-one or many-to-many operation thus won&#8217;t be able to operate inside the extension (yet).</p>
</div>
<div class="paragraph">
<p>Lastly, the <code>Serializer</code> used by the converter can be adjusted.
See the <a href="../axon-framework/serialization.html" class="xref page">Serializer</a> section for more details on this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KafkaMessageConversationConfiguration {
    // ...
    public KafkaMessageConverter&lt;String, byte[]&gt; kafkaMessageConverter(Serializer serializer,
                                                                       SequencingPolicy&lt;? super EventMessage&lt;?&gt;&gt; sequencingPolicy,
                                                                       BiFunction&lt;String, Object, RecordHeader&gt; headerValueMapper,
                                                                       EventUpcasterChain upcasterChain) {
        return DefaultKafkaMessageConverter.builder()
                                           .serializer(serializer)                  // Hard requirement
                                           .sequencingPolicy(sequencingPolicy)      // Defaults to a "SequentialPerAggregatePolicy"
                                           .upcasterChain(upcasterChain)            // Defaults to empty upcaster chain
                                           .headerValueMapper(headerValueMapper)    // Defaults to "HeaderUtils#byteMapper()"
                                           .build();
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to use an identical <code>KafkaMessageConverter</code> on both the producing and consuming end, as otherwise exception upon deserialization should be expected.
A <code>CloudEventKafkaMessageConverter</code> is also available using the <a href="https://cloudevents.io/">Cloud Events</a> spec.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_in_spring_boot"><a class="anchor" href="#_configuration_in_spring_boot"></a>Configuration in Spring Boot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension can be added as a Spring Boot starter dependency to your project using group id <code>org.axonframework.extensions.kafka</code> and artifact id <code>axon-kafka-spring-boot-starter</code>.
When using the auto configuration, the following components will be created for you automatically:</p>
</div>
<div class="paragraph">
<p><strong>Generic Components:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>DefaultKafkaMessageConverter</code> using the configured <code>eventSerializer</code> (which defaults to <code>XStreamSerializer</code>), which is used by default to convert between Axon Event messages and Kafka records.</p>
<div class="paragraph">
<p>Uses a <code>String</code> for the keys and a <code>byte[]</code> for the record&#8217;s values.</p>
</div>
<div class="paragraph">
<p>When the property <code>axon.kafka.message-converter-mode</code> is set to <code>cloud_event</code> a <code>CloudEventKafkaMessageConverter</code> will be used instead.
This will use <code>String</code> for the keys and <code>CloudEvent</code>.</p>
</div>
<div class="paragraph">
<p>For each the matching Kafka (de)serializers will also be set as default.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Producer Components:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>DefaultProducerFactory</code> using a <code>String</code> for the keys and a <code>byte[]</code> for the record&#8217;s values.</p>
<div class="paragraph">
<p>This creates a <code>ProducerFactory</code> in confirmation mode "NONE", as is specified <a href="kafka.md#publishing-events-to-kafka">here</a>.</p>
</div>
<div class="paragraph">
<p>The <code>axon.kafka.publisher.confirmation-mode</code> should be adjusted to change this mode,</p>
</div>
<div class="paragraph">
<p>where the "TRANSACTIONAL" mode requires <code>axon.kafka.producer.transaction-id-prefix</code> property to be provided.</p>
</div>
<div class="paragraph">
<p>If the <code>axon.kafka.producer.transaction-id-prefix</code> is non-null and non-empty,</p>
</div>
<div class="paragraph">
<p>it is assumed a "TRANSACTIONAL" confirmation mode is desired</p>
</div>
</li>
<li>
<p>A <code>KafkaPublisher</code>.</p>
<div class="paragraph">
<p>Uses a <code>Producer</code> instance from the <code>ProducerFactory</code> to publish events to the configured Kafka topic.</p>
</div>
</li>
<li>
<p>A <code>KafkaEventPublisher</code>.
Used to provide events to the <code>KafkaPublisher</code> and to assign a processor name</p>
<div class="paragraph">
<p>and processing group called <code>__axon-kafka-event-publishing-group</code> to it.
Defaults to a <code>SubscribingEventProcessor</code>.</p>
</div>
<div class="paragraph">
<p>If a <code>TrackingEventProcessor</code> is desired, the <code>axon.kafka.producer.event-processor-mode</code> should be set to <code>tracking</code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Consumer Components:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>DefaultConsumerFactory</code> using a <code>String</code> for the keys and a <code>byte[]</code> for the record&#8217;s values</p>
</li>
<li>
<p>An <code>AsyncFetcher</code>.
To adjust the <code>Fetcher</code>'s poll timeout, the <code>axon.kafka.fetcher.poll-timeout</code> can be set.</p>
</li>
<li>
<p>A <code>StreamableKafkaMessageSource</code> which can be used for <code>TrackingEventProcessor</code> instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the Spring Boot auto configuration be mindful to provide an <code>application.properties</code> file.
The Kafka extension configuration specifics should be placed under prefix <code>axon.kafka</code>.
On this level, the <code>bootstrapServers</code> (defaults to <code>localhost:9092</code>) and <code>default-topic</code> used by the producing and consuming side can be defined.</p>
</div>
<div class="paragraph">
<p>The <code>DefaultProducerFactory</code> and <code>DefaultConsumerFactory</code> expects a <code>Map</code> of configuration properties, which correspond to Kafka <code>Producer</code> and <code>Consumer</code> specific properties respectively.
As such, Axon itself passes along these properties without using them directly itself.
The <code>application.properties</code> file provides a number of named properties under the <code>axon.kafka.producer.</code> and <code>axon.kafka.consumer.</code> prefixes.
If the property you are looking for is not predefined in Axon <code>KafkaProperties</code> file, you are always able to introduce properties in a map style.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># This is a sample properties file to configure the Kafka Extension
axon:
  kafka:
    bootstrap-servers: localhost:9092
    client-id: kafka-axon-example
    default-topic: local.event
    properties:
      security.protocol: PLAINTEXT

    publisher:
      confirmation-mode: transactional

    producer:
      transaction-id-prefix: kafka-sample
      retries: 0
      event-processor-mode: subscribing
      # For additional unnamed properties, add them to the `properties` map like so
      properties:
        some-key: [some-value]

    fetcher:
      poll-timeout: 3000

    consumer:
      enable-auto-commit: true
      auto-commit-interval: 3000
      event-processor-mode: tracking
      # For additional unnamed properties, add them to the `properties` map like so
      properties:
        some-key: [some-value]</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Auto configuring a <code>SubscribableKafkaMessageSource</code></strong></p>
</div>
<div class="paragraph">
<p>The auto configured <code>StreamableKafkaMessageSource</code> can be toggled off by setting the <code>axon.kafka.consumer.event-processing-mode</code> to <code>subscribing</code>.</p>
</div>
<div class="paragraph">
<p>Note that this <strong>does not</strong> create a <code>SubscribableKafkaMessageSource</code> for you out of the box.
To set up a subscribable message, we recommend to read <a href="kafka.md#consuming-events-with-a-subscribable-message-source">this</a> section.</p>
</div>
</blockquote>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="jgroups.html">JGroups</a></span>
  <span class="next"><a href="kotlin.html">Kotlin</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="primary-footer">
    <div class="footer-logo ">
      <a href="https://axoniq.io/">
        <img src="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png" alt="Logo AxonIQ" loading="lazy" srcset="https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=45&amp;height=10&amp;name=Logo%20AxonIQ%20(2).png 45w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=90&amp;height=20&amp;name=Logo%20AxonIQ%20(2).png 90w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=135&amp;height=30&amp;name=Logo%20AxonIQ%20(2).png 135w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=180&amp;height=40&amp;name=Logo%20AxonIQ%20(2).png 180w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=225&amp;height=50&amp;name=Logo%20AxonIQ%20(2).png 225w, https://www.axoniq.io/hs-fs/hubfs/Logo%20AxonIQ%20(2).png?width=270&amp;height=60&amp;name=Logo%20AxonIQ%20(2).png 270w" sizes="(max-width: 90px) 100vw, 90px" width="90" height="20">
      </a>
    </div>

    <div class="footer-menu">
	    <h3>Products</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-framework/overview">Axon Framework</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server/overview">Axon Server Standard</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-server-enterprise/overview">Axon Server Enterprise</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axoniq-cloud/overview">AxonIQ Cloud</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/axon-data-protection/overview">AxonIQ Data Protection</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Sites</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="http://support.axoniq.io/"> Client Support Portal</a></li>
          <li><a class="ext" target="_blank" href="https://developer.axoniq.io/">AxonIQ Developer Portal</a></li>
          <li><a class="ext" target="_blank" href="https://academy.axoniq.io/">AxonIQ Academy</a></li>
          <li><a class="ext" target="_blank" href="https://discuss.axoniq.io/">AxonIQ Discuss</a></li>
          <li><a class="ext" target="_blank" href="https://start.axoniq.io/">AxonIQ Initializr</a></li>
          <li><a class="ext" target="_blank" href="https://console.cloud.axoniq.io">AxonIQ Cloud</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-menu">
	    <h3>Follow us</h3>
	    <div>
        <ul role="menu">
          <li><a class="ext" target="_blank" href="https://www.youtube.com/axoniq">YouTube</a></li>
          <li><a class="ext" target="_blank" href="https://www.linkedin.com/company/axoniq">LinkedIn</a></li>
          <li><a class="ext" target="_blank" href="https://www.facebook.com/AxonIQ.io">Facebook</a></li>
          <li><a class="ext" target="_blank" href="https://twitter.com/axon_iq">Twitter</a></li>
          <li><a class="ext" target="_blank" href="https://github.com/AxonIQ">GitHub</a></li>
          <li><a class="ext" target="_blank" href="https://medium.com/axoniq">Medium</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
